#!/bin/sh

if [ "$1" == "--help" ]; then
	echo "missing xorg packages"
	exit 1
fi
if [ ! -d ../_darcs -o ! -d ../source ]; then
	echo "hey, where are you?"
	exit 1
fi

cd ..

upstream=`mktemp`
fw=`mktemp`

for i in app data doc driver font lib proto testdir util xserver
do
	lynx -dump http://xorg.freedesktop.org/releases/individual/$i/|grep bz2$|sed 's|.*/\(.*\)-.*|\1|'
done |sort -u |tr [A-Z] [a-z]>$upstream
ls source/x11|sed 's|/$||' >$fw
# xf86-video-impact is mips-only :)
# blacklisting compiz requested by Alex
# xf86-video-wsfb is for *bsd
diff -u $upstream $fw|grep ^-[^-] |grep -v '\(xf86-video-impact\|compiz\|xf86-video-wsfb\)'|sed 's/^-//'
rm -f $upstream $fw
