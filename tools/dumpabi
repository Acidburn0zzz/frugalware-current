#!/bin/sh

if [ -z "$1" ]; then
	echo "Usage: $0 <fpm>"
	exit 1
fi

export LC_ALL=C
DIR="$(mktemp -td)"
if [ "$1" == "$(basename $1)" ]; then
	FPM="$(pwd)/$1"
else
	FPM="$1"
fi
IFS=$'\n'

cd "$DIR"

tar -xf "$FPM"

chmod -R 0777 .

for i in $(find . -type f | file -f - | sed -rn 's|([^:]+):.*ELF.*|\1|p'); do
	for j in $(objdump -p "$i" | sed -rn 's|\s*NEEDED\s*(\S+)\s*|\1|p'); do
		echo "${i/.\//}: $j"
	done
done

rm -rf "$DIR"
