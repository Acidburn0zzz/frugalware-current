#!/bin/bash

drpull()
{
	[ -d $1 ] || mkdir $1
	cd $1

	rsync -a --delete-after $server/$1/_darcs ./

	darcsdir="_darcs/pristine"
	if [ ! -d $darcsdir ]; then
		darcsdir="_darcs/current"
	fi

	rsync -a --delete-after --exclude "_darcs" $darcsdir/ ./
	cd - >/dev/null
}

server="rsync://rsync.frugalware.org/pub/other/homepage-ng/darcs/repos/"

cd `dirname $0`/../repos
for i in `rsync $server|sed 's/.* \([^ ]\)/\1/;1 d'`
do
	[ "$1" == "-v" ] && echo $i
	[ -e $i/_darcs/lock ] && continue
	drpull $i
done
