#!/bin/bash

# (c) 2004-2006 Miklos Vajna <vmiklos@frugalware.org>
# genpkgdbs for Frugalware
# distributed under GPL License

archs=('i686' 'x86_64' 'ppc')

cd `dirname $0`/..

# Changelog
echo -n "generating ChangeLog.txt..."
darcs changes --from-tag "0.4$" >ChangeLog.txt
echo " done"

# AUTHORS
echo -n "generating AUTHORS..."
genauthors docs/xml/authors.xml >AUTHORS
echo " done"

# Filelist.txt
echo -n "generating Filelist.txt..."
echo -e "Last Modified: `LANG= LC_ALL= date`\n\nFrugalware Source Tree">Filelist.txt
tree|grep -v ^\.$>>Filelist.txt
echo " done"

# .fdb
for i in "${archs[@]}"
do
	arch=$i gensync source/ frugalware-$i/frugalware-current.fdb
done

# fixing permsissions
echo -n "fixing permissions..."
cd - >/dev/null
./fixperms
echo " done"

# testsuite

cd ../testsuite
sh srcjunk.sh --remove .. >/dev/null 2>&1
