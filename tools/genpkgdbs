#!/bin/bash

# (c) 2004-2007 Miklos Vajna <vmiklos@frugalware.org>,
#               CSÉCSY László <boobaa@frugalware.org>
# genpkgdbs for Frugalware
# distributed under GPL License

# this script is invoked by cron daily

cd `dirname $0`/..

# Changelog
echo -n "generating ChangeLog.txt..."
darcs changes --from-tag "0.6$" | iconv -c -f iso8859-2 -t utf8 >ChangeLog.txt
echo " done"

# AUTHORS
echo -n "generating AUTHORS..."
genauthors docs/xml/authors.xml >AUTHORS
echo " done"

# Filelist.txt
echo -n "generating Filelist.txt..."
echo -e "Last Modified: `LANG= LC_ALL= date`\n\nFrugalware Source Tree">Filelist.txt
tree|grep -v ^\.$>>Filelist.txt
echo " done"

# fixing permsissions
echo -n "fixing permissions..."
cd tools
./fixperms
echo " done"

# documentation

cd ../docs
make clean
make all 2>&1 |tee build.log
make -i all-i18n 2>&1 |tee build-i18n.log

# testsuite

cd ../t
./srcjunk --remove >/dev/null 2>&1
./fpmjunk-i686 --remove >/dev/null 2>&1
./fpmjunk-x86_64 --remove >/dev/null 2>&1
sh mailer.sh

# autotag

cd ..
sh tools/tagger.sh .
