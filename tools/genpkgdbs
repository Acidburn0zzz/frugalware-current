#!/bin/bash

# (c) 2004-2005 Vajna Miklos <vmiklos@frugalware.org>
# genpkgdbs for Frugalware
# distributed under GPL License

archs=('i686' 'x86_64' 'ppc')

# Changelog
echo -n "generating ChangeLog.txt..."
(cd .. && darcs changes --from-tag "0.4$" >ChangeLog.txt)
echo " done"

# AUTHORS
echo -n "generating AUTHORS..."
(cd .. && genauthors docs/xml/authors.xml >AUTHORS)
echo " done"

# Filelist.txt
echo -n "generating Filelist.txt..."
( cd ..
  echo -e "Last Modified: `LANG= LC_ALL= date`\n\nFrugalware Source Tree">Filelist.txt
  tree|grep -v ^\.$>>Filelist.txt )
echo " done"

# .fdbs
( cd ../
for i in "${archs[@]}"
do
	arch=$i gensync source/ frugalware-$i/frugalware-current.fdb
done )
( cd ../extra
# temporarily workaround
for i in i686 x86_64
do
	arch=$i gensync source/ frugalware-$i/extra-current.fdb
done )

# fixing permsissions
echo -n "fixing permissions..."
./fixperms
echo " done"
