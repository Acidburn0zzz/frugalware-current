#!/bin/bash

version=current
target=../frugalware-$version-iso/
date=`date -r ../Packages.lst +%Y%m%d 2>/dev/null`

base=('base' 'apps' 'lib' 'multimedia' 'network')
for i in "${base[@]}"
do
baselst=$baselst`grep ^$i/ ../Packages.lst |sed "s|$i| -x ./frugalware|"`
done

x11=('x11' 'xlib' 'xapps' 'gnome' 'kde' 'devel')
for i in "${x11[@]}"
do
x11lst=$x11lst`grep ^$i/ ../Packages.lst |sed "s|$i| -x ./frugalware|"`
done

cd ..

# CD1: base system
mkisofs -o frugalware-$version-cd1.iso \
	-R -J -V "Frugalware Install" \
	-A "Frugalware Install CD 1" \
	-x ./source \
	-x ./extra \
	-x ./pasture \
	$x11lst \
	-hide-rr-moved \
	-b boot/grub/stage2_eltorito \
	-v -d -N -no-emul-boot -boot-load-size 4 -boot-info-table . || exit 1
ln -s frugalware-$version-cd1.iso frugalware-$date-cd1.iso
mv frugalware-$version-cd1.iso frugalware-$date-cd1.iso $target
# exit 0

# CD2: x11 system
mkisofs -o frugalware-$version-cd2.iso \
	-R -J -V "Frugalware Install" \
	-A "Frugalware Install CD 2" \
	-x ./source \
	-x ./extra \
	$baselst \
	-hide-rr-moved \
	-b boot/grub/stage2_eltorito \
	-v -d -N -no-emul-boot -boot-load-size 4 -boot-info-table . || exit 1
ln -s frugalware-$version-cd2.iso frugalware-$date-cd2.iso
mv frugalware-$version-cd2.iso frugalware-$date-cd2.iso $target
# exit 0

# CD3: extra repo
mkisofs -o frugalware-$version-cd3.iso \
	-R -J -V "Frugalware Install" \
	-A "Frugalware Install CD 3" \
	-x ./frugalware \
	-x ./source \
	-x ./extra/source \
	-hide-rr-moved \
	-b boot/grub/stage2_eltorito \
	-v -d -N -no-emul-boot -boot-load-size 4 -boot-info-table . || exit 1
ln -s frugalware-$version-cd3.iso frugalware-$date-cd3.iso
mv frugalware-$version-cd3.iso frugalware-$date-cd3.iso $target
# exit 0

# DVD: full tree with sources
mkisofs -o frugalware-$version-dvd.iso \
	-R -J -V "Frugalware Install" \
	-A "Frugalware Install DVD" \
	-hide-rr-moved \
	-b boot/grub/stage2_eltorito \
	-v -d -N -no-emul-boot -boot-load-size 4 -boot-info-table . || exit 1
ln -s frugalware-$version-dvd.iso frugalware-$date-dvd.iso
mv frugalware-$version-dvd.iso frugalware-$date-dvd.iso $target
