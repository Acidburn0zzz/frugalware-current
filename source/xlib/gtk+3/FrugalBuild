# Compiling time: 6.25 SBU
# Maintainer: Baste <baste@frugalware.org>
# Contributor: bouleetbil <bouleetbil@frogdev.info>


## TODO: split cups and whever other optional stuff

pkgname=gtk+3
_F_gnome_name=gtk+
pkgver=3.18.6
pkgrel=2
pkgdesc="The GTK+ Toolkit (3.x series)"
depends=('gdk-pixbuf2>=2.32.3-2' 'pango>=1.38.1-2' 'libxcursor>=1.1.14-2' 'libxcomposite>=0.4.4-2' 'libxkbcommon>=0.5.0-3' 'libwayland-egl>=11.1.0-2' \
	'libepoxy>=1.3.1-3' 'at-spi2-atk' 'colord>=1.2.12-5' 'libcups>=2.1.2-2' 'libpng>=1.6.20' 'libffi>=3.2.1')
makedepends=('gobject-introspection>=1.46.0-2' 'gtk-doc>=1.24' 'cups>=2.1.2-2' 'json-glib>=1.0.4-2' 'shared-mime-info')
rodepends=('gtk+3-tools' 'gtk-update-icon-cache' 'adwaita-icon-theme' 'shared-mime-info')
groups=('xlib')

archs=('i686' 'x86_64' 'arm')
_F_gnome_glib="y"
_F_gnome_iconcache="y"
_F_gnome_ext=".tar.xz"
_F_gnome_devel="n"
_F_gnome_immodules="y"
_F_gnome_doc="y"
Finclude gnome gnome-scriptlet
url="http://www.gtk.org/"
_F_cd_path="gtk+-$pkgver"
source=($source settings.ini)
sha1sums=('e7dd8a397031316c57b845bc76744ed5886385b1' \
          '92c3120655ba14f163846a22d5c94fa50b0eb437')
backup=(/usr/share/gtk-3.0/settings.ini)

if [ "$_F_gnome_git" != "n" ]; then
	unset sha1sums
	source=($source im-cedilla.conf)
fi

subpkgs=("${subpkgs[@]}" "$pkgname-tools")
subdescs=("${subdescs[@]}" "GTK+3 commandline tools.")
subdepends=("${subdepends[@]}" "glib2>=2.46.2-3 pango>=1.38.1-2 libffi>=3.2.1")
subrodepends=("${subrodepends[@]}" "$pkgname>=$pkgver")
subgroups=("${subgroups[@]}" 'xapps')
subarchs=("${subarchs[@]}" 'i686 x86_64 arm')
subreplaces=("${subreplaces[@]}" '')
subprovides=("${subprovides[@]}" '')
subconflicts=("${subconflicts[@]}" '')

subpkgs=("${subpkgs[@]}" "gtk-update-icon-cache")
subdescs=("${subdescs[@]}" "The GTK+ update icon cache tool.")
subdepends=("${subdepends[@]}" "gdk-pixbuf2>=2.32.3-2 pango>=1.38.1-2 libffi>=3.2.1")
subrodepends=("${subrodepends[@]}" "")
subgroups=("${subgroups[@]}" 'xapps')
subarchs=("${subarchs[@]}" 'i686 x86_64 arm')
subreplaces=("${subreplaces[@]}" 'gtk+2-tools')
subprovides=("${subprovides[@]}" '')
subconflicts=("${subconflicts[@]}" '')

subpkgs=("${subpkgs[@]}" "$pkgname-immodules")
subdescs=("${subdescs[@]}" "Input methods for GTK3+.")
subdepends=("${subdepends[@]}" "glib2>=2.46.2-3 pango>=1.38.1-2 libffi>=3.2.1")
subrodepends=("${subrodepends[@]}" "$pkgname>=$pkgver")
subgroups=("${subgroups[@]}" 'xlib')
subarchs=("${subarchs[@]}" 'i686 x86_64 arm')
subreplaces=("${subreplaces[@]}" 'immodules')
subprovides=("${subprovides[@]}" 'immodules')
subconflicts=("${subconflicts[@]}" 'immodules')

subpkgs=("${subpkgs[@]}" "$pkgname-immodules-xim")
subdescs=("${subdescs[@]}" "The gtk3-immodule-xim package contains XIM support for GTK+ 3.")
subdepends=("${subdepends[@]}" "glib2>=2.46.2-3 pango>=1.38.1-2 libffi>=3.2.1")
subrodepends=("${subrodepends[@]}" "$pkgname>=$pkgver")
subgroups=("${subgroups[@]}" 'xlib')
subarchs=("${subarchs[@]}" 'i686 x86_64 arm')
subreplaces=("${subreplaces[@]}" 'immodules-xim')
subprovides=("${subprovides[@]}" 'immodules-xim')
subconflicts=("${subconflicts[@]}" 'immodules-xim')

subpkgs=("${subpkgs[@]}" "$pkgname-demos")
subdescs=("${subdescs[@]}" "GTK+3 Demos.")
subdepends=("${subdepends[@]}" "gdk-pixbuf2>=2.32.3-2 pango>=1.38.1-2 libffi>=3.2.1 libepoxy>=1.3.1-3")
subrodepends=("${subrodepends[@]}" "$pkgname>=$pkgver")
subgroups=("${subgroups[@]}" 'xapps-extra')
subarchs=("${subarchs[@]}" 'i686 x86_64 arm')
subreplaces=("${subreplaces[@]}" '')
subprovides=("${subprovides[@]}" '')
subconflicts=("${subconflicts[@]}" '')

build() {


	if [ "$_F_gnome_git" != "n" ]; then
		Funpack_scm
		Fcd $pkgname
		sh ./autogen.sh || Fdie
	else

		Fbuild \
			--prefix=/usr \
			--sysconfdir=/etc \
			--localstatedir=/var \
			--disable-schemas-compile \
			--enable-x11-backend \
			--enable-broadway-backend \
			--enable-wayland-backend
			##--enable-debug=yes
	fi


	# gtk-update-icon-cache
	Fsplit gtk-update-icon-cache usr/bin/gtk-update-icon-cache
	Fsplit gtk-update-icon-cache usr/share/man/man1/gtk-update-icon-cache*

        Fsplit $pkgname-tools usr/bin/gtk-query-immodules-3.0
	Fsplit $pkgname-tools usr/share/man

	## -demos
	Fsplit $pkgname-demos usr/bin/*-demo*

	Fsplit $pkgname-immodules-xim usr/lib/gtk-3.0/3.0.0/immodules/im-xim.so
	touch $Fdestdir/usr/lib/gtk-3.0/3.0.0/immodules.cache
	Fsplit $pkgname-immodules usr/lib/gtk-3.0/3.0.0/immodules

	Fcp settings.ini usr/share/gtk-3.0/settings.ini || Fdie

	Fbuild_gnome_scriptlet
}

# optimization OK
