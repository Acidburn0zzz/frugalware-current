# Compiling Time: 0.06 SBU
# Maintainer: DeX77 <dex77@frugalware.org>
# Contributor: Devil505 <devil505linux@gmail.com>


pkgname=libdbusmenu
pkgver=12.10.2
pkgrel=3
pkgdesc="A small little library that was created by pulling out some common code out of indicator-applet."
depends=('json-glib>=1.0.4-3')
makedepends=('intltool' 'gobject-introspection>=1.46.0-2' 'vala>=0.30.0-3' \
	'gtk+2>=2.24.29-2' 'gtk+3>=3.18.6-2' 'x11-protos' 'gnome-doc-utils')
options=('scriptlet')
groups=('xlib')
archs=('i686' 'x86_64')
_F_launchpad_dirname="dbusmenu"
_F_launchpad_branch="12.10"
Finclude launchpad
Fconfopts+="--disable-static --enable-introspection=yes --disable-tests --disable-dumper --disable-scrollkeeper"
sha1sums=('067b77564f90633aa58494e54b99d733a21f3142')

subpkgs+=("$pkgname-gtk2")
subdescs+=("GTK2 bindings for libdbusmenu")
subdepends+=("gdk-pixbuf2>=2.32.3-2 gtk+2>=2.24.29-2 libffi>=3.2.1")
subrodepends+=("$pkgname")
subgroups+=('xlib')
subarchs+=('i686 x86_64')
subprovides+=("${subprovides[@]}" 'libdbusmenu-gtk')
subconflicts+=("${subconflicts[@]}" 'libdbusmenu-gtk')
subreplaces+=("${subreplaces[@]}" 'libdbusmenu-gtk')

subpkgs+=("$pkgname-gtk3")
subdescs+=("GTK3 bindings for libdbusmenu")
subdepends+=("gdk-pixbuf2>=2.32.3-2 gtk+3>=3.18.6-2 libffi>=3.2.1")
subrodepends+=("$pkgname")
subgroups+=('xlib')
subarchs+=('i686 x86_64')
subprovides+=('')
subconflicts+=('')
subreplaces+=('')

build()	{
	export HAVE_VALGRIND_TRUE='#'
	export HAVE_VALGRIND_FALSE=''

	Fmake --with-gtk=2
	Fmakeinstall
        Fsplit $pkgname-gtk2 usr/include/libdbusmenu-gtk-*/
        Fsplit $pkgname-gtk2 usr/lib/libdbusmenu-gtk.*
        Fsplit $pkgname-gtk2 usr/lib/pkgconfig/dbusmenu-gtk-*.pc
        Fsplit $pkgname-gtk2 usr/share/gir-1.0/DbusmenuGtk-*.gir
        Fsplit $pkgname-gtk2 usr/share/vala/vapi/DbusmenuGtk-*.vapi

	make clean || Fdie

        Fmake --with-gtk=3
	Fmakeinstall

	Fsplit $pkgname-gtk3 usr/include/libdbusmenu-gtk3-*/
	Fsplit $pkgname-gtk3 usr/lib/libdbusmenu-gtk3.*
	Fsplit $pkgname-gtk3 usr/lib/pkgconfig/dbusmenu-gtk3-*.pc
	Fsplit $pkgname-gtk3 usr/share/gir-1.0/DbusmenuGtk3-*.gir
	Fsplit $pkgname-gtk3 usr/share/vala/vapi/DbusmenuGtk3-*.vapi
}

# optimization OK
