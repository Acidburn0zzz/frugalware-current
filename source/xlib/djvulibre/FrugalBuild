# Compiling Time: 1.43 SBU
# Maintainer: crazy <crazy@frugalware.org>

pkgname=djvulibre
pkgver=3.5.19
pkgrel=2
pkgdesc="DjVu is a web-centric format for distributing documents and images."
depends=('libtiff' 'libjpeg')
makedepends=('kdelibs' 'gnome-mime-data' 'gnome-icon-theme' 'htop' 'xdg-utils')
rodepends=('xdg-utils')
groups=('xlib')
archs=('i686' 'x86_64')
options=('scriptlet')
_F_sourceforge_dirname="djvu"
_F_sourceforge_broken_up2date=1
_F_sourceforge_mirror="mesh"
Finclude sourceforge
url="http://djvulibre.djvuzone.org/"
source=(${source[@]} head_-n1.patch fix-all-FLAGS.patch)

subpkgs=('djview')
subdescs=('DjVu viewer for qt and mozilla plugins.')
subdepends=('libxi libgl qt libxmu')
subrodepends=("$pkgname=$pkgver xdg-utils")
subgroups=('xapps-extra')
subarchs=('i686 x86_64')
subinstall=djview.install

build()
{
	Fcd
	Fpatchall
	Fautoreconf
	unset MAKEFLAGS
	export CFLAGS="$CFLAGS"
	export CXXFLAGS="$CXXFLAGS"
	Fconf \
		--enable-threads \
		--enable-desktopfiles \
		--enable-xmltools \
		--enable-djview
	make depend || Fdie
	make || Fdie
	Fmakeinstall
	Fln /usr/lib/netscape/plugins/nsdejavu.so \
		/usr/lib/mozilla/plugins/nsdejavu.so
	Fln djview3.1.gz usr/share/man/man1/djview.1

	Fsplit djview usr/bin/djview
	Fsplit djview usr/bin/djview3
	Fsplit djview usr/lib/mozilla
	Fsplit djview usr/lib/netscape
	for i in . ja; do
		[[ $i == . ]] && Fsplit djview usr/share/man/$i/man1/djview.1
		Fsplit djview usr/share/man/$i/man1/djview3.1
		Fsplit djview usr/share/man/$i/man1/nsdejavu.1
	done
	Fsplit djview usr/share/djvu/djview3
}

sha1sums=('439977e03c8c35ca74eb5887993edb317923133f'\
          'df699c98fae73de45fb68bc6a7fe12d30a5c87bf'\
          'd39c386e650c3c50b45bb5ec7fc3198c7d3a1eb1')
# optimization OK

