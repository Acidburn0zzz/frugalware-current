# Last Modified: Tue, 27 Dec 2005 20:38:20 +0100
# Compiling Time: ~3 minutes
# Maintainer: VMiklos <vmiklos@frugalware.org>

pkgname=tk
pkgver=8.4.12
shortpkgver=8.4
pkgrel=1
pkgdesc="A windowing toolkit for use with tcl"
depends=('tcl' 'x')
groups=('xlib')
archs=('i686' 'x86_64')
up2date="lynx -dump 'http://prdownloads.sourceforge.net/tcl/?sort_by=date&sort=desc'|grep 'tk[0-9\.]*-src.tar.gz$'|sed -n 's/.*tk\(.*\)-.*/\1/;1 p'"
source=(http://heanet.dl.sf.net/sourceforge/tcl/tk$pkgver-src.tar.gz \
	tk-8.4.12-bash31.diff)
sha1sums=('05e8a82fc4ab9f825b8e7b8cbc917ea9ba31ed5d' \
	  '248f72ca53550d062644f77f221833607008023f')

build() {
	Fcd tk$pkgver
	Fpatchall
	cd unix
	autoconf
	Fmake --enable-threads || return 1	
	make INSTALL_ROOT=$Fdestdir install || return 1
	Fmv /usr/bin/wish$shortpkgver /usr/bin/wish

	# headers
	Fmkdir /usr/include/tk/{generic,unix}
	cp ../unix/*.h $Fdestdir/usr/include/tk/unix
	cp ../generic/*.h $Fdestdir/usr/include/tk/generic

	sed -i \
	    -e "s,^TK_BUILD_LIB_SPEC='-L.*/unix,TK_BUILD_LIB_SPEC='-L/usr/lib," \
	    -e "s,^TK_SRC_DIR='.*',TK_SRC_DIR='/usr/include/tk'," \
	    -e "s,^TK_BUILD_STUB_LIB_SPEC='-L.*/unix,TK_BUILD_STUB_LIB_SPEC='-L/usr/lib," \
	    -e "s,^TK_BUILD_STUB_LIB_PATH='.*/unix,TK_BUILD_STUB_LIB_PATH='/usr/lib," \
	    -e "s,^TK_CC_SEARCH_FLAGS='\(.*\)',TK_CC_SEARCH_FLAGS='\1:/usr/lib'," \
	    -e "s,^TK_LD_SEARCH_FLAGS='\(.*\)',TK_LD_SEARCH_FLAGS='\1:/usr/lib'," \
	${Fdestdir}/usr/lib/tkConfig.sh

	Fln /usr/lib/libtk$shortpkgver.so /usr/lib/libtk.so
	Fln /usr/lib/libtkstub$shortpkgver.a /usr/lib/libtkstub.a
}

# optimalization OK
