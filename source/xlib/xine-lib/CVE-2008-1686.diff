# HG changeset patch
# User Diego 'Flameeyes' PettenÃ² <flameeyes@gmail.com>
# Date 1208205483 -7200
# Node ID 66e1654718fb0581846d60c60bc09ae3b6b8c0cf
# Parent 3eee61c465769841a7795a2883ad74cc943c32e8
Add boundary check on speex mode, see bug #83.

--- a/src/libxineadec/xine_speex_decoder.c	Mon Apr 14 21:28:26 2008 +0100
+++ b/src/libxineadec/xine_speex_decoder.c	Mon Apr 14 22:38:03 2008 +0200
@@ -204,7 +204,7 @@ static void speex_decode_data (audio_dec
       if (!this->st) {
 	SpeexMode * spx_mode;
 	SpeexHeader * spx_header;
-	int modeID;
+	unsigned int modeID;
 	int bitrate;
 
 	speex_bits_init (&this->bits);
@@ -216,7 +216,12 @@ static void speex_decode_data (audio_dec
 	  return;
 	}
 
-	modeID = spx_header->mode;
+	modeID = (unsigned int)spx_header->mode;
+	if (modeID >= SPEEX_NB_MODES) {
+	  xprintf(this->stream->xine, XINE_VERBOSITY_DEBUG, LOG_MODULE ": invalid mode ID %u\n", modeID);
+	  return;
+	}
+	
 	spx_mode = (SpeexMode *) speex_mode_list[modeID];
 
 	if (spx_mode->bitstream_version != spx_header->mode_bitstream_version) {

