# Compiling Time: 0.11 SBU
# Maintainer: voroskoi <voroskoi@frugalware.org>

pkgname=umfpack
pkgver=5.4.0
pkgrel=1
pkgdesc="UMFPACK is a set of routines for solving unsymmetric sparse linear systems."
url="http://www.cise.ufl.edu/research/sparse/umfpack/"
depends=('blas' 'libgfortran')
rodepends=('amd')
makedepends=('gcc-gfortran')
groups=('lib-extra')
archs=('i686' 'x86_64')
up2date="lynx -dump ${url}/UMFPACK/Doc/ChangeLog |grep version |sed -ne 's/.*ion //;1p'"
source=(http://www.cise.ufl.edu/research/sparse/umfpack/UMFPACK-5.4.0.tar.gz \
	http://www.cise.ufl.edu/research/sparse/amd/AMD-2.2.0.tar.gz \
	http://www.cise.ufl.edu/research/sparse/UFconfig/UFconfig-3.4.0.tar.gz)
sha1sums=('b9f7d1329d537fe42c8f1cb4a48e93846c197cd2' \
          '862d2fd3538f31f37e9d133204e04ff36ed59c0f' \
          'a57736182a04acae261e0aaebb5f1a5d3c31cdc7')
_F_cd_path="UMFPACK"

subpkgs=('amd')
subdescs=('AMD is a set of routines for ordering a sparse matrix prior to Cholesky factorization.')
subdepends=('libgfortran')
subgroups=('lib-extra')
subarchs=('i686 x86_64')

build() {
	Fcd
	Fsed '-O3' "${CFLAGS}" ../UFconfig/UFconfig.mk
	# f77 is history, do not link to that
	Fsed '-lg2c' '' ../UFconfig/UFconfig.mk
	Fmake

	# UMFPACK
	# includes
	Ffilerel Include/* ${Fprefix}/include
	# libs
	Fmkdir ${Fprefix}/lib
	Ffilerel Lib/libumfpack.a ${Fprefix}/lib/
	# doc
	Fdocrel Doc/*

	# AMD
	# includes
	Ffile AMD/Include/* ${Fprefix}/include
	# libs
	Fmkdir ${Fprefix}/lib
	Ffile AMD/Lib/libamd.a ${Fprefix}/lib/
	# doc
	Fmkdir ${Fprefix}/share/doc/AMD
	Ffile AMD/Doc/* ${Fprefix}/share/doc/AMD/

	Fsplit amd usr/lib/libamd*
	Fsplit amd usr/include/amd*
	Fsplit amd usr/share/doc/AMD
}

# optimization OK
