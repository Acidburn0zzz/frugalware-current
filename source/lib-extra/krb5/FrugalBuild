# Compiling time: 0.93 SBU
# Maintainer: Michel Hermier <hermier@frugalware.org>

pkgname=krb5
pkgver=1.10.1
pkgrel=2arcturus1
pkgdesc="Kerberos: The Network Authentication Protocol"
url="http://web.mit.edu/kerberos/"
license="MIT licence"
depends=('e2fsprogs' 'db' 'openssl>=1.0.0')
makedepends=('perl')
rodepends=("libkrb5=$pkgver")
archs=('i686' 'x86_64' 'arm')
groups=('lib-extra')
up2date="Flastarchive ${url}dist/index.html -signed.tar"
source=(http://web.mit.edu/kerberos/dist/$pkgname/1.10/$pkgname-$pkgver-signed.tar)
sha1sums=('f9f3b77173f68b268b43e4f9c29bf7c9f3fd1f0e')
#signature=($source.asc)
#signatures=(http://web.mit.edu/kerberos/www/$pkgname-$pkgver/$pkgname-$pkgver.sig)

subpkgs=('libkrb5')
subdescs=('krb5 libraries files.')
subdepends=('e2fsprogs db libgssglue')
subgroups=('lib')
subarchs=('i686 x86_64 arm')

# FSA fix ***
source=(${source[@]} CVE-2014-4341-4342.patch CVE-2014-4343.patch
                     CVE-2014-4344.patch CVE-2014-4345.patch
                     gcc47fix.patch)
sha1sums=(${sha1sums[@]} 'f6c18abd4d1c98af1090b2ae898e4c0f8920f3ad' \
                         '2f3bd4fdd0f7f2be4c594e18e06bb9e328ae313d' \
                         '73f008acdeacb3fc2ae27aff0c83ffc1548024cd' \
                         'c0ccb48f104a4be55f332c59462e5349804e318b' \
                         '5f7fab402a03a63ff5e80ecfdb72cfbd13346f50')
# ***********


build() {
	Fextract $pkgname-$pkgver.tar.gz
	Fpatchall
	cd src || Fdie
	export CPPFLAGS="$CPPFLAGS -I/usr/include/et"
	Fmake \
		--with-system-et \
		--with-system-ss
	#	--with-system-db \
	Fmakeinstall
	Fsplit libkrb5 usr/lib/libgssapi_krb5.so*
	Fsplit libkrb5 usr/lib/libk5*
	Fsplit libkrb5 usr/lib/libkrb5.so.*
	Fsplit libkrb5 usr/lib/libkrb5support*
#	Fsplit libkrb5 usr/include
	Fsplit libkrb5 usr/share/examples/krb5
}

# optimization OK
