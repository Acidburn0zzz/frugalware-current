# Compiling Time: 1.11 SBU
# Maintainer: Melko <melko@frugalware.org>

pkgname=lapack
pkgver=3.6.1
pkgrel=2
pkgdesc="Linear Algebra PACKage."
url="http://www.netlib.org/lapack"
makedepends=('gcc-gfortran>=6.2.1-5')
depends=('libgfortran>=6.2.1-5')
rodepends=('blas')
groups=('lib')
archs=('i686' 'x86_64')
up2date="Flasttar $url"
Finclude cmake
source=(http://netlib.org/$pkgname/$pkgname.tgz)
sha1sums=('7220a9bc9c766cb513007f313b804d88f110c228')
options=('noversrc')
_F_cd_path="$pkgname-$pkgver"

subpkgs=('blas')
subdescs=('Basic Linear Algebra Subprograms.')
subdepends=('libgfortran>=6.2.1-5')
subgroups=('lib')
subarchs=('i686 x86_64')

build() {
	[ "$CARCH" == "x86_64" ] && export CXXFLAGS="$CXXFLAGS -fPIC" && export CFLAGS="$CFLAGS -fPIC" && export FFLAGS="$FFLAGS -fPIC"
	Fcd
	CMake_build -DBUILD_SHARED_LIBS=ON -DLAPACKE=ON

	## why we need that ? -- crazy --
	for name in liblapacke libtmglib; do
		Fmv /usr/lib/{$name.so,$name.so.$pkgver}
		Fln ${name}.so.$pkgver /usr/lib/${name}.so
		Fln ${name}.so /usr/lib/${name}.so.3
	done

	Fsplit blas /usr/lib/pkgconfig/blas.pc
	Fsplit blas /usr/lib/libblas\*
}

# optimization OK
