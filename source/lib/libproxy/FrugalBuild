# Compiling time: 0.05 SBU
# Maintainer: bouleetbil <bouleetbil@frogdev.info>

pkgname=libproxy
pkgver=0.4.0
pkgrel=2
pkgdesc="libproxy is a library that provides automatic proxy configuration management."
depends=('glibc' 'dbus')
#makedepends=('automoc4')
groups=('lib')
archs=('i686' 'x86_64' 'ppc')
Finclude googlecode cmake python
sha1sums=('4d9dc92dd40255a51e541099b39d9852563dbc6a')

subpkgs=("${subpkgs[@]}" "$pkgname-python")
subdescs=("${subdescs[@]}" "$pkgname python binding")
subdepends=("${subdepends[@]}" "python")
subrodepends=("${subrodepends[@]}" "$pkgname")
subgroups=("${subgroups[@]}" 'devel-extra')
subarchs=("${subarchs[@]}" 'i686 x86_64 ppc')

subpkgs=("${subpkgs[@]}" "$pkgname-webkit")
subdescs=("${subdescs[@]}" "$pkgname webkit support")
subdepends=("${subdepends[@]}" "webkit")
subrodepends=("${subrodepends[@]}" "$pkgname")
subgroups=("${subgroups[@]}" 'xlib-extra')
subarchs=("${subarchs[@]}" 'i686 x86_64 ppc')

subpkgs=("${subpkgs[@]}" "$pkgname-xulrunner")
subdescs=("${subdescs[@]}" "$pkgname xulrunner support")
subdepends=("${subdepends[@]}" "xulrunner")
subrodepends=("${subrodepends[@]}" "$pkgname")
subgroups=("${subgroups[@]}" 'xlib-extra')
subarchs=("${subarchs[@]}" 'i686 x86_64 ppc')

#subpkgs=("${subpkgs[@]}" "$pkgname-kde")
#subdescs=("${subdescs[@]}" "$pkgname kde support")
#subdepends=("${subdepends[@]}" "kdelibs")
#subrodepends=("${subrodepends[@]}" "$pkgname")
#subgroups=("${subgroups[@]}" 'kde-extra')
#subarchs=("${subarchs[@]}" 'i686 x86_64 ppc')

subpkgs=("${subpkgs[@]}" "$pkgname-gnome")
subdescs=("${subdescs[@]}" "$pkgname gnome support")
subdepends=("${subdepends[@]}" "gconf")
subrodepends=("${subrodepends[@]}" "$pkgname")
subgroups=("${subgroups[@]}" 'gnome')
subarchs=("${subarchs[@]}" 'i686 x86_64 ppc')

#TODO : added mono support, and fix kde4 (kde4 break xulrunner support)

build() {
	Fcd
	Fsed "mozilla-js" "libxul-unstable" libproxy/CMakeLists.txt
	#Fix missing install pkgconfig
	Fmkdir usr/lib/pkgconfig
	Fsed "@prefix@" "/usr" libproxy/libproxy-1.0.pc.in
	Fsed '@libdir@' '${prefix}/lib' libproxy/libproxy-1.0.pc.in
	Fsed '@includedir@' '${prefix}/include' libproxy/libproxy-1.0.pc.in
	Fsed "@VERSION@" "$pkgver" libproxy/libproxy-1.0.pc.in
	Fcp $pkgname-$pkgver/libproxy/libproxy-1.0.pc.in usr/lib/pkgconfig/libproxy-1.0.pc
	CMake_build
	Fsplit $pkgname-python $_F_python_libdir
	Fsplit $pkgname-gnome usr/lib/$pkgname/$pkgver/modules/config_gnome.so
	Fsplit $pkgname-gnome usr/libexec/pxgconf
	#Fsplit $pkgname-kde usr/lib/$pkgname/modules/$pkgver/config_kde.so
	Fsplit $pkgname-webkit usr/lib/$pkgname/$pkgver/modules/pacrunner_webkit.so
	Fsplit $pkgname-xulrunner usr/lib/$pkgname/$pkgver/modules/pacrunner_mozjs.so
}

# optimization OK
