# Last Modified: Sun, 12 Mar 2006 03:15:20 +0100
# Compiling Time: 2.38 SBU
# Maintainer: Christian Hamar alias krix <krics@linuxforum.hu>

pkgname=gcc-lib
pkgver=4.0.3
pkgrel=1
pkgdesc="The GNU GCC library (libgcc_s.so)"
url="http://gcc.gnu.org"
depends=('glibc')
conflicts=('gcc<=4.0.1-1')
groups=('lib' 'chroot-core')
archs=('i686' 'x86_64')
up2date="lynx -dump $url |grep 4.0|sed 's/.*C \(.*\) (.*/\1/;q'"
source=(ftp://gcc.gnu.org/pub/gcc/releases/gcc-$pkgver/gcc-$pkgver.tar.bz2 \
	gcc-3.4.3-no_multilib_amd64.patch0)
sha1sums=('5a94943d9ab823cf8d080cc7f9e8a4a91797afea' \
	  '883ae944eb9aeca85d9adc54b3e16eab8f4a51c3')
[ "$CARCH" == "x86_64" ] && Fconfopts="$Fconfopts --libdir=/usr/lib --disable-multilib"

# do _not_ change this package, your changes after the 4.1.0 merge will be lost!

build()
{
	Fcd gcc-$pkgver
	[ "$CARCH" == "x86_64" ] && Fpatch gcc-3.4.3-no_multilib_amd64.patch0
	mkdir ../$pkgname-build
	cd ../$pkgname-build
	../gcc-$pkgver/configure $Fconfopts --enable-shared \
		--enable-languages=c,c++ --enable-threads=posix \
		--enable-__cxa_atexit
	
	make all-gcc BOOT_CFLAGS="$CFLAGS" || return 1
	
	make DESTDIR=$Fdestdir install-gcc
	
	# include/ contains install-tools/include/* and headers that were fixed
	# up by fixincludes, we don't want former
	for i in `find $Fdestdir/usr/lib/gcc/$CHOST/$pkgver/include/ -name \*.h`
	do
	if grep -q 'It has been auto-edited by fixincludes from' $i; then
	    rm -f $i
        fi
        done

	Frm /usr/{bin,include,info,libexec,man}
	Frm /usr/lib/gcc/
	Frm /usr/share/doc/$pkgname-$pkgver/INSTALL/
	Frm /usr/share/locale
}

# optimalization ok

# vim: ft=sh
