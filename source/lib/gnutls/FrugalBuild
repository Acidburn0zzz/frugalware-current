# Compiling Time: 1.04 SBU
# Maintainer: voroskoi <voroskoi@frugalware.org>
# Contributor: Miklos Vajna <vmiklos@frugalware.org>

options+=('asneeded')

pkgname=gnutls
pkgver=2.12.17
pkgrel=2arcturus2
pkgdesc="A library which provides a secure layer over a reliable transport layer"
url="http://www.gnu.org/software/gnutls/"
groups=('lib')
archs=('i686' 'x86_64' 'arm')
depends=('libtasn1>=1.7' 'nettle' 'p11-kit>=0.11')
makedepends=('gtk-doc')
options=('scriptlet')
up2date="lynx -dump ftp://ftp.gnutls.org/pub/gnutls/|grep tar.bz2$ | grep -v rc | sed -n 's/.*-\(.*\)\.t.*/\1/;$ p'"
source=(ftp://ftp.gnutls.org/gcrypt/gnutls/v2.12/$pkgname-$pkgver.tar.bz2)
Finclude texinfo
signatures=($source.sig)

# FSA fix ***
source=(${source[@]} CVE-2014-1959.patch CVE-2014-0092.patch CVE-2014-3466.patch)
signatures=(${signatures[@]} '' '' '')
# ***********


build()
{
	Fpatchall

	# Fix: error: 'gets' undeclared here (not in a function)
	Fsed '_GL_WARN_ON_USE (gets, "gets is a security hole - use fgets instead");' '' lib/gl/stdio.in.h
	Fsed '_GL_WARN_ON_USE (gets, "gets is a security hole - use fgets instead");' '' gl/stdio.in.h

	Fmake --enable-gtk-doc
	make check || return 1
	Fmakeinstall
}

# optimization OK
