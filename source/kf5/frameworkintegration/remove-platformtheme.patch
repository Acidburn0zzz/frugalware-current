diff --git a/CMakeLists.txt b/CMakeLists.txt
index 8624a986e43b8e677842c64179613c3f84d7baef..a3558d5d8bce293b8a9abe76f9abb886abb057c7 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -69,4 +69,3 @@ install(FILES plasma_workspace.notifyrc DESTINATION ${KDE_INSTALL_KNOTIFY5RCDIR}
 
 
 feature_summary(WHAT ALL   FATAL_ON_MISSING_REQUIRED_PACKAGES)
-message("** frameworkintegration uses Noto Sans (https://www.google.com/get/noto/) and Oxygen Mono (http://download.kde.org/stable/plasma/5.4.0/oxygen-fonts-5.4.0.tar.xz) fonts, ensure these are installed for use at runtime")
diff --git a/autotests/CMakeLists.txt b/autotests/CMakeLists.txt
index 5cbaeebe34da35f7fa7e44dfab51ce240aecca03..5857db4c6e9af1d4b4ee32ff0bb4d0dac302c186 100644
--- a/autotests/CMakeLists.txt
+++ b/autotests/CMakeLists.txt
@@ -2,23 +2,14 @@ include(ECMMarkAsTest)
 include(ECMMarkNonGuiExecutable)
 
 find_package(Qt5Test ${REQUIRED_QT_VERSION} CONFIG QUIET)
-find_package(Qt5Qml ${REQUIRED_QT_VERSION} CONFIG QUIET)
 
 if(NOT Qt5Test_FOUND)
     message(STATUS "Qt5Test not found, autotests will not be built.")
     return()
 endif()
 
-if(NOT Qt5Qml_FOUND)
-    message(STATUS "Qt5Qml not found, QML autotests will not be built.")
-endif()
-
 include_directories( ${Qt5Gui_PRIVATE_INCLUDE_DIRS} )
 
-set(CONFIGFILE "${CMAKE_CURRENT_SOURCE_DIR}/kdeplatformtheme_kdeglobals")
-set(CHANGED_CONFIGFILE "${CMAKE_CURRENT_SOURCE_DIR}/kdeplatformtheme_changed_kdeglobals")
-configure_file(kdeplatformtheme_config.h.in ${CMAKE_CURRENT_BINARY_DIR}/kdeplatformtheme_config.h)
-
 remove_definitions(-DQT_NO_CAST_FROM_ASCII)
 
 macro(FRAMEWORKINTEGRATION_TESTS _testname)
@@ -31,42 +22,6 @@ macro(FRAMEWORKINTEGRATION_TESTS _testname)
 endmacro()
 
 frameworkintegration_tests(
-  kdeplatformtheme_unittest
-  ../src/platformtheme/kdeplatformtheme.cpp
-  ../src/platformtheme/kfontsettingsdata.cpp
-  ../src/platformtheme/khintssettings.cpp
-  ../src/platformtheme/kdeplatformfiledialoghelper.cpp
-  ../src/platformtheme/kdeplatformfiledialogbase.cpp
-  ../src/platformtheme/kdeplatformsystemtrayicon.cpp
-  ../src/platformtheme/kdirselectdialog.cpp
-  ../src/platformtheme/kfiletreeview.cpp
-)
-
-frameworkintegration_tests(
-  kfontsettingsdata_unittest
-  ../src/platformtheme/kfontsettingsdata.cpp
-)
-
-frameworkintegration_tests(
   kstyle_unittest
 )
 
-frameworkintegration_tests(
-  kfiledialog_unittest
-)
-
-frameworkintegration_tests(
-  ksni_unittest
-)
-
-frameworkintegration_tests(
-  kdirselectdialog_unittest
-  ../src/platformtheme/kdeplatformfiledialogbase.cpp
-  ../src/platformtheme/kdirselectdialog.cpp
-  ../src/platformtheme/kfiletreeview.cpp
-)
-
-if(Qt5Qml_FOUND)
-    frameworkintegration_tests(kfiledialogqml_unittest)
-    target_link_libraries(kfiledialogqml_unittest Qt5::Qml)
-endif()
diff --git a/autotests/kdeplatformtheme_changed_kdeglobals b/autotests/kdeplatformtheme_changed_kdeglobals
deleted file mode 100644
index 910e0e3c89d3de7ee69cd22a6c6da6d3b0d331b0..0000000000000000000000000000000000000000
--- a/autotests/kdeplatformtheme_changed_kdeglobals
+++ /dev/null
@@ -1,115 +0,0 @@
-[KDE]
-CursorBlinkRate=1022
-DoubleClickInterval=401
-StartDragDist=35
-StartDragTime=501
-SingleClick=true
-widgetStyle=another-non-existent-widget-style
-ShowIconsInMenuItems=false
-ShowIconsOnPushButtons=true
-GraphicEffectsLevel=1
-WheelScrollLines=122
-ShowIconsInMenuItems=false
-
-[Toolbar style]
-ToolButtonStyle=textundericon
-
-[Icons]
-Theme=other-non-existent
-
-[MainToolbarIcons]
-Size=11
-
-[ColorEffects:Active]
-ChangeSelectionColor=false
-Enable=false
-
-[ColorEffects:Inactive]
-ChangeSelectionColor=false
-Enable=false
-
-[ColorEffects:Disabled]
-ChangeSelectionColor=false
-Enable=false
-
-[Colors:Button]
-BackgroundAlternate=174,11,11
-BackgroundNormal=174,11,11
-DecorationFocus=174,11,11
-DecorationHover=174,11,11
-ForegroundActive=174,11,11
-ForegroundInactive=174,11,11
-ForegroundLink=174,11,11
-ForegroundNegative=174,11,11
-ForegroundNeutral=174,11,11
-ForegroundNormal=174,11,11
-ForegroundPositive=174,11,11
-ForegroundVisited=174,11,11
-
-[Colors:Selection]
-BackgroundAlternate=174,11,11
-BackgroundNormal=174,11,11
-DecorationFocus=174,11,11
-DecorationHover=174,11,11
-ForegroundActive=174,11,11
-ForegroundInactive=174,11,11
-ForegroundLink=174,11,11
-ForegroundNegative=174,11,11
-ForegroundNeutral=174,11,11
-ForegroundNormal=174,11,11
-ForegroundPositive=174,11,11
-ForegroundVisited=174,11,11
-
-[Colors:Tooltip]
-BackgroundAlternate=174,11,11
-BackgroundNormal=174,11,11
-DecorationFocus=174,11,11
-DecorationHover=174,11,11
-ForegroundActive=174,11,11
-ForegroundInactive=174,11,11
-ForegroundLink=174,11,11
-ForegroundNegative=174,11,11
-ForegroundNeutral=174,11,11
-ForegroundNormal=174,11,11
-ForegroundPositive=174,11,11
-ForegroundVisited=174,11,11
-
-[Colors:View]
-BackgroundAlternate=174,11,11
-BackgroundNormal=174,11,11
-DecorationFocus=174,11,11
-DecorationHover=174,11,11
-ForegroundActive=174,11,11
-ForegroundInactive=174,11,11
-ForegroundLink=174,11,11
-ForegroundNegative=174,11,11
-ForegroundNeutral=174,11,11
-ForegroundNormal=174,11,11
-ForegroundPositive=174,11,11
-ForegroundVisited=174,11,11
-
-[Colors:Window]
-BackgroundAlternate=174,11,11
-BackgroundNormal=174,11,11
-DecorationFocus=174,11,11
-DecorationHover=174,11,11
-ForegroundActive=174,11,11
-ForegroundInactive=174,11,11
-ForegroundLink=174,11,11
-ForegroundNegative=174,11,11
-ForegroundNeutral=174,11,11
-ForegroundNormal=174,11,11
-ForegroundPositive=174,11,11
-ForegroundVisited=174,11,11
-
-[WM]
-activeFont=ChangedActiveTest,9,-1,5,50,0,0,0,0,0
-
-[General]
-desktopFont=ChangedDesktopTest,9,-1,5,50,0,0,0,0,0
-fixed=ChangedFixedTest Mono,10,-1,5,50,0,0,0,0,0
-font=ChangedFontTest,9,-1,5,50,0,0,0,0,0
-menuFont=ChangedMenuTest,9,-1,5,50,0,0,0,0,0
-smallestReadableFont=ChangedSmallestReadableTest,8,-1,5,50,0,0,0,0,0
-taskbarFont=ChangedTaskbarTest,9,-1,5,50,0,0,0,0,0
-toolBarFont=ChangedToolbarTest,8,-1,5,50,0,0,0,0,0
\ No newline at end of file
diff --git a/autotests/kdeplatformtheme_config.h.in b/autotests/kdeplatformtheme_config.h.in
deleted file mode 100644
index c434ba29ab4f3ba85a5a9697ad2eae626268dd61..0000000000000000000000000000000000000000
--- a/autotests/kdeplatformtheme_config.h.in
+++ /dev/null
@@ -1,27 +0,0 @@
-/*  This file is part of the KDE libraries
- *  Copyright 2013 Alejandro Fiestas Olivares <afiestas@kde.org>
- *
- *  This library is free software; you can redistribute it and/or modify
- *  it under the terms of the GNU Lesser General Public License as published by
- *  the Free Software Foundation; either version 2 of the License or ( at
- *  your option ) version 3 or, at the discretion of KDE e.V. ( which shall
- *  act as a proxy as in section 14 of the GPLv3 ), any later version.
- *
- *  This library is distributed in the hope that it will be useful,
- *  but WITHOUT ANY WARRANTY; without even the implied warranty of
- *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
- *  Library General Public License for more details.
- *
- *  You should have received a copy of the GNU Lesser General Public License
- *  along with this library; see the file COPYING.LIB.  If not, write to
- *  the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor,
- *  Boston, MA 02110-1301, USA.
- */
-
-#ifndef KPLATFORMTHEMETEST_H
-#define KPLATFORMTHEMETEST_H
-
-#define CONFIGFILE "${CONFIGFILE}"
-#define CHANGED_CONFIGFILE "${CHANGED_CONFIGFILE}"
-
-#endif
diff --git a/autotests/kdeplatformtheme_kdeglobals b/autotests/kdeplatformtheme_kdeglobals
deleted file mode 100644
index df524109064d70c1679dace3881ea37ca03972c6..0000000000000000000000000000000000000000
--- a/autotests/kdeplatformtheme_kdeglobals
+++ /dev/null
@@ -1,116 +0,0 @@
-[KDE]
-CursorBlinkRate=1042
-DoubleClickInterval=4343
-StartDragDist=15
-StartDragTime=555
-SingleClick=false
-widgetStyle=non-existent-widget-style
-ShowIconsInMenuItems=false
-ShowIconsOnPushButtons=false
-GraphicEffectsLevel=0
-WheelScrollLines=1234
-ShowIconsInMenuItems=true
-
-[Toolbar style]
-ToolButtonStyle=textonly
-ToolButtonStyleOtherToolbars=textundericon
-
-[Icons]
-Theme=non-existent-icon-theme
-
-[MainToolbarIcons]
-Size=2
-
-[ColorEffects:Active]
-ChangeSelectionColor=false
-Enable=false
-
-[ColorEffects:Inactive]
-ChangeSelectionColor=false
-Enable=false
-
-[ColorEffects:Disabled]
-ChangeSelectionColor=false
-Enable=false
-
-[Colors:Button]
-BackgroundAlternate=0,128,0
-BackgroundNormal=0,128,0
-DecorationFocus=0,128,0
-DecorationHover=0,128,0
-ForegroundActive=0,128,0
-ForegroundInactive=0,128,0
-ForegroundLink=0,128,0
-ForegroundNegative=0,128,0
-ForegroundNeutral=0,128,0
-ForegroundNormal=0,128,0
-ForegroundPositive=0,128,0
-ForegroundVisited=0,128,0
-
-[Colors:Selection]
-BackgroundAlternate=0,128,0
-BackgroundNormal=0,128,0
-DecorationFocus=0,128,0
-DecorationHover=0,128,0
-ForegroundActive=0,128,0
-ForegroundInactive=0,128,0
-ForegroundLink=0,128,0
-ForegroundNegative=0,128,0
-ForegroundNeutral=0,128,0
-ForegroundNormal=0,128,0
-ForegroundPositive=0,128,0
-ForegroundVisited=0,128,0
-
-[Colors:Tooltip]
-BackgroundAlternate=0,128,0
-BackgroundNormal=0,128,0
-DecorationFocus=0,128,0
-DecorationHover=0,128,0
-ForegroundActive=0,128,0
-ForegroundInactive=0,128,0
-ForegroundLink=0,128,0
-ForegroundNegative=0,128,0
-ForegroundNeutral=0,128,0
-ForegroundNormal=0,128,0
-ForegroundPositive=0,128,0
-ForegroundVisited=0,128,0
-
-[Colors:View]
-BackgroundAlternate=0,128,0
-BackgroundNormal=0,128,0
-DecorationFocus=0,128,0
-DecorationHover=0,128,0
-ForegroundActive=0,128,0
-ForegroundInactive=0,128,0
-ForegroundLink=0,128,0
-ForegroundNegative=0,128,0
-ForegroundNeutral=0,128,0
-ForegroundNormal=0,128,0
-ForegroundPositive=0,128,0
-ForegroundVisited=0,128,0
-
-[Colors:Window]
-BackgroundAlternate=0,128,0
-BackgroundNormal=0,128,0
-DecorationFocus=0,128,0
-DecorationHover=0,128,0
-ForegroundActive=0,128,0
-ForegroundInactive=0,128,0
-ForegroundLink=0,128,0
-ForegroundNegative=0,128,0
-ForegroundNeutral=0,128,0
-ForegroundNormal=0,128,0
-ForegroundPositive=0,128,0
-ForegroundVisited=0,128,0
-
-[WM]
-activeFont=OxyActiveTest,9,-1,5,50,0,0,0,0,0
-
-[General]
-desktopFont=OxyDesktopTest,9,-1,5,50,0,0,0,0,0
-fixed=OxyFixedTest Mono,10,-1,5,50,0,0,0,0,0
-font=OxyFontTest,9,-1,5,50,0,0,0,0,0
-menuFont=OxyMenuTest,9,-1,5,50,0,0,0,0,0
-smallestReadableFont=OxySmallestReadableTest,8,-1,5,50,0,0,0,0,0
-taskbarFont=OxyTaskbarTest,9,-1,5,50,0,0,0,0,0
-toolBarFont=OxyToolbarTest,8,-1,5,50,0,0,0,0,0
\ No newline at end of file
diff --git a/autotests/kdeplatformtheme_unittest.cpp b/autotests/kdeplatformtheme_unittest.cpp
deleted file mode 100644
index a830ef674c0947ffa8a0e94edcd8da5f5e566736..0000000000000000000000000000000000000000
--- a/autotests/kdeplatformtheme_unittest.cpp
+++ /dev/null
@@ -1,300 +0,0 @@
-/*  This file is part of the KDE libraries
- *  Copyright 2013 Alejandro Fiestas Olivares <afiestas@kde.org>
- *
- *  This library is free software; you can redistribute it and/or modify
- *  it under the terms of the GNU Lesser General Public License as published by
- *  the Free Software Foundation; either version 2 of the License or ( at
- *  your option ) version 3 or, at the discretion of KDE e.V. ( which shall
- *  act as a proxy as in section 14 of the GPLv3 ), any later version.
- *
- *  This library is distributed in the hope that it will be useful,
- *  but WITHOUT ANY WARRANTY; without even the implied warranty of
- *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
- *  Library General Public License for more details.
- *
- *  You should have received a copy of the GNU Lesser General Public License
- *  along with this library; see the file COPYING.LIB.  If not, write to
- *  the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor,
- *  Boston, MA 02110-1301, USA.
- */
-
-#include "kdeplatformtheme_config.h"
-#include "../src/platformtheme/kdeplatformtheme.h"
-#include "../src/platformtheme/khintssettings.h"
-
-#include <Qt>
-#include <QTest>
-#include <QDir>
-#include <QFile>
-#include <QString>
-#include <QPalette>
-#include <QDebug>
-#include <QIconEngine>
-#include <QToolButton>
-#include <QApplication>
-#include <QDialogButtonBox>
-#include <QStandardPaths>
-
-#include <QDBusConnection>
-#include <QDBusInterface>
-#include <QDBusMessage>
-
-#include <kiconloader.h>
-
-static void prepareEnvironment()
-{
-    QStandardPaths::setTestModeEnabled(true);
-
-    QString configPath = QStandardPaths::writableLocation(QStandardPaths::GenericConfigLocation);
-
-    if(!QDir(configPath).mkpath(QStringLiteral("."))) {
-        qFatal("Failed to create test configuration directory.");
-    }
-
-    configPath.append("/kdeglobals");
-
-    QFile::remove(configPath);
-    if(!QFile::copy(CONFIGFILE, configPath)) {
-        qFatal("Failed to copy kdeglobals required for tests.");
-    }
-}
-
-Q_CONSTRUCTOR_FUNCTION(prepareEnvironment)
-
-class EventTest : public QObject
-{
-public:
-    EventTest(QObject *tested, QEvent::Type type)
-        : QObject(), gotEvent(false), m_type(type)
-    {
-        tested->installEventFilter(this);
-
-    }
-
-    bool eventFilter(QObject *, QEvent *e) Q_DECL_OVERRIDE
-    {
-        if (e->type() == m_type) {
-            gotEvent = true;
-        }
-        return false;
-    }
-
-    bool gotEvent;
-    QEvent::Type m_type;
-};
-
-class KdePlatformTheme_UnitTest : public QObject
-{
-    Q_OBJECT
-public:
-    KdePlatformTheme_UnitTest()
-    {}
-
-private:
-    void sendNotifyChange(KHintsSettings::ChangeType type, int arg = -1)
-    {
-        QDBusMessage message = QDBusMessage::createSignal(QStringLiteral("/KGlobalSettings"), QStringLiteral("org.kde.KGlobalSettings"), QStringLiteral("notifyChange"));
-        QList<QVariant> args;
-        args.append(static_cast<int>(type));
-        if (arg >= 0) {
-            args.append(arg);
-        }
-        message.setArguments(args);
-        QDBusConnection::sessionBus().send(message);
-    }
-
-    QEventLoop m_loop;
-    QToolButton m_toolBtn;
-    KdePlatformTheme *m_qpa;
-private Q_SLOTS:
-    void initTestCase()
-    {
-        m_qpa = new KdePlatformTheme();
-        QDBusConnection::sessionBus().connect(QString(), QStringLiteral("/KGlobalSettings"), QStringLiteral("org.kde.KGlobalSettings"),
-                                              QStringLiteral("notifyChange"),  &m_loop, SLOT(quit()));
-    }
-
-    void cleanupTestCase()
-    {
-        QString configPath = QStandardPaths::writableLocation(QStandardPaths::GenericConfigLocation);
-        configPath.append("/kdeglobals");
-
-        QFile::remove(configPath);
-    }
-
-    void testPlatformHints()
-    {
-        QCOMPARE(qApp->cursorFlashTime(), 1042);
-        QCOMPARE(qApp->doubleClickInterval(), 4343);
-        QCOMPARE(qApp->startDragDistance(), 15);
-        QCOMPARE(qApp->startDragTime(), 555);
-        QCOMPARE(m_qpa->themeHint(QPlatformTheme::ToolButtonStyle).toInt(), (int) Qt::ToolButtonTextOnly);
-        QCOMPARE(m_qpa->themeHint(QPlatformTheme::ToolBarIconSize).toInt(), 2);
-        QCOMPARE(m_qpa->themeHint(QPlatformTheme::ItemViewActivateItemOnSingleClick).toBool(), false);
-        QCOMPARE(m_qpa->themeHint(QPlatformTheme::SystemIconThemeName).toString(), QLatin1String("non-existent-icon-theme"));
-        QCOMPARE(m_qpa->themeHint(QPlatformTheme::SystemIconFallbackThemeName).toString(), QLatin1String("hicolor"));
-
-        QStringList iconThemeSearchPaths = m_qpa->themeHint(QPlatformTheme::IconThemeSearchPaths).toStringList();
-        foreach (const QString &iconPath, iconThemeSearchPaths) {
-            QVERIFY( iconPath.endsWith(QLatin1String("/icons")) || iconPath.endsWith(QLatin1String("/.icons")) );
-            QVERIFY(QFile::exists(iconPath));
-        }
-        // there must be *some* icons in XDG_DATA_DIRS, right?
-        QVERIFY(!iconThemeSearchPaths.isEmpty());
-
-        QStringList styles;
-        styles << QStringLiteral("non-existent-widget-style") << QStringLiteral("breeze") << QStringLiteral("oxygen") << QStringLiteral("fusion") << QStringLiteral("windows");
-        QCOMPARE(m_qpa->themeHint(QPlatformTheme::StyleNames).toStringList(), styles);
-        QCOMPARE(m_qpa->themeHint(QPlatformTheme::DialogButtonBoxLayout).toInt(), (int) QDialogButtonBox::KdeLayout);
-        QCOMPARE(m_qpa->themeHint(QPlatformTheme::DialogButtonBoxButtonsHaveIcons).toBool(), false);
-        QCOMPARE(m_qpa->themeHint(QPlatformTheme::UseFullScreenForPopupMenu).toBool(), true);
-        QCOMPARE(m_qpa->themeHint(QPlatformTheme::KeyboardScheme).toInt(), (int) QPlatformTheme::KdeKeyboardScheme);
-        QCOMPARE(m_qpa->themeHint(QPlatformTheme::UiEffects).toInt(), 0);
-        QCOMPARE(m_qpa->themeHint(QPlatformTheme::IconPixmapSizes).value<QList<int> >(), QList<int>() << 512 << 256 << 128 << 64 << 32 << 22 << 16 << 8);
-
-        QCOMPARE(qApp->wheelScrollLines(), 1234);
-        QCOMPARE(qApp->testAttribute(Qt::AA_DontShowIconsInMenus), false);
-    }
-
-    void testPlatformPalette()
-    {
-        const QPalette palette = qApp->palette();
-        QPalette::ColorGroup states[3] = {QPalette::Active, QPalette::Inactive, QPalette::Disabled};
-        QColor greenColor(QColor(0, 128, 0));
-        QBrush greenBrush(greenColor);
-        for (int i = 0; i < 3; i++) {
-            QCOMPARE(palette.brush(states[i], QPalette::ButtonText), greenBrush);
-            QCOMPARE(palette.brush(states[i], QPalette::WindowText), greenBrush);
-            QCOMPARE(palette.brush(states[i], QPalette::Window), greenBrush);
-            QCOMPARE(palette.brush(states[i], QPalette::Base), greenBrush);
-            QCOMPARE(palette.brush(states[i], QPalette::Text), greenBrush);
-            QCOMPARE(palette.brush(states[i], QPalette::Button), greenBrush);
-            QCOMPARE(palette.brush(states[i], QPalette::ButtonText), greenBrush);
-            QCOMPARE(palette.brush(states[i], QPalette::Highlight), greenBrush);
-            QCOMPARE(palette.brush(states[i], QPalette::HighlightedText), greenBrush);
-            QCOMPARE(palette.brush(states[i], QPalette::ToolTipBase), greenBrush);
-            QCOMPARE(palette.brush(states[i], QPalette::ToolTipText), greenBrush);
-
-            //KColorScheme applies modifications and we can't disable them, so I extracted
-            //the values and blindly compare them.
-            QCOMPARE(palette.color(states[i], QPalette::Light).green(), 162);
-            QCOMPARE(palette.color(states[i], QPalette::Midlight).green(), 144);
-            QCOMPARE(palette.color(states[i], QPalette::Mid).green(), 109);
-            QCOMPARE(palette.color(states[i], QPalette::Dark).green(), 62);
-            QCOMPARE(palette.color(states[i], QPalette::Shadow).green(), 43);
-
-            QCOMPARE(palette.brush(states[i], QPalette::AlternateBase), greenBrush);
-            QCOMPARE(palette.brush(states[i], QPalette::Link), greenBrush);
-            QCOMPARE(palette.brush(states[i], QPalette::LinkVisited), greenBrush);
-        }
-    }
-
-    void testPlatformIconEngine()
-    {
-        QIconEngine *engine = m_qpa->createIconEngine(QStringLiteral("test-icon"));
-        QCOMPARE(engine->key(), QStringLiteral("KIconEngine"));
-    }
-
-    void testPlatformIconChanges()
-    {
-        QString configPath = QStandardPaths::writableLocation(QStandardPaths::GenericConfigLocation);
-        configPath.append("/kdeglobals");
-        QFile::remove(configPath);
-        QFile::copy(CHANGED_CONFIGFILE, configPath);
-
-        QDBusConnection::sessionBus().connect(QString(), QStringLiteral("/KIconLoader"), QStringLiteral("org.kde.KIconLoader"),
-                                              QStringLiteral("iconChanged"),  &m_loop, SLOT(quit()));
-
-        QDBusMessage message = QDBusMessage::createSignal(QStringLiteral("/KIconLoader"), QStringLiteral("org.kde.KIconLoader"), QStringLiteral("iconChanged"));
-        message.setArguments(QList<QVariant>() << int(KIconLoader::MainToolbar));
-        QDBusConnection::sessionBus().send(message);
-        m_loop.exec();
-
-        QCOMPARE(m_qpa->themeHint(QPlatformTheme::ToolBarIconSize).toInt(), 11);
-    }
-
-    void testPlatformHintChanges()
-    {
-        EventTest tester(&m_toolBtn, QEvent::StyleChange);
-        sendNotifyChange(KHintsSettings::SettingsChanged, KHintsSettings::SETTINGS_QT);
-        m_loop.exec();
-
-        QCOMPARE(qApp->cursorFlashTime(), 1022);
-
-        sendNotifyChange(KHintsSettings::SettingsChanged, KHintsSettings::SETTINGS_MOUSE);
-        m_loop.exec();
-
-        QCOMPARE(m_qpa->themeHint(QPlatformTheme::ItemViewActivateItemOnSingleClick).toBool(), true);
-        QCOMPARE(qApp->doubleClickInterval(), 401);
-        QCOMPARE(qApp->startDragDistance(), 35);
-        QCOMPARE(qApp->startDragTime(), 501);
-
-        QCOMPARE(qApp->wheelScrollLines(), 122);
-        QCOMPARE(qApp->testAttribute(Qt::AA_DontShowIconsInMenus), true);
-
-        sendNotifyChange(KHintsSettings::ToolbarStyleChanged, 2);
-        m_loop.exec();
-
-        QCOMPARE(m_qpa->themeHint(QPlatformTheme::ToolButtonStyle).toInt(), (int) Qt::ToolButtonTextUnderIcon);
-        QCOMPARE(tester.gotEvent, true);
-
-        sendNotifyChange(KHintsSettings::StyleChanged, 2);
-        m_loop.exec();
-
-        QStringList styles;
-        styles << QStringLiteral("another-non-existent-widget-style") << QStringLiteral("breeze") << QStringLiteral("oxygen") << QStringLiteral("fusion") << QStringLiteral("windows");
-        QCOMPARE(m_qpa->themeHint(QPlatformTheme::StyleNames).toStringList(), styles);
-
-        sendNotifyChange(KHintsSettings::SettingsChanged, KHintsSettings::SETTINGS_STYLE);
-        m_loop.exec();
-
-        QCOMPARE(m_qpa->themeHint(QPlatformTheme::DialogButtonBoxButtonsHaveIcons).toBool(), true);
-
-        sendNotifyChange(KHintsSettings::IconChanged, 4);
-        m_loop.exec();
-
-        QCOMPARE(m_qpa->themeHint(QPlatformTheme::SystemIconThemeName).toString(), QLatin1String("other-non-existent"));
-    }
-
-    void testPlatformPaletteChanges()
-    {
-        EventTest tester(QGuiApplication::instance(), QEvent::ApplicationPaletteChange);
-        sendNotifyChange(KHintsSettings::PaletteChanged, 0);
-        m_loop.exec();
-        QCOMPARE(tester.gotEvent, true);
-
-        const QPalette *palette = m_qpa->palette();
-        QPalette::ColorGroup states[3] = {QPalette::Active, QPalette::Inactive, QPalette::Disabled};
-        QColor redColor(QColor(174, 11, 11));
-        QBrush redBrush(redColor);
-        for (int i = 0; i < 3; i++) {
-            QCOMPARE(palette->brush(states[i], QPalette::ButtonText), redBrush);
-            QCOMPARE(palette->brush(states[i], QPalette::WindowText), redBrush);
-            QCOMPARE(palette->brush(states[i], QPalette::Window), redBrush);
-            QCOMPARE(palette->brush(states[i], QPalette::Base), redBrush);
-            QCOMPARE(palette->brush(states[i], QPalette::Text), redBrush);
-            QCOMPARE(palette->brush(states[i], QPalette::Button), redBrush);
-            QCOMPARE(palette->brush(states[i], QPalette::ButtonText), redBrush);
-            QCOMPARE(palette->brush(states[i], QPalette::Highlight), redBrush);
-            QCOMPARE(palette->brush(states[i], QPalette::HighlightedText), redBrush);
-            QCOMPARE(palette->brush(states[i], QPalette::ToolTipBase), redBrush);
-            QCOMPARE(palette->brush(states[i], QPalette::ToolTipText), redBrush);
-
-            //KColorScheme applies modifications and we can't disable them, so I extracted
-            //the values and blindly compare them.
-            QCOMPARE(palette->color(states[i], QPalette::Light).red(), 230);
-            QCOMPARE(palette->color(states[i], QPalette::Midlight).red(), 203);
-            QCOMPARE(palette->color(states[i], QPalette::Mid).red(), 149);
-            QCOMPARE(palette->color(states[i], QPalette::Dark).red(), 84);
-            QCOMPARE(palette->color(states[i], QPalette::Shadow).red(), 60);
-
-            QCOMPARE(palette->brush(states[i], QPalette::AlternateBase), redBrush);
-            QCOMPARE(palette->brush(states[i], QPalette::Link), redBrush);
-            QCOMPARE(palette->brush(states[i], QPalette::LinkVisited), redBrush);
-        }
-    }
-};
-
-QTEST_MAIN(KdePlatformTheme_UnitTest)
-
-#include "kdeplatformtheme_unittest.moc"
diff --git a/autotests/kdirselectdialog_unittest.cpp b/autotests/kdirselectdialog_unittest.cpp
deleted file mode 100644
index 2f6416deb739256f1f064e7e86fce87a6d9ac165..0000000000000000000000000000000000000000
--- a/autotests/kdirselectdialog_unittest.cpp
+++ /dev/null
@@ -1,54 +0,0 @@
-/*  This file is part of the KDE libraries
- *  Copyright 2015 Alejandro Fiestas Olivares <afiestas@kde.org>
- *
- *  This library is free software; you can redistribute it and/or modify
- *  it under the terms of the GNU Lesser General Public License as published by
- *  the Free Software Foundation; either version 2 of the License or ( at
- *  your option ) version 3 or, at the discretion of KDE e.V. ( which shall
- *  act as a proxy as in section 14 of the GPLv3 ), any later version.
- *
- *  This library is distributed in the hope that it will be useful,
- *  but WITHOUT ANY WARRANTY; without even the implied warranty of
- *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
- *  Library General Public License for more details.
- *
- *  You should have received a copy of the GNU Lesser General Public License
- *  along with this library; see the file COPYING.LIB.  If not, write to
- *  the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor,
- *  Boston, MA 02110-1301, USA.
- */
-
-#include <QTest>
-#include "../src/platformtheme/kfiletreeview_p.h"
-#include "../src/platformtheme/kdirselectdialog_p.h"
-
-class KDirSelectDialog_UnitTest : public QObject
-{
-    Q_OBJECT
-private Q_SLOTS:
-    void testSetCurrentUrl_data()
-    {
-        QTest::addColumn<QUrl>("url");
-        QTest::addColumn<QUrl>("expectedUrl");
-
-        QTest::newRow("only_scheme") << QUrl(QStringLiteral("trash:")) << QUrl(QStringLiteral("trash:/"));
-        QTest::newRow("with_no_host") << QUrl(QStringLiteral("trash://")) << QUrl(QStringLiteral("trash://"));
-        QTest::newRow("with_root_path") << QUrl(QStringLiteral("trash:///")) << QUrl(QStringLiteral("trash:///"));
-    }
-
-    void testSetCurrentUrl()
-    {
-        QFETCH(QUrl, url);
-        QFETCH(QUrl, expectedUrl);
-
-        KDirSelectDialog dirDialog;
-        dirDialog.setCurrentUrl(url);
-
-        QCOMPARE(dirDialog.rootUrl(), expectedUrl);
-    }
-};
-
-QTEST_MAIN(KDirSelectDialog_UnitTest)
-
-#include "kdirselectdialog_unittest.moc"
-
diff --git a/autotests/kfiledialog_unittest.cpp b/autotests/kfiledialog_unittest.cpp
deleted file mode 100644
index 59915daab24617d3017d84f3f20babe06059a378..0000000000000000000000000000000000000000
--- a/autotests/kfiledialog_unittest.cpp
+++ /dev/null
@@ -1,238 +0,0 @@
-/*  This file is part of the KDE libraries
- *  Copyright 2014 Dominik Haumann <dhaumann@kde.org>
- *
- *  This library is free software; you can redistribute it and/or modify
- *  it under the terms of the GNU Lesser General Public License as published by
- *  the Free Software Foundation; either version 2 of the License or ( at
- *  your option ) version 3 or, at the discretion of KDE e.V. ( which shall
- *  act as a proxy as in section 14 of the GPLv3 ), any later version.
- *
- *  This library is distributed in the hope that it will be useful,
- *  but WITHOUT ANY WARRANTY; without even the implied warranty of
- *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
- *  Library General Public License for more details.
- *
- *  You should have received a copy of the GNU Lesser General Public License
- *  along with this library; see the file COPYING.LIB.  If not, write to
- *  the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor,
- *  Boston, MA 02110-1301, USA.
- */
-
-#include <QTest>
-#include <QFileDialog>
-#include <KFileWidget>
-#include <KDirOperator>
-
-Q_DECLARE_METATYPE(QFileDialog::ViewMode)
-Q_DECLARE_METATYPE(QFileDialog::FileMode)
-Q_DECLARE_METATYPE(KFile::FileView)
-Q_DECLARE_METATYPE(KFile::Modes)
-
-class KFileDialog_UnitTest : public QObject
-{
-    Q_OBJECT
-private Q_SLOTS:
-    void initTestCase()
-    {
-        qputenv("KDE_FORK_SLAVES", "yes");
-    }
-
-    void cleanupTestCase()
-    {
-    }
-
-    void testSetNameFilters()
-    {
-        QFileDialog dialog;
-
-        QStringList nameFilterList = QStringList() << QStringLiteral("c (*.cpp)") << QStringLiteral("h (*.h)");
-        dialog.setNameFilters(nameFilterList);
-        QCOMPARE(dialog.nameFilters(), nameFilterList);
-    }
-
-    void testSelectNameFilter()
-    {
-        QFileDialog dialog;
-
-        QStringList nameFilterList = QStringList() << QStringLiteral("c (*.cpp)") << QStringLiteral("h (*.h)");
-        dialog.setNameFilters(nameFilterList);
-        QCOMPARE(dialog.nameFilters(), nameFilterList);
-
-        QString selectNameFilter(QStringLiteral("h (*.h)"));
-        dialog.selectNameFilter(selectNameFilter);
-        QEXPECT_FAIL("", "Does currently not work. Works, once the dialog gets shown, though.", Continue);
-        QCOMPARE(dialog.selectedNameFilter(), selectNameFilter);
-
-        dialog.show();
-        QCOMPARE(dialog.selectedNameFilter(), selectNameFilter);
-    }
-
-    void testSetDirectory()
-    {
-        QFileDialog dialog;
-        dialog.setDirectory(QDir::rootPath());
-        QCOMPARE(dialog.directory().absolutePath(), QDir::rootPath());
-    }
-
-    void testViewMode()
-    {
-        // Open a file dialog, and change view mode to tree
-        {
-            QFileDialog dialog;
-            dialog.show();
-
-            KFileWidget *fw = findFileWidget();
-            QVERIFY(fw);
-            fw->setViewMode(KFile::Tree);
-            fw->slotCancel(); // the saving happens there
-        }
-        // Open another one, and check that the view mode is now tree, change it to simple
-        {
-            QFileDialog dialog;
-            dialog.show();
-
-            KFileWidget *fw = findFileWidget();
-            QVERIFY(fw);
-            // real show() is delayed to next event.
-            QTest::qWaitForWindowExposed(fw->window());
-            KDirOperator *op = fw->dirOperator();
-            QCOMPARE(fileViewToString(op->viewMode()), fileViewToString(KFile::Tree));
-            fw->setViewMode(KFile::Simple);
-            fw->slotCancel();
-        }
-        // Open another one, and check that the view mode is now simple
-        {
-            QFileDialog dialog;
-            dialog.show();
-
-            KFileWidget *fw = findFileWidget();
-            QVERIFY(fw);
-            KDirOperator *op = fw->dirOperator();
-            QCOMPARE(fileViewToString(op->viewMode()), fileViewToString(KFile::Simple));
-            fw->setViewMode(KFile::Detail);
-            fw->slotCancel();
-        }
-    }
-
-    void testOpenDialog()
-    {
-        // Open parentless
-        {
-            QFileDialog dialog;
-            dialog.open();
-
-            KFileWidget *fw = findFileWidget();
-            QVERIFY(fw);
-            // real show() is delayed to next event.
-            QTest::qWaitForWindowExposed(fw->window());
-            QCOMPARE(fw->isVisible(), true);
-            fw->slotCancel();
-        }
-        // Open with parent
-        {
-            QWidget w;
-            w.show();
-
-            QFileDialog dialog(&w);
-            dialog.open();
-
-            KFileWidget *fw = findFileWidget();
-            QVERIFY(fw);
-            // real show() is delayed to next event.
-            QTest::qWaitForWindowExposed(fw->window());
-            QCOMPARE(fw->isVisible(), true);
-            fw->slotCancel();
-        }
-    }
-
-    void testShowDialog()
-    {
-        // Show parentless
-        {
-            QFileDialog dialog;
-            dialog.show();
-
-            KFileWidget *fw = findFileWidget();
-            QVERIFY(fw);
-            // real show() is delayed to next event.
-            QTest::qWaitForWindowExposed(fw->window());
-            QCOMPARE(fw->isVisible(), true);
-            fw->slotCancel();
-        }
-        // Show with parent
-        {
-            QWidget w;
-            w.show();
-
-            QFileDialog dialog(&w);
-            dialog.show();
-
-            KFileWidget *fw = findFileWidget();
-            QVERIFY(fw);
-            // real show() is delayed to next event.
-            QTest::qWaitForWindowExposed(fw->window());
-            QCOMPARE(fw->isVisible(), true);
-            fw->slotCancel();
-        }
-    }
-
-    void testSetFileMode_data()
-    {
-        QTest::addColumn<QFileDialog::FileMode>("qtFileMode");
-        QTest::addColumn<KFile::Modes>("kdeFileMode");
-        QTest::newRow("anyfile") << QFileDialog::AnyFile << KFile::Modes(KFile::File);
-        QTest::newRow("existingfile") << QFileDialog::ExistingFile << KFile::Modes(KFile::File | KFile::ExistingOnly);
-        QTest::newRow("directory") << QFileDialog::Directory << KFile::Modes(KFile::Directory | KFile::ExistingOnly);
-        QTest::newRow("existingfiles") << QFileDialog::ExistingFiles << KFile::Modes(KFile::Files | KFile::ExistingOnly);
-    }
-
-    void testSetFileMode()
-    {
-        QFETCH(QFileDialog::FileMode, qtFileMode);
-        QFETCH(KFile::Modes, kdeFileMode);
-        QFileDialog dialog;
-        dialog.setFileMode(qtFileMode);
-        dialog.show();
-
-        KFileWidget *fw = findFileWidget();
-        QVERIFY(fw);
-        QCOMPARE(fw->mode(), kdeFileMode);
-
-        QCOMPARE(dialog.fileMode(), qtFileMode);
-    }
-private:
-    static QString fileViewToString(KFile::FileView fv)
-    {
-        switch (fv) {
-            case KFile::Detail:
-                return QStringLiteral("Detail");
-            case KFile::Simple:
-                return QStringLiteral("Simple");
-            case KFile::Tree:
-                return QStringLiteral("Tree");
-            case KFile::DetailTree:
-                return QStringLiteral("DetailTree");
-            default:
-                break;
-        }
-        return QStringLiteral("ERROR");
-    }
-
-    static KFileWidget *findFileWidget()
-    {
-        QList<KFileWidget *> widgets;
-        foreach (QWidget *widget, QApplication::topLevelWidgets()) {
-            KFileWidget *fw = widget->findChild<KFileWidget *>();
-            if (fw) {
-                widgets.append(fw);
-            }
-        }
-        Q_ASSERT(widgets.count() == 1);
-        return (widgets.count() == 1) ? widgets.first() : Q_NULLPTR;
-    }
-};
-
-QTEST_MAIN(KFileDialog_UnitTest)
-
-#include "kfiledialog_unittest.moc"
-
diff --git a/autotests/kfiledialogqml_unittest.cpp b/autotests/kfiledialogqml_unittest.cpp
deleted file mode 100644
index 6e3686ad131656644b0a2b399f989cb226e1f5e9..0000000000000000000000000000000000000000
--- a/autotests/kfiledialogqml_unittest.cpp
+++ /dev/null
@@ -1,97 +0,0 @@
-/*  This file is part of the KDE libraries
- *  Copyright 2014 Dominik Haumann <dhaumann@kde.org>
- *  Copyright 2015 David Rosca <nowrep@gmail.com>
- *
- *  This library is free software; you can redistribute it and/or modify
- *  it under the terms of the GNU Lesser General Public License as published by
- *  the Free Software Foundation; either version 2 of the License or ( at
- *  your option ) version 3 or, at the discretion of KDE e.V. ( which shall
- *  act as a proxy as in section 14 of the GPLv3 ), any later version.
- *
- *  This library is distributed in the hope that it will be useful,
- *  but WITHOUT ANY WARRANTY; without even the implied warranty of
- *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
- *  Library General Public License for more details.
- *
- *  You should have received a copy of the GNU Lesser General Public License
- *  along with this library; see the file COPYING.LIB.  If not, write to
- *  the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor,
- *  Boston, MA 02110-1301, USA.
- */
-
-#include <QTest>
-#include <QQmlEngine>
-#include <QQmlComponent>
-#include <KFileWidget>
-
-class KFileDialogQml_UnitTest : public QObject
-{
-    Q_OBJECT
-
-private Q_SLOTS:
-    void initTestCase()
-    {
-        qputenv("KDE_FORK_SLAVES", "yes");
-    }
-
-    void cleanupTestCase()
-    {
-    }
-
-    void testShowDialogParentless()
-    {
-        KFileWidget *fw;
-        {
-            QQmlEngine engine;
-            QQmlComponent component(&engine);
-            component.loadUrl(QUrl::fromLocalFile(QFINDTESTDATA("qml/filedialog_parentless.qml")));
-            component.create();
-
-            fw = findFileWidget();
-            QVERIFY(fw);
-            // real show() is delayed to next event.
-            QTest::qWaitForWindowExposed(fw->window());
-            QCOMPARE(fw->isVisible(), true);
-            fw->slotCancel();
-        }
-        delete fw;
-    }
-
-    void testShowDialogWithParent()
-    {
-        KFileWidget *fw;
-        {
-            QQmlEngine engine;
-            QQmlComponent component(&engine);
-            component.loadUrl(QUrl::fromLocalFile(QFINDTESTDATA("qml/filedialog_withparent.qml")));
-            component.create();
-
-            fw = findFileWidget();
-            QVERIFY(fw);
-            // real show() is delayed to next event.
-            QTest::qWaitForWindowExposed(fw->window());
-            QCOMPARE(fw->isVisible(), true);
-            fw->slotCancel();
-        }
-        delete fw;
-    }
-
-private:
-    static KFileWidget *findFileWidget()
-    {
-        QList<KFileWidget *> widgets;
-        foreach (QWidget *widget, QApplication::topLevelWidgets()) {
-            KFileWidget *fw = widget->findChild<KFileWidget *>();
-            if (fw) {
-                widgets.append(fw);
-            }
-        }
-        Q_ASSERT(widgets.count() == 1);
-        return (widgets.count() == 1) ? widgets.first() : Q_NULLPTR;
-    }
-};
-
-QTEST_MAIN(KFileDialogQml_UnitTest)
-
-#include "kfiledialogqml_unittest.moc"
-
diff --git a/autotests/kfontsettingsdata_unittest.cpp b/autotests/kfontsettingsdata_unittest.cpp
deleted file mode 100644
index 9f21ffec746897a0e58ebd03fe9defc52a051f16..0000000000000000000000000000000000000000
--- a/autotests/kfontsettingsdata_unittest.cpp
+++ /dev/null
@@ -1,121 +0,0 @@
-/*  This file is part of the KDE libraries
- *  Copyright 2013 Alejandro Fiestas Olivares <afiestas@kde.org>
- *
- *  This library is free software; you can redistribute it and/or modify
- *  it under the terms of the GNU Lesser General Public License as published by
- *  the Free Software Foundation; either version 2 of the License or ( at
- *  your option ) version 3 or, at the discretion of KDE e.V. ( which shall
- *  act as a proxy as in section 14 of the GPLv3 ), any later version.
- *
- *  This library is distributed in the hope that it will be useful,
- *  but WITHOUT ANY WARRANTY; without even the implied warranty of
- *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
- *  Library General Public License for more details.
- *
- *  You should have received a copy of the GNU Lesser General Public License
- *  along with this library; see the file COPYING.LIB.  If not, write to
- *  the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor,
- *  Boston, MA 02110-1301, USA.
- */
-
-#include "kdeplatformtheme_config.h"
-#include "../src/platformtheme/kfontsettingsdata.h"
-
-#include <Qt>
-#include <QTest>
-#include <QDir>
-#include <QFile>
-#include <QString>
-#include <QPalette>
-#include <QIconEngine>
-#include <QApplication>
-#include <QDialogButtonBox>
-
-#include <QDBusMessage>
-#include <QDBusConnection>
-
-#include <QDebug>
-
-static void prepareEnvironment()
-{
-    qputenv("KDEHOME", QFile::encodeName(QDir::homePath() + QStringLiteral("/.kde5-unit-test-platformtheme")));
-    qputenv("XDG_DATA_HOME", QFile::encodeName(QDir::homePath() + QStringLiteral("/.kde5-unit-test-platformtheme/xdg/local")));
-    QByteArray configPath = QFile::encodeName(QDir::homePath() + QStringLiteral("/.kde5-unit-test-platformtheme/xdg/config"));
-    qputenv("XDG_CONFIG_HOME", configPath);
-    qputenv("KDE_SKIP_KDERC", "1");
-    qunsetenv("KDE_COLOR_DEBUG");
-
-    QDir().mkpath(configPath);
-    configPath.append("/kdeglobals");
-    QFile::remove(configPath);
-    QFile::copy(CONFIGFILE, configPath);
-}
-
-// Run prepareEnvironment before qApp is created! slightly incorrect, QFile::encodeName can be wrong then.
-// But we can't use Q_COREAPP_STARTUP_FUNCTION because the platform theme ends up being created
-// first, with the wrong environment.
-Q_CONSTRUCTOR_FUNCTION(prepareEnvironment);
-
-class KFontSettingsData_UnitTest : public QWidget
-{
-    Q_OBJECT
-public:
-    bool event(QEvent *e) Q_DECL_OVERRIDE
-    {
-        if (e->type() == QEvent::ApplicationFontChange) {
-            m_appChangedFont = true;
-        }
-        return QWidget::event(e);
-    }
-private:
-    bool m_appChangedFont;
-    KFontSettingsData *m_fonts;
-private Q_SLOTS:
-    void initTestCase()
-    {
-        m_appChangedFont = false;
-        m_fonts = new KFontSettingsData;
-        qApp->processEvents(); // give time to delayed dbus connect
-    }
-
-    void testFonts()
-    {
-        QCOMPARE(m_fonts->font(KFontSettingsData::GeneralFont)->family(), QStringLiteral("OxyFontTest"));
-        QCOMPARE(m_fonts->font(KFontSettingsData::FixedFont)->family(), QStringLiteral("OxyFixedTest Mono"));
-        QCOMPARE(m_fonts->font(KFontSettingsData::ToolbarFont)->family(), QStringLiteral("OxyToolbarTest"));
-        QCOMPARE(m_fonts->font(KFontSettingsData::MenuFont)->family(), QStringLiteral("OxyMenuTest"));
-        QCOMPARE(m_fonts->font(KFontSettingsData::WindowTitleFont)->family(), QStringLiteral("OxyActiveTest"));
-        QCOMPARE(m_fonts->font(KFontSettingsData::TaskbarFont)->family(), QStringLiteral("OxyTaskbarTest"));
-        QCOMPARE(m_fonts->font(KFontSettingsData::SmallestReadableFont)->family(), QStringLiteral("OxySmallestReadableTest"));
-    }
-
-    void testFontsChanged()
-    {
-        QByteArray configPath = qgetenv("XDG_CONFIG_HOME");
-        configPath.append("/kdeglobals");
-        QFile::remove(configPath);
-        QVERIFY(QFile::copy(CHANGED_CONFIGFILE, configPath));
-
-        QEventLoop loop;
-        QDBusConnection::sessionBus().connect(QString(), QStringLiteral("/KDEPlatformTheme"), QStringLiteral("org.kde.KDEPlatformTheme"),
-                                              QStringLiteral("refreshFonts"), &loop, SLOT(quit()));
-
-        QDBusMessage message = QDBusMessage::createSignal(QStringLiteral("/KDEPlatformTheme"), QStringLiteral("org.kde.KDEPlatformTheme"), QStringLiteral("refreshFonts"));
-        QDBusConnection::sessionBus().send(message);
-        loop.exec();
-
-        QVERIFY(m_appChangedFont);
-        QCOMPARE(m_fonts->font(KFontSettingsData::GeneralFont)->family(), QStringLiteral("ChangedFontTest"));
-        QCOMPARE(m_fonts->font(KFontSettingsData::FixedFont)->family(), QStringLiteral("ChangedFixedTest Mono"));
-        QCOMPARE(m_fonts->font(KFontSettingsData::ToolbarFont)->family(), QStringLiteral("ChangedToolbarTest"));
-        QCOMPARE(m_fonts->font(KFontSettingsData::MenuFont)->family(), QStringLiteral("ChangedMenuTest"));
-        QCOMPARE(m_fonts->font(KFontSettingsData::WindowTitleFont)->family(), QStringLiteral("ChangedActiveTest"));
-        QCOMPARE(m_fonts->font(KFontSettingsData::TaskbarFont)->family(), QStringLiteral("ChangedTaskbarTest"));
-        QCOMPARE(m_fonts->font(KFontSettingsData::SmallestReadableFont)->family(), QStringLiteral("ChangedSmallestReadableTest"));
-    }
-};
-
-QTEST_MAIN(KFontSettingsData_UnitTest)
-
-#include "kfontsettingsdata_unittest.moc"
-
diff --git a/autotests/ksni_unittest.cpp b/autotests/ksni_unittest.cpp
deleted file mode 100644
index cabdd8b29f24da8481f460b16d77bf3f478c8b7f..0000000000000000000000000000000000000000
--- a/autotests/ksni_unittest.cpp
+++ /dev/null
@@ -1,56 +0,0 @@
-/*  This file is part of the KDE libraries
- *  Copyright 2015 Martin Gräßlin <mgraesslin@kde.org>
- *
- *  This library is free software; you can redistribute it and/or modify
- *  it under the terms of the GNU Lesser General Public License as published by
- *  the Free Software Foundation; either version 2 of the License or ( at
- *  your option ) version 3 or, at the discretion of KDE e.V. ( which shall
- *  act as a proxy as in section 14 of the GPLv3 ), any later version.
- *
- *  This library is distributed in the hope that it will be useful,
- *  but WITHOUT ANY WARRANTY; without even the implied warranty of
- *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
- *  Library General Public License for more details.
- *
- *  You should have received a copy of the GNU Lesser General Public License
- *  along with this library; see the file COPYING.LIB.  If not, write to
- *  the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor,
- *  Boston, MA 02110-1301, USA.
- */
-
-#include <QAbstractEventDispatcher>
-#include <QMenu>
-#include <QSignalSpy>
-#include <QSystemTrayIcon>
-#include <QTest>
-
-class KSniUnitTest : public QObject
-{
-    Q_OBJECT
-private Q_SLOTS:
-    // test for BUG 343976
-    void testHideDontCrash();
-};
-
-void KSniUnitTest::testHideDontCrash()
-{
-    QSystemTrayIcon *sti = new QSystemTrayIcon(this);
-    QMenu *trayIconMenu = new QMenu();
-    QAction *dummyAction = new QAction(QStringLiteral("foo"), sti);
-    trayIconMenu->addAction(dummyAction);
-    QSignalSpy menuDestroyedSpy(trayIconMenu, SIGNAL(destroyed()));
-    QVERIFY(menuDestroyedSpy.isValid());
-    sti->setContextMenu(trayIconMenu);
-
-    connect(sti, &QSystemTrayIcon::destroyed, trayIconMenu, &QMenu::deleteLater);
-    sti->setVisible(true);
-    sti->show();
-
-    // now delete it
-    delete sti;
-    QVERIFY(menuDestroyedSpy.wait());
-}
-
-QTEST_MAIN(KSniUnitTest)
-
-#include "ksni_unittest.moc"
diff --git a/autotests/qml/filedialog_parentless.qml b/autotests/qml/filedialog_parentless.qml
deleted file mode 100644
index c1c96fbc0e1eeeb9df75eceda0fa91e85b459e62..0000000000000000000000000000000000000000
--- a/autotests/qml/filedialog_parentless.qml
+++ /dev/null
@@ -1,27 +0,0 @@
-/*  This file is part of the KDE libraries
- *  Copyright 2015 David Rosca <nowrep@gmail.com>
- *
- *  This library is free software; you can redistribute it and/or modify
- *  it under the terms of the GNU Lesser General Public License as published by
- *  the Free Software Foundation; either version 2 of the License or ( at
- *  your option ) version 3 or, at the discretion of KDE e.V. ( which shall
- *  act as a proxy as in section 14 of the GPLv3 ), any later version.
- *
- *  This library is distributed in the hope that it will be useful,
- *  but WITHOUT ANY WARRANTY; without even the implied warranty of
- *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
- *  Library General Public License for more details.
- *
- *  You should have received a copy of the GNU Lesser General Public License
- *  along with this library; see the file COPYING.LIB.  If not, write to
- *  the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor,
- *  Boston, MA 02110-1301, USA.
- */
-
-import QtQuick 2.2
-import QtQuick.Dialogs 1.0
-
-FileDialog {
-    id: fileDialog
-    Component.onCompleted: visible = true
-}
diff --git a/autotests/qml/filedialog_withparent.qml b/autotests/qml/filedialog_withparent.qml
deleted file mode 100644
index 5915ccf4b406e2406ccb1f0d024a8d9f16f8e221..0000000000000000000000000000000000000000
--- a/autotests/qml/filedialog_withparent.qml
+++ /dev/null
@@ -1,35 +0,0 @@
-/*  This file is part of the KDE libraries
- *  Copyright 2015 David Rosca <nowrep@gmail.com>
- *
- *  This library is free software; you can redistribute it and/or modify
- *  it under the terms of the GNU Lesser General Public License as published by
- *  the Free Software Foundation; either version 2 of the License or ( at
- *  your option ) version 3 or, at the discretion of KDE e.V. ( which shall
- *  act as a proxy as in section 14 of the GPLv3 ), any later version.
- *
- *  This library is distributed in the hope that it will be useful,
- *  but WITHOUT ANY WARRANTY; without even the implied warranty of
- *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
- *  Library General Public License for more details.
- *
- *  You should have received a copy of the GNU Lesser General Public License
- *  along with this library; see the file COPYING.LIB.  If not, write to
- *  the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor,
- *  Boston, MA 02110-1301, USA.
- */
-
-import QtQuick 2.2
-import QtQuick.Window 2.2
-import QtQuick.Dialogs 1.0
-
-Window {
-    x: 100
-    y: 100
-    width: 100
-    height: 100
-
-    FileDialog {
-        id: fileDialog
-        Component.onCompleted: visible = true
-    }
-}
diff --git a/src/CMakeLists.txt b/src/CMakeLists.txt
index 339192d11261b9a558895dd73955fecbeee2ca0b..1c54eb262e4e4f094114e2469fe7270ef3fac142 100644
--- a/src/CMakeLists.txt
+++ b/src/CMakeLists.txt
@@ -1,4 +1,3 @@
 add_subdirectory(integrationplugin)
-add_subdirectory(platformtheme)
 add_subdirectory(kstyle)
 add_subdirectory(infopage)
diff --git a/src/platformtheme/CMakeLists.txt b/src/platformtheme/CMakeLists.txt
deleted file mode 100644
index 23f590ee48d3e395aecf347c5f92cd1bf4a48bbe..0000000000000000000000000000000000000000
--- a/src/platformtheme/CMakeLists.txt
+++ /dev/null
@@ -1,65 +0,0 @@
-if(NOT APPLE)
-  find_package(XCB COMPONENTS XCB)
-  set_package_properties(XCB PROPERTIES
-    TYPE RECOMMENDED
-    PURPOSE "Required for flushing the XCB connection on the X11 Platform"
-  )
-  set(HAVE_X11 ${XCB_XCB_FOUND})
-  if (XCB_XCB_FOUND)
-    find_package(Qt5 ${REQUIRED_QT_VERSION} CONFIG REQUIRED X11Extras)
-    find_package(X11)
-    set_package_properties(X11 PROPERTIES DESCRIPTION "Required for updating the Cursor theme on X11"
-                           URL "http://www.x.org"
-                           TYPE REQUIRED
-                           )
-  endif()
-else()
-    set(HAVE_X11 FALSE)
-endif()
-
-configure_file(config-platformtheme.h.cmake ${CMAKE_CURRENT_BINARY_DIR}/config-platformtheme.h )
-
-set(platformtheme_SRCS
-    kdeplatformtheme.cpp
-    kfontsettingsdata.cpp
-    khintssettings.cpp
-    kdeplatformfiledialoghelper.cpp
-    kdeplatformfiledialogbase.cpp
-    kdeplatformsystemtrayicon.cpp
-    kfiletreeview.cpp
-    kdirselectdialog.cpp
-    main.cpp
-)
-
-include_directories(
-    ${Qt5Gui_PRIVATE_INCLUDE_DIRS}
-)
-remove_definitions(-DQT_NO_CAST_FROM_ASCII)
-
-add_library(KDEPlatformTheme MODULE ${platformtheme_SRCS})
-
-target_link_libraries(KDEPlatformTheme
-    PRIVATE
-        Qt5::DBus
-        KF5::ConfigWidgets
-        KF5::ConfigCore
-        KF5::IconThemes
-        KF5::KIOFileWidgets # KFileFilterCombo, KDirSortFilterProxyModel, KRecentDirs
-        KF5::KIOWidgets
-        KF5::XmlGui
-        KF5::I18n
-        KF5::Notifications
-)
-
-if(HAVE_X11)
-  target_link_libraries(KDEPlatformTheme PRIVATE Qt5::X11Extras XCB::XCB ${X11_Xcursor_LIB})
-endif()
-
-install(TARGETS KDEPlatformTheme DESTINATION ${KDE_INSTALL_QTPLUGINDIR}/platformthemes)
-
-install(FILES frameworksintegration-5.16-font.upd
-  DESTINATION ${KDE_INSTALL_KCONFUPDATEDIR}
-  )
-install(PROGRAMS frameworksintegration-5.16-font.sh
-  DESTINATION ${KDE_INSTALL_KCONFUPDATEDIR}
-  )
diff --git a/src/platformtheme/config-platformtheme.h.cmake b/src/platformtheme/config-platformtheme.h.cmake
deleted file mode 100644
index 89858d17de239cfc7eed1f40a8b828803de3299c..0000000000000000000000000000000000000000
--- a/src/platformtheme/config-platformtheme.h.cmake
+++ /dev/null
@@ -1 +0,0 @@
-#cmakedefine01 HAVE_X11
diff --git a/src/platformtheme/frameworksintegration-5.16-font.sh b/src/platformtheme/frameworksintegration-5.16-font.sh
deleted file mode 100644
index 9a202a17815c60f9d413a48090cfa7a5532a5e1b..0000000000000000000000000000000000000000
--- a/src/platformtheme/frameworksintegration-5.16-font.sh
+++ /dev/null
@@ -1,3 +0,0 @@
-#!/bin/sh
-
-sed -i "s/Oxygen-Sans/Noto Sans/" `kf5-config --path config --locate kdeglobals`
diff --git a/src/platformtheme/frameworksintegration-5.16-font.upd b/src/platformtheme/frameworksintegration-5.16-font.upd
deleted file mode 100644
index ae7f797b9963f030dbf06909483969bb29718b7a..0000000000000000000000000000000000000000
--- a/src/platformtheme/frameworksintegration-5.16-font.upd
+++ /dev/null
@@ -1,5 +0,0 @@
-Version=5
-
-# Update entry in kdeglobals for new font requested by VDG
-Id=frameworksintegration-5.16-font.sh
-Script=frameworksintegration-5.16-font.sh,sh
diff --git a/src/platformtheme/kdeplatformfiledialogbase.cpp b/src/platformtheme/kdeplatformfiledialogbase.cpp
deleted file mode 100644
index 856c052dffd2436399ed02dd9a8a4467c2fd18f2..0000000000000000000000000000000000000000
--- a/src/platformtheme/kdeplatformfiledialogbase.cpp
+++ /dev/null
@@ -1,47 +0,0 @@
-/*  This file is part of the KDE libraries
- *  Copyright 2013 Aleix Pol Gonzalez <aleixpol@blue-systems.com>
- *
- *  This library is free software; you can redistribute it and/or modify
- *  it under the terms of the GNU Lesser General Public License as published by
- *  the Free Software Foundation; either version 2 of the License or ( at
- *  your option ) version 3 or, at the discretion of KDE e.V. ( which shall
- *  act as a proxy as in section 14 of the GPLv3 ), any later version.
- *
- *  This library is distributed in the hope that it will be useful,
- *  but WITHOUT ANY WARRANTY; without even the implied warranty of
- *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
- *  Library General Public License for more details.
- *
- *  You should have received a copy of the GNU Lesser General Public License
- *  along with this library; see the file COPYING.LIB.  If not, write to
- *  the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor,
- *  Boston, MA 02110-1301, USA.
- */
-
-#include "kdeplatformfiledialogbase_p.h"
-
-KDEPlatformFileDialogBase::KDEPlatformFileDialogBase()
-{
-    m_timer.setInterval(0);
-    m_timer.setSingleShot(true);
-    connect(&m_timer, &QTimer::timeout, this, &KDEPlatformFileDialogBase::show);
-}
-
-void KDEPlatformFileDialogBase::delayedShow()
-{
-    m_timer.start();
-}
-
-void KDEPlatformFileDialogBase::discardDelayedShow()
-{
-    // this is used when hide() is called before timer triggers.
-    m_timer.stop();
-}
-
-void KDEPlatformFileDialogBase::closeEvent(QCloseEvent *e)
-{
-    Q_EMIT closed();
-    QDialog::closeEvent(e);
-}
-
-#include "moc_kdeplatformfiledialogbase_p.cpp"
diff --git a/src/platformtheme/kdeplatformfiledialogbase_p.h b/src/platformtheme/kdeplatformfiledialogbase_p.h
deleted file mode 100644
index 3191027bb1d10a70c2a01ef36007e0780ccb633a..0000000000000000000000000000000000000000
--- a/src/platformtheme/kdeplatformfiledialogbase_p.h
+++ /dev/null
@@ -1,61 +0,0 @@
-/*  This file is part of the KDE libraries
- *  Copyright 2013 Aleix Pol Gonzalez <aleixpol@blue-systems.com>
- *
- *  This library is free software; you can redistribute it and/or modify
- *  it under the terms of the GNU Lesser General Public License as published by
- *  the Free Software Foundation; either version 2 of the License or ( at
- *  your option ) version 3 or, at the discretion of KDE e.V. ( which shall
- *  act as a proxy as in section 14 of the GPLv3 ), any later version.
- *
- *  This library is distributed in the hope that it will be useful,
- *  but WITHOUT ANY WARRANTY; without even the implied warranty of
- *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
- *  Library General Public License for more details.
- *
- *  You should have received a copy of the GNU Lesser General Public License
- *  along with this library; see the file COPYING.LIB.  If not, write to
- *  the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor,
- *  Boston, MA 02110-1301, USA.
- */
-
-#ifndef KDEPLATFORMFILEDIALOGBASE_H
-#define KDEPLATFORMFILEDIALOGBASE_H
-
-#include <QDialog>
-#include <QUrl>
-#include <QTimer>
-
-class KFileWidget;
-class QDialogButtonBox;
-class KDEPlatformFileDialogBase : public QDialog
-{
-    Q_OBJECT
-public:
-    friend class KDEPlatformFileDialogHelper;
-
-    explicit KDEPlatformFileDialogBase();
-    virtual QUrl directory() = 0;
-    virtual void selectNameFilter(const QString &filter) = 0;
-    virtual void setDirectory(const QUrl &directory) = 0;
-    virtual void selectFile(const QUrl &filename) = 0;
-    virtual QString selectedNameFilter() = 0;
-    virtual QList<QUrl> selectedFiles() = 0;
-
-    void delayedShow();
-    void discardDelayedShow();
-
-Q_SIGNALS:
-    void closed();
-    void fileSelected(const QUrl &file);
-    void filesSelected(const QList<QUrl> &files);
-    void currentChanged(const QUrl &path);
-    void directoryEntered(const QUrl &directory);
-    void filterSelected(const QString &filter);
-
-protected:
-    void closeEvent(QCloseEvent *e) Q_DECL_OVERRIDE;
-    QDialogButtonBox *m_buttons;
-    QTimer m_timer;
-};
-
-#endif
diff --git a/src/platformtheme/kdeplatformfiledialoghelper.h b/src/platformtheme/kdeplatformfiledialoghelper.h
deleted file mode 100644
index f80b8c78e455312acff23b0461a6f1131b360431..0000000000000000000000000000000000000000
--- a/src/platformtheme/kdeplatformfiledialoghelper.h
+++ /dev/null
@@ -1,81 +0,0 @@
-/*  This file is part of the KDE libraries
- *  Copyright 2013 Aleix Pol Gonzalez <aleixpol@blue-systems.com>
- *
- *  This library is free software; you can redistribute it and/or modify
- *  it under the terms of the GNU Lesser General Public License as published by
- *  the Free Software Foundation; either version 2 of the License or ( at
- *  your option ) version 3 or, at the discretion of KDE e.V. ( which shall
- *  act as a proxy as in section 14 of the GPLv3 ), any later version.
- *
- *  This library is distributed in the hope that it will be useful,
- *  but WITHOUT ANY WARRANTY; without even the implied warranty of
- *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
- *  Library General Public License for more details.
- *
- *  You should have received a copy of the GNU Lesser General Public License
- *  along with this library; see the file COPYING.LIB.  If not, write to
- *  the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor,
- *  Boston, MA 02110-1301, USA.
- */
-
-#ifndef KDEPLATFORMFILEDIALOGHELPER_H
-#define KDEPLATFORMFILEDIALOGHELPER_H
-
-#include <qpa/qplatformdialoghelper.h>
-#include "kdeplatformfiledialogbase_p.h"
-
-class KFileWidget;
-class QDialogButtonBox;
-class KDEPlatformFileDialog : public KDEPlatformFileDialogBase
-{
-    Q_OBJECT
-public:
-    friend class KDEPlatformFileDialogHelper;
-
-    explicit KDEPlatformFileDialog();
-    QUrl directory() Q_DECL_OVERRIDE;
-    void selectNameFilter(const QString &filter) Q_DECL_OVERRIDE;
-    void setDirectory(const QUrl &directory) Q_DECL_OVERRIDE;
-    void selectFile(const QUrl &filename) Q_DECL_OVERRIDE;
-    void setViewMode(QFileDialogOptions::ViewMode view);
-    void setFileMode(QFileDialogOptions::FileMode mode);
-    void setCustomLabel(QFileDialogOptions::DialogLabel label, const QString & text);
-    QString selectedNameFilter() Q_DECL_OVERRIDE;
-    QList<QUrl> selectedFiles() Q_DECL_OVERRIDE;
-
-protected:
-    KFileWidget *m_fileWidget;
-};
-
-class KDEPlatformFileDialogHelper : public QPlatformFileDialogHelper
-{
-    Q_OBJECT
-public:
-    KDEPlatformFileDialogHelper();
-    virtual ~KDEPlatformFileDialogHelper();
-
-    void initializeDialog();
-
-    bool defaultNameFilterDisables() const Q_DECL_OVERRIDE;
-    QUrl directory() const Q_DECL_OVERRIDE;
-    QList<QUrl> selectedFiles() const Q_DECL_OVERRIDE;
-    QString selectedNameFilter() const Q_DECL_OVERRIDE;
-    void selectNameFilter(const QString &filter) Q_DECL_OVERRIDE;
-    void selectFile(const QUrl &filename) Q_DECL_OVERRIDE;
-    void setFilter() Q_DECL_OVERRIDE;
-    void setDirectory(const QUrl &directory) Q_DECL_OVERRIDE;
-    bool isSupportedUrl(const QUrl& url) const Q_DECL_OVERRIDE;
-
-    void exec() Q_DECL_OVERRIDE;
-    void hide() Q_DECL_OVERRIDE;
-    bool show(Qt::WindowFlags windowFlags, Qt::WindowModality windowModality, QWindow *parent) Q_DECL_OVERRIDE;
-
-private Q_SLOTS:
-    void saveSize();
-
-private:
-    void restoreSize();
-    KDEPlatformFileDialogBase *m_dialog;
-};
-
-#endif // KDEPLATFORMFILEDIALOGHELPER_H
diff --git a/src/platformtheme/kdeplatformfiledialoghelper.cpp b/src/platformtheme/kdeplatformfiledialoghelper.cpp
deleted file mode 100644
index 8b2ff6bc27048b41cd1c14a0c763179514ef0165..0000000000000000000000000000000000000000
--- a/src/platformtheme/kdeplatformfiledialoghelper.cpp
+++ /dev/null
@@ -1,390 +0,0 @@
-/*  This file is part of the KDE libraries
- *  Copyright 2013 Aleix Pol Gonzalez <aleixpol@blue-systems.com>
- *  Copyright 2014 Martin Klapetek <mklapetek@kde.org>
- *
- *  This library is free software; you can redistribute it and/or modify
- *  it under the terms of the GNU Lesser General Public License as published by
- *  the Free Software Foundation; either version 2 of the License or ( at
- *  your option ) version 3 or, at the discretion of KDE e.V. ( which shall
- *  act as a proxy as in section 14 of the GPLv3 ), any later version.
- *
- *  This library is distributed in the hope that it will be useful,
- *  but WITHOUT ANY WARRANTY; without even the implied warranty of
- *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
- *  Library General Public License for more details.
- *
- *  You should have received a copy of the GNU Lesser General Public License
- *  along with this library; see the file COPYING.LIB.  If not, write to
- *  the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor,
- *  Boston, MA 02110-1301, USA.
- */
-
-#include "kdeplatformfiledialoghelper.h"
-#include "kdeplatformfiledialogbase_p.h"
-#include "kdirselectdialog_p.h"
-
-#include <kfilefiltercombo.h>
-#include <kfilewidget.h>
-#include <klocalizedstring.h>
-#include <kdiroperator.h>
-#include <KUrlComboBox>
-#include <KSharedConfig>
-#include <KWindowConfig>
-#include <KProtocolInfo>
-#include <QVBoxLayout>
-#include <QDialogButtonBox>
-#include <QPushButton>
-#include <QWindow>
-
-#include <KIO/StatJob>
-#include <KJobWidgets>
-
-#include <QTextStream>
-
-namespace
-{
-
-/*
- * Map a Qt filter string into a KDE one.
- */
-static QString qt2KdeFilter(const QStringList &f)
-{
-    QString               filter;
-    QTextStream           str(&filter, QIODevice::WriteOnly);
-    QStringList           list(f);
-    list.replaceInStrings(QStringLiteral("/"), QStringLiteral("\\/"));
-    QStringList::const_iterator it(list.constBegin()), end(list.constEnd());
-    bool                  first = true;
-
-    for (; it != end; ++it) {
-        int ob = it->lastIndexOf('('),
-            cb = it->lastIndexOf(')');
-
-        if (-1 != cb && ob < cb) {
-            if (first) {
-                first = false;
-            } else {
-                str << '\n';
-            }
-            str << it->mid(ob + 1, (cb - ob) - 1) << '|' << it->mid(0, ob);
-        }
-    }
-
-    return filter;
-}
-
-/*
- * Map a KDE filter string into a Qt one.
- */
-static QString kde2QtFilter(const QStringList &list, const QString &kde)
-{
-    QStringList::const_iterator it(list.constBegin()), end(list.constEnd());
-    int                   pos;
-    QString               sel;
-
-    for (; it != end; ++it) {
-        if (-1 != (pos = it->indexOf(kde)) && pos > 0 &&
-                ('(' == (*it)[pos - 1] || ' ' == (*it)[pos - 1]) &&
-                it->length() >= kde.length() + pos &&
-                (')' == (*it)[pos + kde.length()] || ' ' == (*it)[pos + kde.length()])) {
-            return *it;
-        }
-    }
-    return QString();
-}
-}
-
-KDEPlatformFileDialog::KDEPlatformFileDialog()
-    : KDEPlatformFileDialogBase()
-    , m_fileWidget(new KFileWidget(QUrl(), this))
-{
-    setLayout(new QVBoxLayout);
-    connect(m_fileWidget, SIGNAL(filterChanged(QString)), SIGNAL(filterSelected(QString)));
-    layout()->addWidget(m_fileWidget);
-
-    m_buttons = new QDialogButtonBox(this);
-    m_buttons->addButton(m_fileWidget->okButton(), QDialogButtonBox::AcceptRole);
-    m_buttons->addButton(m_fileWidget->cancelButton(), QDialogButtonBox::RejectRole);
-    connect(m_buttons, SIGNAL(rejected()), m_fileWidget, SLOT(slotCancel()));
-    connect(m_fileWidget->okButton(), SIGNAL(clicked(bool)), m_fileWidget, SLOT(slotOk()));
-    connect(m_fileWidget, SIGNAL(accepted()), m_fileWidget, SLOT(accept()));
-    connect(m_fileWidget, SIGNAL(accepted()), SLOT(accept()));
-    connect(m_fileWidget->cancelButton(), SIGNAL(clicked(bool)), SLOT(reject()));
-    layout()->addWidget(m_buttons);
-}
-
-QUrl KDEPlatformFileDialog::directory()
-{
-    return m_fileWidget->baseUrl();
-}
-
-QList<QUrl> KDEPlatformFileDialog::selectedFiles()
-{
-    return m_fileWidget->selectedUrls();
-}
-
-void KDEPlatformFileDialog::selectFile(const QUrl &filename)
-{
-    QUrl dirUrl = filename.adjusted(QUrl::RemoveFilename);
-    m_fileWidget->setUrl(dirUrl);
-    m_fileWidget->setSelection(filename.fileName());
-}
-
-void KDEPlatformFileDialog::setViewMode(QFileDialogOptions::ViewMode view)
-{
-    switch (view) {
-    case QFileDialogOptions::ViewMode::Detail:
-        m_fileWidget->setViewMode(KFile::FileView::Detail);
-        break;
-    case QFileDialogOptions::ViewMode::List:
-        m_fileWidget->setViewMode(KFile::FileView::Simple);
-        break;
-    default:
-        m_fileWidget->setViewMode(KFile::FileView::Default);
-        break;
-    }
-}
-
-void KDEPlatformFileDialog::setFileMode(QFileDialogOptions::FileMode mode)
-{
-    switch (mode) {
-    case QFileDialogOptions::FileMode::AnyFile:
-        m_fileWidget->setMode(KFile::File);
-        break;
-    case QFileDialogOptions::FileMode::ExistingFile:
-        m_fileWidget->setMode(KFile::Mode::File | KFile::Mode::ExistingOnly);
-        break;
-    case QFileDialogOptions::FileMode::Directory:
-        m_fileWidget->setMode(KFile::Mode::Directory | KFile::Mode::ExistingOnly);
-        break;
-    case QFileDialogOptions::FileMode::ExistingFiles:
-        m_fileWidget->setMode(KFile::Mode::Files | KFile::Mode::ExistingOnly);
-        break;
-    default:
-        m_fileWidget->setMode(KFile::File);
-        break;
-    }
-}
-
-void KDEPlatformFileDialog::setCustomLabel(QFileDialogOptions::DialogLabel label, const QString &text)
-{
-    if (label == QFileDialogOptions::Accept) { // OK button
-        m_fileWidget->okButton()->setText(text);
-    } else if (label == QFileDialogOptions::Reject) { // Cancel button
-        m_fileWidget->cancelButton()->setText(text);
-    } else if (label == QFileDialogOptions::LookIn) { // Location label
-        m_fileWidget->setLocationLabel(text);
-    }
-}
-
-QString KDEPlatformFileDialog::selectedNameFilter()
-{
-    return m_fileWidget->filterWidget()->currentFilter();
-}
-
-void KDEPlatformFileDialog::selectNameFilter(const QString &filter)
-{
-    m_fileWidget->filterWidget()->setCurrentFilter(filter);
-}
-
-void KDEPlatformFileDialog::setDirectory(const QUrl &directory)
-{
-    if (!directory.isLocalFile())  {
-        // Qt can not determine if the remote URL points to a file or a
-        // directory, that is why options()->initialDirectory() always returns
-        // the full URL.
-        KIO::StatJob *job = KIO::stat(directory);
-        KJobWidgets::setWindow(job, this);
-        if (job->exec()) {
-            KIO::UDSEntry entry = job->statResult();
-            if (!entry.isDir()) {
-                // this is probably a file remove the file part
-                m_fileWidget->setUrl(directory.adjusted(QUrl::RemoveFilename));
-                m_fileWidget->setSelection(directory.fileName());
-            }
-            else {
-                m_fileWidget->setUrl(directory);
-            }
-        }
-    }
-    else {
-        m_fileWidget->setUrl(directory);
-    }
-}
-
-bool KDEPlatformFileDialogHelper::isSupportedUrl(const QUrl& url) const
-{
-    return KProtocolInfo::protocols().contains(url.scheme());
-}
-
-////////////////////////////////////////////////
-
-KDEPlatformFileDialogHelper::KDEPlatformFileDialogHelper()
-    : QPlatformFileDialogHelper()
-    , m_dialog(new KDEPlatformFileDialog)
-{
-    connect(m_dialog, SIGNAL(closed()), SLOT(saveSize()));
-    connect(m_dialog, SIGNAL(finished(int)), SLOT(saveSize()));
-    connect(m_dialog, SIGNAL(currentChanged(QUrl)), SIGNAL(currentChanged(QUrl)));
-    connect(m_dialog, SIGNAL(directoryEntered(QUrl)), SIGNAL(directoryEntered(QUrl)));
-    connect(m_dialog, SIGNAL(fileSelected(QUrl)), SIGNAL(fileSelected(QUrl)));
-    connect(m_dialog, SIGNAL(filesSelected(QList<QUrl>)), SIGNAL(filesSelected(QList<QUrl>)));
-    connect(m_dialog, SIGNAL(filterSelected(QString)), SIGNAL(filterSelected(QString)));
-    connect(m_dialog, SIGNAL(accepted()), SIGNAL(accept()));
-    connect(m_dialog, SIGNAL(rejected()), SIGNAL(reject()));
-}
-
-KDEPlatformFileDialogHelper::~KDEPlatformFileDialogHelper()
-{
-    saveSize();
-    delete m_dialog;
-}
-
-void KDEPlatformFileDialogHelper::initializeDialog()
-{
-    if (options()->testOption(QFileDialogOptions::ShowDirsOnly)) {
-        m_dialog->deleteLater();
-        m_dialog = new KDirSelectDialog(
-#if QT_VERSION >= QT_VERSION_CHECK(5,5,0)
-            options()->initialDirectory()
-#else
-            m_dialog->directory()
-#endif
-        );
-        connect(m_dialog, SIGNAL(accepted()), SIGNAL(accept()));
-        connect(m_dialog, SIGNAL(rejected()), SIGNAL(reject()));
-        if (!options()->windowTitle().isEmpty())
-            m_dialog->setWindowTitle(options()->windowTitle());
-    } else {
-        // needed for accessing m_fileWidget
-        KDEPlatformFileDialog *dialog = qobject_cast<KDEPlatformFileDialog*>(m_dialog);
-        dialog->m_fileWidget->setOperationMode(options()->acceptMode() == QFileDialogOptions::AcceptOpen ? KFileWidget::Opening : KFileWidget::Saving);
-        if (options()->windowTitle().isEmpty()) {
-            dialog->setWindowTitle(options()->acceptMode() == QFileDialogOptions::AcceptOpen ? i18n("Opening...") : i18n("Saving..."));
-        } else {
-            dialog->setWindowTitle(options()->windowTitle());
-        }
-#if QT_VERSION >= QT_VERSION_CHECK(5,5,0)
-        setDirectory(options()->initialDirectory());
-#endif
-        //dialog->setViewMode(options()->viewMode()); // don't override our options, fixes remembering the chosen view mode and sizes!
-        dialog->setFileMode(options()->fileMode());
-
-        // custom labels
-        if (options()->isLabelExplicitlySet(QFileDialogOptions::Accept)) { // OK button
-            dialog->setCustomLabel(QFileDialogOptions::Accept, options()->labelText(QFileDialogOptions::Accept));
-        } else if (options()->isLabelExplicitlySet(QFileDialogOptions::Reject)) { // Cancel button
-            dialog->setCustomLabel(QFileDialogOptions::Reject, options()->labelText(QFileDialogOptions::Reject));
-        } else if (options()->isLabelExplicitlySet(QFileDialogOptions::LookIn)) { // Location label
-            dialog->setCustomLabel(QFileDialogOptions::LookIn, options()->labelText(QFileDialogOptions::LookIn));
-        }
-
-        const QStringList mimeFilters = options()->mimeTypeFilters();
-        const QStringList nameFilters = options()->nameFilters();
-        if (!mimeFilters.isEmpty()) {
-            dialog->m_fileWidget->setMimeFilter(mimeFilters);
-
-            if ( mimeFilters.contains( QStringLiteral("inode/directory") ) )
-                dialog->m_fileWidget->setMode( dialog->m_fileWidget->mode() | KFile::Directory );
-        } else if (!nameFilters.isEmpty()) {
-            dialog->m_fileWidget->setFilter(qt2KdeFilter(nameFilters));
-        }
-
-        if (!options()->initiallySelectedNameFilter().isEmpty()) {
-            selectNameFilter(options()->initiallySelectedNameFilter());
-        }
-
-        // overwrite option
-        if (options()->testOption(QFileDialogOptions::FileDialogOption::DontConfirmOverwrite)) {
-            dialog->m_fileWidget->setConfirmOverwrite(false);
-        }
-    }
-}
-
-void KDEPlatformFileDialogHelper::exec()
-{
-    restoreSize();
-    // KDEPlatformFileDialog::show() will always be called during QFileDialog::exec()
-    // discard the delayed show() it and use exec() and it will call show() for us.
-    // We can't hide and show it here because of https://bugreports.qt.io/browse/QTBUG-48248
-    m_dialog->discardDelayedShow();
-    m_dialog->exec();
-}
-
-void KDEPlatformFileDialogHelper::hide()
-{
-    m_dialog->discardDelayedShow();
-    m_dialog->hide();
-}
-
-void KDEPlatformFileDialogHelper::saveSize()
-{
-    KSharedConfig::Ptr conf = KSharedConfig::openConfig();
-    KConfigGroup group = conf->group("FileDialogSize");
-    KWindowConfig::saveWindowSize(m_dialog->windowHandle(), group);
-}
-
-void KDEPlatformFileDialogHelper::restoreSize()
-{
-    m_dialog->winId(); // ensure there's a window created
-    KSharedConfig::Ptr conf = KSharedConfig::openConfig();
-    KWindowConfig::restoreWindowSize(m_dialog->windowHandle(), conf->group("FileDialogSize"));
-    // NOTICE: QWindow::setGeometry() does NOT impact the backing QWidget geometry even if the platform
-    // window was created -> QTBUG-40584. We therefore copy the size here.
-    // TODO: remove once this was resolved in QWidget QPA
-    m_dialog->resize(m_dialog->windowHandle()->size());
-}
-
-bool KDEPlatformFileDialogHelper::show(Qt::WindowFlags windowFlags, Qt::WindowModality windowModality, QWindow *parent)
-{
-    Q_UNUSED(parent)
-    initializeDialog();
-    m_dialog->setWindowFlags(windowFlags);
-    m_dialog->setWindowModality(windowModality);
-    restoreSize();
-    // Use a delayed show here to delay show() after the internal Qt invisible QDialog.
-    // The delayed call shouldn't matter, because for other "real" native QPlatformDialog
-    // implementation like Mac and Windows, the native dialog is not necessarily
-    // show up immediately.
-    m_dialog->delayedShow();
-    return true;
-}
-
-QList<QUrl> KDEPlatformFileDialogHelper::selectedFiles() const
-{
-    return m_dialog->selectedFiles();
-}
-
-QString KDEPlatformFileDialogHelper::selectedNameFilter() const
-{
-    return kde2QtFilter(options()->nameFilters(), m_dialog->selectedNameFilter());
-}
-
-QUrl KDEPlatformFileDialogHelper::directory() const
-{
-    return m_dialog->directory();
-}
-
-void KDEPlatformFileDialogHelper::selectFile(const QUrl &filename)
-{
-    m_dialog->selectFile(filename);
-}
-
-void KDEPlatformFileDialogHelper::setDirectory(const QUrl &directory)
-{
-    m_dialog->setDirectory(directory);
-}
-
-void KDEPlatformFileDialogHelper::selectNameFilter(const QString &filter)
-{
-    m_dialog->selectNameFilter(qt2KdeFilter(QStringList(filter)));
-}
-
-void KDEPlatformFileDialogHelper::setFilter()
-{
-}
-
-bool KDEPlatformFileDialogHelper::defaultNameFilterDisables() const
-{
-    return false;
-}
diff --git a/src/platformtheme/kdeplatformsystemtrayicon.h b/src/platformtheme/kdeplatformsystemtrayicon.h
deleted file mode 100644
index 502942e7a0648312757fe2eb7d844f7bddbdd902..0000000000000000000000000000000000000000
--- a/src/platformtheme/kdeplatformsystemtrayicon.h
+++ /dev/null
@@ -1,119 +0,0 @@
-/*  This file is part of the KDE libraries
- *  Copyright 2014 Martin Gräßlin <mgraesslin@kde.org>
- *
- *  This library is free software; you can redistribute it and/or modify
- *  it under the terms of the GNU Lesser General Public License as published by
- *  the Free Software Foundation; either version 2 of the License or ( at
- *  your option ) version 3 or, at the discretion of KDE e.V. ( which shall
- *  act as a proxy as in section 14 of the GPLv3 ), any later version.
- *
- *  This library is distributed in the hope that it will be useful,
- *  but WITHOUT ANY WARRANTY; without even the implied warranty of
- *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
- *  Library General Public License for more details.
- *
- *  You should have received a copy of the GNU Lesser General Public License
- *  along with this library; see the file COPYING.LIB.  If not, write to
- *  the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor,
- *  Boston, MA 02110-1301, USA.
- */
-#ifndef KDEPLATFORMSYSTEMTRAYICON_H
-#define KDEPLATFORMSYSTEMTRAYICON_H
-
-#include <qpa/qplatformmenu.h>
-#include <qpa/qplatformsystemtrayicon.h>
-
-class KStatusNotifierItem;
-class SystemTrayMenuItem;
-class QAction;
-class QMenu;
-
-#if (QT_VERSION >= QT_VERSION_CHECK(5, 3, 0))
-class SystemTrayMenu : public QPlatformMenu
-{
-    Q_OBJECT
-public:
-    SystemTrayMenu();
-    ~SystemTrayMenu() Q_DECL_OVERRIDE;
-    void insertMenuItem(QPlatformMenuItem *menuItem, QPlatformMenuItem *before) Q_DECL_OVERRIDE;
-    QPlatformMenuItem *menuItemAt(int position) const Q_DECL_OVERRIDE;
-    QPlatformMenuItem *menuItemForTag(quintptr tag) const Q_DECL_OVERRIDE;
-    void removeMenuItem(QPlatformMenuItem *menuItem) Q_DECL_OVERRIDE;
-    void setEnabled(bool enabled) Q_DECL_OVERRIDE;
-    void setIcon(const QIcon &icon) Q_DECL_OVERRIDE;
-    void setTag(quintptr tag) Q_DECL_OVERRIDE;
-    void setText(const QString &text) Q_DECL_OVERRIDE;
-    void setVisible(bool visible) Q_DECL_OVERRIDE;
-    void syncMenuItem(QPlatformMenuItem *menuItem) Q_DECL_OVERRIDE;
-    void syncSeparatorsCollapsible(bool enable) Q_DECL_OVERRIDE;
-    quintptr tag() const Q_DECL_OVERRIDE;
-    QPlatformMenuItem *createMenuItem() const Q_DECL_OVERRIDE;
-
-    QMenu *menu() const;
-
-private:
-    quintptr m_tag;
-    QPointer<QMenu> m_menu;
-    QList<SystemTrayMenuItem*> m_items;
-};
-
-class SystemTrayMenuItem : public QPlatformMenuItem
-{
-    Q_OBJECT
-public:
-    SystemTrayMenuItem();
-    ~SystemTrayMenuItem() Q_DECL_OVERRIDE;
-    void setCheckable(bool checkable) Q_DECL_OVERRIDE;
-    void setChecked(bool isChecked) Q_DECL_OVERRIDE;
-    void setEnabled(bool enabled) Q_DECL_OVERRIDE;
-    void setFont(const QFont &font) Q_DECL_OVERRIDE;
-    void setIcon(const QIcon &icon) Q_DECL_OVERRIDE;
-    void setIsSeparator(bool isSeparator) Q_DECL_OVERRIDE;
-    void setMenu(QPlatformMenu *menu) Q_DECL_OVERRIDE;
-    void setRole(MenuRole role) Q_DECL_OVERRIDE;
-    void setShortcut(const QKeySequence &shortcut) Q_DECL_OVERRIDE;
-    void setTag(quintptr tag) Q_DECL_OVERRIDE;
-    void setText(const QString &text) Q_DECL_OVERRIDE;
-    void setVisible(bool isVisible) Q_DECL_OVERRIDE;
-    quintptr tag() const Q_DECL_OVERRIDE;
-    void setIconSize(int size)
-#if (QT_VERSION >= QT_VERSION_CHECK(5, 4, 0))
-    Q_DECL_OVERRIDE
-#endif
-    ;
-
-    QAction *action() const;
-
-private:
-    quintptr m_tag;
-    QAction *m_action;
-};
-#endif
-
-class KDEPlatformSystemTrayIcon : public QPlatformSystemTrayIcon
-{
-public:
-    KDEPlatformSystemTrayIcon();
-    ~KDEPlatformSystemTrayIcon() Q_DECL_OVERRIDE;
-
-    void init() Q_DECL_OVERRIDE;
-    void cleanup() Q_DECL_OVERRIDE;
-    void updateIcon(const QIcon &icon) Q_DECL_OVERRIDE;
-    void updateToolTip(const QString &tooltip) Q_DECL_OVERRIDE;
-    void updateMenu(QPlatformMenu *menu) Q_DECL_OVERRIDE;
-    QRect geometry() const Q_DECL_OVERRIDE;
-    void showMessage(const QString &title, const QString &msg,
-                     const QIcon &icon, MessageIcon iconType, int secs) Q_DECL_OVERRIDE;
-
-    bool isSystemTrayAvailable() const Q_DECL_OVERRIDE;
-    bool supportsMessages() const Q_DECL_OVERRIDE;
-
-#if (QT_VERSION >= QT_VERSION_CHECK(5, 3, 0))
-    QPlatformMenu *createMenu() const Q_DECL_OVERRIDE;
-#endif
-
-private:
-    KStatusNotifierItem *m_sni;
-};
-
-#endif
diff --git a/src/platformtheme/kdeplatformsystemtrayicon.cpp b/src/platformtheme/kdeplatformsystemtrayicon.cpp
deleted file mode 100644
index 6b882898bdc4ae9f9b16c535076d808c5a6c1440..0000000000000000000000000000000000000000
--- a/src/platformtheme/kdeplatformsystemtrayicon.cpp
+++ /dev/null
@@ -1,363 +0,0 @@
-/*  This file is part of the KDE libraries
- *  Copyright 2014 Martin Gräßlin <mgraesslin@kde.org>
- *
- *  This library is free software; you can redistribute it and/or modify
- *  it under the terms of the GNU Lesser General Public License as published by
- *  the Free Software Foundation; either version 2 of the License or ( at
- *  your option ) version 3 or, at the discretion of KDE e.V. ( which shall
- *  act as a proxy as in section 14 of the GPLv3 ), any later version.
- *
- *  This library is distributed in the hope that it will be useful,
- *  but WITHOUT ANY WARRANTY; without even the implied warranty of
- *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
- *  Library General Public License for more details.
- *
- *  You should have received a copy of the GNU Lesser General Public License
- *  along with this library; see the file COPYING.LIB.  If not, write to
- *  the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor,
- *  Boston, MA 02110-1301, USA.
- */
-#include "kdeplatformsystemtrayicon.h"
-#include <kstatusnotifieritem.h>
-#include <QAction>
-#include <QIcon>
-#include <QMenu>
-#include <QRect>
-#include <QApplication>
-#include <QDBusInterface>
-
-#if (QT_VERSION >= QT_VERSION_CHECK(5, 3, 0))
-SystemTrayMenu::SystemTrayMenu()
-    : QPlatformMenu()
-    , m_tag(0)
-    , m_menu(new QMenu())
-{
-    connect(m_menu.data(), &QMenu::aboutToShow, this, &QPlatformMenu::aboutToShow);
-    connect(m_menu.data(), &QMenu::aboutToHide, this, &QPlatformMenu::aboutToHide);
-}
-
-SystemTrayMenu::~SystemTrayMenu()
-{
-    if (m_menu) {
-        m_menu->deleteLater();
-    }
-}
-
-QPlatformMenuItem *SystemTrayMenu::createMenuItem() const
-{
-    return new SystemTrayMenuItem();
-}
-
-void SystemTrayMenu::insertMenuItem(QPlatformMenuItem *menuItem, QPlatformMenuItem *before)
-{
-    if (SystemTrayMenuItem *ours = qobject_cast<SystemTrayMenuItem*>(menuItem)) {
-        bool inserted = false;
-        if (SystemTrayMenuItem *oursBefore = qobject_cast<SystemTrayMenuItem*>(before)) {
-            for (auto it = m_items.begin(); it != m_items.end(); ++it) {
-                if (*it == oursBefore) {
-                    m_items.insert(it, ours);
-                    if (m_menu) {
-                        m_menu->insertAction(oursBefore->action(), ours->action());
-                    }
-                    inserted = true;
-                    break;
-                }
-            }
-        }
-        if (!inserted) {
-            m_items.append(ours);
-            if (m_menu) {
-                m_menu->addAction(ours->action());
-            }
-        }
-    }
-}
-
-QPlatformMenuItem *SystemTrayMenu::menuItemAt(int position) const
-{
-    if (position < m_items.size()) {
-        return m_items.at(position);
-    }
-    return Q_NULLPTR;
-}
-
-QPlatformMenuItem *SystemTrayMenu::menuItemForTag(quintptr tag) const
-{
-    auto it = std::find_if(m_items.constBegin(), m_items.constEnd(), [tag](SystemTrayMenuItem *item) {
-        return item->tag() == tag;
-    });
-    if (it != m_items.constEnd()) {
-        return *it;
-    }
-    return Q_NULLPTR;
-}
-
-void SystemTrayMenu::removeMenuItem(QPlatformMenuItem *menuItem)
-{
-    if (SystemTrayMenuItem *ours = qobject_cast<SystemTrayMenuItem*>(menuItem)) {
-        m_items.removeOne(ours);
-        if (ours->action() && m_menu) {
-            m_menu->removeAction(ours->action());
-        }
-    }
-}
-
-void SystemTrayMenu::setEnabled(bool enabled)
-{
-    if (!m_menu) {
-        return;
-    }
-    m_menu->setEnabled(enabled);
-}
-
-void SystemTrayMenu::setIcon(const QIcon &icon)
-{
-    if (!m_menu) {
-        return;
-    }
-    m_menu->setIcon(icon);
-}
-
-void SystemTrayMenu::setTag(quintptr tag)
-{
-    m_tag = tag;
-}
-
-void SystemTrayMenu::setText(const QString &text)
-{
-    if (!m_menu) {
-        return;
-    }
-    m_menu->setTitle(text);
-}
-
-void SystemTrayMenu::setVisible(bool visible)
-{
-    if (!m_menu) {
-        return;
-    }
-    m_menu->setVisible(visible);
-}
-
-void SystemTrayMenu::syncMenuItem(QPlatformMenuItem *menuItem)
-{
-    Q_UNUSED(menuItem)
-    // nothing to do
-}
-
-void SystemTrayMenu::syncSeparatorsCollapsible(bool enable)
-{
-    if (!m_menu) {
-        return;
-    }
-    m_menu->setSeparatorsCollapsible(enable);
-}
-
-quintptr SystemTrayMenu::tag() const
-{
-    return m_tag;
-}
-
-QMenu *SystemTrayMenu::menu() const
-{
-    return m_menu.data();
-}
-
-SystemTrayMenuItem::SystemTrayMenuItem()
-    : QPlatformMenuItem()
-    , m_tag(0)
-    , m_action(new QAction(this))
-{
-    connect(m_action, &QAction::triggered, this, &QPlatformMenuItem::activated);
-    connect(m_action, &QAction::hovered, this, &QPlatformMenuItem::hovered);
-}
-
-SystemTrayMenuItem::~SystemTrayMenuItem()
-{
-}
-
-void SystemTrayMenuItem::setCheckable(bool checkable)
-{
-    m_action->setCheckable(checkable);
-}
-
-void SystemTrayMenuItem::setChecked(bool isChecked)
-{
-    m_action->setChecked(isChecked);
-}
-
-void SystemTrayMenuItem::setEnabled(bool enabled)
-{
-    m_action->setEnabled(enabled);
-}
-
-void SystemTrayMenuItem::setFont(const QFont &font)
-{
-    m_action->setFont(font);
-}
-
-void SystemTrayMenuItem::setIcon(const QIcon &icon)
-{
-    m_action->setIcon(icon);
-}
-
-void SystemTrayMenuItem::setIsSeparator(bool isSeparator)
-{
-    m_action->setSeparator(isSeparator);
-}
-
-void SystemTrayMenuItem::setMenu(QPlatformMenu *menu)
-{
-    if (SystemTrayMenu *ourMenu = qobject_cast<SystemTrayMenu *>(menu)) {
-        m_action->setMenu(ourMenu->menu());
-    }
-}
-
-void SystemTrayMenuItem::setRole(QPlatformMenuItem::MenuRole role)
-{
-    Q_UNUSED(role)
-}
-
-void SystemTrayMenuItem::setShortcut(const QKeySequence &shortcut)
-{
-    m_action->setShortcut(shortcut);
-}
-
-void SystemTrayMenuItem::setTag(quintptr tag)
-{
-    m_tag = tag;
-}
-
-void SystemTrayMenuItem::setText(const QString &text)
-{
-    m_action->setText(text);
-}
-
-void SystemTrayMenuItem::setVisible(bool isVisible)
-{
-    m_action->setVisible(isVisible);
-}
-
-void SystemTrayMenuItem::setIconSize(int size)
-{
-    Q_UNUSED(size);
-}
-
-quintptr SystemTrayMenuItem::tag() const
-{
-    return m_tag;
-}
-
-QAction *SystemTrayMenuItem::action() const
-{
-    return m_action;
-}
-#endif
-
-KDEPlatformSystemTrayIcon::KDEPlatformSystemTrayIcon()
-    : QPlatformSystemTrayIcon()
-    , m_sni(Q_NULLPTR)
-{
-}
-
-KDEPlatformSystemTrayIcon::~KDEPlatformSystemTrayIcon()
-{
-}
-
-void KDEPlatformSystemTrayIcon::init()
-{
-    if (!m_sni) {
-        m_sni = new KStatusNotifierItem();
-        m_sni->setStandardActionsEnabled(false);
-        m_sni->setTitle(QApplication::applicationDisplayName());
-        connect(m_sni, &KStatusNotifierItem::activateRequested, [this](bool active, const QPoint &pos) {
-            Q_UNUSED(active)
-            Q_UNUSED(pos)
-            emit activated(QPlatformSystemTrayIcon::Trigger);
-        });
-        connect(m_sni, &KStatusNotifierItem::secondaryActivateRequested, [this](const QPoint &pos) {
-            Q_UNUSED(pos)
-            emit activated(QPlatformSystemTrayIcon::Context);
-        });
-    }
-}
-
-void KDEPlatformSystemTrayIcon::cleanup()
-{
-    delete m_sni;
-    m_sni = Q_NULLPTR;
-}
-
-void KDEPlatformSystemTrayIcon::updateIcon(const QIcon &icon)
-{
-    if (!m_sni) {
-        return;
-    }
-    if (icon.name().isEmpty()) {
-        m_sni->setIconByPixmap(icon);
-        m_sni->setToolTipIconByPixmap(icon);
-    } else {
-        m_sni->setIconByName(icon.name());
-        m_sni->setToolTipIconByName(icon.name());
-    }
-}
-
-void KDEPlatformSystemTrayIcon::updateToolTip(const QString &tooltip)
-{
-    if (!m_sni) {
-        return;
-    }
-    m_sni->setToolTipTitle(tooltip);
-}
-
-void KDEPlatformSystemTrayIcon::updateMenu(QPlatformMenu *menu)
-{
-#if (QT_VERSION >= QT_VERSION_CHECK(5, 3, 0))
-    if (!m_sni) {
-        return;
-    }
-    if (SystemTrayMenu *ourMenu = qobject_cast<SystemTrayMenu*>(menu)) {
-        m_sni->setContextMenu(ourMenu->menu());
-    }
-#else
-    Q_UNUSED(menu)
-#endif
-}
-
-#if (QT_VERSION >= QT_VERSION_CHECK(5, 3, 0))
-QPlatformMenu *KDEPlatformSystemTrayIcon::createMenu() const
-{
-    return new SystemTrayMenu();
-}
-#endif
-
-QRect KDEPlatformSystemTrayIcon::geometry() const
-{
-    // StatusNotifierItem doesn't provide the geometry
-    return QRect();
-}
-
-void KDEPlatformSystemTrayIcon::showMessage(const QString &title, const QString &msg,
-                                            const QIcon &icon, MessageIcon iconType, int secs)
-{
-    Q_UNUSED(iconType)
-    if (!m_sni) {
-        return;
-    }
-    m_sni->showMessage(title, msg, icon.name(), secs);
-}
-
-bool KDEPlatformSystemTrayIcon::isSystemTrayAvailable() const
-{
-    QDBusInterface systrayHost(QStringLiteral("org.kde.StatusNotifierWatcher"), QStringLiteral("/StatusNotifierWatcher"), QStringLiteral("org.kde.StatusNotifierWatcher"));
-    if (systrayHost.isValid()) {
-        return systrayHost.property("IsStatusNotifierHostRegistered").toBool();
-    }
-
-    return false;
-}
-
-bool KDEPlatformSystemTrayIcon::supportsMessages() const
-{
-    return true;
-}
diff --git a/src/platformtheme/kdeplatformtheme.h b/src/platformtheme/kdeplatformtheme.h
deleted file mode 100644
index 97d09df170ca6c489a5b2e1424eb8a9b98fc0ab8..0000000000000000000000000000000000000000
--- a/src/platformtheme/kdeplatformtheme.h
+++ /dev/null
@@ -1,62 +0,0 @@
-/*  This file is part of the KDE libraries
- *  Copyright 2013 Kevin Ottens <ervin+bluesystems@kde.org>
- *
- *  This library is free software; you can redistribute it and/or modify
- *  it under the terms of the GNU Lesser General Public License as published by
- *  the Free Software Foundation; either version 2 of the License or ( at
- *  your option ) version 3 or, at the discretion of KDE e.V. ( which shall
- *  act as a proxy as in section 14 of the GPLv3 ), any later version.
- *
- *  This library is distributed in the hope that it will be useful,
- *  but WITHOUT ANY WARRANTY; without even the implied warranty of
- *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
- *  Library General Public License for more details.
- *
- *  You should have received a copy of the GNU Lesser General Public License
- *  along with this library; see the file COPYING.LIB.  If not, write to
- *  the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor,
- *  Boston, MA 02110-1301, USA.
- */
-
-#ifndef KDEPLATFORMTHEME_H
-#define KDEPLATFORMTHEME_H
-
-#include <qpa/qplatformtheme.h>
-
-#include <QHash>
-#include <QObject>
-#include <QKeySequence>
-
-class KHintsSettings;
-class KFontSettingsData;
-class QIconEngine;
-
-class KdePlatformTheme : public QPlatformTheme
-{
-public:
-    KdePlatformTheme();
-    ~KdePlatformTheme();
-
-    QVariant themeHint(ThemeHint hint) const Q_DECL_OVERRIDE;
-    const QPalette *palette(Palette type = SystemPalette) const Q_DECL_OVERRIDE;
-    const QFont *font(Font type) const Q_DECL_OVERRIDE;
-    QIconEngine *createIconEngine(const QString &iconName) const Q_DECL_OVERRIDE;
-    QList<QKeySequence> keyBindings(QKeySequence::StandardKey key) const Q_DECL_OVERRIDE;
-
-    QPlatformDialogHelper *createPlatformDialogHelper(DialogType type) const Q_DECL_OVERRIDE;
-    bool usePlatformNativeDialog(DialogType type) const Q_DECL_OVERRIDE;
-
-#if QT_VERSION >= QT_VERSION_CHECK(5, 3, 0)
-    QString standardButtonText(int button) const Q_DECL_OVERRIDE;
-#endif
-
-    QPlatformSystemTrayIcon *createPlatformSystemTrayIcon() const Q_DECL_OVERRIDE;
-
-private:
-    void loadSettings();
-
-    KHintsSettings *m_hints;
-    KFontSettingsData *m_fontsData;
-};
-
-#endif // KDEPLATFORMTHEME_H
diff --git a/src/platformtheme/kdeplatformtheme.cpp b/src/platformtheme/kdeplatformtheme.cpp
deleted file mode 100644
index 80dbcb7ed9651c4c730c17dc493d312e276ca3cb..0000000000000000000000000000000000000000
--- a/src/platformtheme/kdeplatformtheme.cpp
+++ /dev/null
@@ -1,281 +0,0 @@
-/*  This file is part of the KDE libraries
- *  Copyright 2013 Kevin Ottens <ervin+bluesystems@kde.org>
- *  Copyright 2013 Aleix Pol Gonzalez <aleixpol@blue-systems.com>
- *  Copyright 2014 Lukáš Tinkl <ltinkl@redhat.com>
- *
- *  This library is free software; you can redistribute it and/or modify
- *  it under the terms of the GNU Lesser General Public License as published by
- *  the Free Software Foundation; either version 2 of the License or ( at
- *  your option ) version 3 or, at the discretion of KDE e.V. ( which shall
- *  act as a proxy as in section 14 of the GPLv3 ), any later version.
- *
- *  This library is distributed in the hope that it will be useful,
- *  but WITHOUT ANY WARRANTY; without even the implied warranty of
- *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
- *  Library General Public License for more details.
- *
- *  You should have received a copy of the GNU Lesser General Public License
- *  along with this library; see the file COPYING.LIB.  If not, write to
- *  the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor,
- *  Boston, MA 02110-1301, USA.
- */
-
-#include "kdeplatformtheme.h"
-#include "kfontsettingsdata.h"
-#include "khintssettings.h"
-#include "kdeplatformfiledialoghelper.h"
-#include "kdeplatformsystemtrayicon.h"
-
-#include <QCoreApplication>
-#include <QFont>
-#include <QPalette>
-#include <QString>
-#include <QStringList>
-#include <QVariant>
-#include <QDebug>
-
-#include <kiconengine.h>
-#include <kiconloader.h>
-#include <kstandardshortcut.h>
-#include <KStandardGuiItem>
-#include <KLocalizedString>
-
-KdePlatformTheme::KdePlatformTheme()
-{
-    loadSettings();
-}
-
-KdePlatformTheme::~KdePlatformTheme()
-{
-    delete m_fontsData;
-    delete m_hints;
-}
-
-QVariant KdePlatformTheme::themeHint(QPlatformTheme::ThemeHint hintType) const
-{
-    QVariant hint = m_hints->hint(hintType);
-    if (hint.isValid()) {
-        return hint;
-    } else {
-        return QPlatformTheme::themeHint(hintType);
-    }
-}
-
-const QPalette *KdePlatformTheme::palette(Palette type) const
-{
-    QPalette *palette = m_hints->palette(type);
-    if (palette) {
-        return palette;
-    } else {
-        return QPlatformTheme::palette(type);
-    }
-}
-
-const QFont *KdePlatformTheme::font(Font type) const
-{
-    KFontSettingsData::FontTypes fdtype;
-    switch (type) {
-    case SystemFont:
-        fdtype = KFontSettingsData::GeneralFont; break;
-    case MenuFont:
-    case MenuBarFont:
-    case MenuItemFont:
-        fdtype = KFontSettingsData::MenuFont; break;
-    case MessageBoxFont:
-    case LabelFont:
-    case TipLabelFont:
-    case StatusBarFont:
-    case PushButtonFont:
-    case ToolButtonFont:
-    case ItemViewFont:
-    case ListViewFont:
-    case HeaderViewFont:
-    case ListBoxFont:
-    case ComboMenuItemFont:
-    case ComboLineEditFont:
-        fdtype = KFontSettingsData::GeneralFont; break;
-    case TitleBarFont:
-    case MdiSubWindowTitleFont:
-    case DockWidgetTitleFont:
-        fdtype = KFontSettingsData::WindowTitleFont; break;
-    case SmallFont:
-    case MiniFont:
-        fdtype = KFontSettingsData::SmallestReadableFont; break;
-    case FixedFont:
-        fdtype = KFontSettingsData::FixedFont; break;
-    default:
-        fdtype = KFontSettingsData::GeneralFont; break;
-    }
-
-    return m_fontsData->font(fdtype);
-}
-
-QIconEngine *KdePlatformTheme::createIconEngine(const QString &iconName) const
-{
-    return new KIconEngine(iconName, KIconLoader::global());
-}
-
-void KdePlatformTheme::loadSettings()
-{
-    m_fontsData = new KFontSettingsData;
-    m_hints = new KHintsSettings;
-}
-
-QList<QKeySequence> KdePlatformTheme::keyBindings(QKeySequence::StandardKey key) const
-{
-    switch (key) {
-    case QKeySequence::HelpContents:
-        return KStandardShortcut::shortcut(KStandardShortcut::Help);
-    case QKeySequence::WhatsThis:
-        return KStandardShortcut::shortcut(KStandardShortcut::WhatsThis);
-    case QKeySequence::Open:
-        return KStandardShortcut::shortcut(KStandardShortcut::Open);
-    case QKeySequence::Close:
-        return KStandardShortcut::shortcut(KStandardShortcut::Close);
-    case QKeySequence::Save:
-        return KStandardShortcut::shortcut(KStandardShortcut::Save);
-    case QKeySequence::New:
-        return KStandardShortcut::shortcut(KStandardShortcut::New);
-    case QKeySequence::Cut:
-        return KStandardShortcut::shortcut(KStandardShortcut::Cut);
-    case QKeySequence::Copy:
-        return KStandardShortcut::shortcut(KStandardShortcut::Copy);
-    case QKeySequence::Paste:
-        return KStandardShortcut::shortcut(KStandardShortcut::Paste);
-    case QKeySequence::Undo:
-        return KStandardShortcut::shortcut(KStandardShortcut::Undo);
-    case QKeySequence::Redo:
-        return KStandardShortcut::shortcut(KStandardShortcut::Redo);
-    case QKeySequence::Back:
-        return KStandardShortcut::shortcut(KStandardShortcut::Back);
-    case QKeySequence::Forward:
-        return KStandardShortcut::shortcut(KStandardShortcut::Forward);
-    case QKeySequence::Refresh:
-        return KStandardShortcut::shortcut(KStandardShortcut::Reload);
-    case QKeySequence::ZoomIn:
-        return KStandardShortcut::shortcut(KStandardShortcut::ZoomIn);
-    case QKeySequence::ZoomOut:
-        return KStandardShortcut::shortcut(KStandardShortcut::ZoomOut);
-    case QKeySequence::Print:
-        return KStandardShortcut::shortcut(KStandardShortcut::Print);
-    case QKeySequence::Find:
-        return KStandardShortcut::shortcut(KStandardShortcut::Find);
-    case QKeySequence::FindNext:
-        return KStandardShortcut::shortcut(KStandardShortcut::FindNext);
-    case QKeySequence::FindPrevious:
-        return KStandardShortcut::shortcut(KStandardShortcut::FindPrev);
-    case QKeySequence::Replace:
-        return KStandardShortcut::shortcut(KStandardShortcut::Replace);
-    case QKeySequence::SelectAll:
-        return KStandardShortcut::shortcut(KStandardShortcut::SelectAll);
-    case QKeySequence::MoveToNextWord:
-        return KStandardShortcut::shortcut(KStandardShortcut::ForwardWord);
-    case QKeySequence::MoveToPreviousWord:
-        return KStandardShortcut::shortcut(KStandardShortcut::BackwardWord);
-    case QKeySequence::MoveToNextPage:
-        return KStandardShortcut::shortcut(KStandardShortcut::Next);
-    case QKeySequence::MoveToPreviousPage:
-        return KStandardShortcut::shortcut(KStandardShortcut::Prior);
-    case QKeySequence::MoveToStartOfLine:
-        return KStandardShortcut::shortcut(KStandardShortcut::BeginningOfLine);
-    case QKeySequence::MoveToEndOfLine:
-        return KStandardShortcut::shortcut(KStandardShortcut::EndOfLine);
-    case QKeySequence::MoveToStartOfDocument:
-        return KStandardShortcut::shortcut(KStandardShortcut::Begin);
-    case QKeySequence::MoveToEndOfDocument:
-        return KStandardShortcut::shortcut(KStandardShortcut::End);
-    case QKeySequence::SaveAs:
-        return KStandardShortcut::shortcut(KStandardShortcut::SaveAs);
-    case QKeySequence::Preferences:
-        return KStandardShortcut::shortcut(KStandardShortcut::Preferences);
-    case QKeySequence::Quit:
-        return KStandardShortcut::shortcut(KStandardShortcut::Quit);
-    case QKeySequence::FullScreen:
-        return KStandardShortcut::shortcut(KStandardShortcut::FullScreen);
-    case QKeySequence::Deselect:
-        return KStandardShortcut::shortcut(KStandardShortcut::Deselect);
-    case QKeySequence::DeleteStartOfWord:
-        return KStandardShortcut::shortcut(KStandardShortcut::DeleteWordBack);
-    case QKeySequence::DeleteEndOfWord:
-        return KStandardShortcut::shortcut(KStandardShortcut::DeleteWordForward);
-    case QKeySequence::NextChild:
-        return KStandardShortcut::shortcut(KStandardShortcut::TabNext);
-    case QKeySequence::PreviousChild:
-        return KStandardShortcut::shortcut(KStandardShortcut::TabPrev);
-    default:
-        return QPlatformTheme::keyBindings(key);
-    }
-}
-
-bool KdePlatformTheme::usePlatformNativeDialog(QPlatformTheme::DialogType type) const
-{
-    return type == QPlatformTheme::FileDialog;
-}
-
-#if QT_VERSION >= QT_VERSION_CHECK(5, 3, 0)
-QString KdePlatformTheme::standardButtonText(int button) const
-{
-    switch (static_cast<QPlatformDialogHelper::StandardButton>(button)) {
-    case QPlatformDialogHelper::NoButton:
-        qWarning() << Q_FUNC_INFO << "Unsupported standard button:" << button;
-        return QString();
-    case QPlatformDialogHelper::Ok:
-        return KStandardGuiItem::ok().text();
-    case QPlatformDialogHelper::Save:
-        return KStandardGuiItem::save().text();
-    case QPlatformDialogHelper::SaveAll:
-        return i18nc("@action:button", "Save All");
-    case QPlatformDialogHelper::Open:
-        return KStandardGuiItem::open().text();
-    case QPlatformDialogHelper::Yes:
-        return KStandardGuiItem::yes().text();
-    case QPlatformDialogHelper::YesToAll:
-        return i18nc("@action:button", "Yes to All");
-    case QPlatformDialogHelper::No:
-        return KStandardGuiItem::no().text();
-    case QPlatformDialogHelper::NoToAll:
-        return i18nc("@action:button", "No to All");
-    case QPlatformDialogHelper::Abort:
-        // FIXME KStandardGuiItem::stop() doesn't seem right here
-        return i18nc("@action:button", "Abort");
-    case QPlatformDialogHelper::Retry:
-        return i18nc("@action:button", "Retry");
-    case QPlatformDialogHelper::Ignore:
-        return i18nc("@action:button", "Ignore");
-    case QPlatformDialogHelper::Close:
-        return KStandardGuiItem::close().text();
-    case QPlatformDialogHelper::Cancel:
-        return KStandardGuiItem::cancel().text();
-    case QPlatformDialogHelper::Discard:
-        return KStandardGuiItem::discard().text();
-    case QPlatformDialogHelper::Help:
-        return KStandardGuiItem::help().text();
-    case QPlatformDialogHelper::Apply:
-        return KStandardGuiItem::apply().text();
-    case QPlatformDialogHelper::Reset:
-        return KStandardGuiItem::reset().text();
-    case QPlatformDialogHelper::RestoreDefaults:
-        return KStandardGuiItem::defaults().text();
-    default:
-        return QPlatformTheme::defaultStandardButtonText(button);
-    }
-}
-#endif
-
-QPlatformDialogHelper *KdePlatformTheme::createPlatformDialogHelper(QPlatformTheme::DialogType type) const
-{
-    switch (type) {
-    case QPlatformTheme::FileDialog:
-        return new KDEPlatformFileDialogHelper;
-    case QPlatformTheme::FontDialog:
-    case QPlatformTheme::ColorDialog:
-    case QPlatformTheme::MessageDialog:
-    default:
-        return 0;
-    }
-}
-
-QPlatformSystemTrayIcon *KdePlatformTheme::createPlatformSystemTrayIcon() const
-{
-    return new KDEPlatformSystemTrayIcon;
-}
diff --git a/src/platformtheme/kdeplatformtheme.json b/src/platformtheme/kdeplatformtheme.json
deleted file mode 100644
index 5d250ccf4d37fb8dba3be5d7cb7705f83700d5bc..0000000000000000000000000000000000000000
--- a/src/platformtheme/kdeplatformtheme.json
+++ /dev/null
@@ -1,3 +0,0 @@
-{
-    "Keys": [ "kde" ]
-}
diff --git a/src/platformtheme/kdirselectdialog.cpp b/src/platformtheme/kdirselectdialog.cpp
deleted file mode 100644
index 0a65cd3e3a98bed7da7385d2500ab8d6d20bbed0..0000000000000000000000000000000000000000
--- a/src/platformtheme/kdirselectdialog.cpp
+++ /dev/null
@@ -1,578 +0,0 @@
-/*
-    Copyright (C) 2001,2002 Carsten Pfeiffer <pfeiffer@kde.org>
-    Copyright (C) 2001 Michael Jarrett <michaelj@corel.com>
-    Copyright (C) 2009 Shaun Reich <shaun.reich@kdemail.net>
-
-    This library is free software; you can redistribute it and/or
-    modify it under the terms of the GNU Library General Public
-    License version 2 as published by the Free Software Foundation.
-
-    This library is distributed in the hope that it will be useful,
-    but WITHOUT ANY WARRANTY; without even the implied warranty of
-    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
-    Library General Public License for more details.
-
-    You should have received a copy of the GNU Library General Public License
-    along with this library; see the file COPYING.LIB.  If not, write to
-    the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor,
-    Boston, MA 02110-1301, USA.
-*/
-
-#include "kdirselectdialog_p.h"
-
-#include <QDebug>
-#include <QDialogButtonBox>
-#include <QDir>
-#include <QFileDialog>
-#include <QInputDialog>
-#include <QLayout>
-#include <QMenu>
-#include <QPushButton>
-#include <QStandardPaths>
-#include <QStringList>
-#include <QUrl>
-
-#include <kio/jobuidelegate.h>
-#include <kactioncollection.h>
-#include <kauthorized.h>
-#include <kconfig.h>
-#include <kconfiggroup.h>
-#include <kfileitemdelegate.h>
-#include <khistorycombobox.h>
-#include <kio/job.h>
-#include <kio/deletejob.h>
-#include <kio/copyjob.h>
-#include <kio/mkdirjob.h>
-#include <kjobwidgets.h>
-#include <klocalizedstring.h>
-#include <kmessagebox.h>
-#include <kpropertiesdialog.h>
-#include <krecentdirs.h>
-#include <kservice.h>
-#include <ksharedconfig.h>
-#include <ktoggleaction.h>
-#include <kurlcompletion.h>
-#include <kurlpixmapprovider.h>
-#include <kfilewidget.h>
-
-#include "kfiletreeview_p.h"
-#include <kfileplacesview.h>
-#include <kfileplacesmodel.h>
-// ### add mutator for treeview!
-
-class KDirSelectDialog::Private
-{
-public:
-    Private(bool localOnly, KDirSelectDialog *parent)
-        : m_parent(parent),
-          m_localOnly(localOnly),
-          m_comboLocked(false),
-          m_urlCombo(0)
-    {
-    }
-
-    void readConfig(const KSharedConfigPtr &config, const QString &group);
-    void saveConfig(KSharedConfigPtr config, const QString &group);
-    void slotMkdir();
-
-    void slotCurrentChanged();
-    void slotExpand(const QModelIndex &);
-    void slotUrlActivated(const QString &);
-    void slotComboTextChanged(const QString &);
-    void slotContextMenuRequested(const QPoint &);
-    void slotNewFolder();
-    void slotMoveToTrash();
-    void slotDelete();
-    void slotProperties();
-
-    KDirSelectDialog *m_parent;
-    bool m_localOnly : 1;
-    bool m_comboLocked : 1;
-    QUrl m_rootUrl;
-    QUrl m_startDir;
-    KFileTreeView *m_treeView;
-    QMenu *m_contextMenu;
-    KActionCollection *m_actions;
-    KFilePlacesView *m_placesView;
-    KHistoryComboBox *m_urlCombo;
-    QString m_recentDirClass;
-    QUrl m_startURL;
-    QAction *moveToTrash;
-    QAction *deleteAction;
-    QAction *showHiddenFoldersAction;
-};
-
-void KDirSelectDialog::Private::readConfig(const KSharedConfig::Ptr &config, const QString &group)
-{
-    m_urlCombo->clear();
-
-    KConfigGroup conf(config, group);
-    m_urlCombo->setHistoryItems(conf.readPathEntry("History Items", QStringList()));
-
-    const QSize size = conf.readEntry("DirSelectDialog Size", QSize());
-    if (size.isValid()) {
-        m_parent->resize(size);
-    }
-}
-
-void KDirSelectDialog::Private::saveConfig(KSharedConfig::Ptr config, const QString &group)
-{
-    KConfigGroup conf(config, group);
-    KConfigGroup::WriteConfigFlags flags(KConfigGroup::Persistent | KConfigGroup::Global);
-    conf.writePathEntry("History Items", m_urlCombo->historyItems(), flags);
-    conf.writeEntry("DirSelectDialog Size", m_parent->size(), flags);
-
-    config->sync();
-}
-
-void KDirSelectDialog::Private::slotMkdir()
-{
-    bool ok;
-    QString where = m_parent->url().toDisplayString(QUrl::PreferLocalFile);
-    QString name = i18nc("folder name", "New Folder");
-    if (m_parent->url().isLocalFile() && QFileInfo(m_parent->url().toLocalFile() + '/' + name).exists()) {
-        name = KIO::suggestName(m_parent->url(), name);
-    }
-
-    QString directory = KIO::encodeFileName(QInputDialog::getText(m_parent, i18nc("@title:window", "New Folder"),
-                                            i18nc("@label:textbox", "Create new folder in:\n%1",  where),
-                                            QLineEdit::Normal, name, &ok));
-    if (!ok) {
-        return;
-    }
-
-    bool selectDirectory = true;
-    bool writeOk = false;
-    bool exists = false;
-    QUrl folderurl(m_parent->url());
-
-    const QStringList dirs = directory.split('/', QString::SkipEmptyParts);
-    QStringList::ConstIterator it = dirs.begin();
-
-    for (; it != dirs.end(); ++it) {
-        folderurl.setPath(folderurl.path() + '/' + *it);
-        KIO::StatJob *job = KIO::stat(folderurl);
-        KJobWidgets::setWindow(job, m_parent);
-        job->setDetails(0); //We only want to know if it exists, 0 == that.
-        job->setSide(KIO::StatJob::DestinationSide);
-        exists = job->exec();
-        if (!exists) {
-            KIO::MkdirJob *job = KIO::mkdir(folderurl);
-            KJobWidgets::setWindow(job, m_parent);
-            writeOk = job->exec();
-        }
-    }
-
-    if (exists) { // url was already existent
-        QString which = folderurl.toDisplayString(QUrl::PreferLocalFile);
-        KMessageBox::sorry(m_parent, i18n("A file or folder named %1 already exists.", which));
-        selectDirectory = false;
-    } else if (!writeOk) {
-        KMessageBox::sorry(m_parent, i18n("You do not have permission to create that folder."));
-    } else if (selectDirectory) {
-        m_parent->setCurrentUrl(folderurl);
-    }
-}
-
-void KDirSelectDialog::Private::slotCurrentChanged()
-{
-    if (m_comboLocked) {
-        return;
-    }
-
-    const QUrl u = m_treeView->currentUrl();
-
-    if (u.isValid()) {
-        m_urlCombo->setEditText(u.toDisplayString(QUrl::PreferLocalFile));
-    } else {
-        m_urlCombo->setEditText(QString());
-    }
-}
-
-void KDirSelectDialog::Private::slotUrlActivated(const QString &text)
-{
-    if (text.isEmpty()) {
-        return;
-    }
-
-    const QUrl url = QUrl::fromUserInput(text);
-    m_urlCombo->addToHistory(url.toDisplayString());
-
-    if (m_parent->localOnly() && !url.isLocalFile()) {
-        return;    //FIXME: messagebox for the user
-    }
-
-    QUrl oldUrl = m_treeView->currentUrl();
-    if (oldUrl.isEmpty()) {
-        oldUrl = m_startDir;
-    }
-
-    m_parent->setCurrentUrl(oldUrl);
-}
-
-void KDirSelectDialog::Private::slotComboTextChanged(const QString &text)
-{
-    m_treeView->blockSignals(true);
-    QUrl url = QUrl::fromUserInput(text);
-#ifdef Q_OS_WIN
-    QUrl rootUrl(m_treeView->rootUrl());
-    if (url.isLocalFile() && !rootUrl.isParentOf(url) && !rootUrl.matches(url, QUrl::StripTrailingSlash)) {
-        QUrl tmp = KIO::upUrl(url);
-        while (tmp.path().length() > 1) {
-            url = tmp;
-            tmp = KIO::upUrl(url);
-        }
-        m_treeView->setRootUrl(url);
-    }
-#endif
-    m_treeView->setCurrentUrl(url);
-    m_treeView->blockSignals(false);
-}
-
-void KDirSelectDialog::Private::slotContextMenuRequested(const QPoint &pos)
-{
-    m_contextMenu->popup(m_treeView->viewport()->mapToGlobal(pos));
-}
-
-void KDirSelectDialog::Private::slotExpand(const QModelIndex &index)
-{
-    m_treeView->setExpanded(index, !m_treeView->isExpanded(index));
-}
-
-void KDirSelectDialog::Private::slotNewFolder()
-{
-    slotMkdir();
-}
-
-void KDirSelectDialog::Private::slotMoveToTrash()
-{
-    const QUrl url = m_treeView->selectedUrl();
-    KIO::JobUiDelegate job;
-    if (job.askDeleteConfirmation(QList<QUrl>() << url, KIO::JobUiDelegate::Trash, KIO::JobUiDelegate::DefaultConfirmation)) {
-        KIO::CopyJob *copyJob = KIO::trash(url);
-        KJobWidgets::setWindow(copyJob, m_parent);
-        copyJob->ui()->setAutoErrorHandlingEnabled(true);
-    }
-}
-
-void KDirSelectDialog::Private::slotDelete()
-{
-    const QUrl url = m_treeView->selectedUrl();
-    KIO::JobUiDelegate job;
-    if (job.askDeleteConfirmation(QList<QUrl>() << url, KIO::JobUiDelegate::Delete, KIO::JobUiDelegate::DefaultConfirmation)) {
-        KIO::DeleteJob *deleteJob = KIO::del(url);
-        KJobWidgets::setWindow(deleteJob, m_parent);
-        deleteJob->ui()->setAutoErrorHandlingEnabled(true);
-    }
-}
-
-void KDirSelectDialog::Private::slotProperties()
-{
-    KPropertiesDialog *dialog = 0;
-    dialog = new KPropertiesDialog(m_treeView->selectedUrl(), this->m_parent);
-    dialog->setAttribute(Qt::WA_DeleteOnClose);
-    dialog->show();
-}
-
-KDirSelectDialog::KDirSelectDialog(const QUrl &startDir, bool localOnly, QWidget *parent)
-// #ifdef Q_OS_WIN
-//     : QDialog(parent, Qt::WindowMinMaxButtonsHint),
-// #else
-//     : QDialog(parent),
-// #endif
-     : d(new Private(localOnly, this))
-{
-    setWindowTitle(i18nc("@title:window", "Select Folder"));
-
-    QVBoxLayout *topLayout = new QVBoxLayout;
-    setLayout(topLayout);
-
-    QFrame *page = new QFrame(this);
-    topLayout->addWidget(page);
-
-    QPushButton *folderButton = new QPushButton;
-    KGuiItem::assign(folderButton, KGuiItem(i18nc("@action:button", "New Folder..."), QStringLiteral("folder-new")));
-    connect(folderButton, SIGNAL(clicked()), this, SLOT(slotNewFolder()));
-
-    m_buttons = new QDialogButtonBox(this);
-    m_buttons->addButton(folderButton, QDialogButtonBox::ActionRole);
-    m_buttons->setStandardButtons(QDialogButtonBox::Ok | QDialogButtonBox::Cancel);
-    connect(m_buttons, SIGNAL(accepted()), this, SLOT(accept()));
-    connect(m_buttons, SIGNAL(rejected()), this, SLOT(reject()));
-    topLayout->addWidget(m_buttons);
-
-    QHBoxLayout *hlay = new QHBoxLayout(page);
-    hlay->setMargin(0);
-    QVBoxLayout *mainLayout = new QVBoxLayout();
-    d->m_actions = new KActionCollection(this);
-    d->m_actions->addAssociatedWidget(this);
-    d->m_placesView = new KFilePlacesView(page);
-    d->m_placesView->setModel(new KFilePlacesModel(d->m_placesView));
-    d->m_placesView->setObjectName(QStringLiteral("speedbar"));
-    d->m_placesView->setHorizontalScrollBarPolicy(Qt::ScrollBarAlwaysOff);
-    d->m_placesView->setSizePolicy(QSizePolicy::Minimum, QSizePolicy::Minimum);
-    connect(d->m_placesView, SIGNAL(urlChanged(QUrl)),
-            SLOT(setCurrentUrl(QUrl)));
-    hlay->addWidget(d->m_placesView);
-    hlay->addLayout(mainLayout);
-
-    d->m_treeView = new KFileTreeView(page);
-    d->m_treeView->setDirOnlyMode(true);
-    d->m_treeView->setContextMenuPolicy(Qt::CustomContextMenu);
-
-    for (int i = 1; i < d->m_treeView->model()->columnCount(); ++i) {
-        d->m_treeView->hideColumn(i);
-    }
-
-    d->m_urlCombo = new KHistoryComboBox(page);
-    d->m_urlCombo->setLayoutDirection(Qt::LeftToRight);
-    d->m_urlCombo->setSizeAdjustPolicy(QComboBox::AdjustToMinimumContentsLength);
-    d->m_urlCombo->setTrapReturnKey(true);
-    d->m_urlCombo->setPixmapProvider(new KUrlPixmapProvider());
-    KUrlCompletion *comp = new KUrlCompletion();
-    comp->setMode(KUrlCompletion::DirCompletion);
-    d->m_urlCombo->setCompletionObject(comp, true);
-    d->m_urlCombo->setAutoDeleteCompletionObject(true);
-    d->m_urlCombo->setDuplicatesEnabled(false);
-
-    d->m_contextMenu = new QMenu(this);
-
-    QAction *newFolder = new QAction(i18nc("@action:inmenu", "New Folder..."), this);
-    d->m_actions->addAction(newFolder->objectName(), newFolder);
-    newFolder->setIcon(QIcon::fromTheme(QStringLiteral("folder-new")));
-    newFolder->setShortcut(Qt::Key_F10);
-    connect(newFolder, SIGNAL(triggered(bool)), this, SLOT(slotNewFolder()));
-    d->m_contextMenu->addAction(newFolder);
-
-    d->moveToTrash = new QAction(i18nc("@action:inmenu", "Move to Trash"), this);
-    d->m_actions->addAction(d->moveToTrash->objectName(), d->moveToTrash);
-    d->moveToTrash->setIcon(QIcon::fromTheme(QStringLiteral("user-trash")));
-    d->moveToTrash->setShortcut(Qt::Key_Delete);
-    connect(d->moveToTrash, SIGNAL(triggered(bool)), this, SLOT(slotMoveToTrash()));
-    d->m_contextMenu->addAction(d->moveToTrash);
-
-    d->deleteAction = new QAction(i18nc("@action:inmenu", "Delete"), this);
-    d->m_actions->addAction(d->deleteAction->objectName(), d->deleteAction);
-    d->deleteAction->setIcon(QIcon::fromTheme(QStringLiteral("edit-delete")));
-    d->deleteAction->setShortcut(Qt::SHIFT + Qt::Key_Delete);
-    connect(d->deleteAction, SIGNAL(triggered(bool)), this, SLOT(slotDelete()));
-    d->m_contextMenu->addAction(d->deleteAction);
-
-    d->m_contextMenu->addSeparator();
-
-    d->showHiddenFoldersAction = new KToggleAction(i18nc("@option:check", "Show Hidden Folders"), this);
-    d->m_actions->addAction(d->showHiddenFoldersAction->objectName(), d->showHiddenFoldersAction);
-    d->showHiddenFoldersAction->setShortcut(Qt::Key_F8);
-    connect(d->showHiddenFoldersAction, SIGNAL(triggered(bool)), d->m_treeView, SLOT(setShowHiddenFiles(bool)));
-    d->m_contextMenu->addAction(d->showHiddenFoldersAction);
-    d->m_contextMenu->addSeparator();
-
-    QAction *propertiesAction = new QAction(i18nc("@action:inmenu", "Properties"), this);
-    d->m_actions->addAction(propertiesAction->objectName(), propertiesAction);
-    propertiesAction->setIcon(QIcon::fromTheme(QStringLiteral("document-properties")));
-    propertiesAction->setShortcut(Qt::ALT + Qt::Key_Return);
-    connect(propertiesAction, SIGNAL(triggered(bool)), this, SLOT(slotProperties()));
-    d->m_contextMenu->addAction(propertiesAction);
-
-    d->m_startURL = KFileWidget::getStartUrl(startDir, d->m_recentDirClass);
-    if (localOnly && !d->m_startURL.isLocalFile()) {
-        QString docPath = QStandardPaths::writableLocation(QStandardPaths::DocumentsLocation);
-        if (QDir(docPath).exists()) {
-            d->m_startURL = QUrl::fromLocalFile(docPath);
-        } else {
-            d->m_startURL = QUrl::fromLocalFile(QDir::homePath());
-        }
-    }
-
-    d->m_startDir = d->m_startURL;
-    d->m_rootUrl = d->m_treeView->rootUrl();
-
-    d->readConfig(KSharedConfig::openConfig(), QStringLiteral("DirSelect Dialog"));
-
-    mainLayout->addWidget(d->m_treeView, 1);
-    mainLayout->addWidget(d->m_urlCombo, 0);
-
-    connect(d->m_treeView, SIGNAL(currentChanged(QUrl)),
-            SLOT(slotCurrentChanged()));
-    connect(d->m_treeView, SIGNAL(activated(QModelIndex)),
-            SLOT(slotExpand(QModelIndex)));
-    connect(d->m_treeView, SIGNAL(customContextMenuRequested(QPoint)),
-            SLOT(slotContextMenuRequested(QPoint)));
-
-    connect(d->m_urlCombo, SIGNAL(editTextChanged(QString)),
-            SLOT(slotComboTextChanged(QString)));
-    connect(d->m_urlCombo, SIGNAL(activated(QString)),
-            SLOT(slotUrlActivated(QString)));
-    connect(d->m_urlCombo, SIGNAL(returnPressed(QString)),
-            SLOT(slotUrlActivated(QString)));
-
-    setCurrentUrl(d->m_startURL);
-}
-
-KDirSelectDialog::~KDirSelectDialog()
-{
-    delete d;
-}
-
-QUrl KDirSelectDialog::url() const
-{
-    QUrl comboUrl = QUrl::fromUserInput(d->m_urlCombo->currentText());
-
-    if (comboUrl.isValid()) {
-        KIO::StatJob *statJob = KIO::stat(comboUrl, KIO::HideProgressInfo);
-        KJobWidgets::setWindow(statJob, d->m_parent);
-        const bool ok = statJob->exec();
-        if (ok && statJob->statResult().isDir()) {
-            return comboUrl;
-        }
-    }
-
-    // qDebug() << comboUrl.path() << " is not an accessible directory";
-    return d->m_treeView->currentUrl();
-}
-
-QUrl KDirSelectDialog::rootUrl() const
-{
-    return d->m_rootUrl;
-}
-
-QAbstractItemView *KDirSelectDialog::view() const
-{
-    return d->m_treeView;
-}
-
-bool KDirSelectDialog::localOnly() const
-{
-    return d->m_localOnly;
-}
-
-QUrl KDirSelectDialog::startDir() const
-{
-    return d->m_startDir;
-}
-
-void KDirSelectDialog::setCurrentUrl(const QUrl &url)
-{
-    if (!url.isValid()) {
-        return;
-    }
-
-    if (url.scheme() != d->m_rootUrl.scheme()) {
-        QUrl u(url);
-        //We need the url to end with / because some code ahead (kdirmodel) is expecting
-        //to find the / separator. It can happen that a valid url like smb: does not have
-        //one so we should add it.
-        if (!u.toString().endsWith(QChar('/'))) {
-            u.setPath(QStringLiteral("/"));
-        }
-
-        d->m_treeView->setRootUrl(u);
-        d->m_rootUrl = u;
-    }
-
-    //Check if url represents a hidden folder and enable showing them
-    QString fileName = url.fileName();
-    //TODO a better hidden file check?
-    bool isHidden = fileName.length() > 1 && fileName[0] == '.' &&
-                    (fileName.length() > 2 ? fileName[1] != '.' : true);
-    bool showHiddenFiles = isHidden && !d->m_treeView->showHiddenFiles();
-    if (showHiddenFiles) {
-        d->showHiddenFoldersAction->setChecked(true);
-        d->m_treeView->setShowHiddenFiles(true);
-    }
-
-    d->m_treeView->setCurrentUrl(url);
-}
-
-void KDirSelectDialog::accept()
-{
-    QUrl selectedUrl = url();
-    if (!selectedUrl.isValid()) {
-        return;
-    }
-
-    if (!d->m_recentDirClass.isEmpty()) {
-        KRecentDirs::add(d->m_recentDirClass, selectedUrl.toString());
-    }
-
-    d->m_urlCombo->addToHistory(selectedUrl.toDisplayString());
-    KFileWidget::setStartDir(url());
-
-    QDialog::accept();
-}
-
-void KDirSelectDialog::hideEvent(QHideEvent *event)
-{
-    d->saveConfig(KSharedConfig::openConfig(), QStringLiteral("DirSelect Dialog"));
-
-    QDialog::hideEvent(event);
-}
-
-// static
-QUrl KDirSelectDialog::selectDirectory(const QUrl &startDir,
-                                       bool localOnly,
-                                       QWidget *parent,
-                                       const QString &caption)
-{
-    KDirSelectDialog myDialog(startDir, localOnly, parent);
-
-    if (!caption.isNull()) {
-        myDialog.setWindowTitle(caption);
-    }
-
-    if (myDialog.exec() == QDialog::Accepted) {
-        QUrl url = myDialog.url();
-
-        //Returning the most local url
-        if (url.isLocalFile()) {
-            return url;
-        }
-
-        KIO::StatJob *job = KIO::stat(url);
-        KJobWidgets::setWindow(job, parent);
-
-        if (!job->exec()) {
-            return url;
-        }
-
-        KIO::UDSEntry entry = job->statResult();
-        const QString path = entry.stringValue(KIO::UDSEntry::UDS_LOCAL_PATH);
-
-        return path.isEmpty() ? url : QUrl::fromLocalFile(path);
-    } else {
-        return QUrl();
-    }
-}
-
-QUrl KDirSelectDialog::directory()
-{
-    return url();
-}
-
-QList<QUrl> KDirSelectDialog::selectedFiles()
-{
-    return QList<QUrl>() << url();
-}
-
-void KDirSelectDialog::setDirectory(const QUrl &directory)
-{
-    setCurrentUrl(directory);
-}
-
-QString KDirSelectDialog::selectedNameFilter()
-{
-    return QString();
-}
-
-void KDirSelectDialog::selectFile(const QUrl &filename)
-{
-    Q_UNUSED(filename)
-}
-
-void KDirSelectDialog::selectNameFilter(const QString &filter)
-{
-    Q_UNUSED(filter)
-}
-
-
-#include "moc_kdirselectdialog_p.cpp"
diff --git a/src/platformtheme/kdirselectdialog_p.h b/src/platformtheme/kdirselectdialog_p.h
deleted file mode 100644
index 06be37f9311ee8275a08e742a6c882896920e8f0..0000000000000000000000000000000000000000
--- a/src/platformtheme/kdirselectdialog_p.h
+++ /dev/null
@@ -1,136 +0,0 @@
-/*
-  Copyright (C) 2001 Michael Jarrett <michaelj@corel.com>
-  Copyright (C) 2001 Carsten Pfeiffer <pfeiffer@kde.org>
-  Copyright (C) 2009 Shaun Reich <shaun.reich@kdemail.net>
-
-  This library is free software; you can redistribute it and/or
-  modify it under the terms of the GNU Library General Public
-  License version 2 as published by the Free Software Foundation.
-
-  This library is distributed in the hope that it will be useful,
-  but WITHOUT ANY WARRANTY; without even the implied warranty of
-  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
-  Library General Public License for more details.
-
-  You should have received a copy of the GNU Library General Public License
-  along with this library; see the file COPYING.LIB.  If not, write to
-  the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor,
-  Boston, MA 02110-1301, USA.
-*/
-
-#ifndef KDIRSELECTDIALOG_H
-#define KDIRSELECTDIALOG_H
-
-#include "kdeplatformfiledialogbase_p.h"
-#include <QUrl>
-
-class QAbstractItemView;
-
-/**
- * A pretty dialog for a KDirSelect control for selecting directories.
- * @author Michael Jarrett <michaelj@corel.com>
- * @deprecated since 5.0, use QFileDialog::getExistingDirectoryUrl instead.
- */
-class KDirSelectDialog : public KDEPlatformFileDialogBase
-{
-    Q_OBJECT
-
-public:
-    /**
-     * Creates a new directory selection dialog.
-     * @internal use the static selectDirectory function
-     * @param startDir the directory, initially shown
-     * @param localOnly unused. You can only select paths below the startDir
-     * @param parent the parent for the dialog, usually 0L
-     */
-    explicit KDirSelectDialog(const QUrl &startDir = QUrl(),
-                              bool localOnly = false,
-                              QWidget *parent = 0L);
-
-    /**
-     * Destroys the directory selection dialog.
-     */
-    ~KDirSelectDialog();
-
-    /**
-     * Returns the currently selected URL, or an empty one if no item is selected.
-     *
-     * If the URL entered in the combobox is valid and exists, it is returned.
-     * Otherwise, the URL selected in the treeview is returned instead.
-     */
-    QUrl url() const;
-
-    /**
-     * Returns the root url
-     */
-    QUrl rootUrl() const;
-
-    /**
-     * Returns a pointer to the view which is used for displaying the directories.
-     */
-    QAbstractItemView *view() const;
-
-    /**
-     * Returns whether only local directories can be selected.
-     */
-    bool localOnly() const;
-
-    /**
-     * Creates a KDirSelectDialog, and returns the result.
-     * @param startDir the directory, initially shown
-     * The tree will display this directory and subdirectories of it.
-     * @param localOnly unused. You can only select paths below the startDir
-     * @param parent the parent widget to use for the dialog, or NULL to create a parent-less dialog
-     * @param caption the caption to use for the dialog, or QString() for the default caption
-     * @return The URL selected, or an empty URL if the user canceled
-     * or no URL was selected.
-     *
-     * @deprecated since 5.0, use QFileDialog::getExistingDirectory (if localOnly was true)
-     * or QFileDialog::getExistingDirectoryUrl (if localOnly was false) instead.
-     */
-    static QUrl selectDirectory(const QUrl &startDir = QUrl(),
-            bool localOnly = false, QWidget *parent = 0L,
-            const QString &caption = QString());
-
-    /**
-     * @return The path for the root node
-     */
-    QUrl startDir() const;
-
-    QUrl directory() Q_DECL_OVERRIDE;
-    void selectNameFilter(const QString &filter) Q_DECL_OVERRIDE;
-    void setDirectory(const QUrl &directory) Q_DECL_OVERRIDE;
-    void selectFile(const QUrl &filename) Q_DECL_OVERRIDE;
-    QString selectedNameFilter() Q_DECL_OVERRIDE;
-    QList<QUrl> selectedFiles() Q_DECL_OVERRIDE;
-
-public Q_SLOTS:
-    /**
-     * Sets the current @p url in the dialog.
-     */
-    void setCurrentUrl(const QUrl &url);
-
-protected:
-    void accept() Q_DECL_OVERRIDE;
-
-    /**
-     * Reimplemented for saving the dialog geometry.
-     */
-    void hideEvent(QHideEvent *event) Q_DECL_OVERRIDE;
-
-private:
-    class Private;
-    Private *const d;
-
-    Q_PRIVATE_SLOT(d, void slotCurrentChanged())
-    Q_PRIVATE_SLOT(d, void slotExpand(const QModelIndex &))
-    Q_PRIVATE_SLOT(d, void slotUrlActivated(const QString &))
-    Q_PRIVATE_SLOT(d, void slotComboTextChanged(const QString &))
-    Q_PRIVATE_SLOT(d, void slotContextMenuRequested(const QPoint &))
-    Q_PRIVATE_SLOT(d, void slotNewFolder())
-    Q_PRIVATE_SLOT(d, void slotMoveToTrash())
-    Q_PRIVATE_SLOT(d, void slotDelete())
-    Q_PRIVATE_SLOT(d, void slotProperties())
-};
-
-#endif
diff --git a/src/platformtheme/kfiletreeview.cpp b/src/platformtheme/kfiletreeview.cpp
deleted file mode 100644
index 77b128d4c7d2309d871b3ab6289f3a8994284123..0000000000000000000000000000000000000000
--- a/src/platformtheme/kfiletreeview.cpp
+++ /dev/null
@@ -1,212 +0,0 @@
-/*
-   This file is part of the KDE project
-
-   Copyright (C) 2007 Tobias Koenig <tokoe@kde.org>
-
-   This library is free software; you can redistribute it and/or
-   modify it under the terms of the GNU Library General Public
-   License as published by the Free Software Foundation; either
-   version 2 of the License, or (at your option) any later version.
-
-   This library is distributed in the hope that it will be useful,
-   but WITHOUT ANY WARRANTY; without even the implied warranty of
-   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
-   Library General Public License for more details.
-
-   You should have received a copy of the GNU Library General Public License
-   along with this library; see the file COPYING.LIB.  If not, write to
-   the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor,
-   Boston, MA 02110-1301, USA.
-*/
-
-#include "kfiletreeview_p.h"
-
-#include <QDir>
-#include <QContextMenuEvent>
-#include <QMenu>
-#include <QUrl>
-
-#include <kdirlister.h>
-#include <kdirmodel.h>
-#include <kdirsortfilterproxymodel.h>
-#include <kfileitemdelegate.h>
-#include <klocalizedstring.h>
-#include <ktoggleaction.h>
-
-class KFileTreeView::Private
-{
-public:
-    Private(KFileTreeView *parent)
-        : q(parent)
-    {
-    }
-
-    QUrl urlForProxyIndex(const QModelIndex &index) const;
-
-    void _k_activated(const QModelIndex &);
-    void _k_currentChanged(const QModelIndex &, const QModelIndex &);
-    void _k_expanded(const QModelIndex &);
-
-    KFileTreeView *q;
-    KDirModel *mSourceModel;
-    KDirSortFilterProxyModel *mProxyModel;
-};
-
-QUrl KFileTreeView::Private::urlForProxyIndex(const QModelIndex &index) const
-{
-    const KFileItem item = mSourceModel->itemForIndex(mProxyModel->mapToSource(index));
-
-    return !item.isNull() ? item.url() : QUrl();
-}
-
-void KFileTreeView::Private::_k_activated(const QModelIndex &index)
-{
-    const QUrl url = urlForProxyIndex(index);
-    if (url.isValid()) {
-        emit q->activated(url);
-    }
-}
-
-void KFileTreeView::Private::_k_currentChanged(const QModelIndex &currentIndex, const QModelIndex &)
-{
-    const QUrl url = urlForProxyIndex(currentIndex);
-    if (url.isValid()) {
-        emit q->currentChanged(url);
-    }
-}
-
-void KFileTreeView::Private::_k_expanded(const QModelIndex &baseIndex)
-{
-    QModelIndex index = mProxyModel->mapFromSource(baseIndex);
-
-    q->selectionModel()->clearSelection();
-    q->selectionModel()->setCurrentIndex(index, QItemSelectionModel::SelectCurrent);
-    q->scrollTo(index);
-}
-
-KFileTreeView::KFileTreeView(QWidget *parent)
-    : QTreeView(parent), d(new Private(this))
-{
-    d->mSourceModel = new KDirModel(this);
-    d->mProxyModel = new KDirSortFilterProxyModel(this);
-    d->mProxyModel->setSourceModel(d->mSourceModel);
-
-    setModel(d->mProxyModel);
-    setItemDelegate(new KFileItemDelegate(this));
-    setLayoutDirection(Qt::LeftToRight);
-
-    d->mSourceModel->dirLister()->openUrl(QUrl::fromLocalFile(QDir::root().absolutePath()), KDirLister::Keep);
-
-    connect(this, SIGNAL(activated(QModelIndex)),
-            this, SLOT(_k_activated(QModelIndex)));
-    connect(selectionModel(), SIGNAL(currentChanged(QModelIndex,QModelIndex)),
-            this, SLOT(_k_currentChanged(QModelIndex,QModelIndex)));
-
-    connect(d->mSourceModel, SIGNAL(expand(QModelIndex)),
-            this, SLOT(_k_expanded(QModelIndex)));
-}
-
-KFileTreeView::~KFileTreeView()
-{
-    delete d;
-}
-
-QUrl KFileTreeView::currentUrl() const
-{
-    return d->urlForProxyIndex(currentIndex());
-}
-
-QUrl KFileTreeView::selectedUrl() const
-{
-    if (!selectionModel()->hasSelection()) {
-        return QUrl();
-    }
-
-    const QItemSelection selection = selectionModel()->selection();
-    const QModelIndex firstIndex = selection.indexes().first();
-
-    return d->urlForProxyIndex(firstIndex);
-}
-
-QList<QUrl> KFileTreeView::selectedUrls() const
-{
-    QList<QUrl> urls;
-
-    if (!selectionModel()->hasSelection()) {
-        return urls;
-    }
-
-    const QModelIndexList indexes = selectionModel()->selection().indexes();
-    foreach (const QModelIndex &index, indexes) {
-        const QUrl url = d->urlForProxyIndex(index);
-        if (url.isValid()) {
-            urls.append(url);
-        }
-    }
-
-    return urls;
-}
-
-QUrl KFileTreeView::rootUrl() const
-{
-    return d->mSourceModel->dirLister()->url();
-}
-
-void KFileTreeView::setDirOnlyMode(bool enabled)
-{
-    d->mSourceModel->dirLister()->setDirOnlyMode(enabled);
-    d->mSourceModel->dirLister()->openUrl(d->mSourceModel->dirLister()->url());
-}
-
-void KFileTreeView::setShowHiddenFiles(bool enabled)
-{
-    QUrl url = currentUrl();
-    d->mSourceModel->dirLister()->setShowingDotFiles(enabled);
-    d->mSourceModel->dirLister()->openUrl(d->mSourceModel->dirLister()->url());
-    setCurrentUrl(url);
-}
-
-void KFileTreeView::setCurrentUrl(const QUrl &url)
-{
-    QModelIndex baseIndex = d->mSourceModel->indexForUrl(url);
-
-    if (!baseIndex.isValid()) {
-        d->mSourceModel->expandToUrl(url);
-        return;
-    }
-
-    QModelIndex proxyIndex = d->mProxyModel->mapFromSource(baseIndex);
-    selectionModel()->clearSelection();
-    selectionModel()->setCurrentIndex(proxyIndex, QItemSelectionModel::SelectCurrent);
-    scrollTo(proxyIndex);
-}
-
-void KFileTreeView::setRootUrl(const QUrl &url)
-{
-    d->mSourceModel->dirLister()->openUrl(url);
-}
-
-void KFileTreeView::contextMenuEvent(QContextMenuEvent *event)
-{
-    QMenu menu;
-    KToggleAction *showHiddenAction = new KToggleAction(i18n("Show Hidden Folders"), &menu);
-    showHiddenAction->setChecked(d->mSourceModel->dirLister()->showingDotFiles());
-    connect(showHiddenAction, SIGNAL(toggled(bool)), this, SLOT(setShowHiddenFiles(bool)));
-
-    menu.addAction(showHiddenAction);
-    menu.exec(event->globalPos());
-}
-
-bool KFileTreeView::showHiddenFiles() const
-{
-    return d->mSourceModel->dirLister()->showingDotFiles();
-}
-
-QSize KFileTreeView::sizeHint() const
-{
-    // This size makes KDirSelectDialog pop up just under 800x600 by default :-)
-    return QSize(680, 500);
-}
-
-#include "moc_kfiletreeview_p.cpp"
-
diff --git a/src/platformtheme/kfiletreeview_p.h b/src/platformtheme/kfiletreeview_p.h
deleted file mode 100644
index 844201814aa4f6e1d8c7131691eb770373ff56f5..0000000000000000000000000000000000000000
--- a/src/platformtheme/kfiletreeview_p.h
+++ /dev/null
@@ -1,128 +0,0 @@
-/*
-   This file is part of the KDE project
-
-   Copyright (C) 2007 Tobias Koenig <tokoe@kde.org>
-
-   This library is free software; you can redistribute it and/or
-   modify it under the terms of the GNU Library General Public
-   License as published by the Free Software Foundation; either
-   version 2 of the License, or (at your option) any later version.
-
-   This library is distributed in the hope that it will be useful,
-   but WITHOUT ANY WARRANTY; without even the implied warranty of
-   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
-   Library General Public License for more details.
-
-   You should have received a copy of the GNU Library General Public License
-   along with this library; see the file COPYING.LIB.  If not, write to
-   the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor,
-   Boston, MA 02110-1301, USA.
-*/
-
-#ifndef KFILETREEVIEW_H
-#define KFILETREEVIEW_H
-
-#include <QTreeView>
-
-#include <QUrl>
-
-/**
- * The file treeview offers a treeview on the filesystem.
- */
-class KFileTreeView : public QTreeView // exported only for kfiletreeviewtest
-{
-    Q_OBJECT
-
-public:
-    /**
-     * Creates a new file tree view.
-     */
-    KFileTreeView(QWidget *parent = 0);
-
-    /**
-     * Destroys the file tree view.
-     */
-    ~KFileTreeView();
-
-    /**
-     * Returns the current url.
-     */
-    QUrl currentUrl() const;
-
-    /**
-     * Returns the selected url.
-     */
-    QUrl selectedUrl() const;
-
-    /**
-     * Returns all selected urls.
-     */
-    QList<QUrl> selectedUrls() const;
-
-    /**
-     * Returns the current root url of the view.
-     */
-    QUrl rootUrl() const;
-
-    /**
-     * Returns true if the view is currently showing hidden files
-     * @since 4.3
-     */
-    bool showHiddenFiles() const;
-
-    /**
-     * @reimplemented
-     */
-    QSize sizeHint() const Q_DECL_OVERRIDE;
-
-public Q_SLOTS:
-    /**
-     * Sets whether the dir-only mode is @p enabled.
-     *
-     * In dir-only mode, only directories and subdirectories
-     * are listed in the view.
-     */
-    void setDirOnlyMode(bool enabled);
-
-    /**
-     * Sets whether hidden files shall be listed.
-     */
-    void setShowHiddenFiles(bool enabled);
-
-    /**
-     * Sets the current @p url of the view.
-     */
-    void setCurrentUrl(const QUrl &url);
-
-    /**
-     * Sets the root @p url of the view.
-     *
-     * The default is file:///.
-     */
-    void setRootUrl(const QUrl &url);
-
-Q_SIGNALS:
-    /**
-     * This signal is emitted whenever an @p url has been activated.
-     */
-    void activated(const QUrl &url);
-
-    /**
-     * This signal is emitted whenever the current @p url has been changed.
-     */
-    void currentChanged(const QUrl &url);
-
-protected:
-    using QTreeView::currentChanged;
-    void contextMenuEvent(QContextMenuEvent *) Q_DECL_OVERRIDE;
-
-private:
-    class Private;
-    Private *const d;
-
-    Q_PRIVATE_SLOT(d, void _k_activated(const QModelIndex &))
-    Q_PRIVATE_SLOT(d, void _k_currentChanged(const QModelIndex &, const QModelIndex &))
-    Q_PRIVATE_SLOT(d, void _k_expanded(const QModelIndex &))
-};
-
-#endif
diff --git a/src/platformtheme/kfontsettingsdata.h b/src/platformtheme/kfontsettingsdata.h
deleted file mode 100644
index 4b92c7df0d952be2989ed99b30109f64f51384d4..0000000000000000000000000000000000000000
--- a/src/platformtheme/kfontsettingsdata.h
+++ /dev/null
@@ -1,71 +0,0 @@
-/* This file is part of the KDE libraries
-   Copyright (C) 2000, 2006 David Faure <faure@kde.org>
-   Copyright 2008 Friedrich W. H. Kossebau <kossebau@kde.org>
-   Copyright 2013 Aleix Pol Gonzalez <aleixpol@blue-systems.com>
-
-   This library is free software; you can redistribute it and/or
-   modify it under the terms of the GNU Library General Public
-   License version 2 as published by the Free Software Foundation.
-
-   This library is distributed in the hope that it will be useful,
-   but WITHOUT ANY WARRANTY; without even the implied warranty of
-   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
-   Library General Public License for more details.
-
-   You should have received a copy of the GNU Library General Public License
-   along with this library; see the file COPYING.LIB.  If not, write to
-   the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor,
-   Boston, MA 02110-1301, USA.
-*/
-
-#ifndef KFONTSETTINGSDATA_H
-#define KFONTSETTINGSDATA_H
-
-#include <QObject>
-#include <QFont>
-#include <ksharedconfig.h>
-
-struct KFontData {
-    const char *ConfigGroupKey;
-    const char *ConfigKey;
-    const char *FontName;
-    int Size;
-    int Weight;
-    QFont::StyleHint StyleHint;
-};
-
-class KFontSettingsData : public QObject
-{
-    Q_OBJECT
-public:
-    // if adding a new type here also add an entry to DefaultFontData
-    enum FontTypes {
-        GeneralFont = 0,
-        FixedFont,
-        ToolbarFont,
-        MenuFont,
-        WindowTitleFont,
-        TaskbarFont,
-        SmallestReadableFont,
-        FontTypesCount
-    };
-
-public:
-    KFontSettingsData();
-    ~KFontSettingsData();
-
-public Q_SLOTS:
-    void dropFontSettingsCache();
-
-private Q_SLOTS:
-    void delayedDBusConnects();
-
-public: // access, is not const due to caching
-    QFont *font(FontTypes fontType);
-
-private:
-    QFont *mFonts[FontTypesCount];
-    KSharedConfigPtr mKdeGlobals;
-};
-
-#endif // KFONTSETTINGSDATA_H
diff --git a/src/platformtheme/kfontsettingsdata.cpp b/src/platformtheme/kfontsettingsdata.cpp
deleted file mode 100644
index b0a4bbf9bc58c681496cffc6a6a8698efceafea7..0000000000000000000000000000000000000000
--- a/src/platformtheme/kfontsettingsdata.cpp
+++ /dev/null
@@ -1,114 +0,0 @@
-/* This file is part of the KDE libraries
-   Copyright (C) 2000, 2006 David Faure <faure@kde.org>
-   Copyright 2008 Friedrich W. H. Kossebau <kossebau@kde.org>
-   Copyright 2013 Aleix Pol Gonzalez <aleixpol@blue-systems.com>
-
-   This library is free software; you can redistribute it and/or
-   modify it under the terms of the GNU Library General Public
-   License version 2 as published by the Free Software Foundation.
-
-   This library is distributed in the hope that it will be useful,
-   but WITHOUT ANY WARRANTY; without even the implied warranty of
-   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
-   Library General Public License for more details.
-
-   You should have received a copy of the GNU Library General Public License
-   along with this library; see the file COPYING.LIB.  If not, write to
-   the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor,
-   Boston, MA 02110-1301, USA.
-*/
-
-#include "kfontsettingsdata.h"
-#include <QCoreApplication>
-#include <QString>
-#include <QVariant>
-#include <QApplication>
-#include <QDBusMessage>
-#include <QDBusConnection>
-#include <qpa/qwindowsysteminterface.h>
-
-#include <ksharedconfig.h>
-#include <kconfiggroup.h>
-
-KFontSettingsData::KFontSettingsData()
-    : QObject(0)
-{
-    QMetaObject::invokeMethod(this, "delayedDBusConnects", Qt::QueuedConnection);
-
-    for (int i = 0; i < FontTypesCount; ++i) {
-        mFonts[i] = 0;
-    }
-}
-
-KFontSettingsData::~KFontSettingsData()
-{
-    for (int i = 0; i < FontTypesCount; ++i) {
-        delete mFonts[i];
-    }
-}
-
-// NOTE: keep in sync with plasma-desktop/kcms/fonts/fonts.cpp
-static const char GeneralId[] =      "General";
-static const char DefaultFont[] =    "Noto Sans";
-
-static const KFontData DefaultFontData[KFontSettingsData::FontTypesCount] = {
-    { GeneralId, "font",                 DefaultFont,  10, -1, QFont::SansSerif },
-    { GeneralId, "fixed",                "Oxygen Mono",  9, -1, QFont::Monospace },
-    { GeneralId, "toolBarFont",          DefaultFont,  9, -1, QFont::SansSerif },
-    { GeneralId, "menuFont",             DefaultFont,  10, -1, QFont::SansSerif },
-    { "WM",      "activeFont",           DefaultFont,  10, -1, QFont::SansSerif },
-    { GeneralId, "taskbarFont",          DefaultFont,  10, -1, QFont::SansSerif },
-    { GeneralId, "smallestReadableFont", DefaultFont,  8, -1, QFont::SansSerif }
-};
-
-QFont *KFontSettingsData::font(FontTypes fontType)
-{
-    QFont *cachedFont = mFonts[fontType];
-
-    if (!cachedFont) {
-        const KFontData &fontData = DefaultFontData[fontType];
-        cachedFont = new QFont(fontData.FontName, fontData.Size, fontData.Weight);
-        cachedFont->setStyleHint(fontData.StyleHint);
-
-        if (!mKdeGlobals) {
-            mKdeGlobals = KSharedConfig::openConfig(QStringLiteral("kdeglobals"), KConfig::NoGlobals);
-        }
-        const KConfigGroup configGroup(mKdeGlobals, fontData.ConfigGroupKey);
-        QString fontInfo = configGroup.readEntry(fontData.ConfigKey, QString());
-
-        //If we have serialized information for this font, restore it
-        //NOTE: We are not using KConfig directly because we can't call QFont::QFont from here
-        if (!fontInfo.isEmpty()) {
-            cachedFont->fromString(fontInfo);
-        }
-
-        mFonts[fontType] = cachedFont;
-    }
-
-    return cachedFont;
-}
-
-void KFontSettingsData::dropFontSettingsCache()
-{
-    if (mKdeGlobals) {
-        mKdeGlobals->reparseConfiguration();
-    }
-    for (int i = 0; i < FontTypesCount; ++i) {
-        delete mFonts[i];
-        mFonts[i] = 0;
-    }
-
-    QWindowSystemInterface::handleThemeChange(0);
-
-    if (qobject_cast<QApplication *>(QCoreApplication::instance())) {
-        QApplication::setFont(*font(KFontSettingsData::GeneralFont));
-    } else {
-        QGuiApplication::setFont(*font(KFontSettingsData::GeneralFont));
-    }
-}
-
-void KFontSettingsData::delayedDBusConnects()
-{
-    QDBusConnection::sessionBus().connect(QString(), QStringLiteral("/KDEPlatformTheme"), QStringLiteral("org.kde.KDEPlatformTheme"),
-                                          QStringLiteral("refreshFonts"), this, SLOT(dropFontSettingsCache()));
-}
diff --git a/src/platformtheme/khintssettings.h b/src/platformtheme/khintssettings.h
deleted file mode 100644
index ec064d32c8516e3647b7731e643bc90d03e7a833..0000000000000000000000000000000000000000
--- a/src/platformtheme/khintssettings.h
+++ /dev/null
@@ -1,89 +0,0 @@
-/*  This file is part of the KDE libraries
- *  Copyright 2013 Alejandro Fiestas Olivares <afiestas@kde.org>
- *
- *  This library is free software; you can redistribute it and/or modify
- *  it under the terms of the GNU Lesser General Public License as published by
- *  the Free Software Foundation; either version 2 of the License or ( at
- *  your option ) version 3 or, at the discretion of KDE e.V. ( which shall
- *  act as a proxy as in section 14 of the GPLv3 ), any later version.
- *
- *  This library is distributed in the hope that it will be useful,
- *  but WITHOUT ANY WARRANTY; without even the implied warranty of
- *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
- *  Library General Public License for more details.
- *
- *  You should have received a copy of the GNU Lesser General Public License
- *  along with this library; see the file COPYING.LIB.  If not, write to
- *  the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor,
- *  Boston, MA 02110-1301, USA.
- */
-
-#ifndef KHINTS_SETTINGS_H
-#define KHINTS_SETTINGS_H
-
-#include <QObject>
-#include <QVariant>
-
-#include <qpa/qplatformtheme.h>
-#include <ksharedconfig.h>
-
-class KConfigGroup;
-
-class QPalette;
-class KHintsSettings : public QObject
-{
-    Q_OBJECT
-public:
-    /**
-    * An identifier for change signals.
-    * @note Copied from KGlobalSettings
-    */
-    enum ChangeType { PaletteChanged = 0, FontChanged, StyleChanged,
-                      SettingsChanged, IconChanged, CursorChanged,
-                      ToolbarStyleChanged, ClipboardConfigChanged,
-                      BlockShortcuts, NaturalSortingChanged
-                    };
-    /**
-    * Valid values for the settingsChanged signal
-    * @note Copied from KGlobalSettings
-    */
-    enum SettingsCategory { SETTINGS_MOUSE, SETTINGS_COMPLETION, SETTINGS_PATHS,
-                            SETTINGS_POPUPMENU, SETTINGS_QT, SETTINGS_SHORTCUTS,
-                            SETTINGS_LOCALE, SETTINGS_STYLE
-                          };
-    explicit KHintsSettings();
-    virtual ~KHintsSettings();
-
-    inline QVariant hint(QPlatformTheme::ThemeHint hint) const
-    {
-        return m_hints[hint];
-    }
-
-    inline QPalette *palette(QPlatformTheme::Palette type) const
-    {
-        return m_palettes[type];
-    }
-
-private Q_SLOTS:
-    void delayedDBusConnects();
-    void setupIconLoader();
-    void toolbarStyleChanged();
-    void slotNotifyChange(int type, int arg);
-
-private:
-    QVariant readConfigValue(const QString &group, const QString &key, const QVariant &defaultValue);
-    void loadPalettes();
-    void iconChanged(int group);
-    void updateQtSettings(KConfigGroup &cg);
-    Qt::ToolButtonStyle toolButtonStyle(const KConfigGroup &cg) const;
-    void updateCursorTheme();
-
-    QStringList xdgIconThemePaths() const;
-    QHash<QPlatformTheme::Palette, QPalette *> m_palettes;
-    QHash<QPlatformTheme::ThemeHint, QVariant> m_hints;
-    KSharedConfigPtr mKdeGlobals;
-    KSharedConfigPtr mDefaultLnfConfig;
-    KSharedConfigPtr mLnfConfig;
-};
-
-#endif //KHINTS_SETTINGS_H
diff --git a/src/platformtheme/khintssettings.cpp b/src/platformtheme/khintssettings.cpp
deleted file mode 100644
index 8adf6c52865beeebdf3ca328f3def121b487fc55..0000000000000000000000000000000000000000
--- a/src/platformtheme/khintssettings.cpp
+++ /dev/null
@@ -1,415 +0,0 @@
-/*  This file is part of the KDE libraries
- *  Copyright 2013 Kevin Ottens <ervin+bluesystems@kde.org>
- *  Copyright 2013 Aleix Pol Gonzalez <aleixpol@blue-systems.com>
- *  Copyright 2013 Alejandro Fiestas Olivares <afiestas@kde.org>
- *
- *  This library is free software; you can redistribute it and/or modify
- *  it under the terms of the GNU Lesser General Public License as published by
- *  the Free Software Foundation; either version 2 of the License or ( at
- *  your option ) version 3 or, at the discretion of KDE e.V. ( which shall
- *  act as a proxy as in section 14 of the GPLv3 ), any later version.
- *
- *  This library is distributed in the hope that it will be useful,
- *  but WITHOUT ANY WARRANTY; without even the implied warranty of
- *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
- *  Library General Public License for more details.
- *
- *  You should have received a copy of the GNU Lesser General Public License
- *  along with this library; see the file COPYING.LIB.  If not, write to
- *  the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor,
- *  Boston, MA 02110-1301, USA.
- */
-
-#include "khintssettings.h"
-
-#include <QDebug>
-#include <QDir>
-#include <QString>
-#include <QFileInfo>
-#include <QToolBar>
-#include <QPalette>
-#include <QToolButton>
-#include <QMainWindow>
-#include <QApplication>
-#include <QGuiApplication>
-#include <QDialogButtonBox>
-#include <QScreen>
-
-#include <QDBusConnection>
-#include <QDBusInterface>
-
-#include <kiconloader.h>
-#include <kconfiggroup.h>
-#include <ksharedconfig.h>
-#include <kcolorscheme.h>
-
-#ifndef UNIT_TEST
-#include <config-platformtheme.h>
-#else
-#define HAVE_X11 0
-#endif
-#if HAVE_X11
-#include <QX11Info>
-#include <X11/Xcursor/Xcursor.h>
-#endif
-
-static const QString defaultLookAndFeelPackage = QStringLiteral("org.kde.breeze.desktop");
-
-KHintsSettings::KHintsSettings() : QObject(0)
-{
-    mKdeGlobals = KSharedConfig::openConfig(QStringLiteral("kdeglobals"), KConfig::NoGlobals);
-    KConfigGroup cg(mKdeGlobals, "KDE");
-
-    // try to extract the proper defaults file from a lookandfeel package
-    const QString looknfeel = cg.readEntry("LookAndFeelPackage", defaultLookAndFeelPackage);
-    mDefaultLnfConfig = KSharedConfig::openConfig(QStandardPaths::locate(QStandardPaths::GenericDataLocation, "plasma/look-and-feel/" + looknfeel + "/contents/defaults"));
-    if (looknfeel != defaultLookAndFeelPackage) {
-        mLnfConfig = KSharedConfig::openConfig(QStandardPaths::locate(QStandardPaths::GenericDataLocation, "plasma/look-and-feel/" + defaultLookAndFeelPackage + "/contents/defaults"));
-    }
-
-
-    m_hints[QPlatformTheme::CursorFlashTime] = qBound(200, cg.readEntry("CursorBlinkRate", 1000), 2000);
-    m_hints[QPlatformTheme::MouseDoubleClickInterval] = cg.readEntry("DoubleClickInterval", 400);
-    m_hints[QPlatformTheme::StartDragDistance] = cg.readEntry("StartDragDist", 10);
-    m_hints[QPlatformTheme::StartDragTime] = cg.readEntry("StartDragTime", 500);
-
-    KConfigGroup cgToolbar(mKdeGlobals, "Toolbar style");
-    m_hints[QPlatformTheme::ToolButtonStyle] = toolButtonStyle(cgToolbar);
-
-    KConfigGroup cgToolbarIcon(mKdeGlobals, "MainToolbarIcons");
-    m_hints[QPlatformTheme::ToolBarIconSize] = cgToolbarIcon.readEntry("Size", 22);
-
-    m_hints[QPlatformTheme::ItemViewActivateItemOnSingleClick] = cg.readEntry("SingleClick", true);
-
-    m_hints[QPlatformTheme::SystemIconThemeName] = readConfigValue(QStringLiteral("Icons"), QStringLiteral("Theme"), "breeze");
-
-    m_hints[QPlatformTheme::SystemIconFallbackThemeName] = "hicolor";
-    m_hints[QPlatformTheme::IconThemeSearchPaths] = xdgIconThemePaths();
-
-    QStringList styleNames;
-    styleNames << cg.readEntry("widgetStyle", QString())
-               << QStringLiteral("breeze")
-               << QStringLiteral("oxygen")
-               << QStringLiteral("fusion")
-               << QStringLiteral("windows");
-    const QString lnfStyle = readConfigValue(QStringLiteral("KDE"), QStringLiteral("widgetStyle"), QString()).toString();
-    if (!lnfStyle.isEmpty()) {
-        styleNames.removeOne(lnfStyle);
-        styleNames.prepend(lnfStyle);
-    }
-    m_hints[QPlatformTheme::StyleNames] = styleNames;
-
-    m_hints[QPlatformTheme::DialogButtonBoxLayout] = QDialogButtonBox::KdeLayout;
-    m_hints[QPlatformTheme::DialogButtonBoxButtonsHaveIcons] = cg.readEntry("ShowIconsOnPushButtons", true);
-    m_hints[QPlatformTheme::UseFullScreenForPopupMenu] = true;
-    m_hints[QPlatformTheme::KeyboardScheme] = QPlatformTheme::KdeKeyboardScheme;
-    m_hints[QPlatformTheme::UiEffects] = cg.readEntry("GraphicEffectsLevel", 0) != 0 ? QPlatformTheme::GeneralUiEffect : 0;
-    m_hints[QPlatformTheme::IconPixmapSizes] = QVariant::fromValue(QList<int>() << 512 << 256 << 128 << 64 << 32 << 22 << 16 << 8);
-
-#if (QT_VERSION >= QT_VERSION_CHECK(5, 5, 0))
-    m_hints[QPlatformTheme::WheelScrollLines] = cg.readEntry("WheelScrollLines", 3);
-#endif
-    if (qobject_cast<QApplication *>(QCoreApplication::instance())) {
-        QApplication::setWheelScrollLines(cg.readEntry("WheelScrollLines", 3));
-    }
-
-    bool showIcons = cg.readEntry("ShowIconsInMenuItems", !QApplication::testAttribute(Qt::AA_DontShowIconsInMenus));
-    QCoreApplication::setAttribute(Qt::AA_DontShowIconsInMenus, !showIcons);
-
-    QMetaObject::invokeMethod(this, "delayedDBusConnects", Qt::QueuedConnection);
-    QMetaObject::invokeMethod(this, "setupIconLoader", Qt::QueuedConnection);
-
-    loadPalettes();
-}
-
-KHintsSettings::~KHintsSettings()
-{
-    qDeleteAll(m_palettes);
-}
-
-QVariant KHintsSettings::readConfigValue(const QString &group, const QString &key, const QVariant &defaultValue)
-{
-    KConfigGroup userCg(mKdeGlobals, group);
-    QVariant value = userCg.readEntry(key, QString());
-
-    if (!value.isNull()) {
-        return value;
-    }
-
-    if (mLnfConfig) {
-        KConfigGroup lnfCg(mLnfConfig, "kdeglobals");
-        lnfCg = KConfigGroup(&lnfCg, group);
-        if (lnfCg.isValid()) {
-            value = lnfCg.readEntry(key, defaultValue);
-
-            if (!value.isNull()) {
-                return value;
-            }
-        }
-    }
-
-    KConfigGroup lnfCg(mDefaultLnfConfig, group);
-    if (lnfCg.isValid()) {
-        return lnfCg.readEntry(key, defaultValue);
-    }
-
-    return defaultValue;
-}
-
-QStringList KHintsSettings::xdgIconThemePaths() const
-{
-    QStringList paths;
-
-    const QFileInfo homeIconDir(QDir::homePath() + QStringLiteral("/.icons"));
-    if (homeIconDir.isDir()) {
-        paths << homeIconDir.absoluteFilePath();
-    }
-
-    QString xdgDirString = QFile::decodeName(qgetenv("XDG_DATA_DIRS"));
-
-    if (xdgDirString.isEmpty()) {
-        xdgDirString = QStringLiteral("/usr/local/share:/usr/share");
-    }
-
-    foreach (const QString &xdgDir, xdgDirString.split(QLatin1Char(':'))) {
-        const QFileInfo xdgIconsDir(xdgDir + QStringLiteral("/icons"));
-        if (xdgIconsDir.isDir()) {
-            paths << xdgIconsDir.absoluteFilePath();
-        }
-    }
-
-    return paths;
-}
-
-void KHintsSettings::delayedDBusConnects()
-{
-    QDBusConnection::sessionBus().connect(QString(), QStringLiteral("/KToolBar"), QStringLiteral("org.kde.KToolBar"),
-                                          QStringLiteral("styleChanged"), this, SLOT(toolbarStyleChanged()));
-    QDBusConnection::sessionBus().connect(QString(), QStringLiteral("/KGlobalSettings"), QStringLiteral("org.kde.KGlobalSettings"),
-                                          QStringLiteral("notifyChange"), this, SLOT(slotNotifyChange(int,int)));
-}
-
-void KHintsSettings::setupIconLoader()
-{
-    connect(KIconLoader::global(), &KIconLoader::iconChanged, this, &KHintsSettings::iconChanged);
-}
-
-void KHintsSettings::toolbarStyleChanged()
-{
-    mKdeGlobals->reparseConfiguration();
-    KConfigGroup cg(mKdeGlobals, "Toolbar style");
-
-    m_hints[QPlatformTheme::ToolButtonStyle] = toolButtonStyle(cg);
-    //from gtksymbol.cpp
-    QWidgetList widgets = QApplication::allWidgets();
-    for (int i = 0; i < widgets.size(); ++i) {
-        QWidget *widget = widgets.at(i);
-        if (qobject_cast<QToolButton *>(widget)) {
-            QEvent event(QEvent::StyleChange);
-            QApplication::sendEvent(widget, &event);
-        }
-    }
-}
-
-void KHintsSettings::slotNotifyChange(int type, int arg)
-{
-    mKdeGlobals->reparseConfiguration();
-    KConfigGroup cg(mKdeGlobals, "KDE");
-
-    switch (type) {
-    case PaletteChanged: {
-        loadPalettes();
-
-        //QApplication::setPalette and QGuiApplication::setPalette are different functions
-        //and non virtual. Call the correct one
-        if (qobject_cast<QApplication *>(QCoreApplication::instance())) {
-            QApplication::setPalette(*m_palettes[QPlatformTheme::SystemPalette]);
-        } else if (qobject_cast<QGuiApplication *>(QCoreApplication::instance())) {
-            QGuiApplication::setPalette(*m_palettes[QPlatformTheme::SystemPalette]);
-        }
-        break;
-    }
-    case SettingsChanged: {
-
-        SettingsCategory category = static_cast<SettingsCategory>(arg);
-        if (category == SETTINGS_QT || category == SETTINGS_MOUSE) {
-            updateQtSettings(cg);
-        } else if (category == SETTINGS_STYLE) {
-            m_hints[QPlatformTheme::DialogButtonBoxButtonsHaveIcons] = cg.readEntry("ShowIconsOnPushButtons", true);
-            m_hints[QPlatformTheme::UiEffects] = cg.readEntry("GraphicEffectsLevel", 0) != 0 ? QPlatformTheme::GeneralUiEffect : 0;
-        }
-        break;
-    }
-    case ToolbarStyleChanged: {
-        toolbarStyleChanged();
-        break;
-    }
-    case IconChanged:
-        iconChanged(arg); //Once the KCM is ported to use IconChanged, this should not be needed
-        break;
-    case CursorChanged:
-        updateCursorTheme();
-        break;
-    case StyleChanged: {
-        QApplication *app = qobject_cast<QApplication *>(QCoreApplication::instance());
-        if (!app) {
-            return;
-        }
-
-        const QString theme = cg.readEntry("widgetStyle", QString());
-        if (theme.isEmpty()) {
-            return;
-        }
-
-        QStringList styleNames;
-        styleNames << cg.readEntry("widgetStyle", QString())
-                << QStringLiteral("breeze")
-                << QStringLiteral("oxygen")
-                << QStringLiteral("fusion")
-                << QStringLiteral("windows");
-        const QString lnfStyle = readConfigValue(QStringLiteral("KDE"), QStringLiteral("widgetStyle"), QString()).toString();
-        if (!lnfStyle.isEmpty() && !styleNames.contains(lnfStyle)) {
-            styleNames.prepend(lnfStyle);
-        }
-        m_hints[QPlatformTheme::StyleNames] = styleNames;
-
-        app->setStyle(theme);
-        loadPalettes();
-        break;
-    }
-    default:
-        qWarning() << "Unknown type of change in KGlobalSettings::slotNotifyChange: " << type;
-    }
-}
-
-void KHintsSettings::iconChanged(int group)
-{
-    KIconLoader::Group iconGroup = (KIconLoader::Group) group;
-    if (iconGroup != KIconLoader::MainToolbar) {
-        m_hints[QPlatformTheme::SystemIconThemeName] = readConfigValue(QStringLiteral("Icons"), QStringLiteral("Theme"), "breeze");
-
-        return;
-    }
-
-    const int currentSize = KIconLoader::global()->currentSize(KIconLoader::MainToolbar);
-    if (m_hints[QPlatformTheme::ToolBarIconSize] == currentSize) {
-        return;
-    }
-
-    m_hints[QPlatformTheme::ToolBarIconSize] = currentSize;
-
-    //If we are not a QApplication, means that we are a QGuiApplication, then we do nothing.
-    if (!qobject_cast<QApplication *>(QCoreApplication::instance())) {
-        return;
-    }
-
-    QWidgetList widgets = QApplication::allWidgets();
-    Q_FOREACH (QWidget *widget, widgets) {
-        if (qobject_cast<QToolBar *>(widget) || qobject_cast<QMainWindow *>(widget)) {
-            QEvent event(QEvent::StyleChange);
-            QApplication::sendEvent(widget, &event);
-        }
-    }
-}
-
-void KHintsSettings::updateQtSettings(KConfigGroup &cg)
-{
-    int flash = qBound(200, cg.readEntry("CursorBlinkRate", 1000), 2000);
-    m_hints[QPlatformTheme::CursorFlashTime] = flash;
-
-    int doubleClickInterval = cg.readEntry("DoubleClickInterval", 400);
-    m_hints[QPlatformTheme::MouseDoubleClickInterval] = doubleClickInterval;
-
-    int startDragDistance = cg.readEntry("StartDragDist", 10);
-    m_hints[QPlatformTheme::StartDragDistance] = startDragDistance;
-
-    int startDragTime = cg.readEntry("StartDragTime", 10);
-    m_hints[QPlatformTheme::StartDragTime] = startDragTime;
-
-    m_hints[QPlatformTheme::ItemViewActivateItemOnSingleClick] = cg.readEntry("SingleClick", true);
-
-    bool showIcons = cg.readEntry("ShowIconsInMenuItems", !QApplication::testAttribute(Qt::AA_DontShowIconsInMenus));
-    QCoreApplication::setAttribute(Qt::AA_DontShowIconsInMenus, !showIcons);
-
-#if (QT_VERSION >= QT_VERSION_CHECK(5, 5, 0))
-    int wheelScrollLines = cg.readEntry("WheelScrollLines", 3);
-    m_hints[QPlatformTheme::WheelScrollLines] = wheelScrollLines;
-#endif
-    QApplication *app = qobject_cast<QApplication *>(QCoreApplication::instance());
-    if (app) {
-        QApplication::setWheelScrollLines(cg.readEntry("WheelScrollLines", 3));
-    }
-}
-
-Qt::ToolButtonStyle KHintsSettings::toolButtonStyle(const KConfigGroup &cg) const
-{
-    const QString buttonStyle = cg.readEntry("ToolButtonStyle", "TextBesideIcon").toLower();
-    return buttonStyle == QLatin1String("textbesideicon") ? Qt::ToolButtonTextBesideIcon
-           : buttonStyle == QLatin1String("icontextright") ? Qt::ToolButtonTextBesideIcon
-           : buttonStyle == QLatin1String("textundericon") ? Qt::ToolButtonTextUnderIcon
-           : buttonStyle == QLatin1String("icontextbottom") ? Qt::ToolButtonTextUnderIcon
-           : buttonStyle == QLatin1String("textonly") ? Qt::ToolButtonTextOnly
-           : Qt::ToolButtonIconOnly;
-}
-
-void KHintsSettings::loadPalettes()
-{
-    qDeleteAll(m_palettes);
-    m_palettes.clear();
-
-    if (mKdeGlobals->hasGroup("Colors:View")) {
-        m_palettes[QPlatformTheme::SystemPalette] = new QPalette(KColorScheme::createApplicationPalette(mKdeGlobals));
-    } else {
-
-        KConfigGroup cg(mKdeGlobals, "KDE");
-        const QString looknfeel = cg.readEntry("LookAndFeelPackage", defaultLookAndFeelPackage);
-        QString path = QStandardPaths::locate(QStandardPaths::GenericDataLocation, "plasma/look-and-feel/" + looknfeel + "/contents/colors");
-        if (!path.isEmpty()) {
-            m_palettes[QPlatformTheme::SystemPalette] = new QPalette(KColorScheme::createApplicationPalette(KSharedConfig::openConfig(path)));
-            return;
-        }
-
-        path = QStandardPaths::locate(QStandardPaths::GenericDataLocation, QStringLiteral("plasma/look-and-feel/org.kde.loonandfeel/contents/colors"));
-        if (!path.isEmpty()) {
-            m_palettes[QPlatformTheme::SystemPalette] = new QPalette(KColorScheme::createApplicationPalette(KSharedConfig::openConfig(path)));
-            return;
-        }
-
-        const QString scheme = readConfigValue(QStringLiteral("General"), QStringLiteral("ColorScheme"), "Breeze").toString();
-        path = QStandardPaths::locate(QStandardPaths::GenericDataLocation, "color-schemes/" + scheme + ".colors");
-
-        if (!path.isEmpty()) {
-            m_palettes[QPlatformTheme::SystemPalette] = new QPalette(KColorScheme::createApplicationPalette(KSharedConfig::openConfig(path)));
-        }
-    }
-}
-
-void KHintsSettings::updateCursorTheme()
-{
-    KConfig config(QStringLiteral("kcminputrc"));
-    KConfigGroup g(&config, "Mouse");
-
-    QString theme = g.readEntry("cursorTheme", QString());
-    int size      = g.readEntry("cursorSize", -1);
-
-    // Default cursor size is 16 points
-    if (size == -1) {
-        if (QScreen *s = QGuiApplication::primaryScreen()) {
-            size = s->logicalDotsPerInchY() * 16 / 72;
-        } else {
-            size = 0;
-        }
-    }
-
-#if HAVE_X11
-    if (QX11Info::isPlatformX11()) {
-        // Note that in X11R7.1 and earlier, calling XcursorSetTheme()
-        // with a NULL theme would cause Xcursor to use "default", but
-        // in 7.2 and later it will cause it to revert to the theme that
-        // was configured when the application was started.
-        XcursorSetTheme(QX11Info::display(), theme.isNull() ?
-                        "default" : QFile::encodeName(theme).constData());
-        XcursorSetDefaultSize(QX11Info::display(), size);
-    }
-#endif
-}
diff --git a/src/platformtheme/main.cpp b/src/platformtheme/main.cpp
deleted file mode 100644
index 05ed28723e6493cd374916a86e0708f26cf330bf..0000000000000000000000000000000000000000
--- a/src/platformtheme/main.cpp
+++ /dev/null
@@ -1,80 +0,0 @@
-/*  This file is part of the KDE libraries
- *  Copyright 2013 Kevin Ottens <ervin+bluesystems@kde.org>
- *
- *  This library is free software; you can redistribute it and/or modify
- *  it under the terms of the GNU Lesser General Public License as published by
- *  the Free Software Foundation; either version 2 of the License or ( at
- *  your option ) version 3 or, at the discretion of KDE e.V. ( which shall
- *  act as a proxy as in section 14 of the GPLv3 ), any later version.
- *
- *  This library is distributed in the hope that it will be useful,
- *  but WITHOUT ANY WARRANTY; without even the implied warranty of
- *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
- *  Library General Public License for more details.
- *
- *  You should have received a copy of the GNU Lesser General Public License
- *  along with this library; see the file COPYING.LIB.  If not, write to
- *  the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor,
- *  Boston, MA 02110-1301, USA.
- */
-
-#include <qpa/qplatformthemeplugin.h>
-
-#include "kdeplatformtheme.h"
-
-#include <config-platformtheme.h>
-#if (QT_VERSION < QT_VERSION_CHECK(5, 3, 1))
-#if HAVE_X11
-#include <QCoreApplication>
-#include <QAbstractEventDispatcher>
-#include <QX11Info>
-#include <xcb/xcb.h>
-#endif
-#endif
-
-class KdePlatformThemePlugin : public QPlatformThemePlugin
-{
-    Q_OBJECT
-    Q_PLUGIN_METADATA(IID "org.qt-project.Qt.QPA.QPlatformThemeFactoryInterface.5.1" FILE "kdeplatformtheme.json")
-public:
-    KdePlatformThemePlugin(QObject *parent = 0)
-        : QPlatformThemePlugin(parent) {}
-
-    QPlatformTheme *create(const QString &key, const QStringList &paramList) Q_DECL_OVERRIDE
-    {
-        Q_UNUSED(key)
-        Q_UNUSED(paramList)
-#if (QT_VERSION < QT_VERSION_CHECK(5, 3, 1))
-        // Must be done after we have an event-dispatcher. By posting a method invocation
-        // we are sure that by the time the method is called we have an event-dispatcher.
-        QMetaObject::invokeMethod(this, "setupXcbFlush", Qt::QueuedConnection);
-#endif
-        return new KdePlatformTheme;
-    }
-
-public Q_SLOTS:
-    void setupXcbFlush();
-};
-
-void KdePlatformThemePlugin::setupXcbFlush()
-{
-#if (QT_VERSION < QT_VERSION_CHECK(5, 3, 1))
-#if HAVE_X11
-    // this is a workaround for BUG 334858
-    // it ensures that the xcb connection gets flushed before the EventDispatcher
-    // is going to block. Qt does not guarantee this in all cases.
-    // For Qt this issue is addressed in https://codereview.qt-project.org/85654
-    // TODO: remove again once we depend on a Qt version with the patch.
-    if (!QX11Info::isPlatformX11() || qstrcmp(qVersion(), "5.3.1") >= 0) {
-        return;
-    }
-    connect(QCoreApplication::eventDispatcher(), &QAbstractEventDispatcher::aboutToBlock,
-        []() {
-            xcb_flush(QX11Info::connection());
-        }
-    );
-#endif
-#endif
-}
-
-#include "main.moc"
diff --git a/tests/CMakeLists.txt b/tests/CMakeLists.txt
index 6bdd310322a39ad700f7ddfa0c065c0fe961b23e..c11a91c10a964a33d1607568cd1316f50e0b596b 100644
--- a/tests/CMakeLists.txt
+++ b/tests/CMakeLists.txt
@@ -1,5 +1,3 @@
 add_executable(kstyletest kstyletest.cpp)
 target_link_libraries(kstyletest Qt5::Widgets KF5::Style)
 
-add_executable(qfiledialogtest qfiledialogtest.cpp)
-target_link_libraries(qfiledialogtest Qt5::Core Qt5::Widgets)
diff --git a/tests/qfiledialogtest.cpp b/tests/qfiledialogtest.cpp
deleted file mode 100644
index 1d69ea15cb95fcc26b6e89db1f3323036b4a63e7..0000000000000000000000000000000000000000
--- a/tests/qfiledialogtest.cpp
+++ /dev/null
@@ -1,103 +0,0 @@
-/*  This file is part of the KDE libraries
- *  Copyright 2013 Aleix Pol Gonzalez <aleixpol@blue-systems.com>
- *
- *  This library is free software; you can redistribute it and/or modify
- *  it under the terms of the GNU Lesser General Public License as published by
- *  the Free Software Foundation; either version 2 of the License or ( at
- *  your option ) version 3 or, at the discretion of KDE e.V. ( which shall
- *  act as a proxy as in section 14 of the GPLv3 ), any later version.
- *
- *  This library is distributed in the hope that it will be useful,
- *  but WITHOUT ANY WARRANTY; without even the implied warranty of
- *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
- *  Library General Public License for more details.
- *
- *  You should have received a copy of the GNU Lesser General Public License
- *  along with this library; see the file COPYING.LIB.  If not, write to
- *  the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor,
- *  Boston, MA 02110-1301, USA.
- */
-
-#include <QApplication>
-#include <QFileDialog>
-#include <QCommandLineParser>
-#include <QDebug>
-
-int main(int argc, char **argv)
-{
-    QApplication app(argc, argv);
-    app.setApplicationName(QStringLiteral("QFileDialogTest"));
-    QCommandLineParser parser;
-    parser.addHelpOption();
-    parser.addOption(QCommandLineOption(QStringList(QStringLiteral("staticFunction")), QStringLiteral("Test one of the static convenience function: 'getOpenFileUrl', 'getExistingDirectory'"), QStringLiteral("function name")));
-    parser.addOption(QCommandLineOption(QStringList(QStringLiteral("acceptMode")), QStringLiteral("File dialog acceptMode: 'open' or 'save'"), QStringLiteral("type"), QStringLiteral("open")));
-    parser.addOption(QCommandLineOption(QStringList(QStringLiteral("fileMode")), QStringLiteral("File dialog fileMode: 'AnyFile' or 'ExistingFile' or 'Directory' or 'ExistingFiles'"), QStringLiteral("type")));
-    parser.addOption(QCommandLineOption(QStringList(QStringLiteral("nameFilter")), QStringLiteral("Dialog nameFilter, e. g. 'cppfiles (*.cpp *.h *.hpp)', can be specified multiple times"), QStringLiteral("nameFilter"), QStringLiteral("Everything (*)")));
-    // add option mimeTypeFilter later
-    parser.addOption(QCommandLineOption(QStringList(QStringLiteral("selectNameFilter")), QStringLiteral("Initially selected nameFilter"), QStringLiteral("selectNameFilter")));
-    parser.addOption(QCommandLineOption(QStringList(QStringLiteral("selectFile")), QStringLiteral("Initially selected file"), QStringLiteral("filename")));
-    parser.addOption(QCommandLineOption(QStringList(QStringLiteral("selectDirectory")), QStringLiteral("Initially selected directory"), QStringLiteral("dirname")));
-    parser.addOption(QCommandLineOption(QStringList(QStringLiteral("modal")), QStringLiteral("Test modal dialog"), QStringLiteral("modality"), QStringLiteral("on")));
-    parser.process(app);
-
-    const QString staticFunction = parser.value(QStringLiteral("staticFunction"));
-    if (staticFunction == QLatin1String("getExistingDirectory")) {
-        QString dir = QFileDialog::getExistingDirectory(nullptr, QStringLiteral("getExistingDirectory test"), QStringLiteral("/tmp"));
-        qDebug() << dir;
-        return 0;
-    } else if (staticFunction == QLatin1String("getOpenFileUrl")) {
-        qDebug() << QFileDialog::getOpenFileUrl(Q_NULLPTR, QStringLiteral("getOpenFileUrl test"), QUrl::fromLocalFile(QDir::homePath()));
-        return 0;
-    }
-
-    QFileDialog dialog;
-    dialog.setAcceptMode(
-        parser.value(QStringLiteral("acceptMode")) == QStringLiteral("open")
-        ? QFileDialog::AcceptOpen
-        : QFileDialog::AcceptSave);
-
-    QString fileModeValue = parser.value(QStringLiteral("fileMode"));
-    if (fileModeValue == QLatin1String("AnyFile")) {
-        dialog.setFileMode(QFileDialog::AnyFile);
-    } else if (fileModeValue == QLatin1String("ExistingFile")) {
-        dialog.setFileMode(QFileDialog::ExistingFile);
-    } else if (fileModeValue == QLatin1String("ExistingFiles")) {
-        dialog.setFileMode(QFileDialog::ExistingFiles);
-    } else if (fileModeValue == QLatin1String("Directory")) {
-        dialog.setFileMode(QFileDialog::Directory);
-    } else if (!fileModeValue.isEmpty()) {
-        qDebug() << "Not implemented or not valid:" << fileModeValue ;
-        exit(0);
-    }
-
-    QStringList nameFilterList = parser.values(QStringLiteral("nameFilter"));
-    if (nameFilterList.size() == 1) {
-        dialog.setNameFilter(nameFilterList.first());
-    }
-    else {
-        dialog.setNameFilters(nameFilterList);
-    }
-
-    QString selectNameFilter = parser.value(QStringLiteral("selectNameFilter"));
-    if (!selectNameFilter.isEmpty()) {
-        dialog.selectNameFilter(selectNameFilter);
-    }
-
-    dialog.setDirectory(parser.value(QStringLiteral("selectDirectory")));
-    dialog.selectFile(parser.value(QStringLiteral("selectFile")));
-
-    int ret;
-    if (parser.value(QStringLiteral("modal")) == QStringLiteral("off")) {
-        dialog.show();
-        ret = app.exec();
-    } else {
-        ret = dialog.exec();
-    }
-
-    if (dialog.result() == QDialog::Accepted) {
-        qDebug() << "selected files" << dialog.selectedFiles();
-        qDebug() << "selected urls" << dialog.selectedUrls();
-        qDebug() << "selected name nameFilter" << dialog.selectedNameFilter();
-    }
-    return ret;
-}
