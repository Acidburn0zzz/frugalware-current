--- /trunk/common/packets.c	2006/07/16 11:48:30	12105
+++ trunk/common/packets.c	2006/07/16 12:15:25	12106
@@ -562,6 +562,7 @@
 	  chunk->total_length, chunk->chunk_length);
 
   if (chunk->total_length < 0
+      || chunk->chunk_length < 0
       || chunk->total_length >= MAX_ATTRIBUTE_BLOCK
       || chunk->offset < 0
       || chunk->offset + chunk->chunk_length > chunk->total_length
--- /trunk/server/unithand.c	2006/07/16 11:48:30	12105
+++ trunk/server/unithand.c	2006/07/16 12:15:25	12106
@@ -1622,7 +1622,8 @@
   struct tile *src_tile = map_pos_to_tile(packet->src_x, packet->src_y);
   int i;
 
-  if (!punit || packet->length < 0 || punit->activity != ACTIVITY_IDLE) {
+  if (!punit || packet->length < 0 || punit->activity != ACTIVITY_IDLE
+      || packet->length > MAX_LEN_ROUTE) {
     return;
   }
 
