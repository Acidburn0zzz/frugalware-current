# Compiling Time: 0.37 SBU
# Contributor: detto <detto_o@freenet.de>
# Maintainer: voroskoi <voroskoi@frugalware.org>

pkgname=warsow
pkgver=0.21
pkgrel=1
pkgdesc="Free online multiplayer competitive FPS based on the Qfusion engine."
url="http://www.warsow.net/"
_F_desktop_name="Warsow"
_F_desktop_icon="warsow.ico"
_F_desktop_categories="Game"
archs=('i686' 'x86_64')
groups=('games-extra')
makedepends=('unzip')
depends=('sdl' 'openal' 'curl>=7.16' 'mesa' 'libxxf86dga' 'libjpeg' 'libvorbis')
up2date=("lynx -dump $url |grep Latest |sed -e 's/.*ow \(.*\)/\1/'")
source=(http://ftp.club-internet.fr/pub/games/nofrag/${pkgname}/${pkgname}_${pkgver}_linux.tar.gz \
        http://ftp.club-internet.fr/pub/games/nofrag/${pkgname}/${pkgname}_${pkgver}_sdk_fixed.zip \
        warsow.sh warsow_server.sh)

build() {
	# copy the whole prebuilt warsow to pkg, remove prebuilt binaries and libs...
	Fmkdir usr/share
	Fcpr warsow usr/share/
	Frm usr/share/warsow/libs/
	Frm usr/share/warsow/{warsow.i386,warsow.x86_64,warsow.freebsd_i386}
	Frm usr/share/warsow/{wsw_server.i386,wsw_server.x86_64,wsw_server.freebsd_i386}

	# and adjust correct permissions
	Fdirschmod usr/ 755
	Ffileschmod usr/ 644
	Ffileschmod usr/share/warsow/warsow 755
	Ffileschmod usr/share/warsow/wsw_server 755

	# going to compile source...
	Fcd source/
	Fmake

	# and copy built binaries to pkg...
	if [ "$CARCH" == "i686" ] ; then
	    Fexerel release/warsow.i386 usr/share/warsow/
	    Fexerel release/wsw_server.i386 usr/share/warsow/
	fi
	if [ "$CARCH" == "x86_64" ] ; then
	    Fexerel release/warsow.x86_64 usr/share/warsow/
	    Fexerel release/wsw_server.x86_64 usr/share/warsow/
	fi

	# and built libs to pkg
	if [ "$CARCH" == "i686" ]; then
	    Fexerel release/libs/{irc_i386.so,snd_openal_i386.so,snd_qf_i386.so} usr/share/warsow/libs/
	    Fexerel release/basewsw/{cgame_i386.so,game_i386.so,ui_i386.so} usr/share/warsow/basewsw/
	fi
	if [ "$CARCH" == "x86_64" ] ; then
	    Fexerel release/libs/{irc_x86_64.so,snd_openal_x86_64.so,snd_qf_x86_64.so} usr/share/warsow/libs/
	    Fexerel release/basewsw/{cgame_x86_64.so,game_x86_64.so,ui_x86_64.so} usr/share/warsow/basewsw/
	fi

	# install the game and server launchers...
	Fexe warsow.sh /usr/bin/warsow
	Fexe warsow_server.sh usr/bin/warsow-server

	# and don't forget the shortcut and icon
	Ffile source/win32/warsow.ico /usr/share/pixmaps/warsow.ico
	Fdesktop2
}
sha1sums=('9faf775721ee88c3db98aa186aa8e805ff4edb7b'\
          'dfe03dbc71150db5530b5ef4181c95c25e921058'\
          'c4b18b46e02c7e120c18427e7ace272d51680da4'\
          'ef06eae2aded9d4f6afc2ebe85d9bf0106e1d843')
