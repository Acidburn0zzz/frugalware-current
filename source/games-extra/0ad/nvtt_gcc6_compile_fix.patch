From ebb66f1cc787de131190f3e0da1c348b87c08f06 Mon Sep 17 00:00:00 2001
From: sanderd17 <sanderd17@3db68df2-c116-0410-a063-a993310a9797>
Date: Sat, 11 Jun 2016 16:33:18 +0000
Subject: [PATCH] Fix NVTT for building with GCC 6. Fixes #3967

git-svn-id: http://svn.wildfiregames.com/public/ps/trunk@18364 3db68df2-c116-0410-a063-a993310a9797
---
 libraries/source/nvtt/README.txt                  |  1 +
 libraries/source/nvtt/patches/gcc6-fix.patch      | 31 +++++++++++++++++++++++
 libraries/source/nvtt/src/src/nvimage/ImageIO.cpp |  6 ++---
 3 files changed, 35 insertions(+), 3 deletions(-)
 create mode 100644 libraries/source/nvtt/patches/gcc6-fix.patch

diff --git a/libraries/source/nvtt/README.txt b/libraries/source/nvtt/README.txt
index a76e446..74b3afa 100644
--- a/libraries/source/nvtt/README.txt
+++ b/libraries/source/nvtt/README.txt
@@ -18,3 +18,4 @@ plus some patches (see patches/):
   issue188.patch (fixes http://code.google.com/p/nvidia-texture-tools/issues/detail?id=188)
   clang-cpp11-error.patch (fixes build error on OS X Yosemite with clang, libc++ and c++11)
   arm64-fix.patch (backported in http://trac.wildfiregames.com/ticket/3344 from upstream https://github.com/castano/nvidia-texture-tools/commit/58617584d4d2541ff9fcfe23a9a492af86b11efb - fixes ARM64 build)
+  gcc6-fix.path (fixes a compilation issue where GCC 6 doesn't want to cast a boolean to a pointer anymore)
diff --git a/libraries/source/nvtt/patches/gcc6-fix.patch b/libraries/source/nvtt/patches/gcc6-fix.patch
new file mode 100644
index 0000000..90654cd
--- /dev/null
+++ b/libraries/source/nvtt/patches/gcc6-fix.patch
@@ -0,0 +1,31 @@
+Index: libraries/source/nvtt/src/src/nvimage/ImageIO.cpp
+===================================================================
+--- libraries/source/nvtt/src/src/nvimage/ImageIO.cpp	(revision 18164)
++++ libraries/source/nvtt/src/src/nvimage/ImageIO.cpp	(working copy)
+@@ -621,7 +621,7 @@
+ 	png_ptr = png_create_read_struct(PNG_LIBPNG_VER_STRING, NULL, NULL, NULL);
+ 	if (png_ptr == NULL) {
+ 	//	nvDebug( "*** LoadPNG: Error allocating read buffer in file '%s'.\n", name );
+-		return false;
++		return NULL;
+ 	}
+ 
+ 	// Allocate/initialize a memory block for the image information
+@@ -629,7 +629,7 @@
+ 	if (info_ptr == NULL) {
+ 		png_destroy_read_struct(&png_ptr, NULL, NULL);
+ 	//	nvDebug( "*** LoadPNG: Error allocating image information for '%s'.\n", name );
+-		return false;
++		return NULL;
+ 	}
+ 
+ 	// Set up the error handling
+@@ -636,7 +636,7 @@
+ 	if (setjmp(png_jmpbuf(png_ptr))) {
+ 		png_destroy_read_struct(&png_ptr, &info_ptr, NULL);
+ 	//	nvDebug( "*** LoadPNG: Error reading png file '%s'.\n", name );
+-		return false;
++		return NULL;
+ 	}
+ 
+ 	// Set up the I/O functions.
diff --git a/libraries/source/nvtt/src/src/nvimage/ImageIO.cpp b/libraries/source/nvtt/src/src/nvimage/ImageIO.cpp
index dc218de..e7a14f1 100644
--- a/libraries/source/nvtt/src/src/nvimage/ImageIO.cpp
+++ b/libraries/source/nvtt/src/src/nvimage/ImageIO.cpp
@@ -621,7 +621,7 @@ Image * nv::ImageIO::loadPNG(Stream & s)
 	png_ptr = png_create_read_struct(PNG_LIBPNG_VER_STRING, NULL, NULL, NULL);
 	if (png_ptr == NULL) {
 	//	nvDebug( "*** LoadPNG: Error allocating read buffer in file '%s'.\n", name );
-		return false;
+		return NULL;
 	}
 
 	// Allocate/initialize a memory block for the image information
@@ -629,14 +629,14 @@ Image * nv::ImageIO::loadPNG(Stream & s)
 	if (info_ptr == NULL) {
 		png_destroy_read_struct(&png_ptr, NULL, NULL);
 	//	nvDebug( "*** LoadPNG: Error allocating image information for '%s'.\n", name );
-		return false;
+		return NULL;
 	}
 
 	// Set up the error handling
 	if (setjmp(png_jmpbuf(png_ptr))) {
 		png_destroy_read_struct(&png_ptr, &info_ptr, NULL);
 	//	nvDebug( "*** LoadPNG: Error reading png file '%s'.\n", name );
-		return false;
+		return NULL;
 	}
 
 	// Set up the I/O functions.
