# Compiling Time: 0.6 SBU
# Maintainer: AlexExtreme <alex@alex-smith.me.uk>

pkgname=eternal-lands
pkgver=1.3.2
extraver="_1"
tmpver=`echo $pkgver | tr -d . | sed 's/_.*//'`
pkgrel=3
pkgdesc="Eternal Lands is an addictive 3D online multiplayer RPG"
depends=('libx11' 'libxdmcp' 'libgl' 'libogg' 'libvorbis' 'libstdc++' 'libpng' 'cal3d' 'openal' 'sdl_net' 'zlib' 'libxml2' 'mesa' 'freealut')
url="http://www.eternal-lands.com"
groups=('games-extra')
archs=('i686' 'x86_64')
up2date="lynx -dump http://www.eternal-lands.com/page/update.php | grep -i -m1 'for linux' | sed 's/.*UPDATE //' | sed 's/ FOR .*//'"
_F_gnome_desktop="y"
Finclude gnome-scriptlet
_F_cd_path="elc-$pkgver$extraver"
source=(http://ftp.frugalware.org/pub/other/sources/${pkgname}/elc-${pkgver}${extraver}.tar.bz2 make.conf fw-el.ini \
	http://www.other-life.com/el/el_${tmpver}_linux_full.zip \
	http://www.eternalmusik.org/music/music_full.zip \
	$pkgname.desktop $pkgname.png)
sha1sums=('4d66a0c6069f648d62c6479344194676930953ed' \
	  '6088f4b7d6d98ecbdccb347eb6d7c519d22aa8da' \
	  '24e77564597194af4e7a9738d4a18f9fc97c6a58' \
	  '3f6c1579dad31b9dfbf2c4230cc5b2e73bdd1595' \
	  'fd470d14d50873704de2ae13876b411a58eb39de' \
	  'cb1fc0711a3886e0e676323076278ba0b31607cd' \
	  '34ee1c154178090f45ca171509f8ba00d26d6a21')

subpkgs=('eternal-lands-music')
subdescs=('Music for Eternal Lands')
subdepends=("$pkgname=$pkgver")
subgroups=('games-extra')
subarchs=('i686 x86_64')

build() {
	Fcd
	
	# Get the build configuration
	cp -f $Fsrcdir/make.conf . || Fdie
	if [ "$CARCH" == "x86_64" ]; then
		sed -i 's/i686/k8/' make.conf || Fdie
	fi
	
	# And our configuration
	cp -f $Fsrcdir/fw-el.ini el.ini || Fdie
	
	# Build
	make -f Makefile.linux || Fdie
	Fexerel el.x86.linux.bin /usr/bin/eternal-lands
	Fmkdir /usr/share/eternal-lands
	
	# License needs to be installed
	Fdoc license.txt
	
	# Prepare some stuff
	cd $Fsrcdir || Fdie
	mv *.ogg *.pll music || Fdie
	rm mapinfo.lst license.txt || Fdie
	
	# Install the data files
	for dir in 2dobjects 3dobjects animations maps meshes music particles skeletons sound textures tiles *.lst *.xml 3dobjects.txt languages actor_defs *.ini *.txt; do
		Fcpr $dir /usr/share/eternal-lands
	done
	
	# Install our configuration file
	Ffilerel fw-el.ini /usr/share/eternal-lands/el.ini
	
	# Kill that disgustingly horrible font
	Frm /usr/share/eternal-lands/textures/font2.bmp
	
	# And finally a desktop file
	Ffile $pkgname.desktop /usr/share/applications/$pkgname.desktop
	Ffilerel $pkgname.png /usr/share/pixmaps/$pkgname.png
	
	# Split the music out
	Fsplit eternal-lands-music usr/share/eternal-lands/music
	
	# Install scriptlet
	Fbuild_gnome_scriptlet
}

# optimization OK
