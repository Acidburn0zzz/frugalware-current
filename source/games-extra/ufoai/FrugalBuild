# Compiling Time: 0.89 SBU
# Maintainer: Christian Hamar alias krix <krics@linuxforum.hu>

pkgname=ufoai
pkgver=2.1
pkgrel=1
pkgdesc="UFO: ALIEN INVASION is a squad-based tactical strategy game in the tradition of the old X-COM PC games, but with a twist."
url="http://ufoai.sourceforge.net"
depends=('libgl' 'libglx' 'sdl' 'sdl_ttf' 'libpng' 'libjpeg' 'libvorbis' 'libogg' 'openal' 'freealut' 'libxxf86dga' 'xf86dga' 'xf86vidmodeproto')
groups=('games-extra')
archs=('i686' 'x86_64')
_F_sourceforge_ext="-source.tar.bz2"
Finclude sourceforge
source=(${source[@]} \
    ${source//source.tar.bz2/data.tar}
#    http://heanet.dl.sourceforge.net/sourceforge/ufoai/music.tar.bz2 \
    ufo \
    ufoai.png \
    xf.diff)

build() {
	Fcd $pkgname-$pkgver-source
	# Patch to link -lXxf86vm to ref_glx.so renderer to work right.
	Fpatch xf.diff

	# Move all base data (i18n, mapsource, etc) to right place
	# First remove any moved 
	rm -rf /var/tmp/fst/src/ufoai-$pkgver-source/base/* || Fdie
	mv $Fsrcdir/base $Fsrcdir/$pkgname-$pkgver-source/ || Fdie
	Fconf --enable-release --with-ipv6

	make || Fdie
	make lang || Fdie

	Fmkdir usr/share/games/ufoai/
	cp -a $Fsrcdir/$pkgname-$pkgver-source/ufo* $Fdestdir/usr/share/games/ufoai/ || Fdie
	cp -a $Fsrcdir/$pkgname-$pkgver-source/ref_* $Fdestdir/usr/share/games/ufoai/ || Fdie
	cp -a $Fsrcdir/$pkgname-$pkgver-source/snd_* $Fdestdir/usr/share/games/ufoai/ || Fdie
	cp -a $Fsrcdir/$pkgname-$pkgver-source/qdata $Fdestdir/usr/share/games/ufoai/ || Fdie

	# Copy pk3 data files and game.so to base/
	Fmkdir usr/share/games/ufoai/base/
	cp -a $Fsrcdir/$pkgname-$pkgver-source/base/*.pk3 $Fdestdir/usr/share/games/ufoai/base/ || Fdie
	cp -a $Fsrcdir/$pkgname-$pkgver-source/base/*.so $Fdestdir/usr/share/games/ufoai/base/ || Fdie

	# Copy i18n locales
	Fmkdir usr/share/locales
	cp -a $Fsrcdir/$pkgname-$pkgver-source/base/i18n/ $Fdestdir/usr/share/locales || Fdie

	# Put our wrapper to /usr/bin
	Fmkdir /usr/bin
	cp -a $Fsrcdir/ufo $Fdestdir/usr/bin || Fdie
	chmod +x $Fdestdir/usr/bin/ufo || Fdie

	# Create menu
	Fmkdir /usr/share/pixmaps
	cp -a $Fsrcdir/ufoai.png $Fdestdir/usr/share/pixmaps/ufoai.png || Fdie
	Fdesktop "/usr/bin/ufo" "/usr/share/pixmaps/ufoai.png" "Game;StrategyGame;"
}

sha1sums=('8eb87f3ce4152a7788f6d008348d055049ed7946'\
          '9f9f8515bf97d0488ca9d6143d2a56640d3d85d0'\
          '7c1d91d26a33d91ee43da2e56a93f6a2b7469e21'\
          '10701a135efa2e368c085462386d5de2506efe62'\
          '93d5ecd1c952cc6523f6ca1c81b46dce0004aaaf')
# optimization OK
