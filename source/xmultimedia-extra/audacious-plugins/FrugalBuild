# Compiling Time: 0.37 SBU
# Maintainer: James Buren <ryuo@frugalware.org>

pkgname=audacious-plugins
pkgver=2.3
pkgrel=3
pkgdesc="Plugins for audacious."
url="http://audacious-media-player.org"
depends=('audacious>=2.3-4' 'flac>=1.1.4' 'libvorbis' 'unzip' 'lame' 'libmad' \
         'libxcomposite' 'alsa-lib' 'faad2' 'libsamplerate')
makedepends=('krb5' 'libcap>=2.19')
# Blue tooth disabled because of compile errors.
conflicts=('audacious-plugin-arts' 'audacious-plugin-musepack' \
           'audacious-plugin-bluetooth' 'audacious-plugin-lastfm' \
           'audacious-plugin-scrobbler')
replaces=('audacious-plugin-arts' 'audacious-plugin-musepack' \
          'audacious-plugin-bluetooth' 'audacious-plugin-lastfm' \
          'audacious-plugin-scrobbler')
groups=('xmultimedia-extra')
archs=('i686' 'x86_64')
options=('scriptlet')
up2date="lynx -dump '$url/downloads' | grep -o '$pkgname-\(.*\).tgz' | tail -n1 | sed 's|$pkgname-\(.*\).tgz|\1|'"
source=(http://distfiles.atheme.org/$pkgname-$pkgver.tgz)

subpkgs=("audacious-plugin-esd" "audacious-plugin-jack" \
	 "audacious-plugin-neon" "audacious-plugin-wavpack" \
	 "audacious-plugin-sidplay" "audacious-plugin-mtp" \
	 "audacious-plugin-mms" \
	 "audacious-plugin-pulseaudio" "audacious-plugin-icecast" \
	 "audacious-plugin-paranormal" \
	 "audacious-plugin-adplug"  \
	 "audacious-plugin-cd" \
	 "audacious-plugin-sndfile" "audacious-plugin-cue" \
	 "audacious-plugin-bs2b" "audacious-plugin-projectm" \
	 "audacious-plugin-ffaudio" "audacious-plugin-fluidsynth")
subdescs=('Audacious esd output plugin' 'Audacious jack output plugin' \
	'Audacious neon transport plugin' 'Audacious wavpack input plugin' \
	'Audacious sid input plugin' 'Audacious mtp general plugin' \
	'Audacious mms transport plugin' \
	'Audacious pulseaudio output plugin' 'Audacious icecast output plugin' \
	'Audacious paranormal visualization plugin' \
	'Audacious adplug input plugin' \
	'Audacious cd input plugin' \
	'Audacious sndfile input plugin' 'Audacious cue container plugin' \
	'Audacious bs2b effect plugin' 'Audacious projectm visualization plugin' \
	'Audacious ffaudio input plugin' 'Audacious fluidsynth input plugin')
subdepends=("esd" "libsamplerate jack" "neon>=0.28.3" "wavpack>=4.40.0" \
	    "libsidplay libsidplay2" "libmtp" "libmms" "pulseaudio libcap>=2.19" \
	    "libshout" "sdl" "adplug>=2.1" \
	    "libcdio>=0.80-2" "libsndfile" "libcue" "libbs2b" \
	    "libprojectm gtkglext" "ffmpeg libraw1394" "fluidsynth")
subrodepends=("$pkgname=$pkgver" "$pkgname=$pkgver" "$pkgname=$pkgver" \
	      "$pkgname=$pkgver" "$pkgname=$pkgver" "$pkgname=$pkgver" \
	      "$pkgname=$pkgver" "$pkgname=$pkgver" "$pkgname=$pkgver" \
	      "$pkgname=$pkgver" "$pkgname=$pkgver" "$pkgname=$pkgver" \
	      "$pkgname=$pkgver" "$pkgname=$pkgver" "$pkgname=$pkgver" \
	      "$pkgname=$pkgver" "$pkgname=$pkgver" "$pkgname=$pkgver")
subgroups=('xmultimedia-extra' 'xmultimedia-extra' 'xmultimedia-extra' \
	   'xmultimedia-extra' 'xmultimedia-extra' 'xmultimedia-extra' \
	   'xmultimedia-extra' 'xmultimedia-extra' 'xmultimedia-extra' \
	   'xmultimedia-extra' 'xmultimedia-extra' 'xmultimedia-extra' \
	   'xmultimedia-extra' 'xmultimedia-extra' 'xmultimedia-extra' \
	   'xmultimedia-extra' 'xmultimedia-extra' 'xmultimedia-extra')
subarchs=('i686 x86_64' 'i686 x86_64' 'i686 x86_64' \
           'i686 x86_64' 'i686 x86_64' 'i686 x86_64' \
	   'i686 x86_64' 'i686 x86_64' 'i686 x86_64' \
	   'i686 x86_64' 'i686 x86_64' 'i686 x86_64' \
	   'i686 x86_64' 'i686 x86_64' 'i686 x86_64' \
	   'i686 x86_64' 'i686 x86_64' 'i686 x86_64')


subpkgs=("${subpkgs[@]}" 'audacious-plugin-lirc')
subdescs=("${subdescs[@]}" 'Audacious lirc plugin')
subdepends=("${subdepends[@]}" "lirc")
subrodepends=("${subrodepends[@]}" "$pkgname=$pkgver")
subgroups=("${subgroups[@]}" 'xmultimedia-extra')
subarchs=("${subarchs[@]}" 'i686 x86_64')


build()
{
	if [ "$CARCH" == "i686" ]; then
		opts="--disable-sse2"
	fi
	Fmake \
		--prefix=/usr \
		--enable-chardet \
		--enable-ipv6 \
		--enable-amidiplug \
		--disable-dependency-tracking \
    --enable-usf \
		$opts
	## Fbuild/Fmakeinstall does not work
	make DESTDIR=$Fdestdir install || Fdie
	Fsplit audacious-plugin-esd usr/lib/audacious/Output/ESD.so
	Fsplit audacious-plugin-jack usr/lib/audacious/Output/jackout.so
	if [ "$CARCH" != "ppc" ]; then
		Fsplit audacious-plugin-lirc usr/lib/audacious/General/lirc.so
	fi
	Fsplit audacious-plugin-neon usr/lib/audacious/Transport/neon.so
	Fsplit audacious-plugin-wavpack usr/lib/audacious/Input/wavpack.so
	Fsplit audacious-plugin-sidplay usr/lib/audacious/Input/sid.so
	Fsplit audacious-plugin-mtp usr/lib/audacious/General/mtp_up.so
	Fsplit audacious-plugin-mms usr/lib/audacious/Transport/mms.so
	Fsplit audacious-plugin-pulseaudio usr/lib/audacious/Output/pulse_audio.so
	Fsplit audacious-plugin-icecast usr/lib/audacious/Output/icecast.so
	Fsplit audacious-plugin-paranormal usr/lib/audacious/Visualization/paranormal.so
	Fsplit audacious-plugin-adplug usr/lib/audacious/Input/adplug.so
	Fsplit audacious-plugin-cd usr/lib/audacious/Input/cdaudio-ng.so
	Fsplit audacious-plugin-sndfile usr/lib/audacious/Input/sndfile.so
	Fsplit audacious-plugin-cue usr/lib/audacious/Container/cue.so
	Fsplit audacious-plugin-bs2b usr/lib/audacious/Effect/bs2b.so
	Fsplit audacious-plugin-projectm usr/lib/audacious/Visualization/projectm-1.0.so
	Fsplit audacious-plugin-ffaudio usr/lib/audacious/Input/ffaudio.so
	Fsplit audacious-plugin-fluidsynth usr/lib/audacious/Input/amidi-plug/ap-fluidsynth.so
}

# optimization OK
sha1sums=('1e18e2f3a070a23e58b8f91f2923ef7d9bbaf153')
