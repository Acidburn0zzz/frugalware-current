# Compiling Time: 0.37 SBU
# Maintainer: crazy <crazy@frugalware.org>

pkgname=audacious-plugins
pkgver=2.1
pkgrel=1
pkgdesc="Plugins for audacious."
url="http://audacious-media-player.org"
depends=('dbus-glib' 'audacious>=2.1' 'flac>=1.1.4' 'libvorbis' 'unzip' \
	'glib2>=2.14.2' 'lame' 'libmad' 'libxcomposite' 'alsa-lib')
makedepends=('jack' 'esd' 'libsamplerate' 'neon>=0.28.3' 'wavpack>=4.40.0' \
	'libsidplay' 'libsidplay2' 'libmtp' 'libmpcdec' 'libmms' 'taglib' \
	'pulseaudio' 'libshout' 'bluez-libs' 'sdl' 'adplug>=2.1' 'curl>=7.19.0'
	'libsndfile' 'libcdio>=0.80-2')
conflicts=('audacious-plugin-projectm' 'audacious-plugin-arts')
replaces=('audacious-plugin-projectm' 'audacious-plugin-arts')
groups=('xmultimedia-extra')
archs=('i686' 'x86_64' 'ppc')
options=('scriptlet')
up2date="lynx -dump '$url/downloads' | grep -o '$pkgname-\(.*\).tgz' | tail -n1 | sed 's|$pkgname-\(.*\).tgz|\1|'"
source=(http://distfiles.atheme.org/$pkgname-$pkgver.tgz)

subpkgs=("audacious-plugin-esd" "audacious-plugin-jack" \
	 "audacious-plugin-neon" "audacious-plugin-wavpack" \
	 "audacious-plugin-sidplay" "audacious-plugin-mtp" \
	 "audacious-plugin-musepack" "audacious-plugin-mms" \
	 "audacious-plugin-pulseaudio" "audacious-plugin-icecast" \
	 "audacious-plugin-bluetooth" "audacious-plugin-paranormal" \
	 "audacious-plugin-adplug" "audacious-plugin-lastfm" \
	 "audacious-plugin-scrobbler" "audacious-plugin-cd" \
	 "audacious-plugin-sndfile")
subdescs=('Audacious esd output plugin' 'Audacious jack output plugin' \
	'Audacious neon transport plugin' 'Audacious wavpack input plugin' \
	'Audacious sid input plugin' 'Audacious mtp plugin' \
	'Audacious musepack input plugin' 'Audacious mms transport plugin' \
	'Audacious pulseaudio output plugin' 'Audacious icecast output plugin' \
	'Audacious bluetooth plugin' \
	'Audacious paranormal visualization plugin' \
	'Audacious adplug input plugin' 'Audacious lastfm transport plugin' \
	'Audacious scrobbler plugin' 'Audacious cd input plugin' \
	'Audacious sndfile input plugin')
subdepends=(\
	"$pkgname=$pkgver esd" "$pkgname=$pkgver libsamplerate jack" \
         "$pkgname=$pkgver neon>=0.28.3" \
	 "$pkgname=$pkgver wavpack>=4.40.0" \
	 "$pkgname=$pkgver libsidplay libsidplay2" \
	 "$pkgname=$pkgver libmtp" "$pkgname=$pkgver libmpcdec taglib" \
	 "$pkgname=$pkgver libmms" "$pkgname=$pkgver pulseaudio libcap" \
	 "$pkgname=$pkgver libshout" "$pkgname=$pkgver bluez-libs"\
	 "$pkgname=$pkgver sdl" "$pkgname=$pkgver adplug>=2.1" \
	 "$pkgname=$pkgver curl>=7.19.0" "$pkgname=$pkgver curl>=7.19.0" \
	 "$pkgname=$pkgver libcdio>=0.80-2" "$pkgname=$pkgver libsndfile")
subgroups=('xmultimedia-extra' 'xmultimedia-extra' 'xmultimedia-extra' \
	   'xmultimedia-extra' 'xmultimedia-extra' 'xmultimedia-extra' \
	   'xmultimedia-extra' 'xmultimedia-extra' 'xmultimedia-extra' \
	   'xmultimedia-extra' 'xmultimedia-extra' 'xmultimedia-extra' \
	   'xmultimedia-extra' 'xmultimedia-extra' 'xmultimedia-extra' \
	   'xmultimedia-extra' 'xmultimedia-extra')
subarchs=('i686 x86_64 ppc' 'i686 x86_64 ppc' 'i686 x86_64 ppc' \
           'i686 x86_64 ppc' 'i686 x86_64 ppc' 'i686 x86_64 ppc' \
	   'i686 x86_64 ppc' 'i686 x86_64 ppc' 'i686 x86_64 ppc' \
	   'i686 x86_64 ppc' 'i686 x86_64 ppc' 'i686 x86_64 ppc' \
	   'i686 x86_64 ppc' 'i686 x86_64 ppc' 'i686 x86_64 ppc' \
	   'i686 x86_64 ppc' 'i686 x86_64 ppc')

if [ "$CARCH" != "ppc" ]; then
	makedepends=("${makedepends[@]}" 'lirc')
	subpkgs=("${subpkgs[@]}" 'audacious-plugin-lirc')
	subdescs=("${subdescs[@]}" 'Audacious lirc plugin')
	subdepends=("${subdepends[@]}" "$pkgname=$pkgver lirc")
	subgroups=("${subgroups[@]}" 'xmultimedia-extra')
	subarchs=("${subarchs[@]}" 'i686 x86_64')
fi

build()
{
	if [ "$CARCH" == "i686" ]; then
		opts="--disable-sse2"
	fi
	Fcd
	Fpatchall
	Fmake \
		--prefix=/usr \
		--enable-chardet \
		--enable-ipv6 \
		--disable-dependency-tracking \
		--disable-amidiplug-flsyn \
		$opts
	## Fbuild/Fmakeinstall does not work
	make DESTDIR=$Fdestdir install || Fdie
	Fsplit audacious-plugin-esd usr/lib/audacious/Output/ESD.so
	Fsplit audacious-plugin-jack usr/lib/audacious/Output/jackout.so
	if [ "$CARCH" != "ppc" ]; then
		Fsplit audacious-plugin-lirc usr/lib/audacious/General/lirc.so
	fi
	Fsplit audacious-plugin-neon usr/lib/audacious/Transport/neon.so
	Fsplit audacious-plugin-wavpack usr/lib/audacious/Input/wavpack.so
	Fsplit audacious-plugin-sidplay usr/lib/audacious/Input/sid.so
	Fsplit audacious-plugin-mtp usr/lib/audacious/General/mtp_up.so
	Fsplit audacious-plugin-musepack usr/lib/audacious/Input/musepack.so
	Fsplit audacious-plugin-mms usr/lib/audacious/Transport/mms.so
	Fsplit audacious-plugin-pulseaudio usr/lib/audacious/Output/pulse_audio.so
	Fsplit audacious-plugin-icecast usr/lib/audacious/Output/icecast.so
	Fsplit audacious-plugin-bluetooth usr/lib/audacious/General/bluetooth.so
	Fsplit audacious-plugin-paranormal usr/lib/audacious/Visualization/paranormal.so
	Fsplit audacious-plugin-adplug usr/lib/audacious/Input/adplug.so
	Fsplit audacious-plugin-lastfm usr/lib/audacious/Transport/lastfm.so
	Fsplit audacious-plugin-scrobbler usr/lib/audacious/General/scrobbler.so
	Fsplit audacious-plugin-cd usr/lib/audacious/Input/cdaudio-ng.so
	Fsplit audacious-plugin-sndfile usr/lib/audacious/Input/sndfile.so
}

# optimization OK
sha1sums=('735c773688e65ee57ce72005a72a53bb7cacc78b')
