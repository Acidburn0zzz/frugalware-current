# Compiling Time: 2.64 SBU
# Maintainer: crazy <crazy@frugalware.org>

pkgname=bmpx
pkgver=0.34.3
basever=0.34
pkgrel=1
pkgdesc="A media player that features support for specifications like XDS DnD, XSPF and DBus."
url="http://bmpx.beep-media-player.org"
depends=('libsidplay' 'gamin' 'alsa-lib' 'dbus-glib' 'libglademm>=2.6.3-2' 'hal>=0.5.7.1-3' \
        'faad2' 'db>=4.5.20' 'neon>=0.26.2' 'libmusicbrainz' 'taglib' 'freetype2' 'librsvg' 'startup-notification' \
        'gst-plugins-base>=0.10.10-4' 'gst-plugins-base-alsa>=0.10.10-4' 'gst-plugins-base-oil>=0.10.10-4' \
	'gst-plugins-base-cdparanoia>=0.10.10-4' 'boost' 'libofa>=0.9.3-2' 'fftw')
makedepends=('flex' 'bison' 'cvs' 'gzip' 'zip' 'firefox')
rodepends=('gst-ffmpeg>=0.10.1-4' 'gst-plugins-good-flac>=0.10.4-5' 'gst-plugins-ugly-mad>=0.10.4-2' \
	  'gst-plugins-bad-faad2>=0.10.3-5' 'gst-plugins-bad-musepack>=0.10.3-5' 'gst-plugins-bad>=0.10.3-5' \
	  'gst-plugins-good>=0.10.4-5' 'gst-plugins-ugly>=0.10.4-2' 'gst-plugins-bad-mms>=0.10.3-5' \
          'gst-plugins-good-speex>=0.10.4-5' 'gst-plugins-ugly-sidplay>=0.10.4-2' 'gst-plugins-base-theora>=0.10.10-4')
options=('scriptlet')
Finclude python
groups=('xmultimedia-extra')
archs=('i686')
up2date="lynx -dump 'http://bmpx.beep-media-player.org/site/Downloads#BMP_Source_Download'|grep -m1 '.tar.bz2'|sed 's/.*-\(.*\).t.*/\1/'"
source=(http://files.beep-media-player.org/releases/$basever/$pkgname-$pkgver.tar.bz2 \
	not_for_upstream_boost_mt.patch  \
        not_for_upstream_python.patch \
	not_for_upstream_build_user.patch)
sha1sums=('da6f5a9633c18cedd284ebbec5b022a0a6bdb9b8' \
          '5fb0ec44d36962375416097e44e0d99c1b74e49c' \
          'f8e940891a6d6ef03b697b22ce771df950d39ba6' \
          '661fdcf6c3746c1081a22348d1a36cd7728c7ad9')


subpkgs=("$pkgname-python" "$pkgname-lastfm-firefox-plugin")
subdescs=("Python bindings for $pkgname" "Firefox LastFM plugin for $pkgname")
subdepends=("$pkgname=$pkgver python" "$pkgname=$pkgver firefox")
subgroups=('xapps-extra' 'xapps-extra')
subarchs=('i686' 'i686')

build()
{
        Fcd
	## -.-
	#export CFLAGS=""
	#export CXXFLAGS=""
	#export LDFLAGS=""
        Fpatchall
        Fautoreconf
	Fmake \
		--enable-hal \
		--enable-mp4v2 \
                --enable-sid \
                --enable-python \
		--enable-ofa \
		--enable-sn \
		--disable-moodriver
        Fmakeinstall
	## broken symlink
        Frm /usr/bin/bmp2
        Fln /usr/bin/beep-media-player-2 /usr/bin/bmp2
        ## ff plugin
	Fmkdir /usr/lib/firefox/extensions/{bc3572da-daf9-435d-a8a6-33cc20fe4533}
        cp  xpi/{*.xpi,*.manifest} $Fdestdir/usr/lib/firefox/extensions/{bc3572da-daf9-435d-a8a6-33cc20fe4533}/
        cd $Fdestdir/usr/lib/firefox/extensions/{bc3572da-daf9-435d-a8a6-33cc20fe4533}
        unzip -qqo bmp.xpi || Fdie
	rm -f bmp.xpi || Fdie
	Fsplit $pkgname-python usr/lib/python$_F_python_ver
        Fsplit $pkgname-lastfm-firefox-plugin usr/lib/firefox
}

# optimization OK
