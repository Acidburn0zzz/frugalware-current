# Compiling Time: 3.89 SBU
# Maintainer: VMiklos <vmiklos@frugalware.org>

pkgname=vlc
pkgver=0.8.6
pkgextraver=b
pkgrel=5
pkgdesc="The cross-platform media player and streaming server."
url="http://www.videolan.org/vlc/"
depends=('alsa-lib' 'dbus-glib>=0.71' 'hal>=0.5.7.1-3' 'libxml2' 'libdvdnav' 'libmad' 'libmatroska' \
	 'mpeg2dec' 'ffmpeg>=20070422' 'fribidi' 'wxgtk-u8' 'live' 'speex' 'libdca' \
	 'sysfsutils' 'mesa' 'libdvbpsi' 'libxv' 'sdlimage' 'libcdio' \
	 'libid3tag' 'libtheora' 'faad2' 'xvidcore')
## WARNING: do NOT add any VCD option to build its kill off the GUI
makedepends=('firefox' 'samba' 'cvs')
options=('scriptlet')
groups=('xmultimedia-extra')
archs=('i686' 'x86_64')
up2date="lynx -dump $url/download-sources.html|grep -m1 'Latest VLC'|sed 's/.*(\(.*\)).*/\1/;s/$pkgextraver//'"
source=(http://download.videolan.org/pub/videolan/vlc/$pkgver$pkgextraver/$pkgname-$pkgver$pkgextraver.tar.bz2 \
	$pkgname-ffmpeg.diff $pkgname.desktop vlc-0.8.5-libintl.diff vlc-0.8.6-flac113.diff libdca.patch)
build()
{
	Fpatchall
	Fsed 'mozilla-config' 'firefox-config' configure.ac
	Fsed 'firefox-config\.h' 'mozilla-config\.h' configure.ac
	Fsed '/usr/lib/mozilla' '/usr/lib/firefox' configure.ac
	Fsed '/usr/share/fonts/truetype/freefont/FreeSerifBold.ttf' \
		'/usr/X11R6/lib/X11/fonts/TTF/VeraBd.ttf' \
		modules/misc/freetype.c
	for i in aclocal automake
	do
		Fsed "=$i" "=$i-" ./bootstrap
	done
	./bootstrap || return 1
	Fconf \
		--enable-dvdread \
		--enable-dvdnav \
		--enable-madi \
		--enable-ffmpeg \
		--disable-rpath \
		--disable-nls \
		--enable-alsa \
		--disable-skins2 \
		--enable-mozilla \
		--enable-v4l \
		--enable-realrtsp \
		--enable-livedotcom \
		--with-livedotcom-tree=/usr/lib/live \
		--enable-speex \
		--enable-wxwidgets \
		--with-wx-config=wx-config-u8 \
		--enable-dts \
		--with-gnu-ld \
		--enable-dvbpsi \
		--with-dvbpsi=/usr/include/dvbpsi \
		--with-ffmpeg-{mp3lame,faac,dts,vorbis,theora,ogg}
	Fsed '%{idldir}' '/usr/share/idl/firefox' mozilla/Makefile
	make || return 1
	Fmakeinstall plugindir=/usr/lib/mozilla/plugins/ \
		vlcintf_xptdir=/usr/lib/mozilla/plugins/
	Frm /usr/share/vlc/{,k,q,g,gnome-}vlc*.{png,xpm,ico}
	Frm /usr/share/vlc/skins2
	for i in 16 32 48
	do
		Ffilerel share/vlc${i}x$i.png \
			/usr/share/icons/hicolor/${i}x$i/apps/vlc.png
	done
	Ffile /usr/share/applications/$pkgname.desktop
}

sha1sums=('2e67f073009de766340f1ef9f3920c2b4efa327e'\
          '888a02c9f81331fce1f6ee5f705ce68e5b486ffd'\
          '0c58c35fe47c4d14cd4d4c8c505863dbfc93f5e0'\
          '50bfbc12fc0ad94178b2e08df22a0b26da36c1d5'\
          '801e115ebe29904b668201e23a783a6289dad8e6'\
          'edc3a14dfd9b022dca7593e006c324fa5cc17e48')
# optimization OK


