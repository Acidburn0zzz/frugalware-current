# Compiling Time: 3.89 SBU
# Maintainer: crazy <crazy@frugalware.org>
# Contributor: VMiklos <vmiklos@frugalware.org>

pkgname=vlc
pkgver=0.8.6
pkgextraver=e
pkgrel=12kalgan3
pkgdesc="The cross-platform media player and streaming server."
url="http://www.videolan.org/vlc/"
depends=('alsa-lib' 'dbus-glib>=0.71' 'hal>=0.5.7.1-3' 'libxml2' 'libdvdnav' 'libmad' 'libmatroska' \
	 'mpeg2dec' 'ffmpeg>=20070422' 'fribidi' 'wxgtk-u8>=2.8.7' 'live' 'speex' 'libdca' \
	 'sysfsutils' 'mesa' 'libdvbpsi' 'libxv' 'sdlimage' 'libcdio' \
	 'libid3tag' 'libtheora' 'faad2' 'xvidcore' 'libtheora')
## WARNING: do NOT add any VCD option to build its kill off the GUI
makedepends=('firefox' 'samba' 'cvs')
options=('scriptlet')
groups=('xmultimedia-extra')
archs=('i686' 'x86_64')
up2date="lynx -dump $url/download-sources.html|grep -m1 'Latest VLC'|sed 's/.*(\(.*\)).*/\1/;s/$pkgextraver//'"
source=(http://download.videolan.org/pub/videolan/vlc/$pkgver$pkgextraver/$pkgname-$pkgver$pkgextraver.tar.bz2 \
	$pkgname-ffmpeg.diff $pkgname.desktop vlc-0.8.5-libintl.diff \
	libdca.patch CVE-2008-1489.patch cinepak-mem-corruption-fixes.patch \
	changeset_r8060b3457e20e6223b70927693f8da8f547b8fef.diff \
	vlc-0.8.x-wx28-volume-backport.patch)
sha1sums=('6b981ddbe7f6b95cd566ee195b4445b5773c21bd' \
          '888a02c9f81331fce1f6ee5f705ce68e5b486ffd' \
          '0c58c35fe47c4d14cd4d4c8c505863dbfc93f5e0' \
          '50bfbc12fc0ad94178b2e08df22a0b26da36c1d5' \
          'edc3a14dfd9b022dca7593e006c324fa5cc17e48' \
          '3e794876f5e5a50d4eb8cb3ae1382524a60b37c4' \
          '5cd2b133b73a44beb34600e48573c3f717bd4545' \
          '5a618ca1340352598786273b6e886f3afab6aa0d' \
          'd039b606217ab166e4fa3e50d91a0285478dab24')

build()
{
	Fpatchall
	export CXXFLAGS="$CXXFLAGS -fno-strict-aliasing"
	Fsed 'mozilla-config' 'firefox-config' configure.ac
	Fsed 'firefox-config\.h' 'mozilla-config\.h' configure.ac
	Fsed '/usr/lib/mozilla' '/usr/lib/firefox' configure.ac
	Fsed '/usr/share/fonts/truetype/freefont/FreeSerifBold.ttf' \
		'/usr/lib/X11/fonts/TTF/VeraBd.ttf' \
		modules/misc/freetype.c
	./bootstrap || return 1
	Fconf \
		--enable-faad \
		--enable-dvdread \
		--enable-dvdnav \
		--enable-madi \
		--enable-ffmpeg \
		--enable-theora \
		--disable-rpath \
		--disable-nls \
		--enable-alsa \
		--disable-skins2 \
		--enable-mozilla \
		--enable-v4l \
		--enable-realrtsp \
		--enable-live555 \
		--with-live555-tree=/usr/lib/live \
		--enable-speex \
		--enable-wxwidgets \
		--with-wx-config=wx-config-u8 \
		--enable-dts \
		--with-gnu-ld \
		--enable-dvbpsi \
		--with-dvbpsi=/usr/include/dvbpsi \
		--with-ffmpeg-{mp3lame,faac,faad,dts,vorbis,theora,ogg}
	Fsed '%{idldir}' '/usr/share/idl/firefox' mozilla/Makefile
	make || return 1
	Fmakeinstall plugindir=/usr/lib/mozilla/plugins/ \
		vlcintf_xptdir=/usr/lib/mozilla/plugins/
	Frm /usr/share/vlc/{,k,q,g,gnome-}vlc*.{png,xpm,ico}
	Frm /usr/share/vlc/skins2
	for i in 16 32 48
	do
		Ffilerel share/vlc${i}x$i.png \
			/usr/share/icons/hicolor/${i}x$i/apps/vlc.png
	done
	Ffile /usr/share/applications/$pkgname.desktop
}

# optimization OK
