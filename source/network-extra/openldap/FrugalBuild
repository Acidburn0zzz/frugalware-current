# Compiling Time: 1.03 SBU
# Maintainer: Miklos Vajna <vmiklos@frugalware.org>

pkgname=openldap
pkgver=2.4.18
pkgrel=1
pkgdesc="A suite of the Lightweight Directory Access Protocol servers"
url="http://www.openldap.org/"
groups=('network-extra')
archs=('i686' 'x86_64' 'ppc')
backup=(etc/openldap/ldap.conf etc/openldap/slapd.conf)
depends=('db-4.5>=4.5.20-2' 'libtool')
rodepends=("libldap=$pkgver")
makedepends=('tcp_wrappers' 'openssl' 'cyrus-sasl' 'groff')
up2date="lynx -dump http://www.openldap.org/software/download/|grep 'United States'|sed -e 's/.*]\(.*\) \[.*/\1/'"
source=(ftp://ftp.openldap.org/pub/OpenLDAP/openldap-release/$pkgname-$pkgver.tgz rc.slapd)
sha1sums=('13adeb6438973d8b2b31e2205a92890396445556' \
          '2cb842757c9d58686cc7957fdd00e46cce236d09')

subpkgs=('libldap')
subdescs=('OpenLDAP library.')
subdepends=('openssl cyrus-sasl')
subgroups=('lib')
subarchs=('i686 x86_64 ppc')

build()
{
	Fcd
	Fpatchall
	autoconf || return 1
	export CPPFLAGS="-I/usr/include/db-4.5 $CPPFLAGS -D_GNU_SOURCE"
	Fmake \
		--localstatedir=/var/openldap --enable-syslog --enable-dynamic \
		--with-readline --with-threads --with-tls --enable-slapd \
		--enable-cleartext --enable-modules --enable-rlookups \
		--enable-wrappers --enable-bdb --enable-slurpd

	make DESTDIR=$Fdestdir install || return 1

	Fln liblber.so /usr/lib/liblber.so.2
	Fln libldap.so /usr/lib/libldap.so.2
	chmod +x $Fdestdir/usr/lib/*so*
	Frcd2 slapd

	Fsplit libldap etc/openldap/ldap.conf*
	Fsplit libldap usr/lib/libldap*
	Fsplit libldap usr/lib/liblber*
}

# optimization OK

