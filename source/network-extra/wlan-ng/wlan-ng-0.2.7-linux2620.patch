---
 src/prism2/driver/hfa384x.c            |    4 ++--
 src/prism2/driver/hfa384x_usb.c        |   12 +++++-------
 src/prism2/driver/prism2sta.c          |   10 +++++-----
 src/prism2/include/prism2/prism2mgmt.h |    4 ++--
 4 files changed, 14 insertions(+), 16 deletions(-)

Index: linux-wlan-ng-0.2.7/src/prism2/driver/prism2sta.c
===================================================================
--- linux-wlan-ng-0.2.7.orig/src/prism2/driver/prism2sta.c
+++ linux-wlan-ng-0.2.7/src/prism2/driver/prism2sta.c
@@ -1438,9 +1438,9 @@ void prism2sta_inf_chinforesults(wlandev
 	return;
 }
 
-void prism2sta_processing_defer(void *data)
+void prism2sta_processing_defer(struct work_struct *work)
 {
-	hfa384x_t		*hw = (hfa384x_t *) data;
+	hfa384x_t		*hw = container_of(work, hfa384x_t, link_bh);
 	wlandevice_t            *wlandev = hw->wlandev;
 	hfa384x_bytestr32_t ssid;
 	int			result;
@@ -1540,7 +1540,7 @@ void prism2sta_processing_defer(void *da
 				WLAN_MACMODE_IBSS_STA : WLAN_MACMODE_ESS_STA;
 
 			/* Get the ball rolling on the comms quality stuff */
-			prism2sta_commsqual_defer(hw);
+			prism2sta_commsqual_defer(work);
 		}
 		break;
 
@@ -2413,9 +2413,9 @@ prism2sta_proc_read(
 }
 #endif
 
-void prism2sta_commsqual_defer(void *data)
+void prism2sta_commsqual_defer(struct work_struct *work)
 {
-        hfa384x_t               *hw = (hfa384x_t *) data;
+        hfa384x_t               *hw = container_of(work, hfa384x_t, commsqual_bh);
         wlandevice_t            *wlandev = hw->wlandev;
 	hfa384x_bytestr32_t ssid;
 	int result = 0;
Index: linux-wlan-ng-0.2.7/src/prism2/driver/hfa384x.c
===================================================================
--- linux-wlan-ng-0.2.7.orig/src/prism2/driver/hfa384x.c
+++ linux-wlan-ng-0.2.7/src/prism2/driver/hfa384x.c
@@ -352,9 +352,9 @@ void hfa384x_create( hfa384x_t *hw, UINT
 	/* Init the auth queue head */
 	skb_queue_head_init(&hw->authq);
 
-	INIT_WORK(&hw->link_bh, prism2sta_processing_defer, hw);
+	INIT_WORK(&hw->link_bh, prism2sta_processing_defer);
 
-        INIT_WORK(&hw->commsqual_bh, prism2sta_commsqual_defer, hw);
+        INIT_WORK(&hw->commsqual_bh, prism2sta_commsqual_defer);
 
 	init_timer(&hw->commsqual_timer);
 	hw->commsqual_timer.data = (unsigned long) hw;
Index: linux-wlan-ng-0.2.7/src/prism2/driver/hfa384x_usb.c
===================================================================
--- linux-wlan-ng-0.2.7.orig/src/prism2/driver/hfa384x_usb.c
+++ linux-wlan-ng-0.2.7/src/prism2/driver/hfa384x_usb.c
@@ -246,8 +246,6 @@ hfa384x_int_rxmonitor( 
 	wlandevice_t *wlandev, 
 	hfa384x_usb_rxfrm_t *rxfrm);
 
-static void
-hfa384x_usb_defer(void *hw);
 
 static int
 submit_rx_urb(hfa384x_t *hw, int flags);
@@ -579,9 +577,9 @@ submit_tx_urb(hfa384x_t *hw, struct urb 
 *	process (by design)
 ----------------------------------------------------------------*/
 static void
-hfa384x_usb_defer(void *data)
+hfa384x_usb_defer(struct work_struct *work)
 {
-	hfa384x_t *hw = data;
+	hfa384x_t *hw = container_of(work, hfa384x_t, usb_work);
 	struct net_device *netdev = hw->wlandev->netdev;
 
 	DBFENTER;
@@ -711,8 +709,8 @@ hfa384x_create( hfa384x_t *hw, struct us
 	tasklet_init(&hw->completion_bh,
 	             hfa384x_usbctlx_completion_task,
 	             (unsigned long)hw);
-	INIT_WORK(&hw->link_bh, prism2sta_processing_defer, hw);
-	INIT_WORK(&hw->usb_work, hfa384x_usb_defer, hw);
+	INIT_WORK(&hw->link_bh, prism2sta_processing_defer);
+	INIT_WORK(&hw->usb_work, hfa384x_usb_defer);
 
 	init_timer(&hw->throttle);
 	hw->throttle.function = hfa384x_usb_throttlefn;
@@ -733,7 +731,7 @@ hfa384x_create( hfa384x_t *hw, struct us
 	hw->link_status = HFA384x_LINK_NOTCONNECTED;
 	hw->state = HFA384x_STATE_INIT;
 
-        INIT_WORK(&hw->commsqual_bh, prism2sta_commsqual_defer, hw);
+        INIT_WORK(&hw->commsqual_bh, prism2sta_commsqual_defer);
 	init_timer(&hw->commsqual_timer);
 	hw->commsqual_timer.data = (unsigned long) hw;
 	hw->commsqual_timer.function = prism2sta_commsqual_timer;
Index: linux-wlan-ng-0.2.7/src/prism2/include/prism2/prism2mgmt.h
===================================================================
--- linux-wlan-ng-0.2.7.orig/src/prism2/include/prism2/prism2mgmt.h
+++ linux-wlan-ng-0.2.7/src/prism2/include/prism2/prism2mgmt.h
@@ -168,9 +168,9 @@ int prism2mgmt_set_grpaddr(UINT32 did, 
 	UINT8 *prism2buf, p80211pstrd_t *pstr, hfa384x_t *priv );
 int prism2mgmt_get_grpaddr_index( UINT32 did );
 
-void prism2sta_processing_defer(void *data);
+void prism2sta_processing_defer(struct work_struct *work);
 
-void prism2sta_commsqual_defer(void *data);
+void prism2sta_commsqual_defer(struct work_struct *work);
 void prism2sta_commsqual_timer(unsigned long data);
 
 /*=============================================================*/
