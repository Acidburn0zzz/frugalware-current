# Compiling Time: 0.33 SBU
# Maintainer: VMiklos <vmiklos@frugalware.org>

pkgname=wlan-ng
pkgver=0.2.8
pkgrel=25
pkgdesc="Wireless Lan modules"
url="http://www.linux-wlan.org/"
Finclude kernel-module
depends=(${depends[@]} 'bash')
groups=('network-extra')
archs=('i686' 'x86_64')
backup=(etc/wlan/wlan.conf)
up2date="lynx -dump ftp://ftp.linux-wlan.org/pub/linux-wlan-ng/|grep tar.bz2$|sed -n 's/.*g-\(.*\)\.t.*/\1/;s/-//;$ p'"
source=(ftp://ftp.linux-wlan.org/pub/linux-wlan-ng/linux-$pkgname-$pkgver.tar.bz2 \
	rc.wlan wlan-ng-0.2.8-kernel26{23,24}.diff)
sha1sums=('a98cd5c7327f5392730ebe1a5b7f289fc88d00de' \
          'b5b76089293cf11ab5c5f634f1c3b8dd7f4c34a7' \
          'dd46ef1066debf1596902c9d8bb7c3988e98e184' \
          '1987d4137a82cfbb4a390228e5d33155f52e1fbc')

build()
{
	# no Fcheckkernel, crosscompilation verified
	Fcd linux-$pkgname-$pkgver
	Fsed '`uname -r`' "$_F_kernelmod_uname" Configure
	find . -type f -exec sed -i '/#include <linux\/config.h>/d' {} \;
	Fsed "TARGET_ROOT_ON_HOST=" "TARGET_ROOT_ON_HOST=$Fdestdir" config.in
	Fsed "PRISM2_PLX=n" "PRISM2_PLX=y" config.in
	Fsed "PRISM2_PCI=n" "PRISM2_PCI=y" config.in
	Fsed "PRISM2_USB=n" "PRISM2_USB=y" config.in
	Fsed "PRISM2_PCMCIA=y" "PRISM2_PCMCIA=n" config.in
	Fpatchall
	make auto_config
	make all || return 1
	make install
	Fmv /usr/local/man /usr/man
	Frm /init.d
	Frcd wlan
	Fbuild_kernelmod_scriptlet
}

# optimization OK
