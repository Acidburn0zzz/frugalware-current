# Compiling Time: 0.20 SBU
# Maintainer: Miklos Vajna <vmiklos@frugalware.org>

pkgname=ejabberd
pkgver=2.1.4
pkgrel=2
pkgdesc="A free and open source instant messaging server written in Erlang."
url="http://ejabberd.jabber.ru/"
depends=('erlang>=14A-2')
backup=(etc/ejabberd/ejabberd.cfg)
groups=('network-extra')
archs=('i686' 'x86_64')
_F_archive_grepv="beta\|rc"
up2date="Flasttar http://www.process-one.net/en/ejabberd/archive/"
source=(http://www.process-one.net/downloads/ejabberd/${pkgver%%_*}/ejabberd-$pkgver.tar.gz \
	rc.ejabberd README.Frugalware \
	0001-Remove-workarounds-that-supported-R11-or-older-EJAB-.patch \
	0002-When-using-OTP-R14-use-public_key-library-instead-of.patch)
sha1sums=('00b1b121f687ba8284dbeb40ff97915d9e1be355' \
          'ac41a05fd1a21dcb6a4f1e104c185e82b5262d43' \
          '016da166aa7527f148cb29d87eeca108424f1d2a' \
          '19bcb8458c99b27d0e878d0d2a6831b7ab23bb9e' \
          'ea084f335cef3c0e16e418f3c10243fba9862297')

build()
{
	unset MAKEFLAGS
	Fcd $pkgname-${pkgver%%_*}
	Fpatchall
	cd src
	Fmake --prefix=/
	Fmakeinstall
	Fmkdir /var/spool/ejabberd /usr/
	Fmv /var/lib /usr/
	Fmv /sbin /usr
	Fsed 'EJABBERD_EBIN=.*' 'EJABBERD_EBIN=$ROOTDIR/usr/lib/ejabberd/ebin' $Fdestdir/usr/sbin/ejabberdctl
	Fsed 'EJABBERD_MSGS_PATH=.*' 'EJABBERD_MSGS_PATH=$ROOTDIR/usr/lib/ejabberd/priv/msgs' $Fdestdir/usr/sbin/ejabberdctl
	Fsed 'EJABBERD_SO_PATH=.*' 'EJABBERD_SO_PATH=$ROOTDIR/usr/lib/ejabberd/priv/lib' $Fdestdir/usr/sbin/ejabberdctl
	Fdocrel ../doc/*
	chown -R 41:41 $Fdestdir/{var/log/ejabberd,var/spool/ejabberd,usr/lib/ejabberd}
	Fdoc README.Frugalware
	Frcd2
}

# optimization OK
