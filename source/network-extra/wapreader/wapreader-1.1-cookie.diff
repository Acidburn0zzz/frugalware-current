diff -Naur wapreader.orig/wapreader.php wapreader/wapreader.php
--- wapreader.orig/wapreader.php	2006-10-24 10:44:17.000000000 +0200
+++ wapreader/wapreader.php	2006-12-05 01:08:55.000000000 +0100
@@ -19,7 +19,7 @@
 Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 
 
-Version: 1.1.vmiklos
+Version: 1.1.vmiklos2
 
 Project home page: http://wapreader.dp.ua/
 
@@ -28,6 +28,15 @@
 //--------------- config -----------------------------------
 //----------------------------------------------------------
 
+function print_header()
+{
+	print('<?xml version="1.0" encoding="utf-8"?>
+<!DOCTYPE wml PUBLIC "-//WAPFORUM//DTD WML 1.1//EN" "http://www.wapforum.org/DTD/wml_1.1.xml">
+
+<wml>
+<template><do type="prev" label="back"><prev/></do></template>');
+}
+
 //Defaul imap/pop3 host.
 $host_default="";
 
@@ -80,6 +89,13 @@
   }
 }
 
+else if(empty($action) && !empty($_COOKIE["wapreader"])) {
+  $qs=explode(":", $_COOKIE["wapreader"]);
+  if(count($qs)>1) {
+    list($login, $password, $host, $protocol)=$qs;
+    $action="login";
+  }
+}
 
 if(!function_exists("imap_open")) {
   $action="error";
@@ -119,16 +135,16 @@
 }
 else {
   @header("Content-type: text/vnd.wap.wml; charset=utf-8");
-  echo "<?xml version=\"1.0\" encoding=\"utf-8\"?>\n";
 }
 
-
-?>
-<!DOCTYPE wml PUBLIC "-//WAPFORUM//DTD WML 1.1//EN" "http://www.wapforum.org/DTD/wml_1.1.xml">
-
-<wml>
-<template><do type="prev" label="back"><prev/></do></template>
-<?php
+if ($action != "login") {
+  print_header();
+}
+else if($action == "logout")
+{
+  setcookie("wapreader", "", time()-3600);
+  $action="auth";
+}
 
 $continue=true;
 while($continue) {
@@ -152,6 +168,7 @@
   $connect="{".$host.$cs_suffixes[$protocol]."}";
 
   if( $box=imap_open($connect, $login, $password) ) {
+    setcookie("wapreader", implode(":", array($login, $password, $host, $protocol)), time()+(60*60*24*365));
     @session_start();
     $sid=session_id();
 
@@ -173,6 +190,7 @@
     $continue=true;
     $error=imap_last_error();
   }
+  print_header();
   break;
 //----------------------------------------------------
 case "auth":
@@ -281,6 +299,7 @@
 ?>
 <br/>
 <a href="<?php echo $_SERVER["PHP_SELF"]?>?action=write&amp;sid=<?php echo $sid?>">[new message &gt;&gt;&gt;]</a><br/>
+<a href="<?php echo $_SERVER["PHP_SELF"]?>?action=logout&amp;sid=<?php echo $sid?>">[logout &gt;&gt;&gt;]</a><br/>
 </p>
 </card>
 <?php
@@ -650,3 +669,4 @@
   return (strtoupper($a->name) < strtoupper($b->name)) ? -1 : 1;
 }
 
+?>
