# Compiling Time: 0 SBU
# Maintainer: Bence Nagy <nagybence@tipogral.hu>

pkgname=joomla
pkgver=1.0.13
pkgrel=2
pkgdesc="One of the most powerful Open Source Content Management Systems on the planet"
url="http://www.joomla.org/"
rodepends=('apache' 'php' 'mysql' 'webappconfig')
depends=()
groups=('network-extra')
archs=('i686' 'x86_64')
up2date="lynx -dump http://www.joomla.org/content/blogcategory/32/66/|grep 'Stable version is'|sed 's/.*\[ *\([0-9.]\+\) *\]/\1/'"
backup=(var/www/joomla/configuration.php)
source=(http://joomlacode.org/gf/download/frsrelease/4508/13216/Joomla_$pkgver-Stable-Full_Package.tar.gz \
	joomlasetup README.Frugalware CVE-2007-5427.diff)
sha1sums=('91934fe13e65ccb679ba50db1962449c306211df' \
          '436fa260a2750e2394eb23f1504757bdb8045af1' \
          'c079d041113ca5302340955027a5e313bee47f4a' \
          '044d0443f13a71893bb1626a690386a7c39514df')

build() {
	_F_cd_path="."
	Fpatchall
	sed -i "s/#__/jos_/g" installation/sql/joomla.sql || Fdie
	sed -i "s/#__/jos_/g" installation/sql/sample_data.sql || Fdie
	Fmkdir /var/www/joomla
	mv "$Fsrcdir"/* "$Fdestdir"/var/www/joomla || Fdie
	rm "$Fdestdir"/var/www/joomla/Joomla_"$pkgver"-Stable-Full_Package.tar.gz || Fdie
	mv "$Fdestdir"/var/www/joomla/joomlasetup . || Fdie
	mv "$Fdestdir"/var/www/joomla/README.Frugalware . || Fdie
	Fexe /usr/bin/joomlasetup
	Fmv /var/www/joomla/configuration.php-dist /var/www/joomla/configuration.php
}
