# Compiling Time: 0.01 SBU
# Maintainer: DeX77 <dex77@frugalware.org>

pkgname=syncthing
pkgver=0.14.33
pkgrel=1
pkgdesc="Open Source Continuous Replication / Cluster Synchronization Thing"
url="http://syncthing.net/"
groups=('network-extra')
license=('MIT')
archs=('x86_64')
depends=('glibc')
makedepends=('go' 'ca-certificates' 'mercurial' 'git')
_F_github_author="$pkgname"
_F_github_name="$pkgname"
_F_github_tag_v="y"
_F_systemd_units="syncthing="
_F_archive_grepv="beta\|-rc"
Finclude github systemd
source+=("fix-build.patch")
sha1sums=('d748faeeda4db6127777f691a617770d12bfbaa3' \
          '9a529b8e6ebb1fb50596748eb22c2e484e340531')
_F_cd_path="src/github.com/syncthing/syncthing"

build() {
	Fpatchall

	Fexec rm -rf src/github.com/syncthing/
	Fexec mkdir -p src/github.com/syncthing/
	Fexec mv "${pkgname}-${pkgver}" src/github.com/syncthing/syncthing

	Fcd

	export GOPATH="$Fsrcdir"
	export PATH=$PATH:$GOROOT/bin
	
	# cover and vet are installed via go package
	Fexec sed -i '/cmd\/cover/d' build.go
        Fexec sed -i '/cmd\/vet/d' build.go

	Fexec go run build.go -version v${pkgver} -no-upgrade

	Fexe src/github.com/syncthing/syncthing/bin/syncthing /usr/bin/syncthing

	Finstallrel 644 etc/linux-systemd/system/syncthing-resume.service lib/systemd/system/syncthing-resume.service
	Finstallrel 644 etc/linux-systemd/system/syncthing@.service lib/systemd/system/syncthing@.service


	
	Fgenscriptlet

}


# optimization OK
