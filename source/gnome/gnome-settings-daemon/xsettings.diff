From 9054d2321acb592cb8223e76b591ce232a91a77e Mon Sep 17 00:00:00 2001
From: Bastien Nocera <hadess@hadess.net>
Date: Tue, 30 Aug 2011 14:51:57 +0000
Subject: xsettings: Don't poke at an empty hashtable

We might not like the result.

https://bugzilla.gnome.org/show_bug.cgi?id=657464
---
diff --git a/plugins/xsettings/gsd-xsettings-gtk.c b/plugins/xsettings/gsd-xsettings-gtk.c
index 494ac77..0ce4db7 100644
--- a/plugins/xsettings/gsd-xsettings-gtk.c
+++ b/plugins/xsettings/gsd-xsettings-gtk.c
@@ -76,8 +76,10 @@ cond_setting_changed (GSettings       *settings,
 
         enabled = g_settings_get_boolean (settings, key);
         if (enabled != FALSE) {
+                if (gtk->priv->dir_modules == NULL) {
+                        gtk->priv->dir_modules = g_hash_table_new_full (g_str_hash, g_str_equal, g_free, NULL);
                 g_hash_table_insert (gtk->priv->dir_modules, g_strdup (module_name), NULL);
-        } else {
+        } else if (gtk->priv->dir_modules != NULL) {
                 g_hash_table_remove (gtk->priv->dir_modules, module_name);
         }
 
--
cgit v0.9.0.2

