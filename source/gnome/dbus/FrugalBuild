# Last modified: Sun, 22 May 2005 08:17:29 +0200
# Compiling time: ~2 minutes
# Maintainer: Laszlo Dvornik <dvornik@gnome.hu>

pkgname=dbus
pkgver=0.23.3
pkgrel=1
pkgdesc="A message bus system"
url="http://freedesktop.org/wiki/Software_2fdbus"
depends=('expat' 'gtk+2')
makedepends=('pkgconfig' 'pyrex' 'gtk-sharp')
groups=('gnome' 'gnome-core')
install=$pkgname.install
up2date="lynx -dump http://freedesktop.org/wiki/Software_2fdbus|grep \"latest release\"|sed -n 's/.*-\(.*\)\.t.*/\1/;1 p'"
source=(http://dbus.freedesktop.org/releases/$pkgname-$pkgver.tar.gz \
	$pkgname.install \
	rc.$pkgname)
md5sums=('acfe66e1e3565d64cb43b44ed6042655' \
	'd1d771afa95bfa18b3847ff68969d902' \
	'587490993de4d874935ea4ab88ef7695')

build() {
	export MONO_SHARED_DIR=$startdir/src/.wabi
	mkdir -p $MONO_SHARED_DIR
	cd $startdir/src/$pkgname-$pkgver

	sed -e 's|<user>messagebus|<user>nobody|g' -i bus/system.conf.in
	./configure --prefix=/usr --sysconfdir=/etc --localstatedir=/var \
		--enable-x --enable-gtk --enable-glib --enable-python \
		--enable-mono --enable-checks --enable-asserts --disable-qt \
		--with-system-pid-file=/var/run/dbus.pid \
		--with-system-socket=/var/lib/dbus/system_bus_socket

	make || return 1

	make DESTDIR=$startdir/pkg install
	mkdir -p $startdir/pkg/var/lib/dbus
	rm -rf $MONO_SHARED_DIR

	# Init scripts.
	mkdir -p $startdir/pkg/etc/rc.d/rc.messages
	install -m755 $startdir/rc.$pkgname $startdir/pkg/etc/rc.d/rc.$pkgname
	install -m644 $startdir/messages/$pkgname.* \
		$startdir/pkg/etc/rc.d/rc.messages/
}

# vim: ft=sh
