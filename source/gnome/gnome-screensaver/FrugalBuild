# Last modified: Wed, 12 Jul 2006 17:27:47 +0200
# Compiling time: 0.50 SBU
# Maintainer: Christian Hamar alias krix <krics@linuxforum.hu>

pkgname=gnome-screensaver
pkgver=2.15.4
pkgrel=1
pkgdesc="GNOME screen saver and locker"
url="http://live.gnome.org/GnomeScreensaver"
depends=('libgnomeui' 'dbus' 'gnome-menus>=2.15.4.1' 'gdm' 'libxscrnsaver' 'scrnsaverproto' 'shadow' 'xscreensaver-data' 'libbonobo')
makedepends=('intltool')
groups=('gnome')
archs=('x86_64' 'i686')
Finclude gnome gnome-scriptlet
_F_gnome_schemas=('/etc/gconf/schemas/gnome-screensaver.schemas')
_F_gnome_desktop="y"
_F_gnome_scrollkeeper="y"
_F_gnome_mime="y"
source=(${source[@]} 61_switch_user_by_default.patch)
sha1sums=('913b65eee43e804a5d810152c854ac2275f11b49' \
	  'b9b5caf32bfd048107da4616c78276e3fe8fe7ee')

build() {
	Fcd
	Fpatchall
	Fbuild_slice_scrollkeeper
	Fmake --sysconfdir=/etc/gnome --disable-schemas-install \
		--disable-scrollkeeper --with-gconf-schema-file-dir=/etc/gconf/schemas \
		--with-gdm-config=/usr/share/gdm/defaults.conf \
		--enable-locking --with-dpms-ext --with-shadow \
		--with-xscreensaverdir=/usr/share/xscreensaver/config/ \
		--with-xscreensaverhackdir=/usr/libexec/xscreensaver
	Fmakeinstall GCONF_DISABLE_SCHEMA_INSTALL=1
	
	# Fix for shadow
	chmod +s $Fdestdir/usr/libexec/gnome-screensaver-dialog
	
	migratescript="$Fsrcdir/$pkgname-$pkgver/data/migrate-xscreensaver-config.sh"
	cd $Fdestdir/usr/share/applications/screensavers
	for i in /usr/share/xscreensaver/config/*; do 
		$migratescript $i
	done
	Fbuild_gnome_scriptlet
}

# optimization OK
