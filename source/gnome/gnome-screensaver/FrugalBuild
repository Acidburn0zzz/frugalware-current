# Last modified: Thu, 13 Apr 2006 08:26:09 +0100
# Compiling time: 0.50 SBU
# Maintainer: Christian Hamar alias krix <krics@linuxforum.hu>

pkgname=gnome-screensaver
pkgver=2.14.1
pkgrel=1
pkgdesc="GNOME screen saver and locker"
url="http://live.gnome.org/GnomeScreensaver"
depends=('libgnomeui' 'dbus' 'gnome-menus' 'gdm' 'libxscrnsaver' 'scrnsaverproto' 'shadow')
makedepends=('intltool' 'xscreensaver')
groups=('gnome')
archs=('x86_64' 'i686')
nondevel=1
Finclude gnome
install=gnome-screensaver.install
source=(http://ftp.gnome.org/pub/gnome/sources/$pkgname/$preup2date/$pkgname-$pkgver.tar.bz2 \
	gdm-conf-path.patch)
sha1sums=('349016118e730cf784049c6c70e40b5034aa8b8a' \
	  '2d63e19e617019cf55c807731dceba2fb86675d4')

build() {
	Fcd
	Fpatchall
	autoreconf || Fdie
	find . -name Makefile.in -exec sed -i -e 's/-scrollkeeper-update.*//' {} \;
	if [ -f omf.make ]; then
		sed -i -e 's/-scrollkeeper-update.*//' omf.make
	fi
	Fmake --disable-schemas-install --disable-scrollkeeper \
		--with-gdm-config=/usr/share/gdm/defaults.conf \
		--enable-locking --with-dpms-ext
	Fmakeinstall GCONF_DISABLE_SCHEMA_INSTALL=1
	
	# Fix for shadow
	chmod +s $Fdestdir/usr/libexec/gnome-screensaver-dialog
	
	# HACK!!!!!!! This gets xscreensaver's screensavers
	install -m755 /usr/libexec/xscreensaver/* $Fdestdir/usr/libexec/gnome-screensaver
	migratescript="$Fsrcdir/$pkgname-$pkgver/data/migrate-xscreensaver-config.sh"
	cd $Fdestdir/usr/share/gnome-screensaver/themes
	for i in /usr/share/xscreensaver/config/*; do 
		$migratescript $i
	done
}

# optimalization OK
