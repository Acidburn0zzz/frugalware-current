# Compiling time: 0.50 SBU
# Maintainer: Christian Hamar alias krix <krics@linuxforum.hu>

pkgname=gnome-screensaver
pkgver=2.17.7
pkgrel=1
pkgdesc="GNOME screen saver and locker"
url="http://live.gnome.org/GnomeScreensaver"
depends=('libgnomeui>=2.17.91' 'dbus-glib>=0.71' 'gnome-menus>=2.17.91' 'gdm>=2.17.7' 'libgnomekbd' \
		'libxscrnsaver' 'shadow' 'xscreensaver-data' 'libbonobo' 'gnome-vfs>=2.17.91')
makedepends=('intltool' 'scrnsaverproto')
groups=('gnome' 'gnome-core')
archs=('x86_64' 'i686')
Finclude gnome gnome-scriptlet
_F_gnome_schemas=('/etc/gconf/schemas/gnome-screensaver.schemas')
_F_gnome_desktop="y"
_F_gnome_scrollkeeper="y"
_F_gnome_mime="y"
sha1sums=('aef21e220fa2f6ebb08628afb0c38aed2517edae')

build() {
	Fcd
	Fpatchall
	Fbuild_slice_scrollkeeper
	Fmake --disable-schemas-install --disable-scrollkeeper \
		--with-gdm-config=/etc/gdm/gdm.conf \
		--enable-locking --with-dpms-ext --with-shadow \
		--with-xscreensaverdir=/usr/share/xscreensaver/config \
		--with-xscreensaverhackdir=/usr/libexec/xscreensaver \
		--with-mit-ext --with-libgl
	Fmakeinstall GCONF_DISABLE_SCHEMA_INSTALL=1
	
	# Fix for shadow
	chmod +s $Fdestdir/usr/libexec/gnome-screensaver-dialog
	
	Fexerel data/migrate-xscreensaver-config.sh /usr/bin/xscreensaver2gnome
	sed -i 's/XSL=\${DIST_BIN}\/xscreensaver-config.xsl/XSL=\/usr\/share\/gnome-screensaver\/xscreensaver-config.xsl/' $Fdestdir/usr/bin/xscreensaver2gnome
	Finstallrel 0644 data/xscreensaver-config.xsl /usr/share/gnome-screensaver/xscreensaver-config.xsl
	
	cd $Fdestdir/usr/share/applications/screensavers
	for i in /usr/share/xscreensaver/config/*; do 
		$Fsrcdir/$pkgname-$pkgver/data/migrate-xscreensaver-config.sh $i
	done
	
	Fmkdir /etc/gnome
	Fmv /etc/xdg /etc/gnome/
	
	Fbuild_gnome_scriptlet
}

# optimization OK
