# Last modified: Tue, 02 Aug 2005 20:47:28 +0200
# Compiling time: ~0.73 SBU
# Maintainer: Laszlo Dvornik <dvornik@gnome.hu>

pkgname=gdm
pkgver=2.8.0.1
pkgrel=2
pkgdesc="GNOME Display Manager"
url="http://www.gnome.org/"
backup=(etc/gdm/gdm.conf)
depends=('libgnomeui' 'librsvg' 'scrollkeeper' 'gksu')
makedepends=('intltool')
groups=('gnome' 'gnome-core')
archs=('i686' 'x86_64')
install=$pkgname.install
[ -e ../up2date.gnome ] && . ../up2date.gnome
source=(http://ftp.gnome.org/pub/gnome/sources/$pkgname/$preup2date/$pkgname-$pkgver.tar.bz2 \
	00-$pkgname-2.8.0.1-gdm.conf.patch \
	01-$pkgname-2.6.0.8-gksu.patch \
	http://ftp.frugalware.org/pub/other/artwork/gdm-theme/GDM-Frugalware-0.2.tar.bz2 \
	http://ftp.frugalware.org/pub/other/artwork/gdm-theme/GDM-Frugalware.tar.bz2 \
	$pkgname.install)
sha1sums=('6ae66c933bf86a44951373019a6d5526ae312acd' \
          'b87a99c36c9c4d9e2ce710357001efd46691825a' \
          'b1ef820381b0bae459675a943fc31e27e023e431' \
          'e57021bf8f78a630e8bfa8b574a346608a9cc9a9' \
          '6206638b67f7e08e1458c39903ffbd03451e223e' \
          '6afeb7427b8e42285f9eb401d1c2107e7568fa29')

build() {
	Fcd
	find . -name Makefile.in -exec sed -i -e 's/-scrollkeeper-update.*//' {} \;
	if [ -f omf.make ]; then
		sed -i -e 's/-scrollkeeper-update.*//' omf.make
	fi
	Fbuild --prefix=/usr --sysconfdir=/etc --localstatedir=/var \
		--enable-authentication-scheme=shadow

	Fmkdir /etc/X11
	Fmv /usr/share/xsessions /etc/X11/sessions
	Frm /etc/dm

	chmod a+r $Fdestdir/var/gdm
	chown root:root $Fdestdir/var/gdm

	# Install our default GDM theme.
	if [ "$CARCH" == "x86_64" ]; then
		cp -R $Fsrcdir/Frugalware_64 $Fdestdir/usr/share/gdm/themes/Frugalware
	else
		mv $Fsrcdir/Frugalware $Fdestdir/usr/share/gdm/themes/
	fi

	# Install our old GDM theme.
	mv $Fsrcdir/Frugalware-0.2 $Fdestdir/usr/share/gdm/themes/
}

# vim: ft=sh

# optimalization OK
