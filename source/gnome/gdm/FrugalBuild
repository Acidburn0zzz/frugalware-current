# Last modified: Tue, 14 Jun 2005 11:30:14 +0000
# Compiling time: ~2 minutes
# Maintainer: Laszlo Dvornik <dvornik@gnome.hu>

pkgname=gdm
pkgver=2.8.0.0
pkgrel=2
pkgdesc="GNOME Display Manager"
url="http://www.gnome.org/"
backup=(etc/gdm/gdm.conf)
depends=('libgnomeui' 'librsvg' 'scrollkeeper' 'gksu')
makedepends=('intltool')
groups=('gnome' 'gnome-core')
archs=('i686' 'x86_64')
install=$pkgname.install
[ -e ../up2date.gnome ] && . ../up2date.gnome
source=(http://ftp.gnome.org/pub/gnome/sources/$pkgname/$preup2date/$pkgname-$pkgver.tar.bz2 \
	00-$pkgname-2.8.0.0-gdm.conf.patch \
	01-$pkgname-2.6.0.8-gksu.patch \
	http://ftp.frugalware.org/pub/other/artwork/gdm-theme/GDM-Frugalware.tar.bz2 \
	$pkgname.install)
md5sums=('f5540e6ddc136d3b4a5bc32baa0ea3eb' \
	'32604df8335b419f782712af9d3f896a' \
	'c2ebe4b0b99173def8b9769e2dddb034' \
	'ddabbc134fa5bb3c65a39b04e3dd0d32' \
	'fb3edb893be6169f124f2a1d0480238f')

build() {
	Fcd
	find . -name Makefile.in -exec sed -i -e 's/-scrollkeeper-update.*//' {} \;
	if [ -f omf.make ]; then
		sed -i -e 's/-scrollkeeper-update.*//' omf.make
	fi
	Fpatch 00-$pkgname-2.8.0.0-gdm.conf.patch || return 1
	Fpatch 01-$pkgname-2.6.0.8-gksu.patch || return 1
	Fmake --prefix=/usr --sysconfdir=/etc --localstatedir=/var

	make DESTDIR=$startdir/pkg install

	mkdir -p $startdir/pkg/etc/X11
	mv $startdir/pkg/usr/share/xsessions $startdir/pkg/etc/X11/sessions
	rm -rf $startdir/pkg/etc/dm

	chmod a+r $startdir/pkg/var/gdm
	chown root:root $startdir/pkg/var/gdm

	# Install our default GDM theme.
	mv $startdir/src/Frugalware $startdir/pkg/usr/share/gdm/themes/
	Fsed "#!/bin/ksh" "#!/bin/sh" $Fdestdir/etc/gdm/Xsession
}

# vim: ft=sh
