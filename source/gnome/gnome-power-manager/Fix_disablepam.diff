--- gnome-power-manager-2.24.0old/configure.ac	2008-09-22 22:45:17.000000000 +0200
+++ gnome-power-manager-2.24.0/configure.ac	2008-10-11 10:35:52.000000000 +0200
@@ -66,7 +66,6 @@
 LIBPANEL_REQUIRED=2.0.0
 GSTREAMER_REQUIRED=0.10
 XRANDR_REQUIRED=1.2.0
-POLKIT_GNOME_REQUIRED=0.8
 
 dnl ---------------------------------------------------------------------------
 dnl - Make above strings available for packaging files (e.g. rpm spec files)
@@ -86,7 +85,6 @@
 AC_SUBST(LIBPANEL_REQUIRED)
 AC_SUBST(GSTREAMER_REQUIRED)
 AC_SUBST(XRANDR_REQUIRED)
-AC_SUBST(POLKIT_GNOME_REQUIRED)
 
 dnl ---------------------------------------------------------------------------
 dnl - Check library dependencies
@@ -162,28 +160,7 @@
 fi
 AC_SUBST(DOCDIR)
 
-dnl ---------------------------------------------------------------------------
-dnl - PolicyKit support?
-dnl ---------------------------------------------------------------------------
-AC_ARG_ENABLE(policykit,
-              AS_HELP_STRING([--enable-policykit],
-                             [support PolicyKit permissions daemon (requires polkitd)]),
-              enable_policykit=$enableval,enable_policykit=no)
-
-AC_MSG_CHECKING([whether to support PolicyKit])
-have_polkit=no
-if test x$enable_policykit = xyes ; then
-    PKG_CHECK_MODULES(POLKIT, \
-                      polkit-grant >= $POLKIT_GNOME_REQUIRED\
-                      polkit-dbus >= $POLKIT_GNOME_REQUIRED)
-    AC_SUBST(POLKIT_CFLAGS)
-    AC_SUBST(POLKIT_LIBS)
-    have_polkit=yes
-    AC_DEFINE(HAVE_POLKIT, 1, [Define if we use PolicyKit])
-    AC_MSG_RESULT(yes)
-else
-    AC_MSG_RESULT(no)
-fi
+
 
 dnl ---------------------------------------------------------------------------
 dnl - Use check-foreground-console (Ubuntu specific) support?
@@ -251,12 +228,7 @@
 AC_MSG_CHECKING([whether to support gconf defaults])
 have_gconfdefaults=no
 if test x$enable_gconfdefaults = xyes ; then
-    PKG_CHECK_MODULES(POLKIT_GNOME, [
-                      polkit-gnome >= $POLKIT_GNOME_REQUIRED])
-    AC_SUBST(POLKIT_GNOME_CFLAGS)
-    AC_SUBST(POLKIT_GNOME_LIBS)
     have_gconfdefaults=yes
-    AC_DEFINE(HAVE_GCONF_DEFAULTS, 1, [Define if have policykit-gnome])
     AC_MSG_RESULT(yes)
 else
     AC_MSG_RESULT(no)
@@ -641,7 +613,6 @@
         unique support:            ${have_unique}
         Building extra applets:    ${enable_applets}
         DPMS support:              ${have_dpms}
-        PolicyKit support:         ${have_polkit}
         XEVENTS support:           ${have_xevents}
         Self test support:         ${have_tests}
         GConf default support:     ${have_gconfdefaults}

--- gnome-power-manager-2.24.0old/src/gpm-prefs-core.c	2008-09-04 12:05:15.000000000 +0200
+++ gnome-power-manager-2.24.0/src/gpm-prefs-core.c	2008-10-02 14:56:41.000000000 +0200
@@ -45,9 +45,7 @@
 #include "gpm-screensaver.h"
 #include "gpm-prefs-server.h"
 
-#ifdef HAVE_GCONF_DEFAULTS
-#include <polkit-gnome/polkit-gnome.h>
-#endif
+
 
 static void     gpm_prefs_class_init (GpmPrefsClass *klass);
 static void     gpm_prefs_init       (GpmPrefs      *prefs);
@@ -69,9 +67,7 @@
 	gboolean		 can_hibernate;
 	GpmConf			*conf;
 	GpmScreensaver		*screensaver;
-#ifdef HAVE_GCONF_DEFAULTS
-	PolKitGnomeAction	*default_action;
-#endif
+
 };
 
 enum {
@@ -965,95 +961,7 @@
 	}
 }
 
-#ifdef HAVE_GCONF_DEFAULTS
-/**
- * pk_prefs_set_defaults_cb:
- **/
-static void
-pk_prefs_set_defaults_cb (PolKitGnomeAction *default_action, GpmPrefs *prefs)
-{
-	DBusGProxy *proxy;
-	DBusGConnection *connection;
-	GError *error;
-	gchar *keys[5] = {
-		"/apps/gnome-power-manager/actions",
-		"/apps/gnome-power-manager/ui",
-		"/apps/gnome-power-manager/buttons",
-		"/apps/gnome-power-manager/backlight",
-		"/apps/gnome-power-manager/timeout"
-	};
-
-	error = NULL;
-	connection = dbus_g_bus_get (DBUS_BUS_SYSTEM, &error);
-	if (error != NULL) {
-		g_warning ("failed to get system bus connection: %s", error->message);
-		g_error_free (error);
-		return;
-	}
-
-	proxy = dbus_g_proxy_new_for_name (connection,
-					   "org.gnome.GConf.Defaults",
-					   "/",
-					   "org.gnome.GConf.Defaults");
-	if (proxy == NULL) {
-		g_warning ("Cannot connect to defaults mechanism");
-		return;
-	}
 
-	GConfClient *client;
-	client = gconf_client_get_default ();
-	gconf_client_suggest_sync (client, NULL);
-	g_object_unref (client);
-	dbus_g_proxy_call (proxy, "SetSystem", &error,
-			   G_TYPE_STRV, keys,
-			   G_TYPE_STRV, NULL,
-			   G_TYPE_INVALID, G_TYPE_INVALID);
-
-	g_object_unref (proxy);
-}
-
-/**
- * gpk_prefs_create_custom_widget:
- **/
-static GtkWidget *
-gpk_prefs_create_custom_widget (GladeXML *xml, gchar *func_name, gchar *name,
-				     gchar *string1, gchar *string2,
-				     gint int1, gint int2, gpointer user_data)
-{
-	GpmPrefs *prefs = GPM_PREFS (user_data);
-	if (strcmp (name, "button_default") == 0) {
-		return polkit_gnome_action_create_button (prefs->priv->default_action);
-	}
-	egg_warning ("name unknown=%s", name);
-	return NULL;
-}
-
-/**
- * gpk_prefs_setup_policykit:
- *
- * We have to do this before the glade stuff if done as the custom handler needs the actions setup
- **/
-static void
-gpk_prefs_setup_policykit (GpmPrefs *prefs)
-{
-	PolKitAction *pk_action;
-
-	g_return_if_fail (GPM_IS_PREFS (prefs));
-
-	/* set default */
-	pk_action = polkit_action_new ();
-	polkit_action_set_action_id (pk_action, "org.freedesktop.packagekit.set-defaults");
-	prefs->priv->default_action = polkit_gnome_action_new_default ("set-defaults", pk_action,
-								       _("Make Default"), NULL);
-	g_object_set (prefs->priv->default_action,
-		      "no-icon-name", GTK_STOCK_FLOPPY,
-		      "auth-icon-name", GTK_STOCK_FLOPPY,
-		      "yes-icon-name", GTK_STOCK_FLOPPY,
-		      "self-blocked-icon-name", GTK_STOCK_FLOPPY,
-		      NULL);
-	polkit_action_unref (pk_action);
-}
-#endif
 
 /**
  * gpm_prefs_init:
@@ -1088,13 +996,7 @@
 	prefs->priv->can_hibernate = gpm_dbus_method_bool ("CanHibernate");
 	egg_debug ("caps=%i", caps);
 
-#ifdef HAVE_GCONF_DEFAULTS
-	/* use custom widgets */
-	glade_set_custom_handler (gpk_prefs_create_custom_widget, prefs);
-
-	/* we have to do this before we connect up the glade file */
-	gpk_prefs_setup_policykit (prefs);
-#endif
+
 
 	prefs->priv->glade_xml = glade_xml_new (GPM_DATA "/gpm-prefs.glade", NULL, NULL);
 	if (prefs->priv->glade_xml == NULL) {
@@ -1120,10 +1022,7 @@
 	g_signal_connect (widget, "clicked",
 			  G_CALLBACK (gpm_prefs_help_cb), prefs);
 
-#ifdef HAVE_GCONF_DEFAULTS
-	g_signal_connect (prefs->priv->default_action, "activate",
-			  G_CALLBACK (pk_prefs_set_defaults_cb), prefs);
-#endif
+
 
 	prefs_setup_ac (prefs);
 	prefs_setup_battery (prefs);
