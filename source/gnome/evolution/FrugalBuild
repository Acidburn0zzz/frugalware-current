# Compiling time: 18.77 SBU
# Maintainer: Baste <baste@frugalware.org>
# Contributor: bouleetbil <bouleetbil@frogdev.info>

pkgname=evolution
pkgver=3.20.0
pkgrel=1
pkgdesc="Integrated mail, calendar and address book suite for GNOME"
depends=('unique>=3.0.2-2' 'gst1-plugins-base>=1.8.0' 'gnome-desktop>=3.20.0' 'libcanberra-gtk>=0.30-12' 'xcb-util>=0.4.0-2' \
	'clutter-gtk>=1.8.0' 'gtkspell3>=3.0.7-2' 'tdb>=1.3.8-2' 'libytnef>=1.5-4')
rodepends=("$pkgname-base")
makedepends=('intltool>=0.51.0-2' 'openldap>=2.4.43-1' 'psmisc>=22.21-3' 'krb5>=1.14-1' 'openssl>=1.0.2-4' 'itstool>=2.0.2-3' \
	'yelp-tools>=3.18.0-2' 'libcryptui>=3.12.2-3' 'gnome-common' 'gtk-doc')
groups=('gnome')
archs=('i686' 'x86_64')
_F_gnome_desktop="y"
_F_gnome_iconcache="y"
_F_gnome_glib="y"
_F_gnome_devel="n"
_F_gnome_ext=".tar.xz"
Finclude gnome gnome-scriptlet
url="http://www.gnome.org/projects/evolution/"

subpkgs=("${subpkgs[@]}" "$pkgname-pst")
subdescs=("${subdescs[@]}" "PST importer plugin for Evolution")
subdepends=("${subdepends[@]}" "libpst>=0.6.54")
subrodepends=("${subrodepends[@]}" "$pkgname")
subgroups=("${subgroups[@]}" 'gnome-extra')
subarchs=("${subarchs[@]}" 'i686 x86_64')

subpkgs=("${subpkgs[@]}" "$pkgname-base")
subdescs=("${subdescs[@]}" "base library for Evolution")
subdepends=("${subdepends[@]}" "clutter-gtk>=1.8.0 evolution-data-server>=3.20.0 \
	webkit-gtk3>=2.4.9-2 libkrb5>=1.14-1 \
	evolution-data-server-ldap>=3.20.0 nss>=3.21-3 nspr>=4.11-3 \
	libnotify>=0.7.6-2 db>=6.1.26-3 networkmanager>=1.0.10-1 libcryptui")
subrodepends=("${subrodepends[@]}" "")
subgroups=("${subgroups[@]}" 'gnome')
subarchs=("${subarchs[@]}" 'i686 x86_64')

subpkgs=("${subpkgs[@]}" "$pkgname-bogofilter")
subdescs=("${subdescs[@]}" "bogofilter for Evolution")
subdepends=("${subdepends[@]}" "bogofilter")
subrodepends=("${subrodepends[@]}" "$pkgname")
subgroups=("${subgroups[@]}" 'gnome-extra')
subarchs=("${subarchs[@]}" 'i686 x86_64')

subpkgs=("${subpkgs[@]}" "$pkgname-spamassassin")
subdescs=("${subdescs[@]}" "spamassassin library for Evolution")
subdepends=("${subdepends[@]}" "spamassassin")
subrodepends=("${subrodepends[@]}" "$pkgname")
subgroups=("${subgroups[@]}" 'gnome-extra')
subarchs=("${subarchs[@]}" 'i686 x86_64')

#TODO : added mono binding

build() {
	Fcd

	# Set the distro name
	Fsed 'VERSION_COMMENT, ""' 'VERSION_COMMENT, "Frugalware Linux"' configure.ac

	NOCONFIGURE=y gnome-autogen.sh || Fdie

	#Fbuild_slice_scrollkeeper

	Fconf \
		--disable-schemas-install \
		--enable-pilot-conduits=yes \
		--enable-nss=yes \
		--enable-smime=yes \
		--datadir=/usr/share \
		--with-openldap=yes \
		--enable-nntp=yes \
		--enable-plugins=all \
		--enable-ipv6 \
		--enable-mono=no \
		--enable-exchange=yes \
		--disable-gtk-doc \
		--with-krb5=/usr \
		--disable-debug \
		--enable-file-locking=fcntl \
		--enable-dot-locking=no \
		--enable-file-chooser=yes \
		--enable-cairo-calendar=yes \
		--enable-nm \
		--enable-pst-import \
		--disable-image-inline \
		--enable-weather \
		--disable-text-highlight \
		--disable-autoar

	Fsed '.*KILL_PROCESS_CMD.*' '#define KILL_PROCESS_CMD "killall"' config.h
	make || Fdie

	Fmakeinstall GCONF_DISABLE_SCHEMA_INSTALL=1
	#TODO : Should split all plugins
	#PST
	Fsplit $pkgname-pst usr/lib/$pkgname/plugins/org-gnome-pst-import.eplug
	Fsplit $pkgname-pst usr/lib/$pkgname//plugins/liborg-gnome-pst-import.*

	#bogofilter
	Fsplit $pkgname-bogofilter usr/lib/$pkgname/modules/module-bogofilter.*

	#spamassassin
	Fsplit $pkgname-spamassassin usr/lib/$pkgname/modules/module-spamassassin.*

	#base for frontend evolution as anjal
	Fsplit $pkgname-base usr/include/evolution
	Fsplit $pkgname-base usr/lib/pkgconfig/*.pc
	Fsplit $pkgname-base usr/lib/evolution/libevolution-mail-composer.*
	Fsplit $pkgname-base usr/lib/evolution/libeabutil.*
	Fsplit $pkgname-base usr/lib/evolution/libecontacteditor.*
	Fsplit $pkgname-base usr/lib/evolution/libecontactlisteditor.*
	Fsplit $pkgname-base usr/lib/evolution/libevolution-mail-formatter.*
	Fsplit $pkgname-base usr/lib/evolution/libevolution-shell.*
	Fsplit $pkgname-base usr/lib/evolution/libessmime.*
	Fsplit $pkgname-base usr/lib/evolution/libevolution-util.*
	Fsplit $pkgname-base usr/lib/evolution/libevolution-addressbook-importers.*
	Fsplit $pkgname-base usr/lib/evolution/libevolution-calendar.*
	Fsplit $pkgname-base usr/lib/evolution/libevolution-calendar-importers.*
	Fsplit $pkgname-base usr/lib/evolution/libevolution-mail-importers.*
	Fsplit $pkgname-base usr/lib/evolution/libevolution-mail.*
	Fsplit $pkgname-base usr/lib/evolution/libevolution-smime.*

	Fbuild_gnome_scriptlet
}

sha1sums=('1e64ae91f27f223aaa6939e21e4921002c8783eb')


# optimization OK
