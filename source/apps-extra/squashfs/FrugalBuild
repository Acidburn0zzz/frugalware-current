# Compiling Time: 0.26 SBU
# Maintainer: VMiklos <vmiklos@frugalware.org>

pkgname=squashfs
pkgver=3.2_r2
kver=2.6.20-5
kdir=/lib/modules/${kver/-/-fw}/kernel/fs/squashfs
pkgrel=3
pkgdesc="A highly compressed read-only filesystem for Linux."
depends=('zlib' "kernel-fwlive=$kver")
makedepends=("kernel-fwlive-source=$kver")
groups=('apps-extra')
archs=('i686')
#_F_kernel_name="-fwlive"
Finclude sourceforge
up2date="lynx -dump http://sourceforge.net/project/showfiles.php?group_id=63835|grep squashfs[0-9]|sed 's/[^]]*][^]]*]squashfs\([^ ]*\) .*/\1/;s/-/_/g;q'"
source=(${source/squashfs-/squashfs} \
	http://$_F_sourceforge_mirror.dl.sourceforge.net/sevenzip/lzma443.tar.bz2 \
	ftp://ftp.slax.org/source/slax/kernel/2.6.20/src-core/patches/squashfs/sqlzma.tar.bz2)
options=('scriptlet')

build()
{
	mkdir lzma443
	tar -C lzma443 -xf lzma443.tar.bz2
	rm sqlzma2k-3.2-r2.patch
	cat *.patch | patch -p0 || return 1
	cp -a /usr/src/linux/ ./
	sed -i "s|KDir =.*|KDir = $Fsrcdir/linux|" Makefile
	sed -i "s|SqFs =.*|SqFs = $Fsrcdir/linux/fs/squashfs|" Makefile

	make || return 1

	Fmkdir $kdir
	Ffilerel linux/fs/squashfs/squashfs.ko $kdir
	Ffilerel lzma443/C/7zip/Compress/LZMA_C/kmod/{un,sq}lzma.ko $kdir
	Fexerel squashfs${pkgver/_/-}/squashfs-tools/{mk,un}squashfs /usr/bin/
}

sha1sums=('e38c16c09435291b2c97aa0a321c29da442ff686'\
          '1667abfb40da82d53fa2690f3cd58a0e7e751e55'\
          '85a3bb092beab15cdae0dcab799452df09f80afa')
# optimization OK
