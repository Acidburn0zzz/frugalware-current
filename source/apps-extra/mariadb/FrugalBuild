# Compiling Time: 5.57 SBU
# Maintainer: Miklos Vajna <vmiklos@frugalware.org>

pkgname=mariadb
pkgver=10.1.30
pkgrel=1
pkgdesc="A fast SQL database server"
url="https://mariadb.org"
backup=(etc/my.cnf etc/sysconfig/mysqld)
depends=('lz4')
groups=('apps-extra')
archs=('x86_64')
up2date="lynx -dump 'https://downloads.mariadb.org/mariadb/+releases/' | grep Stable | grep 10.1 | head -n 1 | cut -d ' ' -f 4 | cut -d ']' -f 2"
source=(http://ftp.hosteurope.de/mirror/mariadb.org//mariadb-${pkgver}/source/mariadb-${pkgver}.tar.gz \
        fix-lz4.patch)
sha1sums=('52d7e77ed57c08ff7a0b6cc68ebf2946deab683b' \
          '6ed6174322ed8627a13bf46b2d915f21a73fd37e')

_F_cmake_confopts="     -DENABLED_LOCAL_INFILE=ON \
                        -DWITH_EMBEDDED_SERVER=ON \
                        -DWITH_INNOBASE_STORAGE_ENGINE=ON \
                        -DWITH_SSL=system \
                        -DWITH_ZLIB=system \
                        -DINSTALL_DOCREADMEDIR=share/doc/mysql-$pkgver \
                        -DINSTALL_INCLUDEDIR=include/mysql \
                        -DINSTALL_SUPPORTFILESDIR=share/mysql \
                        -DINSTALL_PLUGINDIR=lib/mysql \
                        -DINSTALL_INFODIR=share/info \
			-DINSTALL_MANDIR=share/man \
			-DINSTALL_DOCDIR=share/docs \
                        -DINSTALL_MYSQLSHAREDIR=share/mysql \
                        -DINSTALL_SHAREDIR=share/mysql \
                        -DMYSQL_DATADIR=/var/lib/mysql \
                        -DINSTALL_SCRIPTDIR=bin \
                        -DMYSQL_UNIX_ADDR=/var/run/mysql/mysqld.sock"

_F_cmake_type=Release
Finclude cmake
options=('static')

subpkgs=('libmariadbclient' 'libmariadbd')
subdescs=('Mariadb client library.' 'Embedded MariaDB Server Library')
subdepends=('' '')
subgroups=('lib' 'lib-extra')
subarchs=('x86_64' 'x86_64')

build() {
	CMake_build
	Fsplit libmariadbclient usr/lib/libmysqlclient* usr/include/mysql
	Fsplit libmariadbd usr/lib/libmysqld.a
	Fsplit libmariadbd usr/bin/*_embedded
}

# optimization ok
