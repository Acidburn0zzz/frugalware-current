# Compiling Time: 0 SBU
# Maintainer: bouleetbil <bouleetbil@frogdev.info>

pkgname=mkinitrd
pkgver=4.2.0.3
pkgrel=1
pkgdesc="Creates an initial ramdisk image for preloading modules."
url="http://git.fedoraproject.org/git/hosted/mkinitrd"
up2date=$pkgver
source=(http://cvs.fedora.redhat.com/repo/pkgs/$pkgname/$pkgname-$pkgver.tar.bz2/2935065b63321c2406b004e05bbddc78/$pkgname-$pkgver.tar.bz2 \
mkinitrd-4.2.0.3-glibc-2.10.patch)
depends=('popt' 'util-linux' 'libnl' 'lvm2')
groups=('apps-extra')
archs=('i686')
sha1sums=('c2ceacb60bbab52fc406a77b2e8c88d119c837ef' \
          '265a43a90f870ccc1bdbc898faf7419c3a0463ef')
export CFLAGS="${CFLAGS} -Dstrndup=strndup"

build() {
	Fcd
	sed -i \
		-e '/^CFLAGS/s: -Werror::' \
		-e '/^CFLAGS/s: -g::' \
		-e '/^CFLAGS/s:=:+=:' \
		grubby/Makefile nash/Makefile || Fdie
	Fsed '$(BUILDROOT)' "$Fdestdir" nash/Makefile
	Fsed '$(BUILDROOT)' "$Fdestdir" grubby/Makefile
	Fsed '$(BUILDROOT)' "$Fdestdir" Makefile
	#We don't want mkinitrd from Redhat/Fedora just nash
	Frm /usr/bin
	Fbuild
}

# optimization OK
