# Compiling Time: 14.20 SBU
# Maintainer: boobaa <boobaa@frugalware.org>

pkgname=mongodb
pkgver=3.4.9
pkgrel=1
pkgdesc="A scalable, high-performance, open source NoSQL database"
url="http://www.mongodb.org"
up2date="lynx -dump $url/downloads | grep src- -m1 | sed 's/.*-src-r\(.*\)\.tar.*/\1/'"
groups=('apps-extra')
archs=('x86_64')
depends=('libstdc++>=6.2.1-8' 'openssl>=1.0.2-12' 'pcre' 'zlib' 'yaml-cpp' \
	'snappy>=1.1.6' 'libboost>=1.61.0-3' 'libpcap' 'libstemmer')
makedepends+=('scons' 'boost>=1.61.0-3')
source=(http://downloads.mongodb.org/src/mongodb-src-r$pkgver.tar.gz \
	fix-build-with-scons-3.0.patch \
	using-std-string.patch )
sha1sums=('547a73c80f2041fe7752b46afbcaae8bce4ed471' \
          'a6916f197720488edf9b5673c17972c27ffd6dd5' \
          '7e2dc2af8bc8b0c694c346904c6b53ff5b0df419')
options+=('static')

## TODO: - some default conf ?
##       - init service some sort ?
##       - fix C/CXX system flags

build()
{
		### F*** this scons
		Fcd $pkgname-src-r$pkgver
		Fpatchall
		Fsed '-std=c++11' '-std=gnu++11' SConstruct

		export SCONSFLAGS="$MAKEFLAGS"
		OPT="	--disable-warnings-as-errors \
			--ssl \
			--use-system-zlib \
			--use-system-pcre \
			--use-system-yaml \
			--use-system-snappy \
			--use-system-stemmer \
			--use-system-boost"

		Fexec scons all $OPT || Fdie
		Fexec scons --prefix $Fdestdir/usr $OPT --nostrip install || Fdie
}

# optimization OK
