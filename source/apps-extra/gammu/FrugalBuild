# Compiling Time: 0.27 SBU
# Maintainer: Christian Hamar alias krix <krics@linuxforum.hu>

pkgname=gammu
pkgver=1.09.00
pkgrel=1
pkgdesc="Mobile phones tools for Unix (Linux)"
url="http://www.gammu.net/projects/gammu.php"
backup=(etc/gammu/gammurc)
depends=('libmysqlclient' 'bluez-libs>=3.5' 'openssl') # depend to openssl too, if we drop mysql support
makedepends=('mysql')
groups=('apps-extra')
archs=('x86_64' 'i686')
pkgurl="http://www.mwiacek.com/zips/gsm/gammu/stable"
up2date="lynx -dump $pkgurl/\$(lynx -dump $pkgurl|sed -n 's|.*/\(.*\)/|\1|;$ p')/|grep gz$|sed -n 's/.*-\(.*\)\.t.*/\1/;$ p'"
source=($pkgurl/1_0x/$pkgname-$pkgver.tar.gz)
sha1sums=('6d740b383b38ec1176aac6e569b68fd67d149374')

build()
{
	Fsed "-O2 -fPIC -Wall -Wno-format-y2k -pthread" "$CFLAGS -fPIC -Wno-format-y2k -pthread" cfg/Makefile.cfg
	Fsed "-lbluetooth -lsdp" "-lbluetooth" cfg/Makefile.cfg
	Fsed "/etc/gammurc" "/etc/gammu/gammurc" common/gsmstate.c
	Fconf --sysconfdir=/etc/gammu --enable-cb \
		--enable-7110incoming --enable-6210calendar \
		--with-bluedir=/usr/lib --with-docdir=/usr/share/doc/$pkgname-$pkgver \
		--with-localedir=/usr/share/gammu --prefix=/usr
	Fsed "-lz  -pthread" "-lz  -lpthread -lssl" cfg/Makefile.cfg
	make || Fdie
	make DESTDIR=$Fdestdir installshared || Fdie
	Ffilerel docs/examples/config/gammurc /etc/gammu/gammurc
	chmod +x $Fdestdir/usr/lib/libGammu.so.* || Fdie
}
