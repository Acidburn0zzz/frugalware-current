--- arch/um/sys-i386/user-offsets.c.orig	2006-12-01 19:18:07.000000000 +0100
+++ arch/um/sys-i386/user-offsets.c	2006-12-01 19:19:27.000000000 +0100
@@ -11,6 +11,13 @@
 #define DEFINE_LONGS(sym, val) \
 	asm volatile("\n->" #sym " %0 " #val : : "i" (val/sizeof(unsigned long)))
 
+#undef offsetof
+#ifdef __compiler_offsetof
+#define offsetof(TYPE,MEMBER) __compiler_offsetof(TYPE,MEMBER)
+#else
+#define offsetof(TYPE, MEMBER) ((size_t) &((TYPE *)0)->MEMBER)
+#endif
+
 #define OFFSET(sym, str, mem) \
 	DEFINE(sym, offsetof(struct str, mem));
 
