# Compiling Time: 0.33 SBU
# Maintainer: DeX77 <dex77@frugalware.org>

pkgname=docker
pkgver=1.13.0
pkgextraver="49bf474"
pkgrel=3
pkgdesc="Docker - the Linux container runtime"
archs=('!i686' 'x86_64')
groups=('apps-extra')
depends=('bridge-utils' 'iproute2' 'libguestfs' 'sqlite3' 'lvm2' 'btrfs-progs>=4.8.1-2')
makedepends=('go>=1.7' 'git' 'mercurial' 'ca-certificates' 'sphinx-httpdomain' 'mkdocs' \
        'python-jinja' 'python-markupsafe' 'python-markdown' 'pyyaml' 'watchdog' 'pathtools')
_F_github_name="docker"
_F_github_author="docker"
_F_github_tag_v="y"
_F_systemd_units=(docker=)
provides=('lxc-docker')
replaces=('lxc-docker')
conflicts=('lxc-docker')
_F_archive_grepv="rc[1-9]"
Finclude github systemd
_F_cd_path="$pkgname-$pkgver"
source=(${source[@]} \
	_docker)
sha1sums=('c5db88d13e8cb092fe2af37ec7422bd4a2c54c04' \
          '47027a4c415cb1aa556e54dd0dc1c80f4fbe076a')

build() {
	Fcd
	Fpatchall

        export GOPATH="$Fsrcdir/gopath:$Fsrcdir/gopath/src/github.com/docker/docker/vendor"

        Fexec mkdir -p $Fsrcdir/gopath/src/github.com/docker
	Fexec rm -rf $Fsrcdir/gopath/src/github.com/docker/docker
        Fexec mv $Fsrcdir/$_F_github_name-$pkgver/ $Fsrcdir/gopath/src/github.com/docker/docker/

        Fcd gopath/src/github.com/docker/docker

        export DOCKER_GITCOMMIT=$pkgextraver
        Fexec ./hack/make.sh dynbinary

        Finstall 644 _docker usr/share/zsh/site-functions/_docker


        Fexe gopath/src/github.com/docker/docker/bundles/${pkgver}/dynbinary-client/docker-${pkgver} \
                        usr/sbin/docker
	Fexe gopath/src/github.com/docker/docker/bundles/${pkgver}/dynbinary-daemon/dockerd-${pkgver} \
                        usr/sbin/dockerd

        # install systemd service unit
        Finstall 644 gopath/src/github.com/docker/docker/contrib/init/systemd/docker.service lib/systemd/system/docker.service

        Finstall 644 gopath/src/github.com/docker/docker/contrib/completion/bash/docker \
                usr/share/bash-completion/completions/docker

        Fmkdir usr/share/doc/docker-${pkgver}

}

# optimization OK
