# Compiling Time: 0.03 SBU
# Maintainer: Marius Cirsta <mcirsta@frugalware.org>

## added script from gentoo to create the tarball
## on a new version get the amd64.run file..
## http://download.virtualbox.org/virtualbox/$pkgver/VirtualBox-$pkgver-<random_nr>-Linux_x86.run
## run ./create_vbox_modules_tarball.sh the_file
## upload the tarbal on genesis
## done

pkgname=virtualbox-modules
pkgver=5.1.10
pkgrel=2
pkgdesc="Kernel modules for VirtualBox"
url="http://www.virtualbox.org"
_F_kernelmod_scriptlet="$pkgname.install"
groups=('apps-extra')
archs=('i686' 'x86_64')
license=('GPL-2')
up2date="lynx -dump http://download.virtualbox.org/virtualbox/LATEST.TXT | head -n 1"
#if Getoo has the sources alread we don't need to get our own, still useful for when Gentoo doesn't already have this generated
#source=(http://ftp.frugalware.org/pub/other/sources/virtualbox/vbox-kernel-module-src-${pkgver}.tar.xz $pkgname-depmod.patch)
source=(http://dev.gentoo.org/~polynomial-c/virtualbox/vbox-kernel-module-src-${pkgver}.tar.xz $pkgname-depmod.patch $pkgname.install)
Finclude kernel-module
options+=('scriptlet')
sha1sums=('b64d8d7044b834cc172a00d26f4c253310823296' \
          '8c342e7068a235e44ec6cae33d26e3b6a27bafe4' \
          '4913e943017c14a6a49945bf0c9836feecbdfce5')

build() {
	_F_cd_path="."
	Fpatchall
	Fmkdir ${_F_kernelmod_dir}/kernel/misc

	make KERN_DIR=${_F_kernelmod_dir}/build MODULE_DIR_TST=${Fdestdir}/${_F_kernelmod_dir} \
		MODULE_DIR=${Fdestdir}/${_F_kernelmod_dir}/kernel/misc || Fdie
	make KERN_DIR=${_F_kernelmod_dir}/build MODULE_DIR_TST=${Fdestdir}/${_F_kernelmod_dir} \
		MODULE_DIR=${Fdestdir}/${_F_kernelmod_dir}/kernel/misc INSTALL_MOD_PATH=${Fdestdir} install || Fdie

	#cleanup first
	rm -rf fw_tmp || Fdie
	mkdir fw_tmp || Fdie

	cd fw_tmp || Fdie

	Fbuild_kernelmod_scriptlet

	Fkernelver_compress_modules
}

# optimization OK
