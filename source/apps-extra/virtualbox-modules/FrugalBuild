# Compiling Time: 0.03 SBU
# Maintainer: Janos Kovacs <janny@frugalware.org>

pkgname=virtualbox-modules
pkgver=2.1.0
pkgrel=4
pkgdesc="Kernel modules for VirtualBox"
url="http://www.virtualbox.org"
Finclude kernel-module
makedepends=(${makedepends[@]} 'gcc-4.1')
_F_kernelmod_scriptlet=${pkgname}.install
install=${pkgname}.install
groups=('apps-extra')
archs=('i686' 'x86_64')
license=('GPL-2')
up2date="lynx -dump ${url}|grep released|sed 's/.* \([0-9.]*\) .*/\1/;q'"
source=(http://gentoo.zerodev.it/files/vbox-kernel-module-src-${pkgver}.tar.bz2 60-virtualbox.rules ${pkgname}.install)
options=('scriptlet' 'genscriptlet')
sha1sums=('eacb4d89d7f32a51240ba72dff2cfc5a62ba2beb' \
          'b9cb188f62148603b78a0b8c04b6fff369bb7b62' \
          '452822b9d386a8f6eab953becabdf84fc89c235a')

build() {
	Fmkdir ${_F_kernelmod_dir}/kernel/misc

        make KERN_DIR=${_F_kernelmod_dir}/build MODULE_DIR_TST=${Fdestdir}/${_F_kernelmod_dir} \
                MODULE_DIR=${Fdestdir}/${_F_kernelmod_dir}/kernel/misc || Fdie
        make KERN_DIR=${_F_kernelmod_dir}/build MODULE_DIR_TST=${Fdestdir}/${_F_kernelmod_dir} \
                MODULE_DIR=${Fdestdir}/${_F_kernelmod_dir}/kernel/misc INSTALL_MOD_PATH=${Fdestdir} install || Fdie

	## udev rule
	Fexerel ${Fsrcdir}/60-virtualbox.rules /etc/udev/rules.d/60-virtualbox.rules
}

# optimalization OK - uses the kernel's option
