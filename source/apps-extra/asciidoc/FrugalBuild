# Compiling Time: 0.01 SBU
# Maintainer: voroskoi <voroskoi@frugalware.org>

pkgname=asciidoc
pkgver=8.2.1
xmlver=4.2
pkgrel=2
pkgdesc="AsciiDoc is a text document format for writing short documents, articles, books and UNIX man pages."
url="http://www.methods.co.nz/asciidoc/index.html"
depends=()
rodepends=('python>=2.3' 'libxslt')
makedepends=('imagemagick' 'libpng' 'libjpeg')
groups=('apps-extra')
archs=('i686' 'x86_64')
up2date="lynx -dump http://www.methods.co.nz/asciidoc/downloads.html |Flasttar"
source=(http://www.methods.co.nz/asciidoc/asciidoc-$pkgver.tar.gz \
	http://ftp.frugalware.org/pub/other/sources/asciidoc/asciidoc-docbook-xml-$xmlver.tar.bz2)
signatures=('' ${source[1]}.asc)

build() {
	Fmkdir $Fprefix/bin $Fprefix/share/vim
	Fsed 'BINDIR=/usr/local/bin' "BINDIR=$Fdestdir/$Fprefix/bin" install.sh
	Fsed 'MANDIR=/usr/local/man' "MANDIR=$Fdestdir/$Fprefix/man" install.sh
	Fsed 'CONFDIR=/etc/asciidoc' "CONFDIR=$Fdestdir/$Fsysconfdir/asciidoc" install.sh
	Fsed 'VIM_CONFDIR=/etc/vim' "VIM_CONFDIR=$Fdestdir/$Fprefix/share/vim" install.sh
	sh install.sh
	# provive the images in jpg format, too. this is necessary as fop can't
	# use png images without license problems for pdfs
	for i in `find $Fdestdir/etc -name '*.png'`
	do
		convert $i ${i%%.png}.jpg || return 1
	done
	# add pre-downloaded version of some dtd so that offline building of
	# manpages and fo documents will be possible
	Fcpr asciidoc-docbook-xml-$xmlver/docbook-xml /etc/asciidoc
}
