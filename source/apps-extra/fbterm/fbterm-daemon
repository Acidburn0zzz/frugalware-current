#!/bin/sh

set -e

# Refuse to run if we are not fbterm user.
#if [ "$(id -u)" -ne 85 -o "$(id -g)" -ne 85 ]; then
#  echo "$0: refusing to run as incorrect user"
#  exit 1
#fi

reduce_fraction()
{
  local factor
  local numerator
  local denominator
  local a
  local b

  factor="2"
  numerator="$1"
  denominator="$2"

  while true; do
    a="$(( $numerator % $factor ))"
    b="$(( $denominator % $factor ))"
    if [ "$a" -ne 0 -o "$b" -ne 0 ]; then
      if [ "$factor" -gt "$numerator" -o "$factor" -gt "$denominator" ]; then
        break
      fi
      factor="$(( $factor + 1 ))"
      continue
    fi
    numerator="$(( $numerator / $factor ))"
    denominator="$(( $denominator / $factor ))"
  done

  echo "${numerator}x${denominator}"
}

# Change directory to $HOME.
cd $HOME

# Collect information about the framebuffer resolution.
SIZE="$(cat /sys/class/graphics/fb0/virtual_size | tr ',' 'x')"
ASPECT="$(reduce_fraction $(echo $SIZE | cut -d 'x' -f 1) $(echo $SIZE | cut -d 'x' -f 2))"

# Clear screen first.
#echo -n -e "\e[2J"

# Move cursor to top left.
#echo -n -e "\e[1;1H"

# Hide cursor.
#echo -n -e "\e[?25l"

