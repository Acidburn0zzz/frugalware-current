diff -Naur kdebase-workspace-4.3.5/cmake/modules/CMakeLists.txt kdebase-workspace-4.3.5-p/cmake/modules/CMakeLists.txt
--- kdebase-workspace-4.3.5/cmake/modules/CMakeLists.txt	2009-05-14 19:26:20.000000000 +0200
+++ kdebase-workspace-4.3.5-p/cmake/modules/CMakeLists.txt	2010-02-13 01:09:54.000000000 +0100
@@ -7,7 +7,7 @@
                FindGooglegadgets.cmake
                FindLibXKlavier.cmake
                FindPAM.cmake
-               FindPolkitQt.cmake
+               FindPolkitQt-1.cmake
                FindQEdje.cmake
                FindSensors.cmake
                PkgConfigGetVar.cmake
diff -Naur kdebase-workspace-4.3.5/cmake/modules/FindPolkitQt-1.cmake kdebase-workspace-4.3.5-p/cmake/modules/FindPolkitQt-1.cmake
--- kdebase-workspace-4.3.5/cmake/modules/FindPolkitQt-1.cmake	1970-01-01 01:00:00.000000000 +0100
+++ kdebase-workspace-4.3.5-p/cmake/modules/FindPolkitQt-1.cmake	2010-02-13 01:09:07.000000000 +0100
@@ -0,0 +1,99 @@
+# - Try to find PolkitQt-1
+# Once done this will define
+#
+#  POLKITQT-1_FOUND - system has Polkit-qt
+#  POLKITQT-1_INCLUDE_DIR - the Polkit-qt include directory
+#  POLKITQT-1_LIBRARIES - Link these to use all Polkit-qt libs
+#  POLKITQT-1_CORE_LIBRARY - Link this to use the polkit-qt-core library only
+#  POLKITQT-1_GUI_LIBRARY - Link this to use GUI elements in polkit-qt (polkit-qt-gui)
+#  POLKITQT-1_AGENT_LIBRARY - Link this to use the agent wrapper in polkit-qt
+#  POLKITQT-1_DEFINITIONS - Compiler switches required for using Polkit-qt
+
+# Copyright (c) 2009, Dario Freddi, <drf@kde.org>
+#
+# Redistribution and use is allowed according to the terms of the BSD license.
+# For details see the accompanying COPYING-CMAKE-SCRIPTS file.
+
+if (POLKITQT-1_INCLUDE_DIR AND POLKITQT-1_LIB)
+    set(POLKITQT-1_FIND_QUIETLY TRUE)
+endif (POLKITQT-1_INCLUDE_DIR AND POLKITQT-1_LIB)
+
+if (NOT POLKITQT-1_MIN_VERSION)
+  set(POLKITQT-1_MIN_VERSION "0.95.1")
+endif (NOT POLKITQT-1_MIN_VERSION)
+
+if (NOT WIN32)
+   # use pkg-config to get the directories and then use these values
+   # in the FIND_PATH() and FIND_LIBRARY() calls
+   find_package(PkgConfig)
+   pkg_check_modules(PC_POLKITQT-1 QUIET polkit-qt-1)
+   set(POLKITQT-1_DEFINITIONS ${PC_POLKITQT-1_CFLAGS_OTHER})
+endif (NOT WIN32)
+
+find_path( POLKITQT-1_INCLUDE_DIR
+     NAMES polkitqt1-authority.h
+     PATH_SUFFIXES polkit-qt-1
+)
+
+find_path( POLKITQT-1_VERSION_FILE
+     NAMES polkitqt1-version.h
+     PATH_SUFFIXES polkit-qt-1
+)
+
+set(POLKITQT-1_VERSION_OK TRUE)
+if(POLKITQT-1_VERSION_FILE)
+  file(READ ${POLKITQT-1_INCLUDE_DIR}/polkitqt1-version.h POLKITQT-1_VERSION_CONTENT)
+  string (REGEX MATCH "POLKITQT1_VERSION_STRING \".*\"\n" POLKITQT-1_VERSION_MATCH "${POLKITQT-1_VERSION_CONTENT}")
+  
+  if(POLKITQT-1_VERSION_MATCH)
+    string(REGEX REPLACE "POLKITQT1_VERSION_STRING \"(.*)\"\n" "\\1" POLKITQT-1_VERSION ${POLKITQT-1_VERSION_MATCH})
+    if(POLKITQT-1_VERSION STRLESS "${POLKITQT-1_MIN_VERSION}")
+      set(POLKITQT-1_VERSION_OK FALSE)
+      if(PolkitQt-1_FIND_REQUIRED)
+        message(FATAL_ERROR "PolkitQt-1 version ${POLKITQT-1_VERSION} was found, but it is too old. Please install ${POLKITQT-1_MIN_VERSION} or newer.")
+      else(PolkitQt-1_FIND_REQUIRED)
+        message(STATUS "PolkitQt-1 version ${POLKITQT-1_VERSION} is too old. Please install ${POLKITQT-1_MIN_VERSION} or newer.")
+      endif(PolkitQt-1_FIND_REQUIRED)
+    endif(POLKITQT-1_VERSION STRLESS "${POLKITQT-1_MIN_VERSION}")
+  endif(POLKITQT-1_VERSION_MATCH)
+elseif(POLKITQT-1_INCLUDE_DIR)
+  # The version is so old that it does not even have the file
+  set(POLKITQT-1_VERSION_OK FALSE)
+  if(PolkitQt_FIND_REQUIRED)
+    message(FATAL_ERROR "It looks like PolkitQt-1 is too old. Please install PolkitQt-1 version ${POLKITQT-1_MIN_VERSION} or newer.")
+  else(PolkitQt_FIND_REQUIRED)
+    message(STATUS "It looks like PolkitQt-1 is too old. Please install PolkitQt-1 version ${POLKITQT-1_MIN_VERSION} or newer.")
+  endif(PolkitQt_FIND_REQUIRED)
+endif(POLKITQT-1_VERSION_FILE)
+
+find_library( POLKITQT-1_CORE_LIBRARY 
+    NAMES polkit-qt-core-1
+    HINTS ${PC_POLKITQT-1_LIBDIR}
+)
+find_library( POLKITQT-1_GUI_LIBRARY 
+    NAMES polkit-qt-gui-1
+    HINTS ${PC_POLKITQT-1_LIBDIR}
+)
+find_library( POLKITQT-1_AGENT_LIBRARY 
+    NAMES polkit-qt-agent-1
+    HINTS ${PC_POLKITQT-1_LIBDIR}
+)
+
+set(POLKITQT-1_LIBRARIES ${POLKITQT-1_GUI_LIBRARY} ${POLKITQT-1_CORE_LIBRARY} ${POLKITQT-1_AGENT_LIBRARY})
+
+include(FindPackageHandleStandardArgs)
+
+# handle the QUIETLY and REQUIRED arguments and set POLKITQT-1_FOUND to TRUE if 
+# all listed variables are TRUE
+find_package_handle_standard_args(PolkitQt-1 DEFAULT_MSG POLKITQT-1_LIBRARIES POLKITQT-1_INCLUDE_DIR POLKITQT-1_VERSION_OK)
+
+mark_as_advanced(POLKITQT-1_INCLUDE_DIR POLKITQT-1_CORE_LIBRARY POLKITQT-1_GUI_LIBRARY POLKITQT-1_LIBRARIES POLKITQT-1_VERSION_OK)
+
+if (POLKITQT-1_FOUND)
+    if (NOT PC_POLKITQT-1_PREFIX STREQUAL CMAKE_INSTALL_PREFIX)
+        message("WARNING: Installation prefix does not match PolicyKit install prefixes. You probably will need to move files installed "
+                "in POLICY_FILES_INSTALL_DIR and by dbus_add_activation_system_service to the ${PC_POLKITQT-1_PREFIX} prefix")
+    endif (NOT PC_POLKITQT-1_PREFIX STREQUAL CMAKE_INSTALL_PREFIX)
+endif (POLKITQT-1_FOUND)
+
+set(POLKITQT-1_POLICY_FILES_INSTALL_DIR ${CMAKE_INSTALL_PREFIX}/share/polkit-1/actions)
diff -Naur kdebase-workspace-4.3.5/cmake/modules/FindPolkitQt.cmake kdebase-workspace-4.3.5-p/cmake/modules/FindPolkitQt.cmake
--- kdebase-workspace-4.3.5/cmake/modules/FindPolkitQt.cmake	2009-08-27 10:17:39.000000000 +0200
+++ kdebase-workspace-4.3.5-p/cmake/modules/FindPolkitQt.cmake	1970-01-01 01:00:00.000000000 +0100
@@ -1,94 +0,0 @@
-# - Try to find Polkit-qt
-# Once done this will define
-#
-#  POLKITQT_FOUND - system has Polkit-qt
-#  POLKITQT_INCLUDE_DIR - the Polkit-qt include directory
-#  POLKITQT_LIBRARIES - Link these to use all Polkit-qt libs
-#  POLKITQT_CORE_LIBRARY
-#  POLKITQT_GUI_LIBRARY
-#  POLKITQT_DEFINITIONS - Compiler switches required for using Polkit-qt
-
-# Copyright (c) 2008, Adrien Bustany, <madcat@mymadcat.com>
-# Copyright (c) 2009, Daniel Nicoletti, <dantti85-pk@yahoo.com.br>
-# Copyright (c) 2009, Dario Freddi, <drf54321@gmail.com>
-# Copyright (c) 2009, Michal Malek, <michalm@jabster.pl>
-#
-# Redistribution and use is allowed according to the terms of the GPLv2+ license.
-
-if (POLKITQT_INCLUDE_DIR AND POLKITQT_LIB)
-    set(POLKITQT_FIND_QUIETLY TRUE)
-endif (POLKITQT_INCLUDE_DIR AND POLKITQT_LIB)
-
-include(FindPkgConfig)
-
-if (NOT POLKITQT_MIN_VERSION)
-  set(POLKITQT_MIN_VERSION "0.9.0")
-endif (NOT POLKITQT_MIN_VERSION)
-
-pkg_search_module( POLKITQT polkit-qt )
-
-if (POLKITQT_FOUND)
-    if (POLKITQT_VERSION VERSION_LESS POLKITQT_MIN_VERSION)
-        message(STATUS "Found Polkit-Qt release < ${POLKITQT_MIN_VERSION}")
-        message(STATUS "You need Polkit-Qt version ${POLKITQT_MIN_VERSION} or newer to compile this component")
-        set(POLKITQT_FOUND FALSE)
-        return()
-    else (POLKITQT_VERSION VERSION_LESS POLKITQT_MIN_VERSION)
-        message(STATUS "Found Polkit-Qt release >= ${POLKITQT_MIN_VERSION}")
-    endif (POLKITQT_VERSION VERSION_LESS POLKITQT_MIN_VERSION)
-else (POLKITQT_FOUND)
-    set(POLKITQT_FOUND FALSE)
-    message(STATUS "Cannot find Polkit-Qt library!")
-    return()
-endif (POLKITQT_FOUND)
-
-
-# find_path( POLKITQT_INCLUDE_DIR PolicyKit/policykit-qt/Polkit-qt )
-find_path( POLKITQT_INCLUDE_DIR
-    NAMES PolicyKit/polkit-qt/
-    HINTS ${POLKITQT_INCLUDEDIR}
-)
-
-find_library( POLKITQT_CORE_LIBRARY 
-    NAMES polkit-qt-core 
-    HINTS ${POLKITQT_LIBDIR}
-)
-find_library( POLKITQT_GUI_LIBRARY 
-    NAMES polkit-qt-gui 
-    HINTS ${POLKITQT_LIBDIR}
-)
-
-if (POLKITQT_INCLUDE_DIR AND POLKITQT_CORE_LIBRARY AND POLKITQT_GUI_LIBRARY)
-   set(POLKITQT_FOUND TRUE)
-else (POLKITQT_INCLUDE_DIR AND POLKITQT_CORE_LIBRARY AND POLKITQT_GUI_LIBRARY)
-   set(POLKITQT_FOUND FALSE)
-endif (POLKITQT_INCLUDE_DIR AND POLKITQT_CORE_LIBRARY AND POLKITQT_GUI_LIBRARY)
-
-set(POLKITQT_LIBRARIES ${POLKITQT_CORE_LIBRARY} ${POLKITQT_GUI_LIBRARY})
-
-set(POLKITQT_INCLUDE_DIR ${POLKITQT_INCLUDE_DIR}/PolicyKit/polkit-qt ${POLKITQT_INCLUDE_DIR}/PolicyKit/)
-
-set(POLICY_FILES_INSTALL_DIR ${POLKITQT_PREFIX}/share/PolicyKit/policy/)
-
-if (POLKITQT_FOUND)
-  if (NOT POLKITQT_FIND_QUIETLY)
-    message(STATUS "Found Polkit-Qt: ${POLKITQT_LIBRARIES}")
-  endif (NOT POLKITQT_FIND_QUIETLY)
-else (POLKITQT_FOUND)
-  if (POLKITQT_FIND_REQUIRED)
-    message(FATAL_ERROR "Could NOT find Polkit-Qt")
-  endif (POLKITQT_FIND_REQUIRED)
-endif (POLKITQT_FOUND)
-
-mark_as_advanced(POLKITQT_INCLUDE_DIR POLKITQT_LIB)
-
-macro(dbus_add_activation_system_service _sources)
-    pkg_search_module( DBUS dbus-1 )
-    foreach (_i ${_sources})
-        get_filename_component(_service_file ${_i} ABSOLUTE)
-        string(REGEX REPLACE "\\.service.*$" ".service" _output_file ${_i})
-        set(_target ${CMAKE_CURRENT_BINARY_DIR}/${_output_file})
-        configure_file(${_service_file} ${_target})
-        install(FILES ${_target} DESTINATION ${DBUS_PREFIX}/share/dbus-1/system-services )
-    endforeach (_i ${ARGN})
-endmacro(dbus_add_activation_system_service _sources)
diff -Naur kdebase-workspace-4.3.5/CMakeLists.txt kdebase-workspace-4.3.5-p/CMakeLists.txt
--- kdebase-workspace-4.3.5/CMakeLists.txt	2010-01-21 21:48:24.000000000 +0100
+++ kdebase-workspace-4.3.5-p/CMakeLists.txt	2010-02-13 01:14:11.000000000 +0100
@@ -73,8 +73,8 @@
 macro_optional_find_package(Nepomuk)
 macro_log_feature(Nepomuk_FOUND "Nepomuk" "Nepomuk Libraries" "kdelibs" FALSE "" "Required to build Nepomuk features.")
 
-macro_optional_find_package(PolkitQt)
-macro_log_feature(POLKITQT_FOUND "Polkit-Qt" "Qt Wrapper around PolicyKit" "kdesupport" FALSE "" "Required to build PolicyKit-KDE")
+macro_optional_find_package(PolkitQt-1)
+macro_log_feature(POLKITQT-1_FOUND "Polkit-Qt-1" "Qt Wrapper around Polkit" "kdesupport" FALSE "" "Required to build polkit-kde-1")
 
 include(ConfigureChecks.cmake)
 if(NOT WIN32)
@@ -133,8 +133,8 @@
   macro_optional_add_subdirectory( ksysguard )
   macro_optional_add_subdirectory( powerdevil )
   macro_optional_add_subdirectory( kwrited )
-  if(POLKITQT_FOUND)
-    macro_optional_add_subdirectory( PolicyKit-kde )
+  if(POLKITQT-1_FOUND)
+    macro_optional_add_subdirectory( polkit-kde-1 )
   endif(POLKITQT_FOUND)
 endif(NOT WIN32)
 macro_optional_add_subdirectory( krunner )
diff -Naur kdebase-workspace-4.3.5/polkit-kde-1/agent/authdetails.ui kdebase-workspace-4.3.5-p/polkit-kde-1/agent/authdetails.ui
--- kdebase-workspace-4.3.5/polkit-kde-1/agent/authdetails.ui	1970-01-01 01:00:00.000000000 +0100
+++ kdebase-workspace-4.3.5-p/polkit-kde-1/agent/authdetails.ui	2010-02-13 01:10:54.000000000 +0100
@@ -0,0 +1,91 @@
+<ui version="4.0" >
+ <class>AuthDetails</class>
+ <widget class="QWidget" name="AuthDetails" >
+  <property name="geometry" >
+   <rect>
+    <x>0</x>
+    <y>0</y>
+    <width>273</width>
+    <height>80</height>
+   </rect>
+  </property>
+  <property name="sizePolicy" >
+   <sizepolicy vsizetype="MinimumExpanding" hsizetype="MinimumExpanding" >
+    <horstretch>0</horstretch>
+    <verstretch>0</verstretch>
+   </sizepolicy>
+  </property>
+  <layout class="QGridLayout" name="gridLayout" >
+   <item row="1" column="0" >
+    <widget class="QLabel" name="label" >
+     <property name="text" >
+      <string>Application:</string>
+     </property>
+    </widget>
+   </item>
+   <item row="2" column="0" >
+    <widget class="QLabel" name="label_3" >
+     <property name="text" >
+      <string>Action:</string>
+     </property>
+    </widget>
+   </item>
+   <item row="3" column="0" >
+    <widget class="QLabel" name="vendorL" >
+     <property name="text" >
+      <string>Vendor:</string>
+     </property>
+    </widget>
+   </item>
+   <item row="3" column="1" colspan="3" >
+    <widget class="KUrlLabel" name="vendorUL" >
+     <property name="text" >
+      <string>Vendor:</string>
+     </property>
+     <property name="tipText" >
+      <string/>
+     </property>
+     <property name="useTips" >
+      <bool>true</bool>
+     </property>
+    </widget>
+   </item>
+   <item row="2" column="1" colspan="3" >
+    <widget class="KUrlLabel" name="action_label" >
+     <property name="text" >
+      <string>Action:</string>
+     </property>
+     <property name="tipText" >
+      <string/>
+     </property>
+     <property name="useTips" >
+      <bool>true</bool>
+     </property>
+    </widget>
+   </item>
+   <item row="0" column="0" colspan="4" >
+    <widget class="Line" name="line" >
+     <property name="orientation" >
+      <enum>Qt::Horizontal</enum>
+     </property>
+    </widget>
+   </item>
+   <item row="1" column="1" colspan="3" >
+    <widget class="QLabel" name="app_label" >
+     <property name="text" >
+      <string>Application:</string>
+     </property>
+    </widget>
+   </item>
+  </layout>
+ </widget>
+ <customwidgets>
+  <customwidget>
+   <class>KUrlLabel</class>
+   <extends>QLabel</extends>
+   <header>kurllabel.h</header>
+  </customwidget>
+ </customwidgets>
+ <resources/>
+ <connections/>
+</ui>
diff -Naur kdebase-workspace-4.3.5/polkit-kde-1/agent/AuthDialog.cpp kdebase-workspace-4.3.5-p/polkit-kde-1/agent/AuthDialog.cpp
--- kdebase-workspace-4.3.5/polkit-kde-1/agent/AuthDialog.cpp	1970-01-01 01:00:00.000000000 +0100
+++ kdebase-workspace-4.3.5-p/polkit-kde-1/agent/AuthDialog.cpp	2010-02-13 01:10:54.000000000 +0100
@@ -0,0 +1,332 @@
+/*  This file is part of the KDE project
+    Copyright (C) 2007-2008 Gökçen Eraslan <gokcen@pardus.org.tr>
+    Copyright (C) 2008 Dirk Mueller <mueller@kde.org>
+    Copyright (C) 2008 Daniel Nicoletti <dantti85-pk@yahoo.com.br>
+    Copyright (C) 2008 Dario Freddi <drf54321@gmail.com>
+
+    This program is free software; you can redistribute it and/or
+    modify it under the terms of the GNU General Public
+    License as published by the Free Software Foundation; either
+    version 2 of the License, or (at your option) any later version.
+
+    This library is distributed in the hope that it will be useful,
+    but WITHOUT ANY WARRANTY; without even the implied warranty of
+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+    Library General Public License for more details.
+
+    You should have received a copy of the GNU Library General Public License
+    along with this library; see the file COPYING.LIB.  If not, write to
+    the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor,
+    Boston, MA 02110-1301, USA.
+
+*/
+
+#include "AuthDialog.h"
+
+#include <QtCore/QProcess>
+#include <QtGui/QPainter>
+#include <QtGui/QStandardItemModel>
+
+#include <KDebug>
+
+#include <KToolInvocation>
+#include <KUser>
+
+#include <PolkitQt1/Authority>
+#include <PolkitQt1/Details>
+
+Q_DECLARE_METATYPE(PolkitQt1::Identity *);
+
+AuthDialog::AuthDialog(const QString &actionId,
+                       const QString &message,
+                       const QString &iconName,
+                       PolkitQt1::Details *details,
+                       QList<PolkitQt1::Identity *> identities)
+        : KDialog(0, Qt::Dialog)
+{
+    qRegisterMetaType<PolkitQt1::Identity *> ("PolkitQt1::Identity *");
+    setupUi(mainWidget());
+    // the dialog needs to be modal to darken the parent window
+    setModal(true);
+    setButtons(Ok | Cancel | Details);
+
+    if (message.isEmpty()) {
+        kWarning() << "Could not get action message for action.";
+        lblHeader->hide();
+    } else {
+        kDebug() << "Message of action: " << message;
+        lblHeader->setText("<h3>" + message + "</h3>");
+        setCaption(message);
+    }
+
+    // loads the standard key icon
+    QPixmap icon = KIconLoader::global()->loadIcon("dialog-password",
+                                                    KIconLoader::NoGroup,
+                                                    KIconLoader::SizeHuge,
+                                                    KIconLoader::DefaultState);
+    // create a painter to paint the action icon over the key icon
+    QPainter painter(&icon);
+    const int iconSize = icon.size().width();
+    // the the emblem icon to size 32
+    int overlaySize = 32;
+    // try to load the action icon
+    const QPixmap pixmap = KIconLoader::global()->loadIcon(iconName,
+                                                           KIconLoader::NoGroup,
+                                                           overlaySize,
+                                                           KIconLoader::DefaultState,
+                                                           QStringList(),
+                                                           0,
+                                                           true);
+    // if we're able to load the action icon paint it over the
+    // key icon.
+    if (!pixmap.isNull()) {
+        QPoint startPoint;
+        // bottom right corner
+        startPoint = QPoint(iconSize - overlaySize - 2,
+                            iconSize - overlaySize - 2);
+        painter.drawPixmap(startPoint, pixmap);
+    }
+
+    setWindowIcon(icon);
+    lblPixmap->setPixmap(icon);
+
+    // find action description for actionId
+    foreach(PolkitQt1::ActionDescription *desc, PolkitQt1::Authority::instance()->enumerateActionsSync()) {
+        if (desc && actionId == desc->actionId()) {
+            m_actionDescription = desc;
+            kDebug() << "Action description has been found" ;
+            break;
+        }
+    }
+
+    AuthDetails *detailsDialog = new AuthDetails(details, m_actionDescription, m_appname, this);
+    setDetailsWidget(detailsDialog);
+
+    userCB->hide();
+    lePassword->setFocus();
+
+    errorMessageKTW->hide();
+
+    m_userModelSIM = new QStandardItemModel(this);
+    m_userModelSIM->setSortRole(Qt::UserRole);
+
+    // If there is more than 1 identity we will show the combobox for user selection
+    if (identities.size() > 1) {
+        userCB->setModel(m_userModelSIM);
+
+        connect(userCB, SIGNAL(currentIndexChanged(int)),
+                this, SLOT(on_userCB_currentIndexChanged(int)));
+
+        createUserCB(identities);
+    } else {
+        userCB->setCurrentIndex(0);
+        QStandardItem *item = new QStandardItem("");
+        item->setData(qVariantFromValue<PolkitQt1::Identity *> (identities[0]), Qt::UserRole);
+        m_userModelSIM->appendRow(item);
+    }
+}
+
+AuthDialog::~AuthDialog()
+{
+}
+
+void AuthDialog::accept()
+{
+    // Do nothing, do not close the dialog. This is needed so that the dialog stays
+    return;
+}
+
+void AuthDialog::setRequest(const QString &request, bool requiresAdmin)
+{
+    kDebug() << request;
+    PolkitQt1::Identity *identity = adminUserSelected();
+    if (request.startsWith(QLatin1String("password:"), Qt::CaseInsensitive)) {
+        if (requiresAdmin) {
+            if (identity == NULL) {
+                lblPassword->setText(i18n("Password for root:"));
+            } else {
+                lblPassword->setText(i18n("Password for %1:",
+                                          identity->toString().remove("unix-user:")));
+            }
+        } else {
+            lblPassword->setText(i18n("Password:"));
+        }
+    } else if (request.startsWith(QLatin1String("password or swipe finger:"),
+                                  Qt::CaseInsensitive)) {
+        if (requiresAdmin) {
+            if (identity == NULL) {
+                lblPassword->setText(i18n("Password or swipe finger for root:"));
+            } else {
+                lblPassword->setText(i18n("Password or swipe finger for %1:",
+                                          identity->toString().remove("unix-user:")));
+            }
+        } else {
+            lblPassword->setText(i18n("Password or swipe finger:"));
+        }
+    } else {
+        lblPassword->setText(request);
+    }
+
+}
+
+void AuthDialog::setOptions()
+{
+    lblContent->setText(i18n("An application is attempting to perform an action that requires privileges."
+                             " Authentication is required to perform this action."));
+}
+
+void AuthDialog::createUserCB(QList<PolkitQt1::Identity *> identities)
+{
+    /* if we've already built the list of admin users once, then avoid
+        * doing it again.. (this is mainly used when the user entered the
+        * wrong password and the dialog is recycled)
+        */
+    if (identities.count() && (userCB->count() - 1) != identities.count()) {
+        // Clears the combobox in the case some user be added
+        m_userModelSIM->clear();
+
+        // Adds a Dummy user
+        QStandardItem *selectItem;
+        m_userModelSIM->appendRow(selectItem = new QStandardItem(i18n("Select User")));
+        selectItem->setSelectable(false);
+        selectItem->setData(QVariant(), Qt::UserRole);
+
+        // For each user
+        foreach(PolkitQt1::Identity *identity, identities) {
+            // First check to see if the user is valid
+            qDebug() << "User: " << identity;
+            KUser user(identity->toString().remove("unix-user:"));
+            if (!user.isValid()) {
+                kWarning() << "User invalid: " << user.loginName();
+                continue;
+            }
+
+            // Display user Full Name IF available
+            QString display;
+            if (!user.property(KUser::FullName).toString().isEmpty()) {
+                display = user.property(KUser::FullName).toString() + " (" + user.loginName() + ')';
+            } else {
+                display = user.loginName();
+            }
+
+            QStandardItem *item = new QStandardItem(display);
+            item->setData(qVariantFromValue<PolkitQt1::Identity *> (identity), Qt::UserRole);
+
+            // load user icon face
+            if (!user.faceIconPath().isEmpty()) {
+                item->setIcon(KIcon(user.faceIconPath()));
+            } else {
+                item->setIcon(KIcon("user-identity"));
+            }
+            // appends the user item
+            m_userModelSIM->appendRow(item);
+        }
+
+        // Show the widget and set focus
+        userCB->show();
+        userCB->setFocus();
+    }
+}
+
+PolkitQt1::Identity *AuthDialog::adminUserSelected()
+{
+    return qVariantValue<PolkitQt1::Identity *> (m_userModelSIM->data(
+                m_userModelSIM->index(userCB->currentIndex(), 0), Qt::UserRole));
+}
+
+void AuthDialog::on_userCB_currentIndexChanged(int /*index*/)
+{
+    PolkitQt1::Identity *identity = adminUserSelected();
+    // itemData is Null when "Select user" is selected
+    if (identity == NULL) {
+        lePassword->setEnabled(false);
+        lblPassword->setEnabled(false);
+        enableButtonOk(false);
+    } else {
+        lePassword->setEnabled(true);
+        lblPassword->setEnabled(true);
+        enableButtonOk(true);
+        // We need this to restart the auth with the new user
+        emit adminUserSelected(identity);
+        // git password label focus
+        lePassword->setFocus();
+    }
+}
+
+QString AuthDialog::password() const
+{
+    return lePassword->text();
+}
+
+void AuthDialog::authenticationFailure()
+{
+    lePassword->clear();
+    errorMessageKTW->setText(i18n("Authentication failure, please try again."), KTitleWidget::ErrorMessage);
+    QFont bold = font();
+    bold.setBold(true);
+    lblPassword->setFont(bold);
+    lePassword->clear();
+    lePassword->setFocus();
+}
+
+AuthDetails::AuthDetails(PolkitQt1::Details *details,
+                         PolkitQt1::ActionDescription *actionDescription,
+                         const QString &appname,
+                         QWidget *parent)
+        : QWidget(parent)
+{
+    setupUi(this);
+
+    app_label->setText(appname);
+
+    foreach(const QString &key, details->keys()) {
+        int row = gridLayout->rowCount() + 1;
+
+        QLabel *keyLabel = new QLabel(this);
+        keyLabel->setText(i18nc("%1 is the name of a detail about the current action "
+                                "provided by polkit", "%1:", key));
+        gridLayout->addWidget(keyLabel, row, 0);
+
+        QLabel *valueLabel = new QLabel(this);
+        valueLabel->setText(details->lookup(key));
+        gridLayout->addWidget(valueLabel, row, 1);
+    }
+
+    if (actionDescription) {
+        action_label->setText(actionDescription->description());
+
+        action_label->setTipText(i18n("Click to edit %1", actionDescription->actionId()));
+        action_label->setUrl(actionDescription->actionId());
+
+        QString vendor    = actionDescription->vendorName();
+        QString vendorUrl = actionDescription->vendorUrl();
+
+        if (!vendor.isEmpty()) {
+            vendorUL->setText(vendor);
+            vendorUL->setTipText(i18n("Click to open %1", vendorUrl));
+            vendorUL->setUrl(vendorUrl);
+        } else if (!vendorUrl.isEmpty()) {
+            vendorUL->setText(vendorUrl);
+            vendorUL->setTipText(i18n("Click to open %1", vendorUrl));
+            vendorUL->setUrl(vendorUrl);
+        } else {
+            vendorL->hide();
+            vendorUL->hide();
+        }
+    }
+
+    connect(vendorUL, SIGNAL(leftClickedUrl(const QString&)), SLOT(openUrl(const QString&)));
+    connect(action_label, SIGNAL(leftClickedUrl(const QString&)), SLOT(openAction(const QString&)));
+}
+
+void AuthDetails::openUrl(const QString& url)
+{
+    KToolInvocation::invokeBrowser(url);
+}
+
+void AuthDetails::openAction(const QString &url)
+{
+    QProcess::startDetached("polkit-kde-authorization", QStringList() << url);
+}
+
+#include "AuthDialog.moc"
diff -Naur kdebase-workspace-4.3.5/polkit-kde-1/agent/AuthDialog.h kdebase-workspace-4.3.5-p/polkit-kde-1/agent/AuthDialog.h
--- kdebase-workspace-4.3.5/polkit-kde-1/agent/AuthDialog.h	1970-01-01 01:00:00.000000000 +0100
+++ kdebase-workspace-4.3.5-p/polkit-kde-1/agent/AuthDialog.h	2010-02-13 01:10:54.000000000 +0100
@@ -0,0 +1,87 @@
+/*  This file is part of the KDE project
+    Copyright (C) 2007-2008 Gökçen Eraslan <gokcen@pardus.org.tr>
+    Copyright (C) 2008 Daniel Nicoletti <dantti85-pk@yahoo.com.br>
+
+    This program is free software; you can redistribute it and/or
+    modify it under the terms of the GNU General Public
+    License as published by the Free Software Foundation; either
+    version 2 of the License, or (at your option) any later version.
+
+    This library is distributed in the hope that it will be useful,
+    but WITHOUT ANY WARRANTY; without even the implied warranty of
+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+    Library General Public License for more details.
+
+    You should have received a copy of the GNU Library General Public License
+    along with this library; see the file COPYING.LIB.  If not, write to
+    the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor,
+    Boston, MA 02110-1301, USA.
+
+*/
+
+#ifndef AUTHDIALOG_H
+#define AUTHDIALOG_H
+
+#include "ui_AuthDialog.h"
+#include "ui_authdetails.h"
+
+class QStandardItemModel;
+
+namespace PolkitQt1
+{
+class Details;
+class Identity;
+class ActionDescription;
+}
+
+class AuthDialog : public KDialog, private Ui::AuthDialog
+{
+    Q_OBJECT
+public:
+    AuthDialog(const QString &actionId,
+               const QString &message,
+               const QString &iconName,
+               PolkitQt1::Details *details,
+               QList<PolkitQt1::Identity *> identities);
+    ~AuthDialog();
+
+    void setRequest(const QString &request, bool requiresAdmin);
+    void setOptions();
+    QString password() const;
+    void authenticationFailure();
+
+    PolkitQt1::Identity *adminUserSelected();
+
+    PolkitQt1::ActionDescription *m_actionDescription;
+
+signals:
+    void adminUserSelected(PolkitQt1::Identity *);
+
+public slots:
+    virtual void accept();
+
+private slots:
+    void on_userCB_currentIndexChanged(int index);
+
+private:
+    QStandardItemModel *m_userModelSIM;
+    QString m_appname;
+
+    void createUserCB(QList<PolkitQt1::Identity *> identities);
+};
+
+class AuthDetails : public QWidget, private Ui::AuthDetails
+{
+    Q_OBJECT
+public:
+    AuthDetails(PolkitQt1::Details *details,
+                PolkitQt1::ActionDescription *actionDescription,
+                const QString &appname,
+                QWidget *parent);
+
+private slots:
+    void openUrl(const QString&);
+    void openAction(const QString&);
+};
+
+#endif // AUTHDIALOG_H
diff -Naur kdebase-workspace-4.3.5/polkit-kde-1/agent/AuthDialog.ui kdebase-workspace-4.3.5-p/polkit-kde-1/agent/AuthDialog.ui
--- kdebase-workspace-4.3.5/polkit-kde-1/agent/AuthDialog.ui	1970-01-01 01:00:00.000000000 +0100
+++ kdebase-workspace-4.3.5-p/polkit-kde-1/agent/AuthDialog.ui	2010-02-13 01:10:54.000000000 +0100
@@ -0,0 +1,146 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<ui version="4.0">
+ <class>AuthDialog</class>
+ <widget class="QWidget" name="AuthDialog">
+  <property name="geometry">
+   <rect>
+    <x>0</x>
+    <y>0</y>
+    <width>335</width>
+    <height>193</height>
+   </rect>
+  </property>
+  <property name="sizePolicy">
+   <sizepolicy hsizetype="MinimumExpanding" vsizetype="MinimumExpanding">
+    <horstretch>0</horstretch>
+    <verstretch>0</verstretch>
+   </sizepolicy>
+  </property>
+  <layout class="QGridLayout" name="gridLayout">
+   <item row="0" column="0" rowspan="5">
+    <layout class="QVBoxLayout" name="verticalLayout">
+     <item>
+      <widget class="QLabel" name="lblPixmap">
+       <property name="sizePolicy">
+        <sizepolicy hsizetype="Preferred" vsizetype="Preferred">
+         <horstretch>0</horstretch>
+         <verstretch>0</verstretch>
+        </sizepolicy>
+       </property>
+       <property name="text">
+        <string/>
+       </property>
+       <property name="wordWrap">
+        <bool>false</bool>
+       </property>
+       <property name="buddy">
+        <cstring>lePassword</cstring>
+       </property>
+      </widget>
+     </item>
+     <item>
+      <spacer name="verticalSpacer">
+       <property name="orientation">
+        <enum>Qt::Vertical</enum>
+       </property>
+       <property name="sizeHint" stdset="0">
+        <size>
+         <width>20</width>
+         <height>92</height>
+        </size>
+       </property>
+      </spacer>
+     </item>
+    </layout>
+   </item>
+   <item row="0" column="1" colspan="3">
+    <layout class="QVBoxLayout" name="verticalLayout_2">
+     <item>
+      <widget class="QLabel" name="lblHeader">
+       <property name="sizePolicy">
+        <sizepolicy hsizetype="MinimumExpanding" vsizetype="MinimumExpanding">
+         <horstretch>0</horstretch>
+         <verstretch>0</verstretch>
+        </sizepolicy>
+       </property>
+       <property name="text">
+        <string/>
+       </property>
+       <property name="wordWrap">
+        <bool>true</bool>
+       </property>
+       <property name="buddy">
+        <cstring>lePassword</cstring>
+       </property>
+      </widget>
+     </item>
+     <item>
+      <widget class="QLabel" name="lblContent">
+       <property name="sizePolicy">
+        <sizepolicy hsizetype="MinimumExpanding" vsizetype="MinimumExpanding">
+         <horstretch>0</horstretch>
+         <verstretch>0</verstretch>
+        </sizepolicy>
+       </property>
+       <property name="text">
+        <string/>
+       </property>
+       <property name="wordWrap">
+        <bool>true</bool>
+       </property>
+      </widget>
+     </item>
+    </layout>
+   </item>
+   <item row="2" column="1" colspan="3">
+    <widget class="KTitleWidget" name="errorMessageKTW"/>
+   </item>
+   <item row="3" column="1" colspan="2">
+    <widget class="QLabel" name="lblPassword">
+     <property name="text">
+      <string>Password:</string>
+     </property>
+     <property name="buddy">
+      <cstring>lePassword</cstring>
+     </property>
+    </widget>
+   </item>
+   <item row="3" column="3">
+    <widget class="KLineEdit" name="lePassword">
+     <property name="echoMode">
+      <enum>QLineEdit::Password</enum>
+     </property>
+     <property name="passwordMode">
+      <bool>true</bool>
+     </property>
+    </widget>
+   </item>
+   <item row="1" column="1" colspan="3">
+    <widget class="KComboBox" name="userCB"/>
+   </item>
+  </layout>
+ </widget>
+ <customwidgets>
+  <customwidget>
+   <class>KTitleWidget</class>
+   <extends>QWidget</extends>
+   <header>ktitlewidget.h</header>
+  </customwidget>
+  <customwidget>
+   <class>KLineEdit</class>
+   <extends>QLineEdit</extends>
+   <header>klineedit.h</header>
+  </customwidget>
+  <customwidget>
+   <class>KComboBox</class>
+   <extends>QComboBox</extends>
+   <header>kcombobox.h</header>
+  </customwidget>
+ </customwidgets>
+ <tabstops>
+  <tabstop>userCB</tabstop>
+  <tabstop>lePassword</tabstop>
+ </tabstops>
+ <resources/>
+ <connections/>
+</ui>
diff -Naur kdebase-workspace-4.3.5/polkit-kde-1/agent/CMakeLists.txt kdebase-workspace-4.3.5-p/polkit-kde-1/agent/CMakeLists.txt
--- kdebase-workspace-4.3.5/polkit-kde-1/agent/CMakeLists.txt	1970-01-01 01:00:00.000000000 +0100
+++ kdebase-workspace-4.3.5-p/polkit-kde-1/agent/CMakeLists.txt	2010-02-13 01:10:54.000000000 +0100
@@ -0,0 +1,28 @@
+set(policykit_SRCS
+    policykitkde.cpp
+    policykitlistener.cpp
+    main.cpp
+    AuthDialog.cpp
+)
+
+kde4_add_ui_files(policykit_SRCS AuthDialog.ui authdetails.ui)
+
+kde4_add_executable(polkit-kde-authentication-agent-1 ${policykit_SRCS})
+
+target_link_libraries(polkit-kde-authentication-agent-1
+                                         ${KDE4_KDEUI_LIBS}
+                                         ${POLKITQT-1_AGENT_LIBRARY}
+)
+
+configure_file(polkit-kde-authentication-agent-1.desktop.in ${CMAKE_BINARY_DIR}/polkit-kde-authentication-agent-1.desktop)
+
+install(TARGETS polkit-kde-authentication-agent-1 DESTINATION ${LIBEXEC_INSTALL_DIR})
+
+# Install .desktop file to the XDG_CONFIG_DIRS if exists, to the /etc/xdg/autostart otherwise
+set (DESKTOP_INSTALL_DIR $ENV{XDG_CONFIG_DIRS})
+if (DESKTOP_INSTALL_DIR)
+else (DESKTOP_INSTALL_DIR)
+  set (DESKTOP_INSTALL_DIR /etc/xdg/autostart)
+endif (DESKTOP_INSTALL_DIR)
+
+install(FILES ${CMAKE_BINARY_DIR}/polkit-kde-authentication-agent-1.desktop DESTINATION ${DESKTOP_INSTALL_DIR})
diff -Naur kdebase-workspace-4.3.5/polkit-kde-1/agent/main.cpp kdebase-workspace-4.3.5-p/polkit-kde-1/agent/main.cpp
--- kdebase-workspace-4.3.5/polkit-kde-1/agent/main.cpp	1970-01-01 01:00:00.000000000 +0100
+++ kdebase-workspace-4.3.5-p/polkit-kde-1/agent/main.cpp	2010-02-13 01:10:54.000000000 +0100
@@ -0,0 +1,43 @@
+/*  This file is part of the KDE project
+    Copyright (C) 2009 Jaroslav Reznik <jreznik@redhat.com>
+
+    This program is free software; you can redistribute it and/or
+    modify it under the terms of the GNU General Public
+    License as published by the Free Software Foundation; either
+    version 2 of the License, or (at your option) any later version.
+
+    This library is distributed in the hope that it will be useful,
+    but WITHOUT ANY WARRANTY; without even the implied warranty of
+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+    Library General Public License for more details.
+
+    You should have received a copy of the GNU Library General Public License
+    along with this library; see the file COPYING.LIB.  If not, write to
+    the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor,
+    Boston, MA 02110-1301, USA.
+
+*/
+
+#include <KCmdLineArgs>
+#include <KAboutData>
+#include <KLocale>
+
+#include "policykitkde.h"
+
+int main(int argc, char *argv[])
+{
+    KAboutData aboutData("policykit1-kde", "polkit-kde-authentication-agent-1", ki18n("PolicyKit1-KDE"), "0.1",
+                         ki18n("PolicyKit1-KDE"), KAboutData::License_GPL,
+                         ki18n("(c) 2009 Red Hat, Inc."));
+    aboutData.addAuthor(ki18n("Jaroslav Reznik"), ki18n("Maintainer"), "jreznik@redhat.com");
+
+    KCmdLineArgs::init(argc, argv, &aboutData);
+
+    if (!PolicyKitKDE::start()) {
+        qWarning("PolicyKitKDE is already running!\n");
+        return 0;
+    }
+
+    PolicyKitKDE agent;
+    agent.exec();
+}
diff -Naur kdebase-workspace-4.3.5/polkit-kde-1/agent/Messages.sh kdebase-workspace-4.3.5-p/polkit-kde-1/agent/Messages.sh
--- kdebase-workspace-4.3.5/polkit-kde-1/agent/Messages.sh	1970-01-01 01:00:00.000000000 +0100
+++ kdebase-workspace-4.3.5-p/polkit-kde-1/agent/Messages.sh	2010-02-13 01:10:54.000000000 +0100
@@ -0,0 +1,4 @@
+#! /bin/sh
+$EXTRACTRC `find -name \*.ui -o -name \*.rc -o -name \*.kcfg` >> rc.cpp || exit 11
+$XGETTEXT `find -name \*.cpp -o -name \*.h` -o $podir/polkit-kde-authentication-agent-1.pot
+rm -f rc.cpp
diff -Naur kdebase-workspace-4.3.5/polkit-kde-1/agent/policykitkde.cpp kdebase-workspace-4.3.5-p/polkit-kde-1/agent/policykitkde.cpp
--- kdebase-workspace-4.3.5/polkit-kde-1/agent/policykitkde.cpp	1970-01-01 01:00:00.000000000 +0100
+++ kdebase-workspace-4.3.5-p/polkit-kde-1/agent/policykitkde.cpp	2010-02-13 01:10:54.000000000 +0100
@@ -0,0 +1,47 @@
+/*  This file is part of the KDE project
+    Copyright (C) 2009 Jaroslav Reznik <jreznik@redhat.com>
+
+    This program is free software; you can redistribute it and/or
+    modify it under the terms of the GNU General Public
+    License as published by the Free Software Foundation; either
+    version 2 of the License, or (at your option) any later version.
+
+    This library is distributed in the hope that it will be useful,
+    but WITHOUT ANY WARRANTY; without even the implied warranty of
+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+    Library General Public License for more details.
+
+    You should have received a copy of the GNU Library General Public License
+    along with this library; see the file COPYING.LIB.  If not, write to
+    the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor,
+    Boston, MA 02110-1301, USA.
+
+*/
+
+#include "policykitkde.h"
+
+#include <KDebug>
+#include <PolkitQt1/Subject>
+
+PolicyKitKDE::PolicyKitKDE()
+        : m_listener(new PolicyKitListener(this))
+{
+    setQuitOnLastWindowClosed(false);
+
+    PolkitQt1::UnixSessionSubject *session;
+    session = new PolkitQt1::UnixSessionSubject(getpid());
+
+    bool result = m_listener->registerListener(session, "/org/kde/PolicyKit1/AuthenticationAgent");
+
+    kDebug() << result;
+
+    if (!result) {
+        kDebug() << "Couldn't register listener!";
+        exit(1);
+    }
+}
+
+PolicyKitKDE::~PolicyKitKDE()
+{
+    m_listener->deleteLater();
+}
diff -Naur kdebase-workspace-4.3.5/polkit-kde-1/agent/policykitkde.h kdebase-workspace-4.3.5-p/polkit-kde-1/agent/policykitkde.h
--- kdebase-workspace-4.3.5/polkit-kde-1/agent/policykitkde.h	1970-01-01 01:00:00.000000000 +0100
+++ kdebase-workspace-4.3.5-p/polkit-kde-1/agent/policykitkde.h	2010-02-13 01:10:54.000000000 +0100
@@ -0,0 +1,38 @@
+/*  This file is part of the KDE project
+    Copyright (C) 2009 Jaroslav Reznik <jreznik@redhat.com>
+
+    This program is free software; you can redistribute it and/or
+    modify it under the terms of the GNU General Public
+    License as published by the Free Software Foundation; either
+    version 2 of the License, or (at your option) any later version.
+
+    This library is distributed in the hope that it will be useful,
+    but WITHOUT ANY WARRANTY; without even the implied warranty of
+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+    Library General Public License for more details.
+
+    You should have received a copy of the GNU Library General Public License
+    along with this library; see the file COPYING.LIB.  If not, write to
+    the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor,
+    Boston, MA 02110-1301, USA.
+
+*/
+
+#ifndef POLICYKITKDE_H
+#define POLICYKITKDE_H
+
+#include <KUniqueApplication>
+
+#include "policykitlistener.h"
+
+class PolicyKitKDE : public KUniqueApplication
+{
+    Q_OBJECT
+public:
+    PolicyKitKDE();
+    virtual ~PolicyKitKDE();
+private:
+    PolicyKitListener *m_listener;
+};
+
+#endif
diff -Naur kdebase-workspace-4.3.5/polkit-kde-1/agent/policykitlistener.cpp kdebase-workspace-4.3.5-p/polkit-kde-1/agent/policykitlistener.cpp
--- kdebase-workspace-4.3.5/polkit-kde-1/agent/policykitlistener.cpp	1970-01-01 01:00:00.000000000 +0100
+++ kdebase-workspace-4.3.5-p/polkit-kde-1/agent/policykitlistener.cpp	2010-02-13 01:10:54.000000000 +0100
@@ -0,0 +1,205 @@
+/*  This file is part of the KDE project
+    Copyright (C) 2009 Jaroslav Reznik <jreznik@redhat.com>
+
+    This program is free software; you can redistribute it and/or
+    modify it under the terms of the GNU General Public
+    License as published by the Free Software Foundation; either
+    version 2 of the License, or (at your option) any later version.
+
+    This library is distributed in the hope that it will be useful,
+    but WITHOUT ANY WARRANTY; without even the implied warranty of
+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+    Library General Public License for more details.
+
+    You should have received a copy of the GNU Library General Public License
+    along with this library; see the file COPYING.LIB.  If not, write to
+    the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor,
+    Boston, MA 02110-1301, USA.
+
+*/
+
+#include "policykitlistener.h"
+#include "AuthDialog.h"
+
+#include <KDebug>
+#include <KWindowSystem>
+
+#include <PolkitQt1/Agent/Listener>
+#include <PolkitQt1/Agent/Session>
+#include <PolkitQt1/Subject>
+#include <PolkitQt1/Identity>
+#include <PolkitQt1/Details>
+
+PolicyKitListener::PolicyKitListener(QObject *parent)
+        : Listener(parent)
+        , m_inProgress(false)
+        , m_selectedUser(0)
+{
+}
+
+PolicyKitListener::~PolicyKitListener()
+{
+}
+
+void PolicyKitListener::initiateAuthentication(const QString &actionId,
+        const QString &message,
+        const QString &iconName,
+        PolkitQt1::Details *details,
+        const QString &cookie,
+        QList<PolkitQt1::Identity *> identities,
+        PolkitQt1::Agent::AsyncResult* result)
+{
+    kDebug() << "Initiating authentication";
+
+    if (m_inProgress) {
+        result->setError(i18n("Another client is already authenticating, please try again later."));
+        result->setCompleted();
+        kDebug() << "Another client is already authenticating, please try again later.";
+        return;
+    }
+
+    m_identities = identities;
+    m_cookie = cookie;
+    m_result = result;
+    m_session = 0;
+    if (identities.length() == 1) {
+        m_selectedUser = identities[0];
+    } else {
+        m_selectedUser = 0;
+    }
+
+    m_inProgress = true;
+
+    m_dialog = new AuthDialog(actionId, message, iconName, details, identities);
+    connect(m_dialog, SIGNAL(okClicked()), SLOT(dialogAccepted()));
+    connect(m_dialog, SIGNAL(cancelClicked()), SLOT(dialogCanceled()));
+    connect(m_dialog, SIGNAL(adminUserSelected(PolkitQt1::Identity *)), SLOT(userSelected(PolkitQt1::Identity *)));
+
+    m_dialog->setOptions();
+    m_dialog->show();
+    m_dialog->raise();
+    KWindowSystem::raiseWindow(m_dialog.data()->winId());
+
+    m_numTries = 0;
+    tryAgain();
+}
+
+void PolicyKitListener::tryAgain()
+{
+    kDebug() << "Trying again";
+//  test!!!
+    m_wasCancelled = false;
+
+    // We will create new session only when some user is selected
+    if (m_selectedUser != 0) {
+        m_session = new Session(m_selectedUser, m_cookie, m_result);
+        connect(m_session, SIGNAL(request(QString, bool)), this, SLOT(request(QString, bool)));
+        connect(m_session, SIGNAL(completed(bool)), this, SLOT(completed(bool)));
+        connect(m_session, SIGNAL(showError(QString)), this, SLOT(showError(QString)));
+
+        m_session->initiate();
+    }
+
+}
+
+void PolicyKitListener::finishObtainPrivilege()
+{
+    kDebug() << "Finishing obtaining privileges";
+
+    // Number of tries increase only when some user is selected
+    if (m_selectedUser != 0) {
+        m_numTries++;
+    }
+
+    if (!m_gainedAuthorization && !m_wasCancelled && !m_dialog.isNull()) {
+        m_dialog->authenticationFailure();
+
+        if (m_numTries < 3) {
+            m_session.data()->deleteLater();
+
+            tryAgain();
+            return;
+        }
+    }
+
+    if (!m_session.isNull()) {
+        m_session.data()->result()->setCompleted();
+    } else {
+        m_result->setCompleted();
+    }
+
+    if (m_dialog) {
+        m_dialog.data()->hide();
+        m_dialog.data()->deleteLater();
+    }
+
+    m_inProgress = false;
+
+    kDebug() << "Finish obtain authorization:" << m_gainedAuthorization;
+}
+
+bool PolicyKitListener::initiateAuthenticationFinish()
+{
+    kDebug() << "Finishing authentication";
+    return true;
+}
+
+void PolicyKitListener::cancelAuthentication()
+{
+    kDebug() << "Cancelling authentication";
+
+    m_wasCancelled = true;
+    finishObtainPrivilege();
+}
+
+void PolicyKitListener::request(const QString &request, bool echo)
+{
+    kDebug() << "Request: " << request;
+
+    if (m_dialog) {
+        m_dialog->setRequest(request, echo);
+    }
+}
+
+void PolicyKitListener::completed(bool gainedAuthorization)
+{
+    kDebug() << "Completed: " << gainedAuthorization;
+
+    m_gainedAuthorization = gainedAuthorization;
+
+    finishObtainPrivilege();
+}
+
+void PolicyKitListener::showError(const QString &text)
+{
+    kDebug() << "Error: " << text;
+}
+
+void PolicyKitListener::dialogAccepted()
+{
+    kDebug() << "Dialog accepted";
+
+    m_session->setResponse(m_dialog->password());
+}
+
+void PolicyKitListener::dialogCanceled()
+{
+    kDebug() << "Dialog cancelled";
+
+    m_wasCancelled = true;
+    if (!m_session.isNull()) {
+        m_session->cancel();
+    }
+
+    finishObtainPrivilege();
+}
+
+void PolicyKitListener::userSelected(PolkitQt1::Identity *identity)
+{
+    m_selectedUser = identity;
+    // If some user is selected we must destroy existing session
+    if (!m_session.isNull()) {
+        m_session.data()->deleteLater();
+    }
+    tryAgain();
+}
diff -Naur kdebase-workspace-4.3.5/polkit-kde-1/agent/policykitlistener.h kdebase-workspace-4.3.5-p/polkit-kde-1/agent/policykitlistener.h
--- kdebase-workspace-4.3.5/polkit-kde-1/agent/policykitlistener.h	1970-01-01 01:00:00.000000000 +0100
+++ kdebase-workspace-4.3.5-p/polkit-kde-1/agent/policykitlistener.h	2010-02-13 01:10:54.000000000 +0100
@@ -0,0 +1,74 @@
+#ifndef POLICYKITLISTENER_H
+#define POLICYKITLISTENER_H
+
+/*  This file is part of the KDE project
+    Copyright (C) 2009 Jaroslav Reznik <jreznik@redhat.com>
+
+    This program is free software; you can redistribute it and/or
+    modify it under the terms of the GNU General Public
+    License as published by the Free Software Foundation; either
+    version 2 of the License, or (at your option) any later version.
+
+    This library is distributed in the hope that it will be useful,
+    but WITHOUT ANY WARRANTY; without even the implied warranty of
+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+    Library General Public License for more details.
+
+    You should have received a copy of the GNU Library General Public License
+    along with this library; see the file COPYING.LIB.  If not, write to
+    the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor,
+    Boston, MA 02110-1301, USA.
+
+*/
+
+#include <PolkitQt1/Agent/Listener>
+#include <QtCore/QPointer>
+
+class AuthDialog;
+
+using namespace PolkitQt1::Agent;
+
+class PolicyKitListener : public Listener
+{
+    Q_OBJECT
+public:
+    PolicyKitListener(QObject *parent = 0);
+    virtual ~PolicyKitListener();
+
+public slots:
+    void initiateAuthentication(const QString &actionId,
+                                const QString &message,
+                                const QString &iconName,
+                                PolkitQt1::Details *details,
+                                const QString &cookie,
+                                QList<PolkitQt1::Identity *> identities,
+                                PolkitQt1::Agent::AsyncResult* result);
+    bool initiateAuthenticationFinish();
+    void cancelAuthentication();
+
+    void tryAgain();
+    void finishObtainPrivilege();
+
+    void request(const QString &request, bool echo);
+    void completed(bool gainedAuthorization);
+    void showError(const QString &text);
+    /*    void showInfo(const QString &text);    */
+private:
+    QPointer<AuthDialog> m_dialog;
+    QPointer<Session> m_session;
+    bool m_inProgress;
+    bool m_gainedAuthorization;
+    bool m_wasCancelled;
+    int m_numTries;
+    QList<PolkitQt1::Identity *> m_identities;
+    PolkitQt1::Agent::AsyncResult* m_result;
+    QString m_cookie;
+    PolkitQt1::Identity *m_selectedUser;
+
+private slots:
+    void dialogAccepted();
+    void dialogCanceled();
+    void userSelected(PolkitQt1::Identity *identity);
+};
+
+#endif
diff -Naur kdebase-workspace-4.3.5/polkit-kde-1/agent/polkit-kde-authentication-agent-1.desktop.in kdebase-workspace-4.3.5-p/polkit-kde-1/agent/polkit-kde-authentication-agent-1.desktop.in
--- kdebase-workspace-4.3.5/polkit-kde-1/agent/polkit-kde-authentication-agent-1.desktop.in	1970-01-01 01:00:00.000000000 +0100
+++ kdebase-workspace-4.3.5-p/polkit-kde-1/agent/polkit-kde-authentication-agent-1.desktop.in	2010-02-13 01:10:54.000000000 +0100
@@ -0,0 +1,24 @@
+
+[Desktop Entry]
+Name=PolicyKit Authentication Agent
+Name[da]=PolicyKit autentificeringsagent
+Name[en_GB]=PolicyKit Authentication Agent
+Name[et]=PolicyKiti autentimisagent
+Name[pt]=Agente de Autenticação do PolicyKit
+Name[sv]=Policykit behörighetskontrollverktyg
+Name[uk]=Агент розпізнавання PolicyKit
+Name[x-test]=xxPolicyKit Authentication Agentxx
+Comment=PolicyKit Authentication Agent
+Comment[da]=PolicyKit autentificeringsagent
+Comment[en_GB]=PolicyKit Authentication Agent
+Comment[et]=PolicyKiti autentimisagent
+Comment[pt]=Agente de Autenticação do PolicyKit
+Comment[sv]=Policykit behörighetskontrollverktyg
+Comment[uk]=Агент розпізнавання PolicyKit
+Comment[x-test]=xxPolicyKit Authentication Agentxx
+Exec=${LIBEXEC_INSTALL_DIR}/polkit-kde-authentication-agent-1
+Terminal=false
+Type=Application
+Categories=
+X-Desktop-File-Install-Version=0.15
+OnlyShowIn=KDE;
diff -Naur kdebase-workspace-4.3.5/polkit-kde-1/agent/README.porting kdebase-workspace-4.3.5-p/polkit-kde-1/agent/README.porting
--- kdebase-workspace-4.3.5/polkit-kde-1/agent/README.porting	1970-01-01 01:00:00.000000000 +0100
+++ kdebase-workspace-4.3.5-p/polkit-kde-1/agent/README.porting	2010-02-13 01:10:54.000000000 +0100
@@ -0,0 +1,11 @@
+README.porting
+
+This is initial port to Policy Kit 1.
+
+It needs latest polkit-qt library from work branch.
+
+It contains old code, currently only main.cpp and 
+policykitlistener.cpp are used. Other files will be
+changed according needs.
+
+Jaroslav
\ Kein Zeilenumbruch am Dateiende.
diff -Naur kdebase-workspace-4.3.5/polkit-kde-1/CMakeLists.txt kdebase-workspace-4.3.5-p/polkit-kde-1/CMakeLists.txt
--- kdebase-workspace-4.3.5/polkit-kde-1/CMakeLists.txt	1970-01-01 01:00:00.000000000 +0100
+++ kdebase-workspace-4.3.5-p/polkit-kde-1/CMakeLists.txt	2010-02-13 01:12:02.000000000 +0100
@@ -0,0 +1,17 @@
+macro(dbus_add_activation_system_service _sources)
+    pkg_search_module( DBUS dbus-1 )
+    foreach (_i ${_sources})
+        get_filename_component(_service_file ${_i} ABSOLUTE)
+        string(REGEX REPLACE "\\.service.*$" ".service" _output_file ${_i})
+        set(_target ${CMAKE_CURRENT_BINARY_DIR}/${_output_file})
+        configure_file(${_service_file} ${_target})
+        install(FILES ${_target} DESTINATION ${DBUS_PREFIX}/share/dbus-1/system-services )
+    endforeach (_i ${ARGN})
+endmacro(dbus_add_activation_system_service _sources)
+
+include_directories(${KDE4_INCLUDES}
+                    ${POLKITQT-1_INCLUDE_DIR})
+
+macro_optional_add_subdirectory(agent)
+macro_optional_add_subdirectory(kcmodules)
+
diff -Naur kdebase-workspace-4.3.5/polkit-kde-1/COPYING kdebase-workspace-4.3.5-p/polkit-kde-1/COPYING
--- kdebase-workspace-4.3.5/polkit-kde-1/COPYING	1970-01-01 01:00:00.000000000 +0100
+++ kdebase-workspace-4.3.5-p/polkit-kde-1/COPYING	2010-02-13 01:10:55.000000000 +0100
@@ -0,0 +1,346 @@
+NOTE! The GPL below is copyrighted by the Free Software Foundation, but
+the instance of code that it refers to (the kde programs) are copyrighted
+by the authors who actually wrote it.
+
+---------------------------------------------------------------------------
+			
+		    GNU GENERAL PUBLIC LICENSE
+		       Version 2, June 1991
+
+ Copyright (C) 1989, 1991 Free Software Foundation, Inc.
+               51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA
+ Everyone is permitted to copy and distribute verbatim copies
+ of this license document, but changing it is not allowed.
+
+			    Preamble
+
+  The licenses for most software are designed to take away your
+freedom to share and change it.  By contrast, the GNU General Public
+License is intended to guarantee your freedom to share and change free
+software--to make sure the software is free for all its users.  This
+General Public License applies to most of the Free Software
+Foundation's software and to any other program whose authors commit to
+using it.  (Some other Free Software Foundation software is covered by
+the GNU Library General Public License instead.)  You can apply it to
+your programs, too.
+
+  When we speak of free software, we are referring to freedom, not
+price.  Our General Public Licenses are designed to make sure that you
+have the freedom to distribute copies of free software (and charge for
+this service if you wish), that you receive source code or can get it
+if you want it, that you can change the software or use pieces of it
+in new free programs; and that you know you can do these things.
+
+  To protect your rights, we need to make restrictions that forbid
+anyone to deny you these rights or to ask you to surrender the rights.
+These restrictions translate to certain responsibilities for you if you
+distribute copies of the software, or if you modify it.
+
+  For example, if you distribute copies of such a program, whether
+gratis or for a fee, you must give the recipients all the rights that
+you have.  You must make sure that they, too, receive or can get the
+source code.  And you must show them these terms so they know their
+rights.
+
+  We protect your rights with two steps: (1) copyright the software, and
+(2) offer you this license which gives you legal permission to copy,
+distribute and/or modify the software.
+
+  Also, for each author's protection and ours, we want to make certain
+that everyone understands that there is no warranty for this free
+software.  If the software is modified by someone else and passed on, we
+want its recipients to know that what they have is not the original, so
+that any problems introduced by others will not reflect on the original
+authors' reputations.
+
+  Finally, any free program is threatened constantly by software
+patents.  We wish to avoid the danger that redistributors of a free
+program will individually obtain patent licenses, in effect making the
+program proprietary.  To prevent this, we have made it clear that any
+patent must be licensed for everyone's free use or not licensed at all.
+
+  The precise terms and conditions for copying, distribution and
+modification follow.
+
+		    GNU GENERAL PUBLIC LICENSE
+   TERMS AND CONDITIONS FOR COPYING, DISTRIBUTION AND MODIFICATION
+
+  0. This License applies to any program or other work which contains
+a notice placed by the copyright holder saying it may be distributed
+under the terms of this General Public License.  The "Program", below,
+refers to any such program or work, and a "work based on the Program"
+means either the Program or any derivative work under copyright law:
+that is to say, a work containing the Program or a portion of it,
+either verbatim or with modifications and/or translated into another
+language.  (Hereinafter, translation is included without limitation in
+the term "modification".)  Each licensee is addressed as "you".
+
+Activities other than copying, distribution and modification are not
+covered by this License; they are outside its scope.  The act of
+running the Program is not restricted, and the output from the Program
+is covered only if its contents constitute a work based on the
+Program (independent of having been made by running the Program).
+Whether that is true depends on what the Program does.
+
+  1. You may copy and distribute verbatim copies of the Program's
+source code as you receive it, in any medium, provided that you
+conspicuously and appropriately publish on each copy an appropriate
+copyright notice and disclaimer of warranty; keep intact all the
+notices that refer to this License and to the absence of any warranty;
+and give any other recipients of the Program a copy of this License
+along with the Program.
+
+You may charge a fee for the physical act of transferring a copy, and
+you may at your option offer warranty protection in exchange for a fee.
+
+  2. You may modify your copy or copies of the Program or any portion
+of it, thus forming a work based on the Program, and copy and
+distribute such modifications or work under the terms of Section 1
+above, provided that you also meet all of these conditions:
+
+    a) You must cause the modified files to carry prominent notices
+    stating that you changed the files and the date of any change.
+
+    b) You must cause any work that you distribute or publish, that in
+    whole or in part contains or is derived from the Program or any
+    part thereof, to be licensed as a whole at no charge to all third
+    parties under the terms of this License.
+
+    c) If the modified program normally reads commands interactively
+    when run, you must cause it, when started running for such
+    interactive use in the most ordinary way, to print or display an
+    announcement including an appropriate copyright notice and a
+    notice that there is no warranty (or else, saying that you provide
+    a warranty) and that users may redistribute the program under
+    these conditions, and telling the user how to view a copy of this
+    License.  (Exception: if the Program itself is interactive but
+    does not normally print such an announcement, your work based on
+    the Program is not required to print an announcement.)
+
+These requirements apply to the modified work as a whole.  If
+identifiable sections of that work are not derived from the Program,
+and can be reasonably considered independent and separate works in
+themselves, then this License, and its terms, do not apply to those
+sections when you distribute them as separate works.  But when you
+distribute the same sections as part of a whole which is a work based
+on the Program, the distribution of the whole must be on the terms of
+this License, whose permissions for other licensees extend to the
+entire whole, and thus to each and every part regardless of who wrote it.
+
+Thus, it is not the intent of this section to claim rights or contest
+your rights to work written entirely by you; rather, the intent is to
+exercise the right to control the distribution of derivative or
+collective works based on the Program.
+
+In addition, mere aggregation of another work not based on the Program
+with the Program (or with a work based on the Program) on a volume of
+a storage or distribution medium does not bring the other work under
+the scope of this License.
+
+  3. You may copy and distribute the Program (or a work based on it,
+under Section 2) in object code or executable form under the terms of
+Sections 1 and 2 above provided that you also do one of the following:
+
+    a) Accompany it with the complete corresponding machine-readable
+    source code, which must be distributed under the terms of Sections
+    1 and 2 above on a medium customarily used for software interchange; or,
+
+    b) Accompany it with a written offer, valid for at least three
+    years, to give any third party, for a charge no more than your
+    cost of physically performing source distribution, a complete
+    machine-readable copy of the corresponding source code, to be
+    distributed under the terms of Sections 1 and 2 above on a medium
+    customarily used for software interchange; or,
+
+    c) Accompany it with the information you received as to the offer
+    to distribute corresponding source code.  (This alternative is
+    allowed only for noncommercial distribution and only if you
+    received the program in object code or executable form with such
+    an offer, in accord with Subsection b above.)
+
+The source code for a work means the preferred form of the work for
+making modifications to it.  For an executable work, complete source
+code means all the source code for all modules it contains, plus any
+associated interface definition files, plus the scripts used to
+control compilation and installation of the executable.  However, as a
+special exception, the source code distributed need not include
+anything that is normally distributed (in either source or binary
+form) with the major components (compiler, kernel, and so on) of the
+operating system on which the executable runs, unless that component
+itself accompanies the executable.
+
+If distribution of executable or object code is made by offering
+access to copy from a designated place, then offering equivalent
+access to copy the source code from the same place counts as
+distribution of the source code, even though third parties are not
+compelled to copy the source along with the object code.
+
+  4. You may not copy, modify, sublicense, or distribute the Program
+except as expressly provided under this License.  Any attempt
+otherwise to copy, modify, sublicense or distribute the Program is
+void, and will automatically terminate your rights under this License.
+However, parties who have received copies, or rights, from you under
+this License will not have their licenses terminated so long as such
+parties remain in full compliance.
+
+  5. You are not required to accept this License, since you have not
+signed it.  However, nothing else grants you permission to modify or
+distribute the Program or its derivative works.  These actions are
+prohibited by law if you do not accept this License.  Therefore, by
+modifying or distributing the Program (or any work based on the
+Program), you indicate your acceptance of this License to do so, and
+all its terms and conditions for copying, distributing or modifying
+the Program or works based on it.
+
+  6. Each time you redistribute the Program (or any work based on the
+Program), the recipient automatically receives a license from the
+original licensor to copy, distribute or modify the Program subject to
+these terms and conditions.  You may not impose any further
+restrictions on the recipients' exercise of the rights granted herein.
+You are not responsible for enforcing compliance by third parties to
+this License.
+
+  7. If, as a consequence of a court judgment or allegation of patent
+infringement or for any other reason (not limited to patent issues),
+conditions are imposed on you (whether by court order, agreement or
+otherwise) that contradict the conditions of this License, they do not
+excuse you from the conditions of this License.  If you cannot
+distribute so as to satisfy simultaneously your obligations under this
+License and any other pertinent obligations, then as a consequence you
+may not distribute the Program at all.  For example, if a patent
+license would not permit royalty-free redistribution of the Program by
+all those who receive copies directly or indirectly through you, then
+the only way you could satisfy both it and this License would be to
+refrain entirely from distribution of the Program.
+
+If any portion of this section is held invalid or unenforceable under
+any particular circumstance, the balance of the section is intended to
+apply and the section as a whole is intended to apply in other
+circumstances.
+
+It is not the purpose of this section to induce you to infringe any
+patents or other property right claims or to contest validity of any
+such claims; this section has the sole purpose of protecting the
+integrity of the free software distribution system, which is
+implemented by public license practices.  Many people have made
+generous contributions to the wide range of software distributed
+through that system in reliance on consistent application of that
+system; it is up to the author/donor to decide if he or she is willing
+to distribute software through any other system and a licensee cannot
+impose that choice.
+
+This section is intended to make thoroughly clear what is believed to
+be a consequence of the rest of this License.
+
+  8. If the distribution and/or use of the Program is restricted in
+certain countries either by patents or by copyrighted interfaces, the
+original copyright holder who places the Program under this License
+may add an explicit geographical distribution limitation excluding
+those countries, so that distribution is permitted only in or among
+countries not thus excluded.  In such case, this License incorporates
+the limitation as if written in the body of this License.
+
+  9. The Free Software Foundation may publish revised and/or new versions
+of the General Public License from time to time.  Such new versions will
+be similar in spirit to the present version, but may differ in detail to
+address new problems or concerns.
+
+Each version is given a distinguishing version number.  If the Program
+specifies a version number of this License which applies to it and "any
+later version", you have the option of following the terms and conditions
+either of that version or of any later version published by the Free
+Software Foundation.  If the Program does not specify a version number of
+this License, you may choose any version ever published by the Free Software
+Foundation.
+
+  10. If you wish to incorporate parts of the Program into other free
+programs whose distribution conditions are different, write to the author
+to ask for permission.  For software which is copyrighted by the Free
+Software Foundation, write to the Free Software Foundation; we sometimes
+make exceptions for this.  Our decision will be guided by the two goals
+of preserving the free status of all derivatives of our free software and
+of promoting the sharing and reuse of software generally.
+
+			    NO WARRANTY
+
+  11. BECAUSE THE PROGRAM IS LICENSED FREE OF CHARGE, THERE IS NO WARRANTY
+FOR THE PROGRAM, TO THE EXTENT PERMITTED BY APPLICABLE LAW.  EXCEPT WHEN
+OTHERWISE STATED IN WRITING THE COPYRIGHT HOLDERS AND/OR OTHER PARTIES
+PROVIDE THE PROGRAM "AS IS" WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESSED
+OR IMPLIED, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
+MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  THE ENTIRE RISK AS
+TO THE QUALITY AND PERFORMANCE OF THE PROGRAM IS WITH YOU.  SHOULD THE
+PROGRAM PROVE DEFECTIVE, YOU ASSUME THE COST OF ALL NECESSARY SERVICING,
+REPAIR OR CORRECTION.
+
+  12. IN NO EVENT UNLESS REQUIRED BY APPLICABLE LAW OR AGREED TO IN WRITING
+WILL ANY COPYRIGHT HOLDER, OR ANY OTHER PARTY WHO MAY MODIFY AND/OR
+REDISTRIBUTE THE PROGRAM AS PERMITTED ABOVE, BE LIABLE TO YOU FOR DAMAGES,
+INCLUDING ANY GENERAL, SPECIAL, INCIDENTAL OR CONSEQUENTIAL DAMAGES ARISING
+OUT OF THE USE OR INABILITY TO USE THE PROGRAM (INCLUDING BUT NOT LIMITED
+TO LOSS OF DATA OR DATA BEING RENDERED INACCURATE OR LOSSES SUSTAINED BY
+YOU OR THIRD PARTIES OR A FAILURE OF THE PROGRAM TO OPERATE WITH ANY OTHER
+PROGRAMS), EVEN IF SUCH HOLDER OR OTHER PARTY HAS BEEN ADVISED OF THE
+POSSIBILITY OF SUCH DAMAGES.
+
+		     END OF TERMS AND CONDITIONS
+
+	    How to Apply These Terms to Your New Programs
+
+  If you develop a new program, and you want it to be of the greatest
+possible use to the public, the best way to achieve this is to make it
+free software which everyone can redistribute and change under these terms.
+
+  To do so, attach the following notices to the program.  It is safest
+to attach them to the start of each source file to most effectively
+convey the exclusion of warranty; and each file should have at least
+the "copyright" line and a pointer to where the full notice is found.
+
+    <one line to give the program's name and a brief idea of what it does.>
+    Copyright (C) 19yy  <name of author>
+
+    This program is free software; you can redistribute it and/or modify
+    it under the terms of the GNU General Public License as published by
+    the Free Software Foundation; either version 2 of the License, or
+    (at your option) any later version.
+
+    This program is distributed in the hope that it will be useful,
+    but WITHOUT ANY WARRANTY; without even the implied warranty of
+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+    GNU General Public License for more details.
+
+    You should have received a copy of the GNU General Public License
+    along with this program; if not, write to the Free Software
+    Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA
+
+
+Also add information on how to contact you by electronic and paper mail.
+
+If the program is interactive, make it output a short notice like this
+when it starts in an interactive mode:
+
+    Gnomovision version 69, Copyright (C) 19yy name of author
+    Gnomovision comes with ABSOLUTELY NO WARRANTY; for details type `show w'.
+    This is free software, and you are welcome to redistribute it
+    under certain conditions; type `show c' for details.
+
+The hypothetical commands `show w' and `show c' should show the appropriate
+parts of the General Public License.  Of course, the commands you use may
+be called something other than `show w' and `show c'; they could even be
+mouse-clicks or menu items--whatever suits your program.
+
+You should also get your employer (if you work as a programmer) or your
+school, if any, to sign a "copyright disclaimer" for the program, if
+necessary.  Here is a sample; alter the names:
+
+  Yoyodyne, Inc., hereby disclaims all copyright interest in the program
+  `Gnomovision' (which makes passes at compilers) written by James Hacker.
+
+  <signature of Ty Coon>, 1 April 1989
+  Ty Coon, President of Vice
+
+This General Public License does not permit incorporating your program into
+proprietary programs.  If your program is a subroutine library, you may
+consider it more useful to permit linking proprietary applications with the
+library.  If this is what you want to do, use the GNU Library General
+Public License instead of this License.
diff -Naur kdebase-workspace-4.3.5/polkit-kde-1/kcmodules/CMakeLists.txt kdebase-workspace-4.3.5-p/polkit-kde-1/kcmodules/CMakeLists.txt
--- kdebase-workspace-4.3.5/polkit-kde-1/kcmodules/CMakeLists.txt	1970-01-01 01:00:00.000000000 +0100
+++ kdebase-workspace-4.3.5-p/polkit-kde-1/kcmodules/CMakeLists.txt	2010-02-13 01:10:55.000000000 +0100
@@ -0,0 +1,5 @@
+add_subdirectory(polkitactions)
+add_subdirectory(polkitconfig)
+add_subdirectory(helper)
+
+install( FILES settings-system-policies.desktop  DESTINATION  ${SERVICES_INSTALL_DIR} )
diff -Naur kdebase-workspace-4.3.5/polkit-kde-1/kcmodules/helper/CMakeLists.txt kdebase-workspace-4.3.5-p/polkit-kde-1/kcmodules/helper/CMakeLists.txt
--- kdebase-workspace-4.3.5/polkit-kde-1/kcmodules/helper/CMakeLists.txt	1970-01-01 01:00:00.000000000 +0100
+++ kdebase-workspace-4.3.5-p/polkit-kde-1/kcmodules/helper/CMakeLists.txt	2010-02-13 01:10:55.000000000 +0100
@@ -0,0 +1,49 @@
+include_directories(${CMAKE_CURRENT_SOURCE_DIR} ${CMAKE_CURRENT_BINARY_DIR})
+
+# I know, sucks extremely hard, but it's the only way.
+
+set(policy_gen_SRCS
+    policy-gen/policy-gen.cpp
+    policy-gen/kauth-policy-gen-polkit1.cpp )
+
+kde4_add_executable(polkit-kde-helper-policy-gen NOGUI ${policy_gen_SRCS})
+
+target_link_libraries(polkit-kde-helper-policy-gen ${QT_QTCORE_LIBRARY})
+
+## Execute it
+set(_output ${CMAKE_CURRENT_BINARY_DIR}/org.kde.polkitkde1.policy)
+get_filename_component(_input polkitkde1.actions ABSOLUTE)
+
+add_custom_command(OUTPUT ${_output} 
+                   COMMAND ${CMAKE_CURRENT_BINARY_DIR}/polkit-kde-helper-policy-gen ${_input} > ${_output} 
+                   MAIN_DEPENDENCY ${_input}
+                   WORKING_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR}
+                   COMMENT "Generating org.kde.polkitkde1.policy"
+                   DEPENDS polkit-kde-helper-policy-gen)
+add_custom_target("actions for polkit-kde" ALL DEPENDS ${_output})
+
+install(FILES ${_output} DESTINATION ${POLKITQT-1_POLICY_FILES_INSTALL_DIR})
+
+#########
+
+set(polkitkde1helper_SRCS
+    main.cpp
+    polkitkde1helper.cpp
+    ../PKLAEntry.cpp
+)
+
+qt4_add_dbus_adaptor(polkitkde1helper_SRCS
+    org.kde.polkitkde1.helper.xml
+    polkitkde1helper.h
+    PolkitKde1Helper
+)
+
+kde4_add_executable(polkitkde1helper ${polkitkde1helper_SRCS})
+
+target_link_libraries(polkitkde1helper ${QT_QTCORE_LIBRARY} ${POLKITQT-1_CORE_LIBRARY})
+
+install(TARGETS polkitkde1helper DESTINATION ${LIBEXEC_INSTALL_DIR})
+
+dbus_add_activation_system_service(org.kde.polkitkde1.helper.service.in)
+
+install(FILES org.kde.polkitkde1.helper.conf DESTINATION ${SYSCONF_INSTALL_DIR}/dbus-1/system.d)
diff -Naur kdebase-workspace-4.3.5/polkit-kde-1/kcmodules/helper/main.cpp kdebase-workspace-4.3.5-p/polkit-kde-1/kcmodules/helper/main.cpp
--- kdebase-workspace-4.3.5/polkit-kde-1/kcmodules/helper/main.cpp	1970-01-01 01:00:00.000000000 +0100
+++ kdebase-workspace-4.3.5-p/polkit-kde-1/kcmodules/helper/main.cpp	2010-02-13 01:10:55.000000000 +0100
@@ -0,0 +1,19 @@
+/* This file is part of the KDE project
+
+   Copyright (C) 2008 Dario Freddi <drf@kde.org>
+
+   This program is free software; you can redistribute it and/or
+   modify it under the terms of the GNU General Public
+   License as published by the Free Software Foundation; either
+   version 2 of the License, or (at your option) any later version.
+*/
+#include "polkitkde1helper.h"
+#include <QCoreApplication>
+
+int main(int argc, char *argv[])
+{
+    QCoreApplication app(argc, argv);
+
+    PolkitKde1Helper helper;
+    return app.exec();
+}
\ Kein Zeilenumbruch am Dateiende.
diff -Naur kdebase-workspace-4.3.5/polkit-kde-1/kcmodules/helper/org.kde.polkitkde1.helper.conf kdebase-workspace-4.3.5-p/polkit-kde-1/kcmodules/helper/org.kde.polkitkde1.helper.conf
--- kdebase-workspace-4.3.5/polkit-kde-1/kcmodules/helper/org.kde.polkitkde1.helper.conf	1970-01-01 01:00:00.000000000 +0100
+++ kdebase-workspace-4.3.5-p/polkit-kde-1/kcmodules/helper/org.kde.polkitkde1.helper.conf	2010-02-13 01:10:55.000000000 +0100
@@ -0,0 +1,19 @@
+<!DOCTYPE busconfig PUBLIC
+ "-//freedesktop//DTD D-BUS Bus Configuration 1.0//EN"
+ "http://www.freedesktop.org/standards/dbus/1.0/busconfig.dtd">
+<busconfig>
+
+  <!-- This configuration file specifies the required security policies
+       for polkit-kde to work. -->
+
+  <!-- Only user root can own the polkitkde1.helper service -->
+  <policy user="root">
+    <allow own="org.kde.polkitkde1.helper"/>
+  </policy>
+
+  <!-- Allow anyone to call into the service - we'll reject callers using polkit -->
+  <policy context="default">
+    <allow send_destination="org.kde.polkitkde1.helper"/>
+  </policy>
+
+</busconfig>
\ Kein Zeilenumbruch am Dateiende.
diff -Naur kdebase-workspace-4.3.5/polkit-kde-1/kcmodules/helper/org.kde.polkitkde1.helper.service.in kdebase-workspace-4.3.5-p/polkit-kde-1/kcmodules/helper/org.kde.polkitkde1.helper.service.in
--- kdebase-workspace-4.3.5/polkit-kde-1/kcmodules/helper/org.kde.polkitkde1.helper.service.in	1970-01-01 01:00:00.000000000 +0100
+++ kdebase-workspace-4.3.5-p/polkit-kde-1/kcmodules/helper/org.kde.polkitkde1.helper.service.in	2010-02-13 01:10:55.000000000 +0100
@@ -0,0 +1,4 @@
+[D-BUS Service]
+Name=org.kde.polkitkde1.helper
+Exec=@LIBEXEC_INSTALL_DIR@/polkitkde1helper
+User=root
diff -Naur kdebase-workspace-4.3.5/polkit-kde-1/kcmodules/helper/org.kde.polkitkde1.helper.xml kdebase-workspace-4.3.5-p/polkit-kde-1/kcmodules/helper/org.kde.polkitkde1.helper.xml
--- kdebase-workspace-4.3.5/polkit-kde-1/kcmodules/helper/org.kde.polkitkde1.helper.xml	1970-01-01 01:00:00.000000000 +0100
+++ kdebase-workspace-4.3.5-p/polkit-kde-1/kcmodules/helper/org.kde.polkitkde1.helper.xml	2010-02-13 01:10:55.000000000 +0100
@@ -0,0 +1,16 @@
+<!DOCTYPE node PUBLIC "-//freedesktop//DTD D-BUS Object Introspection 1.0//EN"
+"http://www.freedesktop.org/standards/dbus/1.0/introspect.dtd">
+<node>
+   <interface name="org.kde.polkitkde1.helper">
+       <method name="saveGlobalConfiguration" >
+           <arg direction="in" type="s" name="adminIdentities" />
+           <arg direction="in" type="i" name="systemPriority" />
+           <arg direction="in" type="i" name="policiesPriority" />
+       </method>
+       <method name="retrievePolicies" >
+           <annotation name="com.trolltech.QtDBus.QtTypeName.Out0" value="QVariantList"/>
+           <arg direction="out" type="av" />
+       </method>
+
+   </interface>
+</node>
\ Kein Zeilenumbruch am Dateiende.
diff -Naur kdebase-workspace-4.3.5/polkit-kde-1/kcmodules/helper/policy-gen/kauth-policy-gen-polkit1.cpp kdebase-workspace-4.3.5-p/polkit-kde-1/kcmodules/helper/policy-gen/kauth-policy-gen-polkit1.cpp
--- kdebase-workspace-4.3.5/polkit-kde-1/kcmodules/helper/policy-gen/kauth-policy-gen-polkit1.cpp	1970-01-01 01:00:00.000000000 +0100
+++ kdebase-workspace-4.3.5-p/polkit-kde-1/kcmodules/helper/policy-gen/kauth-policy-gen-polkit1.cpp	2010-02-13 01:10:55.000000000 +0100
@@ -0,0 +1,87 @@
+/*
+*   Copyright (C) 2008 Nicola Gigante <nicola.gigante@gmail.com>
+*   Copyright (C) 2009 Dario Freddi <drf@kde.org>
+*
+*   This program is free software; you can redistribute it and/or modify
+*   it under the terms of the GNU Lesser General Public License as published by
+*   the Free Software Foundation; either version 2.1 of the License, or
+*   (at your option) any later version.
+*
+*   This program is distributed in the hope that it will be useful,
+*   but WITHOUT ANY WARRANTY; without even the implied warranty of
+*   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+*   GNU General Public License for more details.
+*
+*   You should have received a copy of the GNU Lesser General Public License
+*   along with this program; if not, write to the
+*   Free Software Foundation, Inc.,
+*   51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA .
+*/
+
+#include "policy-gen.h"
+
+#include <cstdio>
+#include <QDebug>
+#include <QTextStream>
+
+const char header[] = ""
+                      "<?xml version=\"1.0\" encoding=\"utf-8\"?>\n"
+                      "<!DOCTYPE policyconfig PUBLIC\n"
+                      "\"-//freedesktop//DTD PolicyKit Policy Configuration 1.0//EN\"\n"
+                      "\"http://www.freedesktop.org/standards/PolicyKit/1.0/policyconfig.dtd\">\n"
+                      "<policyconfig>\n";
+
+const char policy_tag[] = ""
+                          "      <defaults>\n"
+                          "         <allow_inactive>no</allow_inactive>\n"
+                          "         <allow_active>%1</allow_active>\n"
+                          "      </defaults>\n";
+
+const char dent[] = "   ";
+
+void output(QList<Action> actions, QHash<QString, QString> domain)
+{
+    QTextStream out(stdout);
+
+    out << header;
+
+    if (domain.contains("vendor")) {
+        out << "<vendor>" << domain["vendor"] << "</vendor>\n";
+    }
+    if (domain.contains("vendorurl")) {
+        out << "<vendor_url>" << domain["vendorurl"] << "</vendor_url>\n";
+    }
+    if (domain.contains("icon")) {
+        out << "<icon_name>" << domain["icon"] << "</icon_name>\n";
+    }
+
+    foreach (const Action &action, actions) {
+        out << dent << "<action id=\"" << action.name << "\" >\n";
+
+        foreach (const QString &lang, action.descriptions.keys()) {
+            out << dent << dent << "<description";
+            if (lang != "en")
+                out << " xml:lang=\"" << lang << '"';
+            out << '>' << action.messages.value(lang) << "</description>\n";
+        }
+
+        foreach (const QString &lang, action.messages.keys()) {
+            out << dent << dent << "<message";
+            if (lang != "en") {
+                out << " xml:lang=\"" << lang << '"';
+            }
+            out << '>' << action.descriptions.value(lang) << "</message>\n";
+        }
+
+        QString policy = action.policy;
+        if (!action.persistence.isEmpty() && policy != "yes" && policy != "no") {
+            policy += "_keep";
+        }
+
+        out << QString(policy_tag).arg(policy);
+
+        out << dent << "</action>\n";
+    }
+
+    out << "</policyconfig>\n";
+}
diff -Naur kdebase-workspace-4.3.5/polkit-kde-1/kcmodules/helper/policy-gen/policy-gen.cpp kdebase-workspace-4.3.5-p/polkit-kde-1/kcmodules/helper/policy-gen/policy-gen.cpp
--- kdebase-workspace-4.3.5/polkit-kde-1/kcmodules/helper/policy-gen/policy-gen.cpp	1970-01-01 01:00:00.000000000 +0100
+++ kdebase-workspace-4.3.5-p/polkit-kde-1/kcmodules/helper/policy-gen/policy-gen.cpp	2010-02-13 01:10:55.000000000 +0100
@@ -0,0 +1,145 @@
+/*
+*   Copyright (C) 2008 Nicola Gigante <nicola.gigante@gmail.com>
+*   Copyright (C) 2009 Dario Freddi <drf@kde.org>
+*
+*   This program is free software; you can redistribute it and/or modify
+*   it under the terms of the GNU Lesser General Public License as published by
+*   the Free Software Foundation; either version 2.1 of the License, or
+*   (at your option) any later version.
+*
+*   This program is distributed in the hope that it will be useful,
+*   but WITHOUT ANY WARRANTY; without even the implied warranty of
+*   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+*   GNU General Public License for more details.
+*
+*   You should have received a copy of the GNU Lesser General Public License
+*   along with this program; if not, write to the
+*   Free Software Foundation, Inc.,
+*   51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA .
+*/
+
+#include "policy-gen.h"
+
+#include <QCoreApplication>
+#include <QSettings>
+#include <QRegExp>
+#include <QStringList>
+#include <QDebug>
+
+using namespace std;
+
+QList<Action> parse(QSettings &ini);
+QHash<QString, QString> parseDomain(QSettings &ini);
+
+int main(int argc, char **argv)
+{
+    QCoreApplication app(argc, argv);
+
+    if (argc < 2) {
+        qCritical("Too few arguments");
+        return 1;
+    }
+
+    QSettings ini(argv[1], QSettings::IniFormat);
+    if (ini.status()) {
+        qCritical("Error loading file: %s", argv[1]);
+        return 1;
+    }
+
+    output(parse(ini), parseDomain(ini));
+}
+
+QList<Action> parse(QSettings &ini)
+{
+    QList<Action> actions;
+    QRegExp actionExp("[0-9a-z]+(\\.[0-9a-z]+)*");
+    QRegExp descriptionExp("description(?:\\[(\\w+)\\])?");
+    QRegExp nameExp("name(?:\\[(\\w+)\\])?");
+    QRegExp policyExp("yes|no|auth_self|auth_admin");
+
+    descriptionExp.setCaseSensitivity(Qt::CaseInsensitive);
+    nameExp.setCaseSensitivity(Qt::CaseInsensitive);
+
+    foreach(const QString &name, ini.childGroups()) {
+        Action action;
+
+        if (name == "Domain") {
+            continue;
+        }
+
+        if (!actionExp.exactMatch(name)) {
+            qCritical("Wrong action syntax: %s\n", name.toAscii().data());
+            exit(1);
+        }
+
+        action.name = name;
+        ini.beginGroup(name);
+
+        foreach(const QString &key, ini.childKeys()) {
+            if (descriptionExp.exactMatch(key)) {
+                QString lang = descriptionExp.capturedTexts().at(1);
+
+                if (lang.isEmpty())
+                    lang = "en";
+
+                action.descriptions.insert(lang, ini.value(key).toString());
+
+            } else if (nameExp.exactMatch(key)) {
+                QString lang = nameExp.capturedTexts().at(1);
+
+                if (lang.isEmpty())
+                    lang = "en";
+
+                action.messages.insert(lang, ini.value(key).toString());
+
+            } else if (key.toLower() == "policy") {
+                QString policy = ini.value(key).toString();
+                if (!policyExp.exactMatch(policy)) {
+                    qCritical("Wrong policy: %s", policy.toAscii().data());
+                    exit(1);
+                }
+                action.policy = policy;
+
+            } else if (key.toLower() == "persistence") {
+                QString persistence = ini.value(key).toString();
+                if (persistence != "session" && persistence != "always") {
+                    qCritical("Wrong persistence: %s", persistence.toAscii().data());
+                    exit(1);
+                }
+                action.persistence = persistence;
+            }
+        }
+
+        if (action.policy.isEmpty() || action.messages.isEmpty() || action.descriptions.isEmpty()) {
+            qCritical("Missing option in action: %s", name.toAscii().data());
+            exit(1);
+        }
+        ini.endGroup();
+
+        actions.append(action);
+    }
+
+    return actions;
+}
+
+
+QHash<QString, QString> parseDomain(QSettings& ini)
+{
+    QHash<QString, QString> rethash;
+
+    if (ini.childGroups().contains("Domain")) {
+        if (ini.contains("Domain/Name")) {
+            rethash["vendor"] = ini.value("Domain/Name").toString();
+        }
+        if (ini.contains("Domain/URL")) {
+            rethash["vendorurl"] = ini.value("Domain/URL").toString();
+        }
+        if (ini.contains("Domain/Icon")) {
+            rethash["icon"] = ini.value("Domain/Icon").toString();
+        }
+    }
+
+    return rethash;
+}
+
+
diff -Naur kdebase-workspace-4.3.5/polkit-kde-1/kcmodules/helper/policy-gen/policy-gen.h kdebase-workspace-4.3.5-p/polkit-kde-1/kcmodules/helper/policy-gen/policy-gen.h
--- kdebase-workspace-4.3.5/polkit-kde-1/kcmodules/helper/policy-gen/policy-gen.h	1970-01-01 01:00:00.000000000 +0100
+++ kdebase-workspace-4.3.5-p/polkit-kde-1/kcmodules/helper/policy-gen/policy-gen.h	2010-02-13 01:10:55.000000000 +0100
@@ -0,0 +1,41 @@
+/*
+*   Copyright (C) 2008 Nicola Gigante <nicola.gigante@gmail.com>
+*   Copyright (C) 2009 Dario Freddi <drf@kde.org>
+*
+*   This program is free software; you can redistribute it and/or modify
+*   it under the terms of the GNU Lesser General Public License as published by
+*   the Free Software Foundation; either version 2.1 of the License, or
+*   (at your option) any later version.
+*
+*   This program is distributed in the hope that it will be useful,
+*   but WITHOUT ANY WARRANTY; without even the implied warranty of
+*   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+*   GNU General Public License for more details.
+*
+*   You should have received a copy of the GNU Lesser General Public License
+*   along with this program; if not, write to the
+*   Free Software Foundation, Inc.,
+*   51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA .
+*/
+
+#ifndef _POLICY_GEN_H_
+#define _POLICY_GEN_H_
+
+#include <QString>
+#include <QMap>
+#include <QHash>
+
+struct Action {
+    QString name;
+
+    QHash<QString, QString> descriptions;
+    QHash<QString, QString> messages;
+
+    QString policy;
+    QString persistence;
+};
+
+extern void output(QList<Action> actions, QHash<QString, QString> domain);
+
+
+#endif
diff -Naur kdebase-workspace-4.3.5/polkit-kde-1/kcmodules/helper/polkitkde1.actions kdebase-workspace-4.3.5-p/polkit-kde-1/kcmodules/helper/polkitkde1.actions
--- kdebase-workspace-4.3.5/polkit-kde-1/kcmodules/helper/polkitkde1.actions	1970-01-01 01:00:00.000000000 +0100
+++ kdebase-workspace-4.3.5-p/polkit-kde-1/kcmodules/helper/polkitkde1.actions	2010-02-13 01:10:55.000000000 +0100
@@ -0,0 +1,232 @@
+[Domain]
+Name=System policy settings
+Name[ca]=Arranjament de la política del sistema
+Name[ca@valencia]=Arranjament de la política del sistema
+Name[cs]=Nastavení pravidel systému
+Name[da]=Indstillinger for systempolitik
+Name[de]=Systemregeleinstellungen
+Name[en_GB]=System policy settings
+Name[es]=Preferencias de la política del sistema
+Name[et]=Süsteemi reeglite seadistused
+Name[fi]=Järjestelmän toimintatapa-asetukset
+Name[fr]=Paramètres de la stratégie système
+Name[it]=Impostazioni delle politiche di sistema
+Name[km]=ការ​កំណត់​គោលនយោបាយ​ប្រព័ន្ធ
+Name[lv]=Sistēmas politikas iestatījumi
+Name[nb]=Praksisinnstillinger for systemet
+Name[nds]=Systeemregeln instellen
+Name[nl]=Instellingen voor systeembeleid
+Name[pt]=Configuração da política do sistema
+Name[pt_BR]=Configurações das políticas do sistema
+Name[ro]=Configurări politică de sistem
+Name[sv]=Inställningar av systempolicy
+Name[uk]=Параметри системних правил доступу
+Name[x-test]=xxSystem policy settingsxx
+Name[zh_TW]=系統政策設定
+Icon=security-high
+
+[org.kde.polkitkde1.readauthorizations]
+Name=Read system authorizations
+Name[ca]=Llegeix les autoritzacions del sistema
+Name[ca@valencia]=Llig les autoritzacions del sistema
+Name[cs]=Načíst systémová oprávnění
+Name[da]=Læs systemgodkendelser
+Name[de]=Systemberechtigungen einlesen
+Name[en_GB]=Read system authorisations
+Name[es]=Leer autorizaciones del sistema
+Name[et]=Süsteemi autentimiste lugemine
+Name[fi]=Lue järjestelmän käyttövaltuudet
+Name[fr]=Lire les autorisations système
+Name[it]=Leggi autorizzazioni di sistema
+Name[km]=អាន​ការ​អនុញ្ញាត​របស់ប្រព័ន្ធ
+Name[lv]=Nolasīt sistēmas pilnvaras
+Name[nb]=Les systemets autoriseringer
+Name[nds]=Systeemverlööfnissen lesen
+Name[nl]=Systeemautorisaties lezen
+Name[pt]=Ler as autorizações do sistema
+Name[pt_BR]=Ler as autorizações do sistema
+Name[ro]=Citește autorizările de sistem
+Name[sv]=Läs systembehörigheter
+Name[uk]=Читання системних уповноважень
+Name[x-test]=xxRead system authorizationsxx
+Name[zh_TW]=讀取系統授權
+Description=Authorization is required to read system authorizations
+Description[ca]=Es requereix autorització per llegir les autoritzacions del sistema
+Description[ca@valencia]=Es requereix autorització per llegir les autoritzacions del sistema
+Description[cs]=Pro čtení systémových oprávnění je třeba patřičná oprávnění
+Description[da]=Godkendelse kræves for at læse systemgodkendelser
+Description[de]=Berechtigung ist für das Einlesen von Systemberechtigungen erforderlich
+Description[en_GB]=Authorisation is required to read system authorisations
+Description[es]=Se necesita autorización para leer las autorizaciones del sistema
+Description[et]=Süsteemi autentimiste lugemiseks on vajalik autentimine
+Description[fi]=Varmennusta varten on luettava järjestelmän käyttövaltuudet
+Description[fr]=Une autorisation est requise pour lire les autorisations système
+Description[it]=È richiesta l'autorizzazione per leggere le autorizzazioni di sistema
+Description[km]=ការ​អនុញ្ញាត​ត្រូវ​បានទាមទារ​ ដើម្បីអាន​ការ​អនុញ្ញាត​របស់​ប្រព័ន្ធ
+Description[lv]=Lai nolasītu sistēmas pilnvaras, ir nepieciešama autorizācija
+Description[nb]=Autorisering kreves for å lese systemautoriseringer
+Description[nds]=För't Lesen vun Systeemverlööfnissen deit Verlööf noot.
+Description[nl]=Autorisatie is vereist om systeemautorisaties te lezen
+Description[pt]=É necessária a autorização para ler as autorizações do sistema
+Description[pt_BR]=É necessário autorização para ler as políticas do sistema
+Description[ro]=Pentru a citi autorizările sistemului este nevoie de autorizare
+Description[sv]=Behörighet krävs för att läsa systembehörigheter
+Description[uk]=Для читання системних уповноважень потрібно пройти уповноваження
+Description[x-test]=xxAuthorization is required to read system authorizationsxx
+Description[zh_TW]=讀取系統授權時需要認證
+Policy=auth_admin
+Persistence=session
+
+[org.kde.polkitkde1.changeimplicitauthorizations]
+Name=Change implicit authorizations for an action
+Name[ca]=Canvia les autoritzacions implícites per una acció
+Name[ca@valencia]=Canvia les autoritzacions implícites per una acció
+Name[cs]=Změnit implicitní oprávnění pro činnost
+Name[da]=Ændr implicitte godkendelser for en handling
+Name[de]=Implizite Berechtigungen für eine Aktion ändern
+Name[en_GB]=Change implicit authorisations for an action
+Name[es]=Cambiar autorizaciones implícitas para una acción
+Name[et]=Toimingu kaudsete autentimiste muutmine
+Name[fi]=Muuta epäsuorasti ilmaistut toiminnan käyttövaltuudet
+Name[fr]=Changer les autorisations implicites pour une action
+Name[it]=Modifica l'autorizzazione implicita di un'azione
+Name[km]=ផ្លាស់ប្ដូរ​ការអនុញ្ញាតមិន​​ជាក់លាក់​សម្រាប់​សកម្មភាព
+Name[lv]=Mainīt darbības pastarpinātās pilnvaras
+Name[nb]=Endre implisitte autoriseringer for en handling
+Name[nds]=Inslaten Verlööfnissen för en Akschoon ännern
+Name[nl]=Impliciete autorisaties voor een actie wijzigen
+Name[pt]=Modificar as autorizações implícitas para uma acção
+Name[pt_BR]=Alterar autorizações implícitas para uma ação
+Name[ro]=Schimbă autorizările implicite pentru o acțiune
+Name[sv]=Ändra implicit behörighet för en åtgärd
+Name[uk]=Змінити неявні уповноваження на дію
+Name[x-test]=xxChange implicit authorizations for an actionxx
+Name[zh_TW]=變更某動作的內部授權
+Description=Authorization is required to change implicit authorizations
+Description[ca]=Es requereix autorització per canviar les autoritzacions implícites
+Description[ca@valencia]=Es requereix autorització per canviar les autoritzacions implícites
+Description[cs]=Pro změnu implicitních oprávnění je třeba mít patřičná práva
+Description[da]=Godkendelse kræves for at ændre implicitte godkendelser
+Description[de]=Berechtigung ist für das Ändern von impliziten Berechtigungen erforderlich
+Description[en_GB]=Authorisation is required to change implicit authorisations
+Description[es]=Se necesita autorización para cambiar autorizaciones implícitas
+Description[et]=Kaudsete autentimiste muutmiseks on vajalik autentimine
+Description[fi]=Varmennusta varten on muutettava epäsuorasti ilmaistut käyttövaltuudet
+Description[fr]=Une autorisation est requise pour changer les autorisations implicites
+Description[it]=È richiesta l'autorizzazione per modificare le autorizzazioni implicite
+Description[km]=កា​រអនុញ្ញាត​ត្រូវ​បាន​ទាមទារ​ ដើម្បី​ផ្លាស់ប្ដូរ​ការ​អនុញ្ញាត​មិន​​ជាក់លាក់
+Description[lv]=Lai mainītu pastarpinātās pilnvaras, ir nepieciešama autorizācija
+Description[nb]=Autorisering kreves for å endre implisitte autoriseringer
+Description[nds]=För't Ännern vun inslaten Verlööfnissen deit Verlööf noot.
+Description[nl]=Autorisatie is vereist om impliciete autorisaties te wijzigen
+Description[pt]=É necessária a autorização para modificar as autorizações implícitas
+Description[pt_BR]=É necessário autorização para alterar as autorizações implícitas
+Description[ro]=Pentru a schimba autorizările implicite este nevoie de autorizare
+Description[sv]=Behörighet krävs för att ändra implicita behörigheter
+Description[uk]=Для зміни неявних уповноважень потрібно пройти уповноваження
+Description[x-test]=xxAuthorization is required to change implicit authorizationsxx
+Description[zh_TW]=變更內部授權時需要認證
+Policy=auth_admin
+
+[org.kde.polkitkde1.changeexplicitauthorizations]
+Name=Change explicit authorizations for an action
+Name[ca]=Canvia les autoritzacions explícites per una acció
+Name[ca@valencia]=Canvia les autoritzacions explícites per una acció
+Name[cs]=Změnit explicitní oprávnění pro činnost
+Name[da]=Ændr eksplicitte godkendelser for en handling
+Name[de]=Explizite Berechtigungen für eine Aktion ändern
+Name[en_GB]=Change explicit authorisations for an action
+Name[es]=Cambiar autorizaciones explícitas para una acción
+Name[et]=Toimingu otseste autentimiste muutmine
+Name[fi]=Muuta toiminnan selvästi ilmaistut käyttövaltuudet
+Name[fr]=Changer les autorisations explicites pour une action
+Name[it]=Modifica le autorizzazioni esplicite di un'azione
+Name[km]=ផ្លាស់ប្ដូរ​ការ​អនុញ្ញាតជាក់លាក់​សម្រាប់​សកម្មភាព
+Name[lv]=Mainīt darbības tiešās pilnvaras
+Name[nb]=Endre uttrykkelige autoriseringer for en handling
+Name[nds]=Utspraken Verlööfnissen för en Akschoon ännern
+Name[nl]=Expliciete autorisaties voor een actie wijzigen
+Name[pt]=Modificar as autorizações explícitas para uma acção
+Name[pt_BR]=Alterar autorizações explícitas para uma ação
+Name[ro]=Schimbă autorizările explicite pentru o acțiune
+Name[sv]=Ändra explicit behörighet för en åtgärd
+Name[uk]=Змінити явні уповноваження на дію
+Name[x-test]=xxChange explicit authorizations for an actionxx
+Name[zh_TW]=變更某動作的外部授權
+Description=Authorization is required to change explicit authorizations
+Description[ca]=Es requereix autorització per canviar les autoritzacions explícites
+Description[ca@valencia]=Es requereix autorització per canviar les autoritzacions explícites
+Description[cs]=Pro změnu explicitních oprávnění je třeba mít patřičná práva
+Description[da]=Godkendelse kræves for at ændre eksplicitte godkendelser
+Description[de]=Berechtigung ist für das Ändern von expliziten Berechtigungen erforderlich
+Description[en_GB]=Authorisation is required to change explicit authorisations
+Description[es]=Se necesita autorización para cambiar autorizaciones explícitas
+Description[et]=Otseste autentimiste muutmiseks on vajalik autentimine
+Description[fi]=Varmennusta varten on muutettava selvästi ilmaistut käyttövaltuudet
+Description[fr]=Une autorisation est requise pour changer les autorisations explicites
+Description[it]=È richiesta l'autorizzazione per modificare le autorizzazioni esplicite
+Description[km]=ការ​អនុញ្ញាត​ត្រូវ​បានទាមទារ​ ដើម្បី​ផ្លាស់ប្ដូរ​ការ​អនុញ្ញាត​ជាក់លាក់
+Description[lv]=Lai mainītu tiešās pilnvaras, ir nepieciešama autorizācija
+Description[nb]=Autorisering kreves for å endre uttrykkelige autoriseringer
+Description[nds]=För't Ännern vun utspraken Verlööfnissen deit Verlööf noot.
+Description[nl]=Autorisatie is vereist om expliciete autorisaties te wijzigen
+Description[pt]=É necessária a autorização para modificar as autorizações explícitas
+Description[pt_BR]=É necessário autorização para alterar as autorizações explícitas
+Description[ro]=Pentru a schimba autorizările explicite este nevoie de autorizare
+Description[sv]=Behörighet krävs för att ändra explicita behörigheter
+Description[uk]=Для зміни явних уповноважень потрібно пройти уповноваження
+Description[x-test]=xxAuthorization is required to change explicit authorizationsxx
+Description[zh_TW]=變更外部授權時需要認證
+Policy=auth_admin
+Persistence=session
+
+[org.kde.polkitkde1.changesystemconfiguration]
+Name=Change global configuration for system policies
+Name[ca]=Canvia la configuració global de les polítiques del sistema
+Name[ca@valencia]=Canvia la configuració global de les polítiques del sistema
+Name[cs]=Změnit globální nastavení pro pravidla systému
+Name[da]=Ændr global konfiguration af systempolitikker
+Name[de]=Globale Einstellung für Systemregeln ändern
+Name[en_GB]=Change global configuration for system policies
+Name[es]=Cambiar la configuración global de las políticas del sistema
+Name[et]=Süsteemi reeglite globaalse seadistuse muutmine
+Name[fi]=Muuta järjestelmämenettelytapojen yleisasetukset
+Name[fr]=Changer la configuration globale pour les stratégies système
+Name[it]=Modifica la configurazione globale delle politiche di sistema
+Name[km]=ផ្លាស់ប្ដូរ​ការ​កំណត់​រចនាសម្ព័ន្ធ​សកល​សម្រាប់​គោលនយោបាយ​ប្រព័ន្ធ
+Name[lv]=Mainīt sistēmas politiku globālo konfigurāciju
+Name[nb]=Endre globalt oppsett for systempraksis
+Name[nds]=Globaal Instellen för Systeemregeln ännern
+Name[nl]=Globale configuratie voor systeembeleid wijzigen
+Name[pt]=Modificar a configuração global das políticas do sistema
+Name[pt_BR]=Alterar a configuração global para as políticas do sistema
+Name[ro]=Schimbă configurarea globală pentru politici de sistem
+Name[sv]=Ändra global inställning av systempolicy
+Name[uk]=Змінити загальні налаштування системних правил доступу
+Name[x-test]=xxChange global configuration for system policiesxx
+Name[zh_TW]=變更系統政策的全域設定
+Description=Authorization is required to change global configuration for system policies
+Description[ca]=Es requereix autorització per canviar la configuració global de les polítiques del sistema
+Description[ca@valencia]=Es requereix autorització per canviar la configuració global de les polítiques del sistema
+Description[cs]=Pro změnu globálního nastavení pravidel systému je třeba oprávnění
+Description[da]=Godkendelse kræves for at ændre global konfiguration af systempolitikker
+Description[de]=Berechtigung für das Ändern der globalen Einstellung für Systemregeln erforderlich
+Description[en_GB]=Authorisation is required to change global configuration for system policies
+Description[es]=Se necesita autorización para cambiar la configuración global de las políticas del sistema
+Description[et]=Süsteemi reeglite globaalse seadistuse muutmiseks on vajalik autentimine
+Description[fi]=Varmennusta varten on muutettava järjestelmämenettelytapojen yleisasetukset
+Description[fr]=Une autorisation est requise pour changer la configuration globale des stratégies système
+Description[it]=È richiesta l'autorizzazione per modificare le configurazione globale delle politiche di sistema
+Description[km]=ការ​អនុញ្ញាត​ត្រូវ​បាន​ទាមទារ​ ដើម្បី​ផ្លាស់ប្ដូរ​ការ​កំណត់​រចនាសម្ព័ន្ធសកល​សម្រាប់គោលនយោបាយ​ប្រព័ន្ធ
+Description[lv]=Lai mainītu sistēmas politiku globālo konfigurāciju, ir nepieciešama autorizācija
+Description[nb]=Autorisering kreves for å endre globalt oppsett for systempraksis
+Description[nds]=För't Ännern vun globaal Instellen för Systeemregeln deit Verlööf noot.
+Description[nl]=Autorisatie is vereist om de globale configuratie voor systeembeleid te wijzigen
+Description[pt]=É necessária a autorização para modificar a configuração global das políticas do sistema
+Description[pt_BR]=É necessário autorização para alterar a configuração global para as políticas do sistema
+Description[ro]=Pentru a schimba configurarea globală pentru politici de sistem este nevoie de autorizare
+Description[sv]=Behörighet krävs för att ändra global inställning av systempolicy
+Description[uk]=Для зміни загального налаштування системних прав доступу потрібно пройти уповноваження
+Description[x-test]=xxAuthorization is required to change global configuration for system policiesxx
+Description[zh_TW]=變更系統政策的全域設定時需要認證
+Policy=auth_admin
diff -Naur kdebase-workspace-4.3.5/polkit-kde-1/kcmodules/helper/polkitkde1helper.cpp kdebase-workspace-4.3.5-p/polkit-kde-1/kcmodules/helper/polkitkde1helper.cpp
--- kdebase-workspace-4.3.5/polkit-kde-1/kcmodules/helper/polkitkde1helper.cpp	1970-01-01 01:00:00.000000000 +0100
+++ kdebase-workspace-4.3.5-p/polkit-kde-1/kcmodules/helper/polkitkde1helper.cpp	2010-02-13 01:10:55.000000000 +0100
@@ -0,0 +1,181 @@
+/* This file is part of the KDE project
+
+   Copyright (C) 2008 Dario Freddi <drf@kde.org>
+
+   This program is free software; you can redistribute it and/or
+   modify it under the terms of the GNU General Public
+   License as published by the Free Software Foundation; either
+   version 2 of the License, or (at your option) any later version.
+*/
+
+#include "polkitkde1helper.h"
+
+#include "helperadaptor.h"
+
+#include <QTimer>
+#include <QSettings>
+
+#include <QtDBus/QDBusConnection>
+
+#include <PolkitQt1/Authority>
+#include <qdir.h>
+
+PolkitKde1Helper::PolkitKde1Helper(QObject* parent)
+    : QObject(parent)
+{
+    qDBusRegisterMetaType<PKLAEntry>();
+    (void) new HelperAdaptor(this);
+    // Register the DBus service
+    if (!QDBusConnection::systemBus().registerService("org.kde.polkitkde1.helper")) {
+        qDebug() << QDBusConnection::systemBus().lastError().message();;
+        QTimer::singleShot(0, QCoreApplication::instance(), SLOT(quit()));
+        return;
+    }
+
+    if (!QDBusConnection::systemBus().registerObject("/Helper", this)) {
+        qDebug() << "unable to register service interface to dbus";
+        QTimer::singleShot(0, QCoreApplication::instance(), SLOT(quit()));
+        return;
+    }
+}
+
+PolkitKde1Helper::~PolkitKde1Helper()
+{
+
+}
+
+void PolkitKde1Helper::saveGlobalConfiguration(const QString& adminIdentities, int systemPriority, int policiesPriority)
+{
+    qDebug() << "Request to save the global configuration by " << message().service();
+    PolkitQt1::Authority::Result result;
+    PolkitQt1::SystemBusNameSubject *subject;
+
+    subject = new PolkitQt1::SystemBusNameSubject(message().service());
+
+    result = PolkitQt1::Authority::instance()->checkAuthorizationSync("org.kde.polkitkde1.changesystemconfiguration",
+                                                                      subject, PolkitQt1::Authority::AllowUserInteraction);
+    if (result == PolkitQt1::Authority::Yes) {
+        qDebug() << "Authorized successfully";
+        // It's ok
+    } else {
+        // It's not ok
+        qDebug() << "UnAuthorized! " << PolkitQt1::Authority::instance()->lastError();
+        return;
+    }
+
+    // Ok, let's see what we have to save here.
+    QSettings kdesettings("/etc/polkit-1/polkit-kde-1.conf", QSettings::IniFormat);
+    kdesettings.beginGroup("General");
+
+    kdesettings.setValue("ConfigPriority", systemPriority);
+    kdesettings.setValue("PoliciesPriority", policiesPriority);
+
+    QString contents = QString("[Configuration]\nAdminIdentities=%1\n").arg(adminIdentities);
+
+    qDebug() << contents << "will be wrote to the local authority file";
+    QFile wfile(QString("/etc/polkit-1/localauthority.conf.d/%1-polkitkde.conf").arg(systemPriority));
+    wfile.open(QIODevice::WriteOnly | QIODevice::Truncate | QIODevice::Text);
+    wfile.write(contents.toUtf8());
+    wfile.flush();
+    wfile.close();
+
+    // TODO: Move files around if the priority was changed
+}
+
+QVariantList PolkitKde1Helper::retrievePolicies()
+{
+    qDebug() << "Request to retrieve the action authorizations by " << message().service();
+    PolkitQt1::Authority::Result result;
+    PolkitQt1::SystemBusNameSubject *subject;
+
+    subject = new PolkitQt1::SystemBusNameSubject(message().service());
+
+    result = PolkitQt1::Authority::instance()->checkAuthorizationSync("org.kde.polkitkde1.readauthorizations",
+                                                                      subject, PolkitQt1::Authority::AllowUserInteraction);
+    if (result == PolkitQt1::Authority::Yes) {
+        qDebug() << "Authorized successfully";
+        // It's ok
+    } else {
+        // It's not ok
+        qDebug() << "UnAuthorized! " << PolkitQt1::Authority::instance()->lastError();
+        return QVariantList();
+    }
+
+    QVariantList retlist;
+
+    // Iterate over the directory and find out everything
+    QDir baseDir("/var/lib/polkit-1/localauthority/");
+    QFileInfoList baseList = baseDir.entryInfoList(QDir::Dirs | QDir::NoDotAndDotDot);
+
+    foreach (const QFileInfo &info, baseList) {
+        int filePriority = info.baseName().split('-').first().toInt();
+        qDebug() << "Iterating over the directory " << info.absoluteFilePath() << ", which has a priority of " << filePriority;
+
+        QDir nestedDir(info.absoluteFilePath());
+        QFileInfoList nestedList = nestedDir.entryInfoList(QDir::Files);
+
+        foreach (const QFileInfo &nestedInfo, nestedList) {
+            qDebug() << "Parsing file " << nestedInfo.absoluteFilePath();
+            retlist.append(entriesFromFile(filePriority, nestedInfo.absoluteFilePath()));
+        }
+    }
+
+    return retlist;
+}
+
+QVariantList PolkitKde1Helper::entriesFromFile(int filePriority, const QString& filePath)
+{
+    QList< QVariant > retlist;
+    QFile file(filePath);
+    if (!file.open(QIODevice::ReadOnly | QIODevice::Text)) {
+        qWarning() << "Failed to open " << filePath;
+        return QVariantList();
+    }
+
+    int priority = 0;
+
+    QTextStream in(&file);
+    while (!in.atEnd()) {
+        QString line = in.readLine();
+        if (line.startsWith('[')) {
+            // Ok, that's a key entry
+            PKLAEntry entry;
+            entry.title = line.split('[').last().split(']').first();
+            entry.filePriority = filePriority;
+            entry.fileOrder = priority;
+            // Now parse over all the rest
+            while (!in.atEnd()) {
+                QString line = in.readLine();
+                if (line.startsWith("Identity=")) {
+                    entry.identity = line.split("Identity=").last();
+                } else if (line.startsWith("Action=")) {
+                    entry.action = line.split("Action=").last();
+                } else if (line.startsWith("ResultAny=")) {
+                    entry.resultAny = line.split("ResultAny=").last();
+                } else if (line.startsWith("ResultInactive=")) {
+                    entry.resultInactive = line.split("ResultInactive=").last();
+                } else if (line.startsWith("ResultActive=")) {
+                    entry.resultActive = line.split("ResultActive=").last();
+                } else if (line.startsWith('[')) {
+                    // Ouch!!
+                    qWarning() << "The file appears malformed!! " << filePath;
+                    return QVariantList();
+                }
+
+                // Did we parse it all?
+                if (!entry.identity.isEmpty() && !entry.action.isEmpty() && !entry.resultActive.isEmpty() &&
+                    !entry.resultAny.isEmpty() && !entry.resultInactive.isEmpty()) {
+                    // Awesome, add and wave goodbye. And also increase the priority
+                    ++priority;
+                    qDebug() << "PKLA Parsed:" << entry.title << entry.action << entry.identity << entry.resultAny
+                             << entry.resultInactive << entry.resultActive << entry.fileOrder;
+                    retlist.append(QVariant::fromValue(entry));
+                    break;
+                }
+            }
+        }
+    }
+
+    return retlist;
+}
+
diff -Naur kdebase-workspace-4.3.5/polkit-kde-1/kcmodules/helper/polkitkde1helper.h kdebase-workspace-4.3.5-p/polkit-kde-1/kcmodules/helper/polkitkde1helper.h
--- kdebase-workspace-4.3.5/polkit-kde-1/kcmodules/helper/polkitkde1helper.h	1970-01-01 01:00:00.000000000 +0100
+++ kdebase-workspace-4.3.5-p/polkit-kde-1/kcmodules/helper/polkitkde1helper.h	2010-02-13 01:10:55.000000000 +0100
@@ -0,0 +1,36 @@
+/* This file is part of the KDE project
+
+   Copyright (C) 2008 Dario Freddi <drf@kde.org>
+
+   This program is free software; you can redistribute it and/or
+   modify it under the terms of the GNU General Public
+   License as published by the Free Software Foundation; either
+   version 2 of the License, or (at your option) any later version.
+*/
+
+#ifndef POLKITKDE1HELPER_H
+#define POLKITKDE1HELPER_H
+
+#include <QtCore/QObject>
+#include <QtDBus/QDBusContext>
+#include <QtDBus/qdbusargument.h>
+#include "../PKLAEntry.h"
+
+class PolkitKde1Helper : public QObject, protected QDBusContext
+{
+    Q_OBJECT
+    Q_CLASSINFO("D-Bus Interface", "org.kde.polkitkde1.helper")
+
+    public:
+        PolkitKde1Helper(QObject* parent = 0);
+        virtual ~PolkitKde1Helper();
+
+    public Q_SLOTS:
+        void saveGlobalConfiguration(const QString &adminIdentities, int systemPriority, int policiesPriority);
+        QVariantList retrievePolicies();
+
+    private:
+        QVariantList entriesFromFile(int filePriority, const QString &fileContents);
+};
+
+#endif // POLKITKDE1HELPER_H
diff -Naur kdebase-workspace-4.3.5/polkit-kde-1/kcmodules/PKLAEntry.cpp kdebase-workspace-4.3.5-p/polkit-kde-1/kcmodules/PKLAEntry.cpp
--- kdebase-workspace-4.3.5/polkit-kde-1/kcmodules/PKLAEntry.cpp	1970-01-01 01:00:00.000000000 +0100
+++ kdebase-workspace-4.3.5-p/polkit-kde-1/kcmodules/PKLAEntry.cpp	2010-02-13 01:10:55.000000000 +0100
@@ -0,0 +1,31 @@
+/* This file is part of the KDE project
+
+   Copyright (C) 2008 Dario Freddi <drf@kde.org>
+
+   This program is free software; you can redistribute it and/or
+   modify it under the terms of the GNU General Public
+   License as published by the Free Software Foundation; either
+   version 2 of the License, or (at your option) any later version.
+*/
+
+#include "PKLAEntry.h"
+#include <QtDBus/qdbusargument.h>
+
+QDBusArgument& operator<<(QDBusArgument& argument, const PKLAEntry& entry)
+{
+    argument.beginStructure();
+    argument << entry.title << entry.identity << entry.action << entry.resultAny << entry.resultInactive << entry.resultActive
+             << entry.filePriority << entry.fileOrder;
+    argument.endStructure();
+    return argument;
+}
+
+const QDBusArgument& operator>>(const QDBusArgument& argument, PKLAEntry& entry)
+{
+    argument.beginStructure();
+    argument >> entry.title >> entry.identity >> entry.action >> entry.resultAny >> entry.resultInactive >> entry.resultActive
+             >> entry.filePriority >> entry.fileOrder;
+    argument.endStructure();
+    return argument;
+}
+
diff -Naur kdebase-workspace-4.3.5/polkit-kde-1/kcmodules/PKLAEntry.h kdebase-workspace-4.3.5-p/polkit-kde-1/kcmodules/PKLAEntry.h
--- kdebase-workspace-4.3.5/polkit-kde-1/kcmodules/PKLAEntry.h	1970-01-01 01:00:00.000000000 +0100
+++ kdebase-workspace-4.3.5-p/polkit-kde-1/kcmodules/PKLAEntry.h	2010-02-13 01:10:55.000000000 +0100
@@ -0,0 +1,36 @@
+/* This file is part of the KDE project
+
+   Copyright (C) 2008 Dario Freddi <drf@kde.org>
+
+   This program is free software; you can redistribute it and/or
+   modify it under the terms of the GNU General Public
+   License as published by the Free Software Foundation; either
+   version 2 of the License, or (at your option) any later version.
+*/
+
+#ifndef PKLAENTRY_H
+#define PKLAENTRY_H
+#include <QMetaType>
+
+class QDBusArgument;
+
+class PKLAEntry {
+    public:
+    QString title;
+    QString identity;
+    QString action;
+    QString resultAny;
+    QString resultInactive;
+    QString resultActive;
+
+    int filePriority;
+    int fileOrder;
+};
+Q_DECLARE_METATYPE(PKLAEntry)
+
+typedef QList<PKLAEntry> PKLAEntryList;
+
+QDBusArgument& operator<<(QDBusArgument& argument, const PKLAEntry& entry);
+const QDBusArgument& operator>>(const QDBusArgument& argument, PKLAEntry& entry);
+
+#endif // PKLAENTRY_H
diff -Naur kdebase-workspace-4.3.5/polkit-kde-1/kcmodules/polkitactions/ActionWidget.cpp kdebase-workspace-4.3.5-p/polkit-kde-1/kcmodules/polkitactions/ActionWidget.cpp
--- kdebase-workspace-4.3.5/polkit-kde-1/kcmodules/polkitactions/ActionWidget.cpp	1970-01-01 01:00:00.000000000 +0100
+++ kdebase-workspace-4.3.5-p/polkit-kde-1/kcmodules/polkitactions/ActionWidget.cpp	2010-02-13 01:10:55.000000000 +0100
@@ -0,0 +1,143 @@
+/* This file is part of the KDE project
+
+   Copyright (C) 2009 Dario Freddi <drf@kde.org>
+
+   This program is free software; you can redistribute it and/or
+   modify it under the terms of the GNU General Public
+   License as published by the Free Software Foundation; either
+   version 2 of the License, or (at your option) any later version.
+*/
+
+#include "ActionWidget.h"
+
+#include "ui_actionwidget.h"
+
+#include <QtDBus/QDBusMessage>
+#include <QtDBus/QDBusConnection>
+#include <qdbuspendingcall.h>
+#include <QtDBus/qdbusmetatype.h>
+#include <PolkitQt1/ActionDescription>
+#include <QDebug>
+
+namespace PolkitKde {
+
+ActionWidget::ActionWidget(PolkitQt1::ActionDescription* action, QWidget* parent)
+        : QWidget(parent)
+        , m_ui(new Ui::ActionWidget)
+        , m_action(0)
+{
+    m_ui->setupUi(this);
+
+    // Initialize
+    reloadPKLAs();
+
+    setAction(action);
+}
+
+ActionWidget::~ActionWidget()
+{
+
+}
+
+void ActionWidget::reloadPKLAs()
+{
+    m_entries.clear();
+    QDBusMessage message = QDBusMessage::createMethodCall("org.kde.polkitkde1.helper",
+                                                          "/Helper",
+                                                          "org.kde.polkitkde1.helper",
+                                                          QLatin1String("retrievePolicies"));
+    QDBusPendingCall reply = QDBusConnection::systemBus().asyncCall(message);
+    reply.waitForFinished();
+    if (reply.reply().arguments().count() >= 1) {
+        QVariantList vlist;
+        reply.reply().arguments().first().value<QDBusArgument>() >> vlist;
+        foreach (const QVariant &variant, vlist) {
+            PKLAEntry entry;
+            variant.value<QDBusArgument>() >> entry;
+            qDebug() << entry.title;
+            m_entries.append(entry);
+        }
+    }
+
+    if (m_action) {
+        computeActionPolicies();
+    }
+}
+
+void ActionWidget::computeActionPolicies()
+{
+    foreach (const PKLAEntry &entry, m_entries) {
+        QStringList realActions = entry.action.split(';');
+        if (realActions.contains(m_action->actionId())) {
+            // Match! Is it, actually, an implicit override?
+            if (entry.title == "PolkitKdeOverrideImplicit") {
+                // It is!
+                setImplicitAuthorization(implFromText(entry.resultActive), m_ui->activeComboBox);
+                setImplicitAuthorization(implFromText(entry.resultInactive), m_ui->inactiveComboBox);
+                setImplicitAuthorization(implFromText(entry.resultAny), m_ui->anyComboBox);
+            } else {
+                // TODO: Add it to the local auths
+            }
+        }
+    }
+}
+
+PolkitQt1::ActionDescription::ImplicitAuthorization ActionWidget::implFromText(const QString& text)
+{
+    if (text == "yes") {
+        return PolkitQt1::ActionDescription::Authorized;
+    } else if (text == "no") {
+        return PolkitQt1::ActionDescription::NotAuthorized;
+    } else if (text == "auth_admin") {
+        return PolkitQt1::ActionDescription::AdministratorAuthenticationRequired;
+    } else if (text == "auth_admin_keep") {
+        return PolkitQt1::ActionDescription::AdministratorAuthenticationRequiredRetained;
+    } else if (text == "auth_self") {
+        return PolkitQt1::ActionDescription::AuthenticationRequired;
+    } else if (text == "auth_self_keep") {
+        return PolkitQt1::ActionDescription::AuthenticationRequiredRetained;
+    } else {
+        return PolkitQt1::ActionDescription::Unknown;
+    }
+}
+
+void ActionWidget::setImplicitAuthorization(PolkitQt1::ActionDescription::ImplicitAuthorization auth, QComboBox* box)
+{
+    switch (auth) {
+        case PolkitQt1::ActionDescription::Authorized:
+            box->setCurrentIndex(0);
+            break;
+        case PolkitQt1::ActionDescription::NotAuthorized:
+            box->setCurrentIndex(1);
+            break;
+        case PolkitQt1::ActionDescription::AuthenticationRequired:
+            box->setCurrentIndex(4);
+            break;
+        case PolkitQt1::ActionDescription::AuthenticationRequiredRetained:
+            box->setCurrentIndex(5);
+            break;
+        case PolkitQt1::ActionDescription::AdministratorAuthenticationRequired:
+            box->setCurrentIndex(2);
+            break;
+        case PolkitQt1::ActionDescription::AdministratorAuthenticationRequiredRetained:
+            box->setCurrentIndex(3);
+            break;
+    }
+}
+
+void ActionWidget::setAction(PolkitQt1::ActionDescription* action)
+{
+    m_action = action;
+    setImplicitAuthorization(action->implicitActive(), m_ui->activeComboBox);
+    setImplicitAuthorization(action->implicitInactive(), m_ui->inactiveComboBox);
+    setImplicitAuthorization(action->implicitAny(), m_ui->anyComboBox);
+
+    m_ui->descriptionLabel->setText(action->description());
+    m_ui->vendorLabel->setText(action->vendorName());
+    m_ui->vendorLabel->setUrl(action->vendorUrl());
+    m_ui->pixmapLabel->setPixmap(KIcon(action->iconName()).pixmap(64));
+
+    computeActionPolicies();
+}
+
+}
diff -Naur kdebase-workspace-4.3.5/polkit-kde-1/kcmodules/polkitactions/ActionWidget.h kdebase-workspace-4.3.5-p/polkit-kde-1/kcmodules/polkitactions/ActionWidget.h
--- kdebase-workspace-4.3.5/polkit-kde-1/kcmodules/polkitactions/ActionWidget.h	1970-01-01 01:00:00.000000000 +0100
+++ kdebase-workspace-4.3.5-p/polkit-kde-1/kcmodules/polkitactions/ActionWidget.h	2010-02-13 01:10:55.000000000 +0100
@@ -0,0 +1,50 @@
+/* This file is part of the KDE project
+
+   Copyright (C) 2009 Dario Freddi <drf@kde.org>
+
+   This program is free software; you can redistribute it and/or
+   modify it under the terms of the GNU General Public
+   License as published by the Free Software Foundation; either
+   version 2 of the License, or (at your option) any later version.
+*/
+
+#ifndef ACTIONWIDGET_H
+#define ACTIONWIDGET_H
+
+#include <QtGui/QWidget>
+#include "../PKLAEntry.h"
+#include <PolkitQt1/ActionDescription>
+
+class QComboBox;
+namespace Ui {
+class ActionWidget;
+}
+
+namespace PolkitKde {
+
+class ActionWidget : public QWidget
+{
+    Q_OBJECT
+    public:
+        explicit ActionWidget(PolkitQt1::ActionDescription *action, QWidget* parent = 0);
+        virtual ~ActionWidget();
+
+    public Q_SLOTS:
+        void setAction(PolkitQt1::ActionDescription *action);
+        void computeActionPolicies();
+
+    private Q_SLOTS:
+        void reloadPKLAs();
+
+    private:
+        PolkitQt1::ActionDescription::ImplicitAuthorization implFromText(const QString &text);
+        void setImplicitAuthorization(PolkitQt1::ActionDescription::ImplicitAuthorization auth, QComboBox *box);
+
+        Ui::ActionWidget *m_ui;
+        PolkitQt1::ActionDescription *m_action;
+        PKLAEntryList m_entries;
+};
+
+}
+
+#endif // ACTIONWIDGET_H
diff -Naur kdebase-workspace-4.3.5/polkit-kde-1/kcmodules/polkitactions/actionwidget.ui kdebase-workspace-4.3.5-p/polkit-kde-1/kcmodules/polkitactions/actionwidget.ui
--- kdebase-workspace-4.3.5/polkit-kde-1/kcmodules/polkitactions/actionwidget.ui	1970-01-01 01:00:00.000000000 +0100
+++ kdebase-workspace-4.3.5-p/polkit-kde-1/kcmodules/polkitactions/actionwidget.ui	2010-02-13 01:10:55.000000000 +0100
@@ -0,0 +1,277 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<ui version="4.0">
+ <class>ActionWidget</class>
+ <widget class="QWidget" name="ActionWidget">
+  <property name="geometry">
+   <rect>
+    <x>0</x>
+    <y>0</y>
+    <width>412</width>
+    <height>508</height>
+   </rect>
+  </property>
+  <property name="windowTitle">
+   <string/>
+  </property>
+  <layout class="QVBoxLayout" name="verticalLayout_2">
+   <item>
+    <layout class="QHBoxLayout" name="horizontalLayout_3">
+     <item>
+      <widget class="QLabel" name="pixmapLabel">
+       <property name="minimumSize">
+        <size>
+         <width>64</width>
+         <height>64</height>
+        </size>
+       </property>
+       <property name="maximumSize">
+        <size>
+         <width>64</width>
+         <height>64</height>
+        </size>
+       </property>
+       <property name="text">
+        <string/>
+       </property>
+      </widget>
+     </item>
+     <item>
+      <layout class="QVBoxLayout" name="verticalLayout">
+       <item>
+        <widget class="KUrlLabel" name="vendorLabel">
+         <property name="text">
+          <string/>
+         </property>
+        </widget>
+       </item>
+       <item>
+        <widget class="QLabel" name="descriptionLabel">
+         <property name="text">
+          <string/>
+         </property>
+        </widget>
+       </item>
+      </layout>
+     </item>
+    </layout>
+   </item>
+   <item>
+    <widget class="QGroupBox" name="groupBox">
+     <property name="sizePolicy">
+      <sizepolicy hsizetype="Preferred" vsizetype="Preferred">
+       <horstretch>0</horstretch>
+       <verstretch>0</verstretch>
+      </sizepolicy>
+     </property>
+     <property name="maximumSize">
+      <size>
+       <width>16777215</width>
+       <height>16777215</height>
+      </size>
+     </property>
+     <property name="title">
+      <string>Implicit authorizations</string>
+     </property>
+     <layout class="QVBoxLayout" name="verticalLayout_4">
+      <item>
+       <layout class="QFormLayout" name="formLayout">
+        <item row="0" column="0">
+         <widget class="QLabel" name="label">
+          <property name="text">
+           <string>Any</string>
+          </property>
+         </widget>
+        </item>
+        <item row="0" column="1">
+         <widget class="KComboBox" name="anyComboBox">
+          <item>
+           <property name="text">
+            <string>Yes</string>
+           </property>
+          </item>
+          <item>
+           <property name="text">
+            <string>No</string>
+           </property>
+          </item>
+          <item>
+           <property name="text">
+            <string>Administrator Authentication</string>
+           </property>
+          </item>
+          <item>
+           <property name="text">
+            <string>Administrator Authentication (retain)</string>
+           </property>
+          </item>
+          <item>
+           <property name="text">
+            <string>Authentication</string>
+           </property>
+          </item>
+          <item>
+           <property name="text">
+            <string>Authentication (retain)</string>
+           </property>
+          </item>
+         </widget>
+        </item>
+        <item row="1" column="0">
+         <widget class="QLabel" name="label_2">
+          <property name="text">
+           <string>Inactive console</string>
+          </property>
+         </widget>
+        </item>
+        <item row="1" column="1">
+         <widget class="KComboBox" name="inactiveComboBox">
+          <item>
+           <property name="text">
+            <string>Yes</string>
+           </property>
+          </item>
+          <item>
+           <property name="text">
+            <string>No</string>
+           </property>
+          </item>
+          <item>
+           <property name="text">
+            <string>Administrator Authentication</string>
+           </property>
+          </item>
+          <item>
+           <property name="text">
+            <string>Administrator Authentication (retain)</string>
+           </property>
+          </item>
+          <item>
+           <property name="text">
+            <string>Authentication</string>
+           </property>
+          </item>
+          <item>
+           <property name="text">
+            <string>Authentication (retain)</string>
+           </property>
+          </item>
+         </widget>
+        </item>
+        <item row="2" column="0">
+         <widget class="QLabel" name="label_3">
+          <property name="text">
+           <string>Active console</string>
+          </property>
+         </widget>
+        </item>
+        <item row="2" column="1">
+         <widget class="KComboBox" name="activeComboBox">
+          <item>
+           <property name="text">
+            <string>Yes</string>
+           </property>
+          </item>
+          <item>
+           <property name="text">
+            <string>No</string>
+           </property>
+          </item>
+          <item>
+           <property name="text">
+            <string>Administrator Authentication</string>
+           </property>
+          </item>
+          <item>
+           <property name="text">
+            <string>Administrator Authentication (retain)</string>
+           </property>
+          </item>
+          <item>
+           <property name="text">
+            <string>Authentication</string>
+           </property>
+          </item>
+          <item>
+           <property name="text">
+            <string>Authentication (retain)</string>
+           </property>
+          </item>
+         </widget>
+        </item>
+       </layout>
+      </item>
+     </layout>
+    </widget>
+   </item>
+   <item>
+    <widget class="QGroupBox" name="groupBox_2">
+     <property name="title">
+      <string>Local authorizations</string>
+     </property>
+     <layout class="QVBoxLayout" name="verticalLayout_3">
+      <item>
+       <widget class="QScrollArea" name="scrollArea">
+        <property name="widgetResizable">
+         <bool>true</bool>
+        </property>
+        <widget class="QWidget" name="scrollAreaWidgetContents">
+         <property name="geometry">
+          <rect>
+           <x>0</x>
+           <y>0</y>
+           <width>380</width>
+           <height>223</height>
+          </rect>
+         </property>
+        </widget>
+       </widget>
+      </item>
+      <item>
+       <layout class="QHBoxLayout" name="horizontalLayout_2">
+        <item>
+         <spacer name="horizontalSpacer_2">
+          <property name="orientation">
+           <enum>Qt::Horizontal</enum>
+          </property>
+          <property name="sizeHint" stdset="0">
+           <size>
+            <width>40</width>
+            <height>20</height>
+           </size>
+          </property>
+         </spacer>
+        </item>
+        <item>
+         <widget class="KPushButton" name="addLocalButton">
+          <property name="text">
+           <string>Add</string>
+          </property>
+         </widget>
+        </item>
+       </layout>
+      </item>
+     </layout>
+    </widget>
+   </item>
+  </layout>
+ </widget>
+ <customwidgets>
+  <customwidget>
+   <class>KPushButton</class>
+   <extends>QPushButton</extends>
+   <header>kpushbutton.h</header>
+  </customwidget>
+  <customwidget>
+   <class>KUrlLabel</class>
+   <extends>QLabel</extends>
+   <header>kurllabel.h</header>
+  </customwidget>
+  <customwidget>
+   <class>KComboBox</class>
+   <extends>QComboBox</extends>
+   <header>kcombobox.h</header>
+  </customwidget>
+ </customwidgets>
+ <resources/>
+ <connections/>
+</ui>
diff -Naur kdebase-workspace-4.3.5/polkit-kde-1/kcmodules/polkitactions/AuthorizationsFilterModel.cpp kdebase-workspace-4.3.5-p/polkit-kde-1/kcmodules/polkitactions/AuthorizationsFilterModel.cpp
--- kdebase-workspace-4.3.5/polkit-kde-1/kcmodules/polkitactions/AuthorizationsFilterModel.cpp	1970-01-01 01:00:00.000000000 +0100
+++ kdebase-workspace-4.3.5-p/polkit-kde-1/kcmodules/polkitactions/AuthorizationsFilterModel.cpp	2010-02-13 01:10:55.000000000 +0100
@@ -0,0 +1,87 @@
+/*  This file is part of the KDE project
+    Copyright (C) 2008 Dario Freddi <drf54321@gmail.com>
+    Copyright (C) 2009 Daniel Nicoletti <dantti85-pk@yahoo.com.br>
+
+    This program is free software; you can redistribute it and/or
+    modify it under the terms of the GNU General Public
+    License as published by the Free Software Foundation; either
+    version 2 of the License, or (at your option) any later version.
+
+    This library is distributed in the hope that it will be useful,
+    but WITHOUT ANY WARRANTY; without even the implied warranty of
+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+    Library General Public License for more details.
+
+    You should have received a copy of the GNU Library General Public License
+    along with this library; see the file COPYING.LIB.  If not, write to
+    the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor,
+    Boston, MA 02110-1301, USA.
+
+*/
+
+#include "AuthorizationsFilterModel.h"
+
+#include "PoliciesModel.h"
+
+#include <KDebug>
+
+namespace PolkitKde
+{
+
+AuthorizationsFilterModel::AuthorizationsFilterModel(QObject *parent)
+        : QSortFilterProxyModel(parent)
+{
+}
+
+AuthorizationsFilterModel::~AuthorizationsFilterModel()
+{
+}
+
+bool AuthorizationsFilterModel::filterAcceptsRow(int source_row, const QModelIndex &source_parent) const
+{
+    QModelIndex index = sourceModel()->index(source_row, 0, source_parent);
+
+    // if the filter is empty avoid checking since if the model isn't complete populated
+    // some items might be hidden
+    if (filterRegExp().isEmpty()) {
+        return true;
+    }
+
+    if (index.data(PolkitKde::PoliciesModel::IsGroupRole).toBool()) {
+        return groupHasMatchingItem(index);
+    }
+
+    return (index.data(PolkitKde::PoliciesModel::PathRole).toString().contains(filterRegExp()) ||
+            index.data(Qt::DisplayRole).toString().contains(filterRegExp()));
+}
+
+bool AuthorizationsFilterModel::groupHasMatchingItem(const QModelIndex &parent) const
+{
+//     kDebug() << "group" << parent.data(Qt::DisplayRole);
+    for (int i = 0; i < sourceModel()->rowCount(parent); i++) {
+        QModelIndex index = sourceModel()->index(i, 0, parent);
+        // we check to see if the item is a group
+        // if so we call groupHasMatchingItem for that group
+        if (index.data(PolkitKde::PoliciesModel::IsGroupRole).toBool()) {
+            // we call to see if the subgroup has an matching item
+            if (groupHasMatchingItem(sourceModel()->index(i, 0, parent))) {
+                return true;
+            }
+        } else {
+//             kDebug() << "item" << index.data(Qt::DisplayRole);
+            // here we have an action let's see it this match
+            if (index.data(PolkitKde::PoliciesModel::PathRole).toString().contains(filterRegExp()) ||
+                index.data(Qt::DisplayRole).toString().contains(filterRegExp()))
+            {
+                return true;
+            }
+        }
+    }
+    // if we don't find any matching action return false
+    return false;
+}
+
+
+}
+
+#include "AuthorizationsFilterModel.moc"
diff -Naur kdebase-workspace-4.3.5/polkit-kde-1/kcmodules/polkitactions/AuthorizationsFilterModel.h kdebase-workspace-4.3.5-p/polkit-kde-1/kcmodules/polkitactions/AuthorizationsFilterModel.h
--- kdebase-workspace-4.3.5/polkit-kde-1/kcmodules/polkitactions/AuthorizationsFilterModel.h	1970-01-01 01:00:00.000000000 +0100
+++ kdebase-workspace-4.3.5-p/polkit-kde-1/kcmodules/polkitactions/AuthorizationsFilterModel.h	2010-02-13 01:10:55.000000000 +0100
@@ -0,0 +1,47 @@
+/*  This file is part of the KDE project
+    Copyright (C) 2008 Dario Freddi <drf54321@gmail.com>
+    Copyright (C) 2009 Daniel Nicoletti <dantti85-pk@yahoo.com.br>
+
+    This program is free software; you can redistribute it and/or
+    modify it under the terms of the GNU General Public
+    License as published by the Free Software Foundation; either
+    version 2 of the License, or (at your option) any later version.
+
+    This library is distributed in the hope that it will be useful,
+    but WITHOUT ANY WARRANTY; without even the implied warranty of
+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+    Library General Public License for more details.
+
+    You should have received a copy of the GNU Library General Public License
+    along with this library; see the file COPYING.LIB.  If not, write to
+    the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor,
+    Boston, MA 02110-1301, USA.
+
+*/
+
+#ifndef AUTHORIZATIONSFILTERMODEL_H
+#define AUTHORIZATIONSFILTERMODEL_H
+
+#include <QSortFilterProxyModel>
+
+namespace PolkitKde
+{
+
+class AuthorizationsFilterModel : public QSortFilterProxyModel
+{
+    Q_OBJECT
+
+public:
+    AuthorizationsFilterModel(QObject *parent = 0);
+    ~AuthorizationsFilterModel();
+
+protected:
+    bool filterAcceptsRow(int source_row, const QModelIndex &source_parent) const;
+
+private:
+    bool groupHasMatchingItem(const QModelIndex &parent) const;
+};
+
+}
+
+#endif /* AUTHORIZATIONSFILTERMODEL_H */
diff -Naur kdebase-workspace-4.3.5/polkit-kde-1/kcmodules/polkitactions/CMakeLists.txt kdebase-workspace-4.3.5-p/polkit-kde-1/kcmodules/polkitactions/CMakeLists.txt
--- kdebase-workspace-4.3.5/polkit-kde-1/kcmodules/polkitactions/CMakeLists.txt	1970-01-01 01:00:00.000000000 +0100
+++ kdebase-workspace-4.3.5-p/polkit-kde-1/kcmodules/polkitactions/CMakeLists.txt	2010-02-13 01:10:55.000000000 +0100
@@ -0,0 +1,29 @@
+set( kcm_polkitactions_SRCS
+    PolkitActionsKCM.cpp
+    AuthorizationsFilterModel.cpp
+    PoliciesModel.cpp
+    PolicyItem.cpp
+    ActionWidget.cpp
+    ../PKLAEntry.cpp
+    pkitemdelegate.cpp
+)
+
+kde4_add_ui_files(kcm_polkitactions_SRCS
+    mainview.ui
+    explicitwidget.ui
+    actionwidget.ui)
+
+kde4_add_plugin(kcm_polkitactions ${kcm_polkitactions_SRCS})
+
+target_link_libraries(kcm_polkitactions
+     ${KDE4_KDECORE_LIBS}
+     ${KDE4_KDEUI_LIBRARY}
+     ${POLKITQT-1_CORE_LIBRARY}
+)
+
+install(TARGETS kcm_polkitactions  DESTINATION ${PLUGIN_INSTALL_DIR} )
+
+
+########### install files ###############
+
+install( FILES kcm_polkitactions.desktop  DESTINATION  ${SERVICES_INSTALL_DIR} )
\ Kein Zeilenumbruch am Dateiende.
diff -Naur kdebase-workspace-4.3.5/polkit-kde-1/kcmodules/polkitactions/explicitwidget.ui kdebase-workspace-4.3.5-p/polkit-kde-1/kcmodules/polkitactions/explicitwidget.ui
--- kdebase-workspace-4.3.5/polkit-kde-1/kcmodules/polkitactions/explicitwidget.ui	1970-01-01 01:00:00.000000000 +0100
+++ kdebase-workspace-4.3.5-p/polkit-kde-1/kcmodules/polkitactions/explicitwidget.ui	2010-02-13 01:10:55.000000000 +0100
@@ -0,0 +1,247 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<ui version="4.0">
+ <class>ExplicitAuthorizationWidget</class>
+ <widget class="QWidget" name="ExplicitAuthorizationWidget">
+  <property name="geometry">
+   <rect>
+    <x>0</x>
+    <y>0</y>
+    <width>434</width>
+    <height>153</height>
+   </rect>
+  </property>
+  <property name="windowTitle">
+   <string/>
+  </property>
+  <layout class="QHBoxLayout" name="horizontalLayout_3">
+   <item>
+    <layout class="QVBoxLayout" name="verticalLayout_2">
+     <item>
+      <layout class="QHBoxLayout" name="horizontalLayout">
+       <item>
+        <widget class="KComboBox" name="identityTypeBox">
+         <item>
+          <property name="text">
+           <string>User</string>
+          </property>
+         </item>
+         <item>
+          <property name="text">
+           <string>Group</string>
+          </property>
+         </item>
+        </widget>
+       </item>
+       <item>
+        <widget class="KComboBox" name="identityBox"/>
+       </item>
+       <item>
+        <spacer name="horizontalSpacer">
+         <property name="orientation">
+          <enum>Qt::Horizontal</enum>
+         </property>
+         <property name="sizeHint" stdset="0">
+          <size>
+           <width>78</width>
+           <height>20</height>
+          </size>
+         </property>
+        </spacer>
+       </item>
+       <item>
+        <widget class="KPushButton" name="removeButton">
+         <property name="text">
+          <string>Remove</string>
+         </property>
+        </widget>
+       </item>
+      </layout>
+     </item>
+     <item>
+      <layout class="QFormLayout" name="formLayout">
+       <item row="0" column="0">
+        <widget class="QLabel" name="label_2">
+         <property name="text">
+          <string>Any</string>
+         </property>
+        </widget>
+       </item>
+       <item row="0" column="1">
+        <widget class="KComboBox" name="anyComboBox">
+         <item>
+          <property name="text">
+           <string>Yes</string>
+          </property>
+         </item>
+         <item>
+          <property name="text">
+           <string>No</string>
+          </property>
+         </item>
+         <item>
+          <property name="text">
+           <string>Administrator Authentication (one shot)</string>
+          </property>
+         </item>
+         <item>
+          <property name="text">
+           <string>Administrator Authentication (retain)</string>
+          </property>
+         </item>
+         <item>
+          <property name="text">
+           <string>Authentication (one shot)</string>
+          </property>
+         </item>
+         <item>
+          <property name="text">
+           <string>Authentication (retain)</string>
+          </property>
+         </item>
+        </widget>
+       </item>
+       <item row="1" column="0">
+        <widget class="QLabel" name="label_3">
+         <property name="text">
+          <string>Inactive console</string>
+         </property>
+        </widget>
+       </item>
+       <item row="1" column="1">
+        <widget class="KComboBox" name="inactiveComboBox">
+         <item>
+          <property name="text">
+           <string>Yes</string>
+          </property>
+         </item>
+         <item>
+          <property name="text">
+           <string>No</string>
+          </property>
+         </item>
+         <item>
+          <property name="text">
+           <string>Administrator Authentication (one shot)</string>
+          </property>
+         </item>
+         <item>
+          <property name="text">
+           <string>Administrator Authentication (retain)</string>
+          </property>
+         </item>
+         <item>
+          <property name="text">
+           <string>Authentication (one shot)</string>
+          </property>
+         </item>
+         <item>
+          <property name="text">
+           <string>Authentication (retain)</string>
+          </property>
+         </item>
+        </widget>
+       </item>
+       <item row="2" column="0">
+        <widget class="QLabel" name="label_4">
+         <property name="text">
+          <string>Active console</string>
+         </property>
+        </widget>
+       </item>
+       <item row="2" column="1">
+        <widget class="KComboBox" name="kcombobox_3">
+         <item>
+          <property name="text">
+           <string>Yes</string>
+          </property>
+         </item>
+         <item>
+          <property name="text">
+           <string>No</string>
+          </property>
+         </item>
+         <item>
+          <property name="text">
+           <string>Administrator Authentication (one shot)</string>
+          </property>
+         </item>
+         <item>
+          <property name="text">
+           <string>Administrator Authentication (retain)</string>
+          </property>
+         </item>
+         <item>
+          <property name="text">
+           <string>Authentication (one shot)</string>
+          </property>
+         </item>
+         <item>
+          <property name="text">
+           <string>Authentication (retain)</string>
+          </property>
+         </item>
+        </widget>
+       </item>
+      </layout>
+     </item>
+    </layout>
+   </item>
+   <item>
+    <layout class="QVBoxLayout" name="verticalLayout">
+     <item>
+      <widget class="KPushButton" name="kpushbutton">
+       <property name="minimumSize">
+        <size>
+         <width>32</width>
+         <height>32</height>
+        </size>
+       </property>
+       <property name="maximumSize">
+        <size>
+         <width>32</width>
+         <height>32</height>
+        </size>
+       </property>
+       <property name="baseSize">
+        <size>
+         <width>32</width>
+         <height>32</height>
+        </size>
+       </property>
+      </widget>
+     </item>
+     <item>
+      <widget class="KPushButton" name="kpushbutton_2">
+       <property name="minimumSize">
+        <size>
+         <width>32</width>
+         <height>32</height>
+        </size>
+       </property>
+       <property name="maximumSize">
+        <size>
+         <width>32</width>
+         <height>32</height>
+        </size>
+       </property>
+      </widget>
+     </item>
+    </layout>
+   </item>
+  </layout>
+ </widget>
+ <customwidgets>
+  <customwidget>
+   <class>KPushButton</class>
+   <extends>QPushButton</extends>
+   <header>kpushbutton.h</header>
+  </customwidget>
+  <customwidget>
+   <class>KComboBox</class>
+   <extends>QComboBox</extends>
+   <header>kcombobox.h</header>
+  </customwidget>
+ </customwidgets>
+ <resources/>
+ <connections/>
+</ui>
diff -Naur kdebase-workspace-4.3.5/polkit-kde-1/kcmodules/polkitactions/kcm_polkitactions.desktop kdebase-workspace-4.3.5-p/polkit-kde-1/kcmodules/polkitactions/kcm_polkitactions.desktop
--- kdebase-workspace-4.3.5/polkit-kde-1/kcmodules/polkitactions/kcm_polkitactions.desktop	1970-01-01 01:00:00.000000000 +0100
+++ kdebase-workspace-4.3.5-p/polkit-kde-1/kcmodules/polkitactions/kcm_polkitactions.desktop	2010-02-13 01:10:55.000000000 +0100
@@ -0,0 +1,63 @@
+[Desktop Entry]
+Exec=kcmshell4 kcm_polkitactions
+Icon=system-lock-screen
+Type=Service
+X-KDE-ServiceTypes=KCModule
+#X-DocPath=kcontrol/powerdevil/index.html
+
+X-KDE-Library=kcm_polkitactions
+X-KDE-ParentApp=kcontrol
+
+X-KDE-System-Settings-Parent-Category=system-policies
+
+Name=Actions policy
+Name[ca]=Política d'accions
+Name[ca@valencia]=Política d'accions
+Name[cs]=Pravidla činností
+Name[da]=Politik for handlinger
+Name[de]=Aktionsregeln
+Name[en_GB]=Actions policy
+Name[es]=Política de acciones
+Name[et]=Toimingute reegel
+Name[fi]=Toimintojen menettelytapa
+Name[fr]=Stratégie des actions
+Name[it]=Politiche delle azioni
+Name[km]=គោលនយោបាយ​សកម្មភាព
+Name[lv]=Darbību politika
+Name[nb]=Praksis for handlinger
+Name[nds]=Akschonenregel
+Name[nl]=Beleid voor acties
+Name[pt]=Política das acções
+Name[pt_BR]=Política de ações
+Name[ro]=Politică acțiuni
+Name[sv]=Åtgärdspolicy
+Name[uk]=Правила дій
+Name[x-test]=xxActions policyxx
+Name[zh_TW]=動作政策
+
+Comment=Configure policies for trusted actions in the system
+Comment[ca]=Configura les polítiques per accions fiables en el sistema
+Comment[ca@valencia]=Configura les polítiques per accions fiables en el sistema
+Comment[cs]=Nastavit pravidla pro důvěryhodné činnosti v systému
+Comment[da]=Indstil politikker for betroede handlinger i systemet
+Comment[de]=Regeln für vertrauliche Aktionen im System einrichten
+Comment[en_GB]=Configure policies for trusted actions in the system
+Comment[es]=Configurar políticas para acciones de confianza en el sistema
+Comment[et]=Süsteemi usaldusväärsete toimingute reeglite seadistamine
+Comment[fi]=Asetusmenettelytavat luetuille toimnoille järjestelmässä
+Comment[fr]=Configurer les stratégies pour les actions sécurisées dans le système
+Comment[it]=Configura le politiche delle azioni fidate nel sistema
+Comment[km]=កំណត់​រចនាសម្ព័ន្ធ​គោលនយោបាយ​ សម្រាប់​សកម្មភាព​ដែល​ទុកចិត្ត​នៅ​ក្នុង​ប្រព័ន្ធ
+Comment[lv]=Konfigurēt politikas uzticamajām darbībām sistēmā
+Comment[nb]=Sett opp praksis for tiltrodde handlinger i systemet
+Comment[nds]=Regeln för troot Akschonen op Dien Systeem fastleggen
+Comment[nl]=Beleid voor vertrouwde acties in het systeem configureren
+Comment[pt]=Configurar as políticas para as acções fidedignas no sistema
+Comment[pt_BR]=Configura as políticas para as ações confiáveis no sistema
+Comment[ro]=Configurează politici pentru acțiunile de încredere în sistem
+Comment[sv]=Anpassa policy för pålitliga åtgärder i systemet
+Comment[uk]=Налаштування правил щодо виконання довірених дій у системі
+Comment[x-test]=xxConfigure policies for trusted actions in the systemxx
+Comment[zh_TW]=設定系統中可信任動作的政策
+
+X-KDE-Keywords=system,policy,policies,security,polkit,policykit,password
diff -Naur kdebase-workspace-4.3.5/polkit-kde-1/kcmodules/polkitactions/mainview.ui kdebase-workspace-4.3.5-p/polkit-kde-1/kcmodules/polkitactions/mainview.ui
--- kdebase-workspace-4.3.5/polkit-kde-1/kcmodules/polkitactions/mainview.ui	1970-01-01 01:00:00.000000000 +0100
+++ kdebase-workspace-4.3.5-p/polkit-kde-1/kcmodules/polkitactions/mainview.ui	2010-02-13 01:10:55.000000000 +0100
@@ -0,0 +1,45 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<ui version="4.0">
+ <class>PolkitActionsMainView</class>
+ <widget class="QWidget" name="PolkitActionsMainView">
+  <property name="geometry">
+   <rect>
+    <x>0</x>
+    <y>0</y>
+    <width>508</width>
+    <height>526</height>
+   </rect>
+  </property>
+  <property name="windowTitle">
+   <string/>
+  </property>
+  <layout class="QHBoxLayout" name="horizontalLayout">
+   <item>
+    <layout class="QVBoxLayout" name="verticalLayout">
+     <item>
+      <widget class="KLineEdit" name="searchLine"/>
+     </item>
+     <item>
+      <widget class="QTreeView" name="treeView"/>
+     </item>
+    </layout>
+   </item>
+   <item>
+    <widget class="QLabel" name="label">
+     <property name="text">
+      <string>Pick an action on the right</string>
+     </property>
+    </widget>
+   </item>
+  </layout>
+ </widget>
+ <customwidgets>
+  <customwidget>
+   <class>KLineEdit</class>
+   <extends>QLineEdit</extends>
+   <header>klineedit.h</header>
+  </customwidget>
+ </customwidgets>
+ <resources/>
+ <connections/>
+</ui>
diff -Naur kdebase-workspace-4.3.5/polkit-kde-1/kcmodules/polkitactions/Messages.sh kdebase-workspace-4.3.5-p/polkit-kde-1/kcmodules/polkitactions/Messages.sh
--- kdebase-workspace-4.3.5/polkit-kde-1/kcmodules/polkitactions/Messages.sh	1970-01-01 01:00:00.000000000 +0100
+++ kdebase-workspace-4.3.5-p/polkit-kde-1/kcmodules/polkitactions/Messages.sh	2010-02-13 01:10:55.000000000 +0100
@@ -0,0 +1,4 @@
+#! /bin/sh
+$EXTRACTRC `find -name \*.ui -o -name \*.rc -o -name \*.kcfg` >> rc.cpp || exit 11
+$XGETTEXT `find -name \*.cpp -o -name \*.h` -o $podir/kcm_polkitactions.pot
+rm -f rc.cpp
diff -Naur kdebase-workspace-4.3.5/polkit-kde-1/kcmodules/polkitactions/pkitemdelegate.cpp kdebase-workspace-4.3.5-p/polkit-kde-1/kcmodules/polkitactions/pkitemdelegate.cpp
--- kdebase-workspace-4.3.5/polkit-kde-1/kcmodules/polkitactions/pkitemdelegate.cpp	1970-01-01 01:00:00.000000000 +0100
+++ kdebase-workspace-4.3.5-p/polkit-kde-1/kcmodules/polkitactions/pkitemdelegate.cpp	2010-02-13 01:10:55.000000000 +0100
@@ -0,0 +1,142 @@
+/*  This file is part of the KDE project
+    Copyright (C) 2008 Alessandro Diaferia <alediaferia@gmail.com>
+
+    This program is free software; you can redistribute it and/or
+    modify it under the terms of the GNU General Public
+    License as published by the Free Software Foundation; either
+    version 2 of the License, or (at your option) any later version.
+
+    This library is distributed in the hope that it will be useful,
+    but WITHOUT ANY WARRANTY; without even the implied warranty of
+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+    Library General Public License for more details.
+
+    You should have received a copy of the GNU Library General Public License
+    along with this library; see the file COPYING.LIB.  If not, write to
+    the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor,
+    Boston, MA 02110-1301, USA.
+*/
+#include "pkitemdelegate.h"
+#include "PoliciesModel.h"
+
+#include <QStyleOptionViewItemV4>
+#include <QPainter>
+#include <QApplication>
+#include <QFontMetrics>
+
+#include <KIcon>
+#include <KGlobalSettings>
+#include <KDebug>
+
+const int ITEM_ROW_HEIGHT = 32;
+const int GROUP_ROW_HEIGHT = 22;
+const int ICON_SIZE = 22;
+const int MARGIN = 1;
+
+namespace PolkitKde {
+
+PkItemDelegate::PkItemDelegate(QObject *parent) : QStyledItemDelegate(parent)
+{}
+
+PkItemDelegate::~PkItemDelegate()
+{}
+
+void PkItemDelegate::paint(QPainter *painter, const QStyleOptionViewItem &option,
+                           const QModelIndex &index) const
+{
+    QStyleOptionViewItemV4 opt(option);
+
+    const int gHeight = (opt.rect.height() > GROUP_ROW_HEIGHT) ? opt.rect.height() : GROUP_ROW_HEIGHT;
+    const int iHeight = (opt.rect.height() > ITEM_ROW_HEIGHT) ? opt.rect.height() : ITEM_ROW_HEIGHT;
+    const int ROW_HEIGHT = index.data(PolkitKde::PoliciesModel::IsGroupRole).toBool() ? gHeight : iHeight;
+
+    QStyle *style = QApplication::style();
+    style->drawPrimitive(QStyle::PE_PanelItemViewItem, &opt, painter, opt.widget);
+
+    QPixmap pixmap(opt.rect.size());
+    pixmap.fill(Qt::transparent);
+    QPainter p(&pixmap);
+    p.translate(-opt.rect.topLeft());
+
+    QRect clipRect(opt.rect);
+    p.setClipRect(clipRect);
+
+    // here we draw the icon
+    KIcon icon(qvariant_cast<QIcon>(index.data(Qt::DecorationRole)));
+
+    QIcon::Mode iconMode = QIcon::Normal;
+
+    if (opt.state & QStyle::State_MouseOver) {
+        iconMode = QIcon::Active;
+    }
+
+    QRect iconRect(opt.rect.topLeft(), QSize(ICON_SIZE, ICON_SIZE));
+    const QRect iconPlaceRect(opt.rect.topLeft(), QSize(ROW_HEIGHT, ROW_HEIGHT));
+    iconRect.moveCenter(iconPlaceRect.center());
+    icon.paint(&p, iconRect, Qt::AlignCenter, iconMode);
+
+    QColor foregroundColor = (opt.state.testFlag(QStyle::State_Selected)) ?
+                             opt.palette.color(QPalette::HighlightedText) : opt.palette.color(QPalette::Text);
+
+    p.setPen(foregroundColor);
+
+    // here we draw the action description
+    clipRect.setSize(QSize(opt.rect.width() - ROW_HEIGHT - MARGIN, ROW_HEIGHT / 2));
+    clipRect.translate(ROW_HEIGHT + MARGIN, 0);
+    p.setClipRect(clipRect);
+
+    QFont descriptionFont = opt.font;
+    if (index.model()->hasChildren(index)) {
+        descriptionFont.setBold(true);
+    }
+    descriptionFont.setPointSize(descriptionFont.pointSize());
+    p.setFont(descriptionFont);
+
+    // let's differ groups from items
+    if (index.data(PolkitKde::PoliciesModel::IsGroupRole).toBool()) { // it is a group item
+        clipRect.setSize(QSize(clipRect.width(), GROUP_ROW_HEIGHT));
+        p.setClipRect(clipRect);
+        p.drawText(clipRect, Qt::AlignLeft | Qt::AlignVCenter, index.data(Qt::DisplayRole).toString());
+    } else { // it is a normal item
+        p.drawText(clipRect, Qt::AlignLeft | Qt::AlignBottom, index.data(Qt::DisplayRole).toString());
+
+        // here we draw the action raw name
+        clipRect.translate(0, qApp->fontMetrics().height());
+        p.setClipRect(clipRect);
+
+        QFont actionNameFont = KGlobalSettings::smallestReadableFont();
+        actionNameFont.setItalic(true);
+        p.setFont(actionNameFont);
+        p.drawText(clipRect, Qt::AlignLeft | Qt::AlignVCenter, index.data(PolkitKde::PoliciesModel::PathRole).toString());
+    }
+
+    p.end();
+
+    painter->drawPixmap(opt.rect.topLeft(), pixmap);
+}
+
+QSize PkItemDelegate::sizeHint(const QStyleOptionViewItem &option, const QModelIndex &index) const
+{
+    QFont dFont = option.font;
+
+
+    const QFont rFont = KGlobalSettings::smallestReadableFont();
+
+    QFontMetrics d_fm(dFont); // description font
+    QFontMetrics r_fm(rFont); // raw string font
+
+//     PolkitKde::AuthorizationsModel::EntryType type = (PolkitKde::AuthorizationsModel::EntryType)index.data(PolkitKde::AuthorizationsModel::Entry48Role).toInt();
+    if (index.data(PolkitKde::PoliciesModel::IsGroupRole).toBool()) {
+        dFont.setBold(true);
+        d_fm = QFontMetrics(dFont);
+        return QSize(qMax(d_fm.width(index.data(Qt::DisplayRole).toString()),
+                          d_fm.width(index.data(PolkitKde::PoliciesModel::PathRole).toString())),
+                     qMax(GROUP_ROW_HEIGHT, d_fm.height()));
+    }
+
+    return QSize(qMax(d_fm.width(index.data(Qt::DisplayRole).toString()),
+                      d_fm.width(index.data(PolkitKde::PoliciesModel::PathRole).toString())),
+                 qMax(ITEM_ROW_HEIGHT, d_fm.height() + r_fm.height()));
+}
+
+}
diff -Naur kdebase-workspace-4.3.5/polkit-kde-1/kcmodules/polkitactions/pkitemdelegate.h kdebase-workspace-4.3.5-p/polkit-kde-1/kcmodules/polkitactions/pkitemdelegate.h
--- kdebase-workspace-4.3.5/polkit-kde-1/kcmodules/polkitactions/pkitemdelegate.h	1970-01-01 01:00:00.000000000 +0100
+++ kdebase-workspace-4.3.5-p/polkit-kde-1/kcmodules/polkitactions/pkitemdelegate.h	2010-02-13 01:10:55.000000000 +0100
@@ -0,0 +1,43 @@
+/*  This file is part of the KDE project
+    Copyright (C) 2008 Alessandro Diaferia <alediaferia@gmail.com>
+
+    This program is free software; you can redistribute it and/or
+    modify it under the terms of the GNU General Public
+    License as published by the Free Software Foundation; either
+    version 2 of the License, or (at your option) any later version.
+
+    This library is distributed in the hope that it will be useful,
+    but WITHOUT ANY WARRANTY; without even the implied warranty of
+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+    Library General Public License for more details.
+
+    You should have received a copy of the GNU Library General Public License
+    along with this library; see the file COPYING.LIB.  If not, write to
+    the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor,
+    Boston, MA 02110-1301, USA.
+*/
+#ifndef PKITEMDELEGATE_H
+#define PKITEMDELEGATE_H
+
+#include <QStyledItemDelegate>
+
+class QStyleOptionViewItem;
+
+namespace PolkitKde {
+
+class PkItemDelegate : public QStyledItemDelegate
+{
+    Q_OBJECT
+
+public:
+    PkItemDelegate(QObject *parent = 0);
+    ~PkItemDelegate();
+
+    void paint(QPainter *painter, const QStyleOptionViewItem &option, const QModelIndex &index) const;
+    QSize sizeHint(const QStyleOptionViewItem &option, const QModelIndex &index) const;
+
+};
+
+}
+
+#endif
diff -Naur kdebase-workspace-4.3.5/polkit-kde-1/kcmodules/polkitactions/PoliciesModel.cpp kdebase-workspace-4.3.5-p/polkit-kde-1/kcmodules/polkitactions/PoliciesModel.cpp
--- kdebase-workspace-4.3.5/polkit-kde-1/kcmodules/polkitactions/PoliciesModel.cpp	1970-01-01 01:00:00.000000000 +0100
+++ kdebase-workspace-4.3.5-p/polkit-kde-1/kcmodules/polkitactions/PoliciesModel.cpp	2010-02-13 01:10:55.000000000 +0100
@@ -0,0 +1,291 @@
+/***************************************************************************
+ *   Copyright (C) 2009 by Daniel Nicoletti                                *
+ *   dantti85-pk@yahoo.com.br                                              *
+ *   Copyright (C) 2009 by Dario Freddi                                    *
+ *   drf@kde.org                                                           *
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ *   This program is distributed in the hope that it will be useful,       *
+ *   but WITHOUT ANY WARRANTY; without even the implied warranty of        *
+ *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the         *
+ *   GNU General Public License for more details.                          *
+ *                                                                         *
+ *   You should have received a copy of the GNU General Public License     *
+ *   along with this program; if not, write to the                         *
+ *   Free Software Foundation, Inc.,                                       *
+ *   51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA .        *
+ ***************************************************************************/
+
+#include "PoliciesModel.h"
+
+#include <QStringList>
+#include <KDebug>
+
+#include "PolicyItem.h"
+
+using namespace PolkitKde;
+
+PoliciesModel::PoliciesModel(QObject *parent)
+    : QAbstractItemModel(parent)
+{
+    rootItem = new PolicyItem(true);
+}
+
+PoliciesModel::~PoliciesModel()
+{
+    delete rootItem;
+}
+
+int PoliciesModel::columnCount(const QModelIndex &parent) const
+{
+    Q_UNUSED(parent)
+    return 1;
+}
+
+QVariant PoliciesModel::data(const QModelIndex &index, int role) const
+{
+    if (!index.isValid())
+        return QVariant();
+
+    PolicyItem *item = static_cast<PolicyItem*>(index.internalPointer());
+
+    return item->data(role);
+}
+
+Qt::ItemFlags PoliciesModel::flags(const QModelIndex &index) const
+{
+    if (!index.isValid())
+        return 0;
+
+    return Qt::ItemIsEnabled | Qt::ItemIsSelectable;
+}
+
+QModelIndex PoliciesModel::index(int row, int column, const QModelIndex &parent)
+            const
+{
+    if (!hasIndex(row, column, parent))
+        return QModelIndex();
+
+    PolicyItem *parentItem;
+
+    if (!parent.isValid())
+        parentItem = rootItem;
+    else
+        parentItem = static_cast<PolicyItem*>(parent.internalPointer());
+
+    PolicyItem *childItem = parentItem->child(row);
+    if (childItem)
+        return createIndex(row, column, childItem);
+    else
+        return QModelIndex();
+}
+
+QModelIndex PoliciesModel::parent(const QModelIndex &index) const
+{
+    if (!index.isValid())
+        return QModelIndex();
+
+    PolicyItem *childItem = static_cast<PolicyItem*>(index.internalPointer());
+    PolicyItem *parentItem = childItem->parent();
+
+    if (parentItem == rootItem)
+        return QModelIndex();
+
+    return createIndex(parentItem->row(), 0, parentItem);
+}
+
+int PoliciesModel::rowCount(const QModelIndex &parent) const
+{
+    PolicyItem *parentItem;
+    if (parent.column() > 0)
+        return 0;
+
+    if (!parent.isValid())
+        parentItem = rootItem;
+    else
+        parentItem = static_cast<PolicyItem*>(parent.internalPointer());
+
+    return parentItem->childCount();
+}
+
+void PoliciesModel::setCurrentEntries(const PolkitQt1::ActionDescription::List &entries)
+{
+    // before inserting let's remove entries (policies)
+    // that don't exist anymore
+    QStringList stringEntries;
+    foreach(PolkitQt1::ActionDescription *entry, entries) {
+        stringEntries.append(entry->actionId());
+    }
+    removeEntries(stringEntries, rootItem);
+
+    // now we insert or update all the items
+    foreach(PolkitQt1::ActionDescription *entry, entries) {
+        QStringList actionPath;
+        actionPath = entry->actionId().split('.');
+        if (actionPath.size() > 2) {
+            // if we have an action id bigger than
+            // "org.kde"
+            QString rootString = actionPath.takeFirst();
+            rootString += '.' + actionPath.takeFirst();
+            actionPath.prepend(rootString);
+            insertOrUpdate(actionPath, entry, rootItem);
+        } else if (actionPath.size() > 1) {
+            // although pretty weird and probably
+            // bad behavior, here we check if the action
+            // id is bigger than "org"
+            insertOrUpdate(actionPath, entry, rootItem);
+        } else {
+            kWarning() << "Bad Policy file entry" << entry->actionId() << entry;
+        }
+    }
+}
+
+QModelIndex PoliciesModel::indexFromId(const QString &id) const
+{
+    return indexFromId(id, rootItem);
+}
+
+QModelIndex PoliciesModel::indexFromId(const QString &id, PolicyItem *parent) const
+{
+    for (int i = 0; i < parent->childCount(); i++) {
+        PolicyItem *item = parent->child(i);
+//         kDebug() << "ITEM" << item->data(PathRole).toString() << parent->childCount();
+        if (item->isGroup()) {
+            const QModelIndex index = indexFromId(id, item);
+            if (index != QModelIndex()) {
+                return index;
+            }
+        } else if (id == item->data(PathRole).toString()) {
+            if (parent == rootItem) {
+                // i doubt this would ever happen :D
+                return QModelIndex();
+            } else{
+                return createIndex(item->row(), 0, item);
+            }
+        }
+    }
+    return QModelIndex();
+}
+
+bool PoliciesModel::removeEntries(const QStringList &entries, PolicyItem *parent)
+{
+    for (int i = 0; i < parent->childCount(); i++) {
+        PolicyItem *item = parent->child(i);
+//         kDebug() << "ITEM" << item->data(PathRole).toString() << parent->childCount();
+        if (item->isGroup()) {
+            if (!removeEntries(entries, item)) {
+                // removeEntries returns true if the action does
+                // not have any children
+                // if there are items let's continue to the next item
+                continue;
+            }
+        } else {
+            bool found = false;
+            // lets see if this action still exists in the new list
+            foreach (const QString &entry, entries) {
+                if (entry == item->data(PathRole).toString()) {
+                    found = true;
+                    break;
+                }
+            }
+            if (found) {
+                // if we found it let's go to the next item
+                continue;
+            }
+        }
+        // if we got here we can remove
+        QModelIndex index;
+        if (parent != rootItem) {
+            index = createIndex(parent->row(), 0, parent);
+        }
+//         kDebug() << "REMOVING" << item->data(PathRole).toString() << index;
+        beginRemoveRows(index, item->row(), item->row());
+        parent->removeChild(item);
+        endRemoveRows();
+        // we decrement the iterator as
+        // the item was removed ;)
+        i--;
+    }
+    return parent->childCount() == 0;
+}
+
+void PoliciesModel::insertOrUpdate(const QStringList &actionPath, PolkitQt1::ActionDescription *entry,
+                                   PolicyItem *parent, int level)
+{
+//     kDebug() << actionPath << actionPath.size() << entry << level << parent;
+    if (actionPath.size() - 1 == level) {
+        // if the actionPath size is equal as
+        // the leve we are about to insert the
+        // action itself
+        QString path = actionPath.join(".");
+        PolicyItem *action = 0;
+        for (int i = 0; i < parent->childCount(); i++) {
+            if (!parent->child(i)->isGroup() && path == parent->child(i)->data(PathRole)) {
+                action = parent->child(i);
+                break;
+            }
+        }
+        QModelIndex index;
+        if (parent != rootItem) {
+            index = createIndex(parent->row(), 0, parent);
+        }
+        if (action) {
+            // ok action found let's update it.
+//             kDebug() << "Updating action:" << path << index;
+            action->setPolkitEntry(entry);
+            emit dataChanged(index, index);
+        } else {
+            // action not found lets add one
+//             kDebug() << "Adding action:" << path << index;
+            beginInsertRows(index, parent->childCount(), parent->childCount());
+            parent->appendChild(action = new PolicyItem(false, parent));
+            action->setPolkitEntry(entry);
+            endInsertRows();
+            // Update the parent
+            emit dataChanged(index, index);
+        }
+    } else {
+        // here we are adding or finding a group
+        QString path = actionPath.at(level);
+        PolicyItem *group = 0;
+        for (int i = 0; i < parent->childCount(); i++) {
+            if (parent->child(i)->isGroup() && path == parent->child(i)->data(PathRole)) {
+                group = parent->child(i);
+                break;
+            }
+        }
+        if (group) {
+//             kDebug() << "Group Found" << path;
+            insertOrUpdate(actionPath, entry, group, level + 1);
+        } else {
+            // ok we didn't find the group
+            // let's add the group
+            QModelIndex index;
+            if (parent != rootItem) {
+                index = createIndex(parent->row(), 0, parent);
+            }
+//             kDebug() << "Group NOT Found, adding one: " << path << index;
+            beginInsertRows(index, parent->childCount(), parent->childCount());
+            parent->appendChild(group = new PolicyItem(true, parent));
+            group->setData(PathRole, path);
+            // if we are at the lowest level of a group
+            // we try to get the vendorName
+            if (actionPath.size() - 2 == level) {
+                const QString vendorName = entry->vendorName();
+                if (vendorName.isEmpty()) {
+                    group->setData(Qt::DisplayRole, path);
+                } else {
+                    group->setData(Qt::DisplayRole, vendorName);
+                }
+            } else {
+                group->setData(Qt::DisplayRole, path);
+            }
+            endInsertRows();
+            insertOrUpdate(actionPath, entry, group, level + 1);
+        }
+    }
+}
diff -Naur kdebase-workspace-4.3.5/polkit-kde-1/kcmodules/polkitactions/PoliciesModel.h kdebase-workspace-4.3.5-p/polkit-kde-1/kcmodules/polkitactions/PoliciesModel.h
--- kdebase-workspace-4.3.5/polkit-kde-1/kcmodules/polkitactions/PoliciesModel.h	1970-01-01 01:00:00.000000000 +0100
+++ kdebase-workspace-4.3.5-p/polkit-kde-1/kcmodules/polkitactions/PoliciesModel.h	2010-02-13 01:10:55.000000000 +0100
@@ -0,0 +1,74 @@
+/***************************************************************************
+ *   Copyright (C) 2009 by Daniel Nicoletti                                *
+ *   dantti85-pk@yahoo.com.br                                              *
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ *   This program is distributed in the hope that it will be useful,       *
+ *   but WITHOUT ANY WARRANTY; without even the implied warranty of        *
+ *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the         *
+ *   GNU General Public License for more details.                          *
+ *                                                                         *
+ *   You should have received a copy of the GNU General Public License     *
+ *   along with this program; if not, write to the                         *
+ *   Free Software Foundation, Inc.,                                       *
+ *   51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA .        *
+ ***************************************************************************/
+
+#ifndef POLICIES_MODEL_H
+#define POLICIES_MODEL_H
+
+#include <QAbstractItemModel>
+#include <QModelIndex>
+#include <QVariant>
+
+#include <PolkitQt1/ActionDescription>
+
+namespace PolkitKde
+{
+
+class PolicyItem;
+
+class PoliciesModel : public QAbstractItemModel
+{
+    Q_OBJECT
+
+public:
+    enum DataRoles {
+        PathRole = 41,
+        IsGroupRole = 42,
+        PolkitEntryRole = 43
+    };
+
+    PoliciesModel(QObject *parent = 0);
+    ~PoliciesModel();
+
+    QVariant data(const QModelIndex &index, int role) const;
+    Qt::ItemFlags flags(const QModelIndex &index) const;
+    QModelIndex index(int row, int column,
+                      const QModelIndex &parent = QModelIndex()) const;
+    QModelIndex parent(const QModelIndex &index) const;
+    int rowCount(const QModelIndex &parent = QModelIndex()) const;
+    int columnCount(const QModelIndex &parent = QModelIndex()) const;
+
+    QModelIndex indexFromId(const QString &id) const;
+
+public slots:
+    void setCurrentEntries(const PolkitQt1::ActionDescription::List &entries);
+
+private:
+    void insertOrUpdate(const QStringList &actionPath, PolkitQt1::ActionDescription *entry,
+                        PolicyItem *parent, int level = 0);
+    bool removeEntries(const QStringList &entries, PolicyItem *parent);
+    QModelIndex indexFromId(const QString &id, PolicyItem *parent) const;
+
+    PolicyItem *rootItem;
+};
+
+
+}
+
+#endif
diff -Naur kdebase-workspace-4.3.5/polkit-kde-1/kcmodules/polkitactions/PolicyItem.cpp kdebase-workspace-4.3.5-p/polkit-kde-1/kcmodules/polkitactions/PolicyItem.cpp
--- kdebase-workspace-4.3.5/polkit-kde-1/kcmodules/polkitactions/PolicyItem.cpp	1970-01-01 01:00:00.000000000 +0100
+++ kdebase-workspace-4.3.5-p/polkit-kde-1/kcmodules/polkitactions/PolicyItem.cpp	2010-02-13 01:10:55.000000000 +0100
@@ -0,0 +1,116 @@
+/***************************************************************************
+ *   Copyright (C) 2009 by Daniel Nicoletti                                *
+ *   dantti85-pk@yahoo.com.br                                              *
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ *   This program is distributed in the hope that it will be useful,       *
+ *   but WITHOUT ANY WARRANTY; without even the implied warranty of        *
+ *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the         *
+ *   GNU General Public License for more details.                          *
+ *                                                                         *
+ *   You should have received a copy of the GNU General Public License     *
+ *   along with this program; if not, write to the                         *
+ *   Free Software Foundation, Inc.,                                       *
+ *   51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA .        *
+ ***************************************************************************/
+
+#include "PolicyItem.h"
+
+#include <KIconLoader>
+#include <KIcon>
+
+#include "PoliciesModel.h"
+
+using namespace PolkitKde;
+
+PolicyItem::PolicyItem(bool isGroup, PolicyItem *parent)
+    : parentItem(parent)
+{
+    if (isGroup) {
+        itemData[Qt::DecorationRole] = KIcon("folder-locked");
+    } else {
+        itemData[Qt::DecorationRole] = KIcon("preferences-desktop-cryptography");
+    }
+    itemData[PoliciesModel::IsGroupRole] = isGroup;
+}
+
+PolicyItem::~PolicyItem()
+{
+    if (itemData.contains(PoliciesModel::PolkitEntryRole)) {
+        delete (itemData[PoliciesModel::PolkitEntryRole].value<PolkitQt1::ActionDescription *>());
+    }
+    qDeleteAll(childItems);
+}
+
+void PolicyItem::setPolkitEntry(PolkitQt1::ActionDescription *entry)
+{
+    // yep, caching the icon DOES improve speed
+    QString iconName = entry->iconName();
+    if (KIconLoader::global()->iconPath(iconName, KIconLoader::NoGroup, true).isEmpty()) {
+        itemData[Qt::DecorationRole] = KIcon("preferences-desktop-cryptography");
+    } else {
+        itemData[Qt::DecorationRole] = KIcon(iconName);
+    }
+
+    itemData[Qt::DisplayRole] = entry->description();
+    itemData[PoliciesModel::PathRole] = entry->actionId();
+    if (itemData.contains(PoliciesModel::PolkitEntryRole)) {
+        delete entry;
+    }
+    itemData[PoliciesModel::PolkitEntryRole] = QVariant::fromValue(entry);
+}
+
+void PolicyItem::appendChild(PolicyItem *item)
+{
+    childItems.append(item);
+}
+
+void PolicyItem::removeChild(PolicyItem *item)
+{
+    delete childItems.takeAt(childItems.indexOf(item));
+}
+
+PolicyItem *PolicyItem::child(int row)
+{
+    return childItems.value(row);
+}
+
+int PolicyItem::childCount() const
+{
+    return childItems.count();
+}
+
+QVariant PolicyItem::data(int role) const
+{
+    if (itemData.contains(role)) {
+        return itemData[role];
+    }
+    return QVariant();
+}
+
+void PolicyItem::setData(int role, const QVariant &data)
+{
+    itemData[role] = data;
+}
+
+PolicyItem *PolicyItem::parent()
+{
+    return parentItem;
+}
+
+int PolicyItem::row() const
+{
+    if (parentItem)
+        return parentItem->childItems.indexOf(const_cast<PolicyItem*>(this));
+
+    return 0;
+}
+
+bool PolicyItem::isGroup() const
+{
+    return itemData[PoliciesModel::IsGroupRole].toBool();
+}
diff -Naur kdebase-workspace-4.3.5/polkit-kde-1/kcmodules/polkitactions/PolicyItem.h kdebase-workspace-4.3.5-p/polkit-kde-1/kcmodules/polkitactions/PolicyItem.h
--- kdebase-workspace-4.3.5/polkit-kde-1/kcmodules/polkitactions/PolicyItem.h	1970-01-01 01:00:00.000000000 +0100
+++ kdebase-workspace-4.3.5-p/polkit-kde-1/kcmodules/polkitactions/PolicyItem.h	2010-02-13 01:10:55.000000000 +0100
@@ -0,0 +1,64 @@
+/***************************************************************************
+ *   Copyright (C) 2009 by Daniel Nicoletti                                *
+ *   dantti85-pk@yahoo.com.br                                              *
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ *   This program is distributed in the hope that it will be useful,       *
+ *   but WITHOUT ANY WARRANTY; without even the implied warranty of        *
+ *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the         *
+ *   GNU General Public License for more details.                          *
+ *                                                                         *
+ *   You should have received a copy of the GNU General Public License     *
+ *   along with this program; if not, write to the                         *
+ *   Free Software Foundation, Inc.,                                       *
+ *   51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA .        *
+ ***************************************************************************/
+
+#ifndef POLICY_ITEM_H
+#define POLICY_ITEM_H
+
+#include <QList>
+#include <QHash>
+#include <QVariant>
+
+namespace PolkitQt1 {
+class ActionDescription;
+}
+
+namespace PolkitKde
+{
+
+class PolicyItem
+{
+public:
+    explicit PolicyItem(bool isGroup, PolicyItem *parent = 0);
+    ~PolicyItem();
+
+    void appendChild(PolicyItem *child);
+    void removeChild(PolicyItem *item);
+
+    PolicyItem *child(int row);
+    int childCount() const;
+    QVariant data(int role) const;
+    void setData(int role, const QVariant &data);
+    int row() const;
+    PolicyItem *parent();
+
+    bool isGroup() const;
+    void setPolkitEntry(PolkitQt1::ActionDescription *entry);
+
+private:
+    QList<PolicyItem*> childItems;
+    QHash<int, QVariant> itemData;
+    PolicyItem *parentItem;
+};
+
+}
+
+Q_DECLARE_METATYPE(PolkitQt1::ActionDescription*)
+
+#endif
diff -Naur kdebase-workspace-4.3.5/polkit-kde-1/kcmodules/polkitactions/PolkitActionsKCM.cpp kdebase-workspace-4.3.5-p/polkit-kde-1/kcmodules/polkitactions/PolkitActionsKCM.cpp
--- kdebase-workspace-4.3.5/polkit-kde-1/kcmodules/polkitactions/PolkitActionsKCM.cpp	1970-01-01 01:00:00.000000000 +0100
+++ kdebase-workspace-4.3.5-p/polkit-kde-1/kcmodules/polkitactions/PolkitActionsKCM.cpp	2010-02-13 01:10:55.000000000 +0100
@@ -0,0 +1,113 @@
+/* This file is part of the KDE project
+
+   Copyright (C) 2009 Dario Freddi <drf@kde.org>
+
+   This program is free software; you can redistribute it and/or
+   modify it under the terms of the GNU General Public
+   License as published by the Free Software Foundation; either
+   version 2 of the License, or (at your option) any later version.
+*/
+
+#include "PolkitActionsKCM.h"
+
+#include <KPluginFactory>
+#include <KAboutData>
+#include <klocalizedstring.h>
+#include <PolkitQt1/Authority>
+#include "ui_mainview.h"
+#include "PoliciesModel.h"
+#include "AuthorizationsFilterModel.h"
+#include "pkitemdelegate.h"
+#include <QLayout>
+#include "ActionWidget.h"
+#include "PolicyItem.h"
+
+K_PLUGIN_FACTORY(KCMPolkitActionsFactory,
+                 registerPlugin<PolkitActionsKCM>();
+                )
+K_EXPORT_PLUGIN(KCMPolkitActionsFactory("kcm_polkitactions"))
+
+PolkitActionsKCM::PolkitActionsKCM(QWidget* parent, const QVariantList& args)
+    : KCModule(KCMPolkitActionsFactory::componentData(), parent, args)
+    , m_ui(new Ui::PolkitActionsMainView)
+{
+    KAboutData *about =
+        new KAboutData("kcm_polkitactions", "kcm_polkitactions", ki18n("Global system policy settings"),
+                       "1.0.0", ki18n("A configuration for polkit-1 system administrators and policy priorities"),
+                       KAboutData::License_GPL, ki18n("(c), 2009 Dario Freddi"),
+                       ki18n("From this module, you can configure system administrators and priorities "
+                             "for the policies defined in the Actions module"));
+
+    about->addAuthor(ki18n("Dario Freddi"), ki18n("Maintainer") , "drf@kde.org", "http://drfav.wordpress.com");
+
+    setAboutData(about);
+
+    // Build the UI
+    m_ui->setupUi(this);
+    m_model = new PolkitKde::PoliciesModel(this);
+    m_proxyModel = new PolkitKde::AuthorizationsFilterModel(this);
+    m_proxyModel->setSourceModel(m_model);
+    m_ui->treeView->header()->hide();
+    m_ui->treeView->setModel(m_proxyModel);
+    m_ui->treeView->setItemDelegate(new PolkitKde::PkItemDelegate(this));
+
+    connect(m_ui->searchLine, SIGNAL(textChanged(QString)),
+            m_proxyModel, SLOT(setFilterRegExp(QString)));
+    connect(m_ui->treeView->selectionModel(), SIGNAL(currentChanged(QModelIndex,QModelIndex)),
+            this, SLOT(slotCurrentChanged(QModelIndex,QModelIndex)));
+
+    // Initialize
+    connect(PolkitQt1::Authority::instance(), SIGNAL(checkAuthorizationFinished(PolkitQt1::Authority::Result)),
+            this, SLOT(slotCheckAuthorizationFinished(PolkitQt1::Authority::Result)));
+    connect(PolkitQt1::Authority::instance(), SIGNAL(enumerateActionsFinished(PolkitQt1::ActionDescription::List)),
+            m_model, SLOT(setCurrentEntries(PolkitQt1::ActionDescription::List)));
+    PolkitQt1::Authority::instance()->enumerateActions();
+}
+
+PolkitActionsKCM::~PolkitActionsKCM()
+{
+
+}
+
+void PolkitActionsKCM::load()
+{
+    KCModule::load();
+}
+
+void PolkitActionsKCM::save()
+{
+    KCModule::save();
+}
+
+void PolkitActionsKCM::defaults()
+{
+    KCModule::defaults();
+}
+
+void PolkitActionsKCM::slotCheckAuthorizationFinished(PolkitQt1::Authority::Result result)
+{
+
+}
+
+void PolkitActionsKCM::slotCurrentChanged(const QModelIndex& current, const QModelIndex& )
+{
+    if (current.data(PolkitKde::PoliciesModel::IsGroupRole).toBool() == false) {
+        PolkitQt1::ActionDescription *action;
+        action = current.data(PolkitKde::PoliciesModel::PolkitEntryRole).value<PolkitQt1::ActionDescription *>();
+
+        if (action) {
+            if (m_actionWidget.isNull()) {
+                if (layout()->count() == 2) {
+                    layout()->takeAt(1)->widget()->deleteLater();
+                }
+                m_actionWidget = new PolkitKde::ActionWidget(action);
+                layout()->addWidget(m_actionWidget.data());
+            } else {
+                m_actionWidget.data()->setAction(action);
+            }
+        }
+    } else {
+        // TODO
+    }
+}
+
diff -Naur kdebase-workspace-4.3.5/polkit-kde-1/kcmodules/polkitactions/PolkitActionsKCM.h kdebase-workspace-4.3.5-p/polkit-kde-1/kcmodules/polkitactions/PolkitActionsKCM.h
--- kdebase-workspace-4.3.5/polkit-kde-1/kcmodules/polkitactions/PolkitActionsKCM.h	1970-01-01 01:00:00.000000000 +0100
+++ kdebase-workspace-4.3.5-p/polkit-kde-1/kcmodules/polkitactions/PolkitActionsKCM.h	2010-02-13 01:10:55.000000000 +0100
@@ -0,0 +1,51 @@
+/* This file is part of the KDE project
+
+   Copyright (C) 2009 Dario Freddi <drf@kde.org>
+
+   This program is free software; you can redistribute it and/or
+   modify it under the terms of the GNU General Public
+   License as published by the Free Software Foundation; either
+   version 2 of the License, or (at your option) any later version.
+*/
+
+#ifndef POLKITACTIONSKCM_H
+#define POLKITACTIONSKCM_H
+
+#include <kcmodule.h>
+#include <PolkitQt1/Authority>
+#include <QtCore/QPointer>
+
+class QModelIndex;
+namespace PolkitKde {
+class PoliciesModel;
+class AuthorizationsFilterModel;
+class ActionWidget;
+}
+
+namespace Ui {
+    class PolkitActionsMainView;
+}
+
+class PolkitActionsKCM : public KCModule
+{
+    Q_OBJECT
+    public:
+        PolkitActionsKCM(QWidget* parent = 0, const QVariantList& args = QVariantList());
+        virtual ~PolkitActionsKCM();
+
+        virtual void load();
+        virtual void save();
+        virtual void defaults();
+
+    public slots:
+        void slotCheckAuthorizationFinished(PolkitQt1::Authority::Result result);
+        void slotCurrentChanged(const QModelIndex &current, const QModelIndex&);
+
+    private:
+        Ui::PolkitActionsMainView *m_ui;
+        PolkitKde::PoliciesModel *m_model;
+        PolkitKde::AuthorizationsFilterModel *m_proxyModel;
+        QPointer<PolkitKde::ActionWidget> m_actionWidget;
+};
+
+#endif // POLKITACTIONSKCM_H
diff -Naur kdebase-workspace-4.3.5/polkit-kde-1/kcmodules/polkitconfig/CMakeLists.txt kdebase-workspace-4.3.5-p/polkit-kde-1/kcmodules/polkitconfig/CMakeLists.txt
--- kdebase-workspace-4.3.5/polkit-kde-1/kcmodules/polkitconfig/CMakeLists.txt	1970-01-01 01:00:00.000000000 +0100
+++ kdebase-workspace-4.3.5-p/polkit-kde-1/kcmodules/polkitconfig/CMakeLists.txt	2010-02-13 01:10:55.000000000 +0100
@@ -0,0 +1,23 @@
+set( kcm_polkitconfig_SRCS
+     kcmpolkitconfig.cpp
+     identitywidget.cpp
+)
+
+kde4_add_ui_files(kcm_polkitconfig_SRCS 
+    polkitconfig.ui
+    identitywidget.ui)
+
+kde4_add_plugin(kcm_polkitconfig ${kcm_polkitconfig_SRCS})
+
+target_link_libraries(kcm_polkitconfig  
+     ${KDE4_KDECORE_LIBS}
+     ${KDE4_KDEUI_LIBRARY}
+)
+
+install(TARGETS kcm_polkitconfig  DESTINATION ${PLUGIN_INSTALL_DIR} )
+
+
+########### install files ###############
+
+install( FILES kcm_polkitconfig.desktop  DESTINATION  ${SERVICES_INSTALL_DIR} )
+
diff -Naur kdebase-workspace-4.3.5/polkit-kde-1/kcmodules/polkitconfig/identitywidget.cpp kdebase-workspace-4.3.5-p/polkit-kde-1/kcmodules/polkitconfig/identitywidget.cpp
--- kdebase-workspace-4.3.5/polkit-kde-1/kcmodules/polkitconfig/identitywidget.cpp	1970-01-01 01:00:00.000000000 +0100
+++ kdebase-workspace-4.3.5-p/polkit-kde-1/kcmodules/polkitconfig/identitywidget.cpp	2010-02-13 01:10:55.000000000 +0100
@@ -0,0 +1,101 @@
+/* This file is part of the KDE project
+
+   Copyright (C) 2009 Dario Freddi <drf@kde.org>
+
+   This program is free software; you can redistribute it and/or
+   modify it under the terms of the GNU General Public
+   License as published by the Free Software Foundation; either
+   version 2 of the License, or (at your option) any later version.
+*/
+
+#include "identitywidget.h"
+
+#include "ui_identitywidget.h"
+#include <KUser>
+#include <KDebug>
+
+IdentityWidget::IdentityWidget(IdentityWidget::IdentityType type, const QString& name, QWidget* parent)
+    : QWidget(parent)
+{
+    init(type);
+    setIdentityName(name);
+}
+
+IdentityWidget::IdentityWidget(QWidget* parent)
+    : QWidget(parent)
+{
+    init(UserIdentity);
+}
+
+void IdentityWidget::init(IdentityType type)
+{
+    m_ui = new Ui::IdentityWidget;
+    m_ui->setupUi(this);
+    m_ui->removeButton->setIcon(KIcon("list-remove"));
+    m_ui->identityTypeBox->setItemIcon(0, KIcon("user-identity"));
+    m_ui->identityTypeBox->setItemIcon(1, KIcon("system-users"));
+    m_ui->identityTypeBox->setCurrentIndex((int)type);
+    populateIdentityNameBox();
+
+    connect(m_ui->identityTypeBox, SIGNAL(currentIndexChanged(int)),
+            this, SIGNAL(changed()));
+    connect(m_ui->identityTypeBox, SIGNAL(currentIndexChanged(int)),
+            this, SLOT(populateIdentityNameBox()));
+    connect(m_ui->identityNameBox, SIGNAL(currentIndexChanged(int)),
+            this, SIGNAL(changed()));
+    connect(m_ui->removeButton, SIGNAL(clicked(bool)),
+            this, SIGNAL(changed()));
+    connect(m_ui->removeButton, SIGNAL(clicked(bool)),
+            this, SLOT(deleteLater()));
+}
+
+QString IdentityWidget::identityName() const
+{
+    return m_ui->identityNameBox->itemData(m_ui->identityNameBox->currentIndex()).toString();
+}
+
+IdentityWidget::IdentityType IdentityWidget::identityType() const
+{
+    return (IdentityType)(m_ui->identityTypeBox->currentIndex());
+}
+
+void IdentityWidget::setIdentityName(const QString& name)
+{
+    m_ui->identityNameBox->setCurrentIndex(m_ui->identityNameBox->findData(name));
+}
+
+void IdentityWidget::setIdentityType(IdentityWidget::IdentityType type)
+{
+    m_ui->identityTypeBox->setCurrentIndex((int)type);
+}
+
+void IdentityWidget::populateIdentityNameBox()
+{
+    m_ui->identityNameBox->clear();
+    if (m_ui->identityTypeBox->currentIndex() == (int)UserIdentity) {
+        QList<KUser> users = KUser::allUsers();
+
+        foreach (const KUser &user, users) {
+            QIcon icon;
+            QString displayName;
+            if (!user.faceIconPath().isEmpty()) {
+                icon.addPixmap(QPixmap(user.faceIconPath()));
+            } else {
+                icon = KIcon("user-identity");
+            }
+            if (user.fullName().isEmpty()) {
+                displayName = user.loginName();
+            } else {
+                displayName = QString("%1 (%2)").arg(user.fullName()).arg(user.loginName());
+            }
+
+            m_ui->identityNameBox->addItem(icon, displayName, user.loginName());
+        }
+    } else {
+        QList<KUserGroup> groups = KUserGroup::allGroups();
+
+        foreach (const KUserGroup &group, groups) {
+            m_ui->identityNameBox->addItem(KIcon("system-users"), group.name(), group.name());
+        }
+    }
+}
diff -Naur kdebase-workspace-4.3.5/polkit-kde-1/kcmodules/polkitconfig/identitywidget.h kdebase-workspace-4.3.5-p/polkit-kde-1/kcmodules/polkitconfig/identitywidget.h
--- kdebase-workspace-4.3.5/polkit-kde-1/kcmodules/polkitconfig/identitywidget.h	1970-01-01 01:00:00.000000000 +0100
+++ kdebase-workspace-4.3.5-p/polkit-kde-1/kcmodules/polkitconfig/identitywidget.h	2010-02-13 01:10:55.000000000 +0100
@@ -0,0 +1,50 @@
+/* This file is part of the KDE project
+
+   Copyright (C) 2009 Dario Freddi <drf@kde.org>
+
+   This program is free software; you can redistribute it and/or
+   modify it under the terms of the GNU General Public
+   License as published by the Free Software Foundation; either
+   version 2 of the License, or (at your option) any later version.
+*/
+
+#ifndef IDENTITYWIDGET_H
+#define IDENTITYWIDGET_H
+
+#include <QtGui/QWidget>
+
+namespace Ui {
+    class IdentityWidget;
+}
+
+class IdentityWidget : public QWidget
+{
+    Q_OBJECT
+    public:
+        enum IdentityType {
+            UserIdentity = 0,
+            GroupIdentity = 1
+        };
+
+        IdentityWidget(IdentityType type, const QString &name, QWidget* parent = 0);
+        IdentityWidget(QWidget* parent = 0);
+
+        void setIdentityType(IdentityType type);
+        void setIdentityName(const QString &name);
+
+        IdentityType identityType() const;
+        QString identityName() const;
+
+    Q_SIGNALS:
+        void changed();
+
+    private Q_SLOTS:
+        void populateIdentityNameBox();
+
+    private:
+        void init(IdentityType type);
+
+        Ui::IdentityWidget *m_ui;
+};
+
+#endif // IDENTITYWIDGET_H
diff -Naur kdebase-workspace-4.3.5/polkit-kde-1/kcmodules/polkitconfig/identitywidget.ui kdebase-workspace-4.3.5-p/polkit-kde-1/kcmodules/polkitconfig/identitywidget.ui
--- kdebase-workspace-4.3.5/polkit-kde-1/kcmodules/polkitconfig/identitywidget.ui	1970-01-01 01:00:00.000000000 +0100
+++ kdebase-workspace-4.3.5-p/polkit-kde-1/kcmodules/polkitconfig/identitywidget.ui	2010-02-13 01:10:55.000000000 +0100
@@ -0,0 +1,81 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<ui version="4.0">
+ <class>IdentityWidget</class>
+ <widget class="QWidget" name="IdentityWidget">
+  <property name="geometry">
+   <rect>
+    <x>0</x>
+    <y>0</y>
+    <width>426</width>
+    <height>42</height>
+   </rect>
+  </property>
+  <property name="windowTitle">
+   <string/>
+  </property>
+  <layout class="QVBoxLayout" name="verticalLayout">
+   <item>
+    <layout class="QHBoxLayout" name="horizontalLayout">
+     <item>
+      <widget class="KComboBox" name="identityTypeBox">
+       <item>
+        <property name="text">
+         <string>User</string>
+        </property>
+       </item>
+       <item>
+        <property name="text">
+         <string>Group</string>
+        </property>
+       </item>
+      </widget>
+     </item>
+     <item>
+      <widget class="KComboBox" name="identityNameBox"/>
+     </item>
+     <item>
+      <spacer name="horizontalSpacer">
+       <property name="orientation">
+        <enum>Qt::Horizontal</enum>
+       </property>
+       <property name="sizeHint" stdset="0">
+        <size>
+         <width>192</width>
+         <height>20</height>
+        </size>
+       </property>
+      </spacer>
+     </item>
+     <item>
+      <widget class="KPushButton" name="removeButton">
+       <property name="text">
+        <string>Remove</string>
+       </property>
+      </widget>
+     </item>
+    </layout>
+   </item>
+   <item>
+    <widget class="Line" name="line">
+     <property name="orientation">
+      <enum>Qt::Horizontal</enum>
+     </property>
+    </widget>
+   </item>
+  </layout>
+ </widget>
+ <customwidgets>
+  <customwidget>
+   <class>KPushButton</class>
+   <extends>QPushButton</extends>
+   <header>kpushbutton.h</header>
+  </customwidget>
+  <customwidget>
+   <class>KComboBox</class>
+   <extends>QComboBox</extends>
+   <header>kcombobox.h</header>
+  </customwidget>
+ </customwidgets>
+ <resources/>
+ <connections/>
+</ui>
diff -Naur kdebase-workspace-4.3.5/polkit-kde-1/kcmodules/polkitconfig/kcmpolkitconfig.cpp kdebase-workspace-4.3.5-p/polkit-kde-1/kcmodules/polkitconfig/kcmpolkitconfig.cpp
--- kdebase-workspace-4.3.5/polkit-kde-1/kcmodules/polkitconfig/kcmpolkitconfig.cpp	1970-01-01 01:00:00.000000000 +0100
+++ kdebase-workspace-4.3.5-p/polkit-kde-1/kcmodules/polkitconfig/kcmpolkitconfig.cpp	2010-02-13 01:10:55.000000000 +0100
@@ -0,0 +1,190 @@
+/* This file is part of the KDE project
+
+   Copyright (C) 2009 Dario Freddi <drf@kde.org>
+
+   This program is free software; you can redistribute it and/or
+   modify it under the terms of the GNU General Public
+   License as published by the Free Software Foundation; either
+   version 2 of the License, or (at your option) any later version.
+*/
+
+#include "kcmpolkitconfig.h"
+
+#include "ui_polkitconfig.h"
+
+#include <KPluginFactory>
+#include <KAboutData>
+#include <klocalizedstring.h>
+
+#include <QtDBus/QDBusMessage>
+#include <QtDBus/QDBusInterface>
+#include <QtDBus/QDBusConnectionInterface>
+#include <qsettings.h>
+#include <qfileinfo.h>
+#include <qdir.h>
+#include <qlayoutitem.h>
+#include "identitywidget.h"
+#include <KDebug>
+
+K_PLUGIN_FACTORY(KCMPolkitConfigFactory,
+                 registerPlugin<KCMPolkitConfig>();
+                )
+K_EXPORT_PLUGIN(KCMPolkitConfigFactory("kcm_polkitconfig"))
+
+KCMPolkitConfig::KCMPolkitConfig(QWidget* parent, const QVariantList& args)
+    : KCModule(KCMPolkitConfigFactory::componentData(), parent, args)
+{
+    KAboutData *about =
+        new KAboutData("kcm_polkitconfig", "kcm_polkitconfig", ki18n("Global system policy settings"),
+                       "1.0.0", ki18n("A configuration for polkit-1 system administrators and policy priorities"),
+                       KAboutData::License_GPL, ki18n("(c), 2009 Dario Freddi"),
+                       ki18n("From this module, you can configure system administrators and priorities "
+                             "for the policies defined in the Actions module"));
+
+    about->addAuthor(ki18n("Dario Freddi"), ki18n("Maintainer") , "drf@kde.org",
+                     "http://drfav.wordpress.com");
+
+    setAboutData(about);
+
+    m_ui = new Ui::PolkitConfig;
+    m_ui->setupUi(this);
+
+    m_ui->warningTextLabel->setVisible(false);
+    m_ui->warningPixmapLabel->setVisible(false);
+    m_ui->addIdentityButton->setIcon(KIcon("list-add"));
+
+    m_identitiesLayout = new QVBoxLayout;
+    m_identitiesLayout->addStretch();
+    m_ui->scrollAreaWidgetContents->setLayout(m_identitiesLayout);
+
+    connect(m_ui->addIdentityButton, SIGNAL(clicked(bool)),
+            this, SLOT(addNewIdentity()));
+    connect(m_ui->configPrioritySpin, SIGNAL(valueChanged(int)),
+            this, SLOT(changed()));
+    connect(m_ui->policyPrioritySpin, SIGNAL(valueChanged(int)),
+            this, SLOT(changed()));
+}
+
+KCMPolkitConfig::~KCMPolkitConfig()
+{
+
+}
+
+void KCMPolkitConfig::defaults()
+{
+
+}
+
+void KCMPolkitConfig::load()
+{
+    // Load the first tab
+    QSettings settings("/etc/polkit-1/polkit-kde-1.conf", QSettings::IniFormat);
+    settings.beginGroup("General");
+
+    int priority = settings.value("ConfigPriority", 75).toInt();
+    int highestPriority = -1;
+    QString highestFilename;
+
+    QDir dir("/etc/polkit-1/localauthority.conf.d/");
+    dir.setFilter(QDir::Files);
+    QFileInfoList infolist = dir.entryInfoList();
+
+    foreach (const QFileInfo &finfo, infolist) {
+        int fpriority = finfo.baseName().split('-').first().toInt();
+        kDebug() << "Considering " << finfo.absoluteFilePath() << " which should have priority "<< fpriority;
+        if (fpriority > highestPriority) {
+            kDebug() << "Setting it as highest priority";
+            highestPriority = fpriority;
+            highestFilename = finfo.absoluteFilePath();
+        }
+    }
+
+    if (highestPriority > priority) {
+        kDebug() << "Highest priority is " << highestPriority << ", polkit kde priority is " << priority;
+        m_ui->warningTextLabel->setText(i18n("The changes will have no effect, since another policy has an higher priority "
+                                             "(%1). Please change the priority of policies defined through this module to an "
+                                             "higher value.", highestPriority));
+        m_ui->warningTextLabel->setVisible(true);
+        m_ui->warningPixmapLabel->setPixmap(KIcon("dialog-warning").pixmap(48));
+        m_ui->warningPixmapLabel->setVisible(true);
+    }
+
+    kDebug() << "The highest filename is " << highestFilename;
+    QFile policyFile(highestFilename);
+    policyFile.open(QIODevice::ReadOnly | QIODevice::Text);
+    QString identities = QString(policyFile.readAll()).split("AdminIdentities=").last();
+    identities = identities.split('\n').first();
+    policyFile.close();
+
+    kDebug() << "our identities are " << identities;
+    foreach (const QString &identity, identities.split(';')) {
+        IdentityWidget::IdentityType type;
+        if (identity.split(':').first() == "unix-user") {
+            type = IdentityWidget::UserIdentity;
+            kDebug() << "It's an user";
+        } else {
+            type = IdentityWidget::GroupIdentity;
+            kDebug() << "It's a group";
+        }
+        QString name = identity.split(':').last();
+        IdentityWidget *iw = new IdentityWidget(type, name);
+        m_identitiesLayout->insertWidget(m_identitiesLayout->count() - 1, iw);
+        connect(iw, SIGNAL(changed()), this, SLOT(changed()));
+    }
+
+    // Set up the other tab
+    m_ui->configPrioritySpin->setValue(priority);
+    m_ui->policyPrioritySpin->setValue(settings.value("PoliciesPriority", 75).toInt());
+}
+
+void KCMPolkitConfig::save()
+{
+    // Get back all the identities first
+    QString identities;
+    for (int i = 0; i < m_identitiesLayout->count(); ++i) {
+        QLayoutItem *item = m_identitiesLayout->itemAt(i);
+        if (item != 0) {
+            QWidget *widget = item->widget();
+            if (widget != 0) {
+                IdentityWidget *identityWidget = qobject_cast< IdentityWidget* >(widget);
+                if (identityWidget != 0) {
+                    // Whew, let's add it
+                    if (identityWidget->identityType() == IdentityWidget::UserIdentity) {
+                        identities.append("unix-user:");
+                    } else {
+                        identities.append("unix-group:");
+                    }
+                    identities.append(identityWidget->identityName());
+                    identities.append(';');
+                }
+            }
+        }
+    }
+
+    if (!identities.isEmpty()) {
+        identities.remove(identities.length() - 1, 1);
+    }
+
+    kDebug() << "Identities to save: " << identities;
+
+    QDBusMessage message = QDBusMessage::createMethodCall("org.kde.polkitkde1.helper",
+                                                          "/Helper",
+                                                          "org.kde.polkitkde1.helper",
+                                                          QLatin1String("saveGlobalConfiguration"));
+    QList<QVariant> argumentList;
+    argumentList << QVariant::fromValue(identities);
+    argumentList << QVariant::fromValue(m_ui->configPrioritySpin->value());
+    argumentList << QVariant::fromValue(m_ui->policyPrioritySpin->value());
+    message.setArguments(argumentList);
+
+    QDBusPendingCall reply = QDBusConnection::systemBus().asyncCall(message);
+}
+
+void KCMPolkitConfig::addNewIdentity()
+{
+    IdentityWidget *iw = new IdentityWidget();
+    m_identitiesLayout->insertWidget(m_identitiesLayout->count() - 1, iw);
+    connect(iw, SIGNAL(changed()), this, SLOT(changed()));
+    changed();
+}
+
diff -Naur kdebase-workspace-4.3.5/polkit-kde-1/kcmodules/polkitconfig/kcm_polkitconfig.desktop kdebase-workspace-4.3.5-p/polkit-kde-1/kcmodules/polkitconfig/kcm_polkitconfig.desktop
--- kdebase-workspace-4.3.5/polkit-kde-1/kcmodules/polkitconfig/kcm_polkitconfig.desktop	1970-01-01 01:00:00.000000000 +0100
+++ kdebase-workspace-4.3.5-p/polkit-kde-1/kcmodules/polkitconfig/kcm_polkitconfig.desktop	2010-02-13 01:10:55.000000000 +0100
@@ -0,0 +1,63 @@
+[Desktop Entry]
+Exec=kcmshell4 kcm_polkitconfig
+Icon=system-lock-screen
+Type=Service
+X-KDE-ServiceTypes=KCModule
+#X-DocPath=kcontrol/powerdevil/index.html
+
+X-KDE-Library=kcm_polkitconfig
+X-KDE-ParentApp=kcontrol
+
+X-KDE-System-Settings-Parent-Category=system-policies
+
+Name=Global policy configuration
+Name[ca]=Configuració de la política global
+Name[ca@valencia]=Configuració de la política global
+Name[cs]=Nastavení globálních pravidel
+Name[da]=Konfiguration af global politik
+Name[de]=Globale Regeleinstellung
+Name[en_GB]=Global policy configuration
+Name[es]=Configuración de la política global
+Name[et]=Reeglite globaalne seadistamine
+Name[fi]=Menettelytapayleisasetukset
+Name[fr]=Configuration de la stratégie globale
+Name[it]=Configurazione globale delle politiche
+Name[km]=ការ​កំណត់​គោលនយោបាយ​សកល
+Name[lv]=Globālās politikas konfigurācija
+Name[nb]=Globalt praksisoppsett
+Name[nds]=Globaal Regeln instellen
+Name[nl]=Configuratie voor globaal beleid
+Name[pt]=Configuração da política global
+Name[pt_BR]=Configuração da política global
+Name[ro]=Configurare politică globală
+Name[sv]=Inställning av global policy
+Name[uk]=Налаштування загальних правил доступу
+Name[x-test]=xxGlobal policy configurationxx
+Name[zh_TW]=全域政策設定
+
+Comment=Configure global settings for system policies
+Comment[ca]=Configura l'arranjament global de les polítiques del sistema
+Comment[ca@valencia]=Configura l'arranjament global de les polítiques del sistema
+Comment[cs]=Nastavit globální nastavení pro pravidla systému
+Comment[da]=Sæt globale indstillinger for systempolitikker
+Comment[de]=Globale Einstellungen für Systemregeln einrichten
+Comment[en_GB]=Configure global settings for system policies
+Comment[es]=Configurar las preferencias globales para las políticas del sistema
+Comment[et]=Süsteemi reeglite globaalne seadistamine
+Comment[fi]=Aseta järjestelmämenettelutapojen yleisasetukset
+Comment[fr]=Configurer les paramètres globaux des stratégies système
+Comment[it]=Configura le impostazione globali delle politiche di sistema
+Comment[km]=កំណត់​រចនាសម្ព័ន្ធនៃ​ការ​កំណត់​សកល​សម្រាប់​គោលនយោបាយ​ប្រព័ន្ធ
+Comment[lv]=Konfigurēt sistēmas politiku globālos iestatījumus
+Comment[nb]=Sett opp globale innstillinger for systempraksis
+Comment[nds]=Globaal Instellen för Systeemregeln fastleggen
+Comment[nl]=Globale instellingen voor systeembeleid configureren
+Comment[pt]=Configurar as opções globais das políticas do sistema
+Comment[pt_BR]=Configura as opções globais para as políticas do sistema
+Comment[ro]=Configurează parametrii globali pentru politici de sistem
+Comment[sv]=Anpassa globala inställningar av systempolicy
+Comment[uk]=Налаштування загальних параметрів системних правил доступу
+Comment[x-test]=xxConfigure global settings for system policiesxx
+Comment[zh_TW]=設定系統政策的全域設定
+
+X-KDE-Keywords=system,policy,policies,security,polkit,policykit,password
diff -Naur kdebase-workspace-4.3.5/polkit-kde-1/kcmodules/polkitconfig/kcmpolkitconfig.h kdebase-workspace-4.3.5-p/polkit-kde-1/kcmodules/polkitconfig/kcmpolkitconfig.h
--- kdebase-workspace-4.3.5/polkit-kde-1/kcmodules/polkitconfig/kcmpolkitconfig.h	1970-01-01 01:00:00.000000000 +0100
+++ kdebase-workspace-4.3.5-p/polkit-kde-1/kcmodules/polkitconfig/kcmpolkitconfig.h	2010-02-13 01:10:55.000000000 +0100
@@ -0,0 +1,40 @@
+/* This file is part of the KDE project
+
+   Copyright (C) 2009 Dario Freddi <drf@kde.org>
+
+   This program is free software; you can redistribute it and/or
+   modify it under the terms of the GNU General Public
+   License as published by the Free Software Foundation; either
+   version 2 of the License, or (at your option) any later version.
+*/
+
+#ifndef KCMPOLKITCONFIG_H
+#define KCMPOLKITCONFIG_H
+
+#include <kcmodule.h>
+
+class QVBoxLayout;
+namespace Ui {
+    class PolkitConfig;
+}
+
+class KCMPolkitConfig : public KCModule
+{
+    Q_OBJECT
+    public:
+        KCMPolkitConfig(QWidget* parent, const QVariantList& args);
+        virtual ~KCMPolkitConfig();
+
+        virtual void defaults();
+        virtual void load();
+        virtual void save();
+
+    private slots:
+        void addNewIdentity();
+
+    private:
+        Ui::PolkitConfig *m_ui;
+        QVBoxLayout *m_identitiesLayout;
+};
+
+#endif // KCMPOLKITCONFIG_H
diff -Naur kdebase-workspace-4.3.5/polkit-kde-1/kcmodules/polkitconfig/polkitconfig.ui kdebase-workspace-4.3.5-p/polkit-kde-1/kcmodules/polkitconfig/polkitconfig.ui
--- kdebase-workspace-4.3.5/polkit-kde-1/kcmodules/polkitconfig/polkitconfig.ui	1970-01-01 01:00:00.000000000 +0100
+++ kdebase-workspace-4.3.5-p/polkit-kde-1/kcmodules/polkitconfig/polkitconfig.ui	2010-02-13 01:10:55.000000000 +0100
@@ -0,0 +1,187 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<ui version="4.0">
+ <class>PolkitConfig</class>
+ <widget class="QWidget" name="PolkitConfig">
+  <property name="geometry">
+   <rect>
+    <x>0</x>
+    <y>0</y>
+    <width>518</width>
+    <height>321</height>
+   </rect>
+  </property>
+  <property name="windowTitle">
+   <string/>
+  </property>
+  <layout class="QVBoxLayout" name="verticalLayout">
+   <item>
+    <widget class="KTabWidget" name="ktabwidget">
+     <property name="currentIndex">
+      <number>0</number>
+     </property>
+     <widget class="QWidget" name="tab">
+      <attribute name="title">
+       <string>System settings</string>
+      </attribute>
+      <layout class="QVBoxLayout" name="verticalLayout_2">
+       <item>
+        <layout class="QHBoxLayout" name="horizontalLayout_2">
+         <item>
+          <widget class="QLabel" name="warningPixmapLabel">
+           <property name="minimumSize">
+            <size>
+             <width>48</width>
+             <height>48</height>
+            </size>
+           </property>
+           <property name="maximumSize">
+            <size>
+             <width>48</width>
+             <height>48</height>
+            </size>
+           </property>
+           <property name="text">
+            <string/>
+           </property>
+          </widget>
+         </item>
+         <item>
+          <widget class="QLabel" name="warningTextLabel">
+           <property name="text">
+            <string/>
+           </property>
+           <property name="scaledContents">
+            <bool>true</bool>
+           </property>
+           <property name="wordWrap">
+            <bool>true</bool>
+           </property>
+          </widget>
+         </item>
+        </layout>
+       </item>
+       <item>
+        <widget class="QGroupBox" name="groupBox">
+         <property name="title">
+          <string>System administrators</string>
+         </property>
+         <layout class="QVBoxLayout" name="verticalLayout_3">
+          <item>
+           <widget class="QScrollArea" name="scrollArea">
+            <property name="widgetResizable">
+             <bool>true</bool>
+            </property>
+            <widget class="QWidget" name="scrollAreaWidgetContents">
+             <property name="geometry">
+              <rect>
+               <x>0</x>
+               <y>0</y>
+               <width>470</width>
+               <height>144</height>
+              </rect>
+             </property>
+            </widget>
+           </widget>
+          </item>
+          <item>
+           <layout class="QHBoxLayout" name="horizontalLayout">
+            <item>
+             <spacer name="horizontalSpacer">
+              <property name="orientation">
+               <enum>Qt::Horizontal</enum>
+              </property>
+              <property name="sizeHint" stdset="0">
+               <size>
+                <width>40</width>
+                <height>20</height>
+               </size>
+              </property>
+             </spacer>
+            </item>
+            <item>
+             <widget class="KPushButton" name="addIdentityButton">
+              <property name="text">
+               <string>Add</string>
+              </property>
+             </widget>
+            </item>
+           </layout>
+          </item>
+         </layout>
+        </widget>
+       </item>
+      </layout>
+     </widget>
+     <widget class="QWidget" name="tab_2">
+      <attribute name="title">
+       <string>Configuration priority</string>
+      </attribute>
+      <layout class="QFormLayout" name="formLayout">
+       <item row="0" column="0">
+        <widget class="QLabel" name="label">
+         <property name="text">
+          <string>System configuration priority</string>
+         </property>
+        </widget>
+       </item>
+       <item row="0" column="1">
+        <widget class="KIntSpinBox" name="configPrioritySpin">
+         <property name="singleStep">
+          <number>10</number>
+         </property>
+        </widget>
+       </item>
+       <item row="1" column="0">
+        <widget class="QLabel" name="label_2">
+         <property name="text">
+          <string>Policy setting priority</string>
+         </property>
+        </widget>
+       </item>
+       <item row="1" column="1">
+        <widget class="KIntSpinBox" name="policyPrioritySpin">
+         <property name="singleStep">
+          <number>10</number>
+         </property>
+        </widget>
+       </item>
+       <item row="2" column="0" colspan="2">
+        <widget class="QLabel" name="label_3">
+         <property name="text">
+          <string>&lt;i&gt;Please note that 0 is the lowest priority, whereas 99 is the highest.&lt;/i&gt;</string>
+         </property>
+         <property name="scaledContents">
+          <bool>true</bool>
+         </property>
+         <property name="wordWrap">
+          <bool>true</bool>
+         </property>
+        </widget>
+       </item>
+      </layout>
+     </widget>
+    </widget>
+   </item>
+  </layout>
+ </widget>
+ <customwidgets>
+  <customwidget>
+   <class>KIntSpinBox</class>
+   <extends>QSpinBox</extends>
+   <header>knuminput.h</header>
+  </customwidget>
+  <customwidget>
+   <class>KPushButton</class>
+   <extends>QPushButton</extends>
+   <header>kpushbutton.h</header>
+  </customwidget>
+  <customwidget>
+   <class>KTabWidget</class>
+   <extends>QTabWidget</extends>
+   <header>ktabwidget.h</header>
+   <container>1</container>
+  </customwidget>
+ </customwidgets>
+ <resources/>
+ <connections/>
+</ui>
diff -Naur kdebase-workspace-4.3.5/polkit-kde-1/kcmodules/settings-system-policies.desktop kdebase-workspace-4.3.5-p/polkit-kde-1/kcmodules/settings-system-policies.desktop
--- kdebase-workspace-4.3.5/polkit-kde-1/kcmodules/settings-system-policies.desktop	1970-01-01 01:00:00.000000000 +0100
+++ kdebase-workspace-4.3.5-p/polkit-kde-1/kcmodules/settings-system-policies.desktop	2010-02-13 01:10:55.000000000 +0100
@@ -0,0 +1,32 @@
+[Desktop Entry]
+Type=Service
+X-KDE-ServiceTypes=SystemSettingsCategory
+X-KDE-System-Settings-Category=system-policies
+X-KDE-System-Settings-Parent-Category=system
+Icon=preferences-desktop-user-password
+
+Name=System policies
+Name[ca]=Polítiques del sistema
+Name[ca@valencia]=Polítiques del sistema
+Name[cs]=Pravidla systému
+Name[da]=Systempolitikker
+Name[de]=Systemregeln
+Name[en_GB]=System policies
+Name[es]=Políticas del sistema
+Name[et]=Süsteemi reeglid
+Name[fi]=Järjestelmämenettelytavat
+Name[fr]=Stratégies système
+Name[hr]=Pravila sustava
+Name[it]=Politiche di sistema
+Name[km]=គោលនយោបាយ​ប្រព័ន្ធ
+Name[lv]=Sistēmas politikas
+Name[nb]=Systempraksis
+Name[nds]=Systeemregeln
+Name[nl]=Systeenbeleid
+Name[pt]=Políticas do sistema
+Name[pt_BR]=Políticas do sistema
+Name[ro]=Politici de sistem
+Name[sv]=Systempolicy
+Name[uk]=Системні правила доступу
+Name[x-test]=xxSystem policiesxx
+Name[zh_TW]=系統政策
