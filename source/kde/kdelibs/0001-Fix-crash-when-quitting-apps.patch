From 9323adac35d40da69e3cb18504340e984c4afd05 Mon Sep 17 00:00:00 2001
From: Anne-Marie Mahfouf <annma@kde.org>
Date: Fri, 10 May 2013 17:12:33 +0200
Subject: [PATCH] Fix crash when quitting apps

Backport to 4.10 branch

CCBUG: 319137
---
 plasma/private/dialogshadows.cpp | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/plasma/private/dialogshadows.cpp b/plasma/private/dialogshadows.cpp
index b54fb1a..1925670 100644
--- a/plasma/private/dialogshadows.cpp
+++ b/plasma/private/dialogshadows.cpp
@@ -336,6 +336,9 @@ void DialogShadows::Private::freeX11Pixmaps()
 {
 #ifdef Q_WS_X11
     foreach (const QPixmap &pixmap, m_shadowPixmaps) {
+        if (!QX11Info::display()) {
+            return;
+        }
         if (!pixmap.isNull()) {
             XFreePixmap(QX11Info::display(), pixmap.handle());
         }
-- 
1.8.1.2

