# Compiling Time: 25.85 SBU
# Maintainer: centuri0 <achevaux at gmail dot com>

pkgname=kdelibs
pkgrel=4
pkgdesc="KDE4 Core Libraries."
groups=('kde')
replaces=('kat')
archs=('i686' 'x86_64' 'ppc')
Finclude kde
depends=()
## for now
makedepends=("${makedepends[@]}" "krb5" "libqttest>=$_F_kde_qtver" \
	"shared-desktop-ontologies>=0.5")
source=("${source[@]}" \
	frugalware-menu.patch \
	kde-applications-menu.patch)
sha1sums=("${sha1sums[@]}" \
          'c657c474875c155197dde1c846f1791e744febc2' \
          '86ee8c8660f19de8141ac99cd6943964d97a1ed7')

DNSSDDEP="libdnssd>=$_F_kde_ver"
KDE3SUPPORTDEP="libkde3support>=$_F_kde_ver"
KDESUDEP="libkdesu>=$_F_kde_ver"
WEBKITDEP="libkdewebkit>=$_F_kde_ver"
KFILEDEP="libkfile>=$_F_kde_ver"
KHTMLDEP="libkhtml>=$_F_kdever"
KNEWDEP="libknewstuff>=$_F_kde_ver"
KNOTITYDEP="libknotify>=$_F_kde_ver"
KROSSDEP="libkross>=$_F_kde_ver"
KUTILSDEP="libkutils>=$_F_kde_ver"
NEPOMUKDEP="libnepomuk>=$_F_kde_ver"
PLASMADEP="libplasma>=$_F_kde_ver"
THREADWDEP="libthreadweaver>=$_F_kde_ver"

KDELIBS_COREDEP="kdelibs-core>=$_F_kde_ver"

PHONONDEP="phonon>=4.4.0-2"
POLKIT_QT_1DEP="polkit-qt-1>=0.99.0"

LIBQT3SUPPORTDEP="libqt3support>=$_F_kde_qtver"
LIBQTCLUCENEDEP="libqtclucene>=$_F_kde_qtver"
LIBQTCOREDEP="libqtcore>=$_F_kde_qtver"
LIBQTDBUSDEP="libqtdbus>=$_F_kde_qtver"
LIBQTDECLARATIVE="libqtdeclarative>=$_F_kde_qtver"
LIBQTDESIGNERDEP="libqtdesigner>=$_F_kde_qtver"
LIBQTGUIDEP="libqtgui>=$_F_kde_qtver"
LIBQTHELPDEP="libqthelp>=$_F_kde_qtver"
LIBQTOPENGLDEP="libqtopengl>=$_F_kde_qtver"
LIBQTPHONONDEP="phonon" # No version check here for regular phonon package
LIBQTNETWORKDEP="libqtnetwork>=$_F_kde_qtver"
LIBQTSCRIPTDEP="libqtscript>=$_F_kde_qtver"
LIBQTSQLDEP="libqtsql>=$_F_kde_qtver"
LIBQTSVGDEP="libqtsvg>=$_F_kde_qtver"
LIBQTTESTDEP="libqttest>=$_F_kde_qtver"
LIBQTUITOOLSDEP="libqtuitools>=$_F_kde_qtver"
LIBQTWEBKITDEP="libqtwebkit>=$_F_kde_qtver"
LIBQTXMLDEP="libqtxml>=$_F_kde_qtver"
LIBQTXMLPATTERNSDEP="libqtxmlpatterns>=$_F_kde_qtver"

##################################
## auto-split magic starts here ##
##################################

subpkgs=("${subpkgs[@]}" "libkde3support")
subdescs=("${subdescs[@]}" "Libraries to support KDE3 code.")
subdepends=("${subdepends[@]}" "$LIBQTDBUSDEP $LIBQT3SUPPORTDEP $LIBQTSVGDEP
	$POLKIT_QT_1DEP gamin xfsprogs-attr libsm libxcursor libpng fontconfig libxi")
subrodepends=("${subrodepends[@]}" "$KDELIBS_COREDEP $KDESUDEP")
subgroups=("${subgroups[@]}" 'kde kde-core')
subarchs=("${subarchs[@]}" 'i686 x86_64 ppc')

subpkgs=("${subpkgs[@]}" "libplasma")
subdescs=("${subdescs[@]}" "Framework for the KDE desktop shell and its widgets.")
subdepends=("${subdepends[@]}" "$LIBQTUITOOLSDEP $LIBQTWEBKITDEP $LIBQTOPENGLDEP
	qca gamin xfsprogs-attr libqtdbus libxcb libxdamage $POLKIT_QT_1DEP")
subrodepends=("${subrodepends[@]}" "$KDELIBS_COREDEP $KNEWDEP $THREADWDEP $DNSSDDEP")
subgroups=("${subgroups[@]}" 'kde kde-core')
subarchs=("${subarchs[@]}" 'i686 x86_64 ppc')

subpkgs=("${subpkgs[@]}" "libdnssd")
subdescs=("${subdescs[@]}" "Interface to support the DNS-SD (Zeroconf) protocol.")
subdepends=("${subdepends[@]}" "$LIBQTDBUSDEP $LIBQTGUIDEP bzip2 libxext $POLKIT_QT_1DEP avahi")
subrodepends=("${subrodepends[@]}" "$KDELIBS_COREDEP")
subgroups=("${subgroups[@]}" 'kde kde-core')
subarchs=("${subarchs[@]}" 'i686 x86_64 ppc')

subpkgs=("${subpkgs[@]}" "libknotify")
subdescs=("${subdescs[@]}" "User Notification Libraries.")
subdepends=("${subdepends[@]}" "$PHONONDEP gamin xfsprogs-attr bzip2 libxext $POLKIT_QT_1DEP")
subrodepends=("${subrodepends[@]}" "$KDELIBS_COREDEP phonon-backend-vlc")
subgroups=("${subgroups[@]}" 'kde kde-core')
subarchs=("${subarchs[@]}" 'i686 x86_64 ppc')

subpkgs=("${subpkgs[@]}" "libkross")
subdescs=("${subdescs[@]}" "Scripting Libraries.")
subdepends=("${subdepends[@]}" "$LIBQTSVGDEP $LIBQTDBUSDEP $LIBQTDESIGNERDEP
	gamin xfsprogs-attr libpng fontconfig libxi $POLKIT_QT_1DEP libsm libxcursor")
subrodepends=("${subrodepends[@]}" "$KDELIBS_COREDEP $KFILEDEP libkjsembed>=$_F_kde_ver")
subgroups=("${subgroups[@]}" 'kde kde-core')
subarchs=("${subarchs[@]}" 'i686 x86_64 ppc')

subpkgs=("${subpkgs[@]}" "libkdewebkit")
subdescs=("${subdescs[@]}" "KDE WebKit Library")
subdepends=("${subdepends[@]}" "$LIBQTWEBKITDEP $LIBQTGUIDEP $LIBQTDBUSDEP gamin xfsprogs-attr bzip2 libxext libxcb $POLKIT_QT_1DEP")
subrodepends=("${subrodepends[@]}" "$KDELIBS_COREDEP")
subgroups=("${subgroups[@]}" 'kde kde-core')
subarchs=("${subarchs[@]}" 'i686 x86_64 ppc')

subpkgs=("${subpkgs[@]}" "libkhtml")
subdescs=("${subdescs[@]}" "HTML rendering widget designed for Konqueror.")
subdepends=("${subdepends[@]}" "$LIBQTGUIDEP $LIBQTDBUSDEP libjpeg>=8a libgif pcre libxcb gamin xfsprogs-attr libxext bzip2 $POLKIT_QT_1DEP")
subrodepends=("${subrodepends[@]}" "$KDELIBS_COREDEP kdelibs-interfaces>=$_F_kde_ver")
subgroups=("${subgroups[@]}" 'kde kde-core')
subarchs=("${subarchs[@]}" 'i686 x86_64 ppc')

subpkgs=("${subpkgs[@]}" "libkfile")
subdescs=("${subdescs[@]}" "File management widgets and dialogs libraries.")
subdepends=("${subdepends[@]}" "$LIBQTGUIDEP $LIBQTDBUSDEP gamin xfsprogs-attr bzip2 libxext $POLKIT_QT_1DEP")
subrodepends=("${subrodepends[@]}" "$KDELIBS_COREDEP")
subgroups=("${subgroups[@]}" 'kde kde-core')
subarchs=("${subarchs[@]}" 'i686 x86_64 ppc')

subpkgs=("${subpkgs[@]}" "libknewstuff")
subdescs=("${subdescs[@]}" "Allows applications to easily download data from the Internet.")
subdepends=("${subdepends[@]}" "$LIBQTGUIDEP $LIBQTDBUSDEP gamin xfsprogs-attr bzip2 libxext $POLKIT_QT_1DEP")
subrodepends=("${subrodepends[@]}" "$KDELIBS_COREDEP")
subgroups=("${subgroups[@]}" 'kde kde-core')
subarchs=("${subarchs[@]}" 'i686 x86_64 ppc')

subpkgs=("${subpkgs[@]}" "libkdewidgets")
subdescs=("${subdescs[@]}" "KDE custom widgets for Qt Designer.")
subdepends=("${subdepends[@]}" "$LIBQTGUIDEP $LIBQTNETWORKDEP $LIBQTDBUSDEP $LIBQTSQLDEP
	libstdc++ zlib strigi>=0.7.2 xfsprogs-acl libxrender libice libxext $POLKIT_QT_1DEP")
subrodepends=("${subrodepends[@]}" "$KDELIBS_COREDEP $KDESUDEP $KDE3SUPPORTDEP")
subgroups=("${subgroups[@]}" 'kde kde-core')
subarchs=("${subarchs[@]}" 'i686 x86_64 ppc')

subpkgs=("${subpkgs[@]}" "libkjsembed")
subdescs=("${subdescs[@]}" "ECMAScript bindings libraries.")
subdepends=("${subdepends[@]}" "$LIBQTUITOOLSDEP $LIBQTDBUSDEP bzip2 libx11 $POLKIT_QT_1DEP")
subrodepends=("${subrodepends[@]}" "$KDELIBS_COREDEP")
subgroups=("${subgroups[@]}" 'kde kde-core')
subarchs=("${subarchs[@]}" 'i686 x86_64 ppc')

subpkgs=("${subpkgs[@]}" "libkutils")
subdescs=("${subdescs[@]}" "Utility library for printing, chatting and more.")
subdepends=("${subdepends[@]}" "$LIBQTDBUSDEP $LIBQTGUIDEP libxscrnsaver gamin xfsprogs-attr bzip2 $POLKIT_QT_1DEP")
subrodepends=("${subrodepends[@]}" "$KDELIBS_COREDEP")
subgroups=("${subgroups[@]}" 'kde kde-core')
subarchs=("${subarchs[@]}" 'i686 x86_64 ppc')

subpkgs=("${subpkgs[@]}" "libthreadweaver")
subdescs=("${subdescs[@]}" "Job-based threading library.")
subdepends=("${subdepends[@]}" "$LIBQTCOREDEP libgcc")
subrodepends=("${subrodepends[@]}" "")
subgroups=("${subgroups[@]}" 'kde kde-core')
subarchs=("${subarchs[@]}" 'i686 x86_64 ppc')

subpkgs=("${subpkgs[@]}" "libkimgio")
subdescs=("${subdescs[@]}" "Gimgio class extension libraries.")
subdepends=("${subdepends[@]}" "$LIBQTGUIDEP $LIBQTDBUSDEP jasper libxext bzip2 $POLKIT_QT_1DEP openexr>=1.6.1")
subrodepends=("${subrodepends[@]}" "$KDELIBS_COREDEP")
subgroups=("${subgroups[@]}" 'kde kde-core')
subarchs=("${subarchs[@]}" 'i686 x86_64 ppc')

subpkgs=("${subpkgs[@]}" "libkunitconversion")
subdescs=("${subdescs[@]}" "KDE Unit conversation library.")
subdepends=("${subdepends[@]}" "$LIBQTDBUSDEP $LIBQTGUIDEP bzip2 libxext $POLKIT_QT_1DEP")
subrodepends=("${subrodepends[@]}" "$KDELIBS_COREDEP")
subgroups=("${subgroups[@]}" 'kde kde-core')
subarchs=("${subarchs[@]}" 'i686 x86_64 ppc')

rodepends=("${rodepends[@]}" "${subpkgs[@]}")

subpkgs=("${subpkgs[@]}" "libkactivities")
subdescs=("${subdescs[@]}" "Libraries for the KDE activities management.")
subdepends=("${subdepends[@]}" "")
subrodepends=("${subrodepends[@]}" "$KDELIBS_COREDEP")
subgroups=("${subgroups[@]}" 'kde-extra')
subarchs=("${subarchs[@]}" 'i686 x86_64 ppc')

subpkgs=("${subpkgs[@]}" "libkdeclarative")
subdescs=("${subdescs[@]}" "KDE declarative extensions")
subdepends=("${subdepends[@]}" "$LIBQTDECLARATIVE")
subrodepends=("${subrodepends[@]}" "$KDELIBS_COREDEP")
subgroups=("${subgroups[@]}" 'kde-extra')
subarchs=("${subarchs[@]}" 'i686 x86_64 ppc')

subpkgs=("${subpkgs[@]}" "libnepomuk")
subdescs=("${subdescs[@]}" "Semantic information retrieval and tagging.")
subdepends=("${subdepends[@]}" "$LIBQTDBUSDEP $LIBQTGUIDEP soprano-backend-redland>=2.7.0 bzip2 $POLKIT_QT_1DEP libxext shared-desktop-ontologies")
subrodepends=("${subrodepends[@]}" "$KDELIBS_COREDEP")
subgroups=("${subgroups[@]}" 'kde-extra')
subarchs=("${subarchs[@]}" 'i686 x86_64 ppc')

_F_kde_subpkgs=("${subpkgs[@]}")

#################################
## auto-split magic stops here ##
#################################

subpkgs=("${subpkgs[@]}" "ksgmltools2")
subdescs=("${subdescs[@]}" "KDE doc tools.")
subdepends=("${subdepends[@]}" "$LIBQTGUIDEP $LIBQTDBUSDEP docbook-xsl libxslt bzip2 gamin xfsprogs-attr libxext $POLKIT_QT_1DEP")
subrodepends=("${subrodepends[@]}" "$KDELIBS_COREDEP")
subgroups=("${subgroups[@]}" 'kde kde-core')
subarchs=("${subarchs[@]}" 'i686 x86_64 ppc')

## maybe split more ? interfces/<foo> ? worth doing that ?
subpkgs=("${subpkgs[@]}" "$pkgname-interfaces")
subdescs=("${subdescs[@]}" "Kparts interface for text editors, mediaplayer and scripting.")
subdepends=("${subdepends[@]}" "gamin xfsprogs-attr bzip2 libxext $POLKIT_QT_1DEP $PHONONDEP")
subrodepends=("${subrodepends[@]}" "$KDELIBS_COREDEP")
subgroups=("${subgroups[@]}" 'kde kde-core')
subarchs=("${subarchs[@]}" 'i686 x86_64 ppc')

## this need kpty
subpkgs=("${subpkgs[@]}" "libkdesu")
subdescs=("${subdescs[@]}" "Library for password entering and handling.")
subdepends=("${subdepends[@]}" "$LIBQTDBUSDEP bzip2 $POLKIT_QT_1DEP")
subrodepends=("${subrodepends[@]}" "$KDELIBS_COREDEP")
subgroups=("${subgroups[@]}" 'kde kde-core')
subarchs=("${subarchs[@]}" 'i686 x86_64 ppc')

######## kdelibs-core / kdelibs-data ###############
## projects in here:                               ##
## kinit , kdecore , kded , cmake , includes       ##
## kconf_update , kio , kioslave , interfaces/kio  ##
## mimetypes , licenses , solid, kdeui, kjs, solid ##
#####################################################


## WARNING : DO NOT REMOVE *kparts , kdeui , kjs , solid*
## from here since these create weird circular depends() -- crazy -- ( KDE 4.4 )
## FIXME!!

subpkgs=("${subpkgs[@]}" "kdelibs-core")
subdescs=("${subdescs[@]}" "KDE4 Core Library.")
subdepends=("${subdepends[@]}" "$LIBQTNETWORKDEP pcre xz $POLKIT_QT_1DEP \
	libdbusmenu-qt>=0.7.0 libgcc strigi>=0.7.2-2 xfsprogs-acl libxrender libice \
	libxtst libxfixes libuuid libkrb5 shared-mime-info udev udisks upower attica>=0.1.2")
subrodepends=("${subrodepends[@]}" "kdelibs-data")
subgroups=("${subgroups[@]}" 'kde kde-core')
subarchs=("${subarchs[@]}" 'i686 x86_64 ppc')

##FIXME!!! what to do with these ?
subpkgs=("${subpkgs[@]}" "kdelibs-data")
subdescs=("${subdescs[@]}" "Data files ( desktop files , protocol files , man , icons).")
subdepends=("${subdepends[@]}" "")
subrodepends=("${subrodepends[@]}" "")
subgroups=("${subgroups[@]}" 'kde kde-core')
subarchs=("${subarchs[@]}" 'i686 x86_64 ppc')

subpkgs=("${subpkgs[@]}" "$pkgname-docs")
subdescs=("${subdescs[@]}" "Kdelibs Documentation")
subdepends=("${subdepends[@]}" "")
subrodepends=("${subrodepends[@]}" "")
subgroups=("${subgroups[@]}" 'docs-extra kde-docs')
subarchs=("${subarchs[@]}" 'i686 x86_64 ppc')

subpkgs=("${subpkgs[@]}" "$pkgname-compiletime")
subdescs=("${subdescs[@]}" "Kdelibs extra headers, cmake and pkgconfig files")
subdepends=("${subdepends[@]}" "")
subrodepends=("${subrodepends[@]}" "")
subgroups=("${subgroups[@]}" 'devel-extra kde-build')
subarchs=("${subarchs[@]}" 'i686 x86_64 ppc')

subpkgs=("${subpkgs[@]}" "sonnet-plugin-hspell")
subdescs=("${subdescs[@]}" "Natural language processing for hspell")
subdepends=("${subdepends[@]}" "$LIBQTDBUSDEP bzip2 $POLKIT_QT_1DEP hspell")
subrodepends=("${subrodepends[@]}" "$KDELIBS_COREDEP")
subgroups=("${subgroups[@]}" 'kde-extra')
subarchs=("${subarchs[@]}" 'i686 x86_64 ppc')

subpkgs=("${subpkgs[@]}" "sonnet-plugin-aspell")
subdescs=("${subdescs[@]}" "Natural language processing for aspell")
subdepends=("${subdepends[@]}" "$LIBQTDBUSDEP aspell bzip2 $POLKIT_QT_1DEP")
subrodepends=("${subrodepends[@]}" "$KDELIBS_COREDEP")
subgroups=("${subgroups[@]}" 'kde-extra')
subarchs=("${subarchs[@]}" 'i686 x86_64 ppc')

subpkgs=("${subpkgs[@]}" "sonnet-plugin-enchant")
subdescs=("${subdescs[@]}" "Natural language processing for enchant")
subdepends=("${subdepends[@]}" "$LIBQTDBUSDEP enchant bzip2 $POLKIT_QT_1DEP")
subrodepends=("${subrodepends[@]}" "$KDELIBS_COREDEP")
subgroups=("${subgroups[@]}" 'kde-extra')
subarchs=("${subarchs[@]}" 'i686 x86_64 ppc')

build()
{
	Fcd
	## First some magic -- FIXME: need patch-$arch ..
	sed -i -e 's|KDE_VERSION_STRING.*|KDE_VERSION_STRING "(KDE ${KDE_VERSION}) Frugalware Linux")|g' CMakeLists.txt || Fdie
	KDE_make_split

	## ksgmltools2
	KDE_project_split ksgmltools2 kdoctools

	## sonnet-plugins
	KDE_project_split sonnet-plugin-hspell  sonnet/plugins/hspell
	KDE_project_split sonnet-plugin-aspell  sonnet/plugins/aspell
	KDE_project_split sonnet-plugin-enchant sonnet/plugins/enchant

	## libkdesu
	KDE_project_install kdesu
	KDE_project_install kpty
	Fsplit libkdesu /\*

	## -interfaces
	KDE_project_install  interfaces/khexedit
	KDE_project_install  interfaces/kimproxy
	KDE_project_install  interfaces/kmediaplayer
	KDE_project_install  interfaces/kregexpeditor
	KDE_project_install  interfaces/kspeech
	KDE_project_install  interfaces/ktexteditor
	KDE_project_install  interfaces/terminal
	Fsplit $pkgname-interfaces /\*

	#####  kdelibs-core / kdelibs-data start  #######
	KDE_project_install kdecore
	KDE_project_install kinit
	KDE_project_install kded
	KDE_project_install kconf_update
	KDE_project_install kio
	KDE_project_install kioslave
	KDE_project_install interfaces/kio
	KDE_project_install licenses
	KDE_project_install mimetypes
	KDE_project_install kjs
	KDE_project_install kdeui
	KDE_project_install kparts
	KDE_project_install solid

	## KDEUI has 2 icon folders ? hmm ? what for ?
        ## And why do we need desktop files for the libs ? .protocol files ? colors ???
        ## These are kdebase-runtime files ? no ?:) I'm lost :-D

	## OK -data subpackage -> man pages
	KDE_project_install doc
	Frm usr/share/doc
	Finstallrel 644 ./cmake/modules/*.1 /usr/share/man/man1/

	KDE_cleanup

	Fsplit kdelibs-data usr/share/apps/kdeui/about
	Fsplit kdelibs-data usr/share/apps/kdeui/pics
	Fsplit kdelibs-data usr/share/kde4/services
	Fsplit kdelibs-data usr/share/kde4/servicetypes
	Fsplit kdelibs-data usr/share/apps/LICENSES
	Fsplit kdelibs-data etc/kde/config/colors
	Fsplit kdelibs-data etc/xdg/menus
	Fsplit kdelibs-data usr/share/man

	## now split the rest to kdelibs-core
	Fsplit kdelibs-core /\*

	KDE_install
}

# optimization OK

