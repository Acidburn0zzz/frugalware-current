# Last modified: Tue, 07 Feb 2006 22:26:39 +0100
# Compiling Time: 0.49 SBU 
# Maintainer: Kapolnasi Tamas <ktamas@tdc.hu>
# Contributor: crazy <crazy@pimpmylinux.org>
 
pkgname=qt
pkgver=3.3.5
pkgrel=3
pkgmore=x11-free
pkgdesc="The QT GUI toolkit."
url="http://www.trolltech.com/products/qt"
install=qt.install
depends=( 'libxrandr' 'mesa' 'libxft' 'libmng' 'libjpeg' 'libxcursor' 'libxinerama' 'libsm' 'imake')
makedepends=('mysql>=5.0.15' 'postgresql' 'sqlite3' 'cups' 'bison')
groups=('kde' 'kde-lib')
archs=('i686' 'x86_64')
options=('nodocs')
removes=('usr/share/doc/qt-3.3.5/README*' 'usr/share/doc/qt-3.3.5/FAQ' 'usr/share/doc/qt-3.3.5/MANIFEST' \
           'usr/share/doc/qt-3.3.5/INSTALL' 'usr/lib/qt/mkspecs/default')
up2date=$pkgver
source=(ftp://ftp.trolltech.com/qt/source/$pkgname-$pkgmore-$pkgver.tar.bz2 qt.sh \
         $pkgname-$pkgmore-$pkgver-gcc4-buildkey.patch \
         $pkgname-$pkgmore-$pkgver-gcc4.patch \
         $pkgname-$pkgmore-$pkgver-fix_werror_with_gcc4.patch \
         $pkgname-$pkgmore-$pkgver-propagate-horizontal-wheelevent.patch \
         $pkgname-$pkgmore-$pkgver-uic.patch \
         $pkgname-$pkgmore-$pkgver-visibility.patch \
         $pkgname-$pkgmore-$pkgver-0007-qpixmap_constants.patch0 \
         $pkgname-$pkgmore-$pkgver-0015-qiconview-finditem.patch0 \
         $pkgname-$pkgmore-$pkgver-0016-qiconview-rebuildcontainer.patch0 \
         $pkgname-$pkgmore-$pkgver-0017-qiconview-ctrl_rubber.patch0 \
         $pkgname-$pkgmore-$pkgver-0035-qvaluelist-streaming-operator.patch0 \
         $pkgname-$pkgmore-$pkgver-0044-qscrollview-windowactivate-fix.patch0 \
         $pkgname-$pkgmore-$pkgver-0046-qiconview-no-useless-scrollbar.patch0 \
         $pkgname-$pkgmore-$pkgver-0049-qiconview-rubber_on_move.patch0 \
         $pkgname-$pkgmore-$pkgver-0051-qtoolbar_77047.patch0 \
         $pkgname-$pkgmore-$pkgver-0056-khotkeys_input_84434.patch0 \
         $pkgname-$pkgmore-$pkgver-no-rpath+fw.patch \
         $pkgname-$pkgmore-$pkgver-0066-fcsort2fcmatch.patch0 \
         $pkgname-$pkgmore-$pkgver-0067-nofclist.patch0 \
	 $pkgname-$pkgmore-$pkgver-0068-xcursors-cache-fix.patch0 \
         $pkgname-$pkgmore-$pkgver-0001-dnd_optimization.patch0 \
         $pkgname-$pkgmore-$pkgver-0002-dnd_active_window_fix.patch0 \
         $pkgname-$pkgmore-$pkgver-0038-dragobject-dont-prefer-unknown.patch0 \
	 $pkgname-$pkgmore-$pkgver-from-3.3.6_fix.patch)


sha1sums=('8d7c7ba0b39848ef60b3cd93fc1d33e9527694ec' \
          '0464d40d9bd518fe8d139b1306136089349a4cdf' \
          'af1e2bf9b97cc73a96c3052f848f7eac0f1df125' \
          '54d37e3988c4b195ae960ef2c59e678151115211' \
          '45f746bafe264540e893085b525cde6bde39db23' \
          '91d67b9cbe860971e73291c5d97d6bd45f91ad31' \
          'dba54b91b2b00c1d052ac512d824b29d31aefb89' \
          '0e88e4f3a184b0f0544bd0cbd8302e55aaf14871' \
          '675dd91472b7e24a2866f8e5ac16ce5d9d9f6a9e' \
          '74f1ea03aa69a708f1b96abaeb9a6b2d72506027' \
          'ba5d57a2ef1c17d7bd1b1ab0f84f1ccbd2f87f01' \
          '133a5d3282f324d079da85803d0b33c9fa713eeb' \
          'ecccc7862b7e6eaca00a20948326761a7ce6b2bb' \
          '657ff8ab47aafbd6469688f489fd3788ccb98907' \
          'e4c2ce1279b6b2a6efc61713d0c0f59befecdfd6' \
          '124e713ab6323f8172d5df1938fb45677f5249de' \
          '7dd9c06079cb7c6f4b6c002948582fce1f190dde' \
          '0508ebaa92068ea475b5906cb298f37230483b73' \
          '44b5c643ceddbf39b3b11cee27f4f653829e1ce7' \
          'f5840c1309a599ebe20d64a602089beed3030d50' \
          '0a6f040743228856104f0302d257cb57ace41c60' \
          'be02bb6061453c06f8c946c686ad6f7c97cfd254' \
          '4f3416c3a7e44d52c1088c52256decb384e4b1bc' \
          '5b16995f072cbde80f000967aa11d8a88ed34e23' \
          '3a2371a520d800904350bb9e6e445d6b3092bb88' \
          'd50158d27b11bf68b646671f2e6bfddf0db1b2a8')



export QTDIR=$startdir/src/$pkgname-$pkgmore-$pkgver
export PATH=${QTDIR}/bin:${PATH}
export LD_LIBRARY_PATH=${QTDIR}/lib:${LD_LIBRARY_PATH}
## may work
export YACC='yacc -d'

build()
{
	Fcd $pkgname-$pkgmore-$pkgver 
	Fpatchall
        rm -rf doc/html examples tutorial
        Fsed "-O2" "${CFLAGS} -fPIC" mkspecs/linux-g++/qmake.conf
        Fsed "-ln -s -f @QMAKESPEC@ @QT_INSTALL_DATA@/mkspecs/default" "" qmake/Makefile.unix
	Fsed "-cp -L -R -f @SOURCE_PATH@/mkspecs @QT_INSTALL_DATA@" "" qmake/Makefile.unix
        ./configure -platform linux-g++ -prefix /usr/lib/qt \
              -qt-gif -system-{libpng,libjpeg,libmng,zlib} \
              -plugin-imgfmt-{png,jpeg,mng} -largefile \
              -plugin-sql-{mysql,psql,sqlite} \
              -thread -shared -stl -release  -no-exceptions -fast -dlopen-opengl \
              -nis -no-pch -sm -tablet || return 1
        Fmkdir /usr/lib/qt/mkspecs
        cp -r mkspecs/linux-g++ $Fdestdir/usr/lib/qt/mkspecs/linux-g++
        ## see the docs for that
        cd $Fsrcdir/$pkgname-$pkgmore-$pkgver/plugins/src/sqldrivers/mysql
        qmake -o Makefile "INCLUDEPATH+=/usr/include/mysql" "LIBS+=-L/usr/lib/mysql -lmysqlclient" mysql.pro
  
        cd $Fsrcdir/$pkgname-$pkgmore-$pkgver/plugins/src/sqldrivers/psql
        qmake -o Makefile "INCLUDEPATH+=/usr/include/postgresql/server /usr/include" "LIBS+=-L/usr/lib -lpq" psql.pro
        
        cd $Fsrcdir/$pkgname-$pkgmore-$pkgver
        make || return 1
        make INSTALL_ROOT=$Fdestdir install 
        rm -rf $Fdestdir/usr/lib/$pkgname/{phrasebooks,templates} ##not needed 
        
        ## man pages ? :)
        Fmkdir /usr/lib/$pkgname/man
        cp -r $Fsrcdir/$pkgname-$pkgmore-$pkgver/doc/man/{man1,man3} $Fdestdir/usr/lib/$pkgname/man 
        Fsed "-L$startdir/src/$pkgname-$pkgmore-$pkgver/lib" "" $Fdestdir/usr/lib/$pkgname/lib/*.prl
        Fexe /etc/profile.d/qt.sh
        (cd $Fdestdir/usr/lib/qt/mkspecs; ln -sf linux-g++ default)
}

# vim: ft=sh

# optimalization OK
