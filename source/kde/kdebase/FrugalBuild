# Last modified: Fri, 29 Sep 2006 15:46:08 +0200
# Compiling time: 15.04 SBU
# Maintainer: crazy <crazy@frugalware.org>
# Contributor: Kapolnasi Tamas <ktamas@tdc.hu>

pkgname=kdebase
pkgver=3.5.4
pkgrel=4
pkgdesc="KDE Base Programs."
depends=('libxcomposite' 'libxscrnsaver' 'kdelibs>=3.5.4-4' 'libraw1394' 'hal>=0.5.7.1-3' 'mtools' 'libxdamage' \
   'pmount' 'xscreensaver' 'bdftopcf' 'lmsensors' 'libxxf86misc' 'libfontenc' 'xkbdata' 'setxkbmap' 'dbus-qt3>=20060814')
makedepends=('samba' 'cyrus-sasl' 'imake' 'doxygen' 'qt-docs')
rodepends=('xorg-server>=1.1.0' 'kde-frugalware>=0.5' 'xsetroot' 'dbus-x11' 'xmessage')
groups=('kde' 'kde-core')
archs=('i686' 'x86_64')
conflicts=('ksplash-engine-moodin')
options=('nodocs' 'scriptlet')
Finclude kde
source=(${source[@]} \
	kde.desktop \
	xinitrc.kde \
	preloadkde \
	konqy_preload.desktop \
	$pkgname-$pkgver-misc_fixes.patch \
        fw-default-dejavu-font.patch \
        fw-default-moodin-0.4.2.patch \
        fw-default-startkde.patch \
        fw-default-theme.patch \
	mediamanager.patch \
	media_unmount.desktop.patch \
	bug-131770.patch  \
	full-hinting.patch)
## NOTE: if someone change fw-default-dejavu-font.patch its _NEED_ be in sync with
##       fw-default-dejavu-font.patch from kdelibs and both pkgs _NEED_ be recompiled!
##       DO NOT REMOVE or CHANGE fw-default-startkde.patch without permission from m8r!  - crazy -
sha1sums=('18f2bb3643a40f937bf260d5969d6919aa52abf4' \
          'e1f706c984fc81633663c662e674b6f2c64d2f83' \
          '81092d3c9cfc08de1ac63c8318f0f1391501fb8d' \
          '47f17c8b39c11496cb13a25db4bf796444f895de' \
          '9c91aef12565bdc07c7643885e8ed506bc44d51c' \
          '08fbbf8bbd4efd83a78028e2ff4a6bd95d67c869' \
          '17380bbffcda4f57d8bda1fe77c24feba243d7db' \
          '3774a1c12b15d3692fb54fd874c74ebed4b9c7f5' \
          'b83a2313f9111a7da5342eab4eac29fd19802256' \
          'c1725544d59140a9f61a7137f160eabf23ef3201' \
          'b2470a23fcb749ce9f78b33a474cf914da132d6f' \
          '8c23593b38a050cb38c135209daee85f46a7ee2a' \
          '0796383a2100d1ac0edbf33a1e1243e7a8a5fa41' \
          'a940daab394615afd1105a4da28418a931c321e0')

subpkgs=("$pkgname-docs")
subdescs=("Kdebase Documentation")
subdepends=("$pkgname=$pkgver")
subgroups=('kde-extra kde-docs')
subarchs=('i686 x86_64')


build()
{
	Fcd
	Fpatchall
	make -f admin/Makefile.common || Fdie
        Fmake CXXFLAGS="$CXXFLAGS -Wno-deprecated" \
		--disable-dependency-tracking \
		--disable-debug \
		--without-debug \
		--disable-warnings \
		--with-dpms \
		--with-gnu-ld \
		--with-libusb \
		--with-shadow \
		--with-hal \
                --enable-gcc-hidden-visibility \
		--enable-final
	Fmakeinstall
        # xinitrc for KDE.
	Fexe /etc/X11/xinit/xinitrc.kde
	Ffile /usr/share/autostart/konqy_preload.desktop
	Ffile /usr/bin/preloadkde

	# Konsole configuration.
	Fsed 'Exec=$' 'Exec=bash -ls' $Fdestdir/usr/share/apps/konsole/shell.desktop
	Fsed 'Exec=$' 'Exec=bash -ls' $Fdestdir/usr/share/apps/konsole/linux.desktop
	
	# Session file.
	Ffile /etc/X11/sessions/kde.desktop
	Frm usr/share/config/kdm/kdmrc
	Frm usr/share/config/kdm/backgroundrc
	Frm usr/share/config/klipperrc
	Fsplit $pkgname-docs usr/share/doc
}

# optimization OK
