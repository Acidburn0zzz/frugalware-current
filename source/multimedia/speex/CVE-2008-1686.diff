diff -Naur speex-1.2beta3/libspeex/speex_header.c fw_speex-1.2beta3/libspeex/speex_header.c
--- speex-1.2beta3/libspeex/speex_header.c	2007-11-25 08:51:47.000000000 +0100
+++ fw_speex-1.2beta3/libspeex/speex_header.c	2008-04-23 23:58:31.000000000 +0200
@@ -178,6 +178,13 @@
    ENDIAN_SWITCH(le_header->frames_per_packet);
    ENDIAN_SWITCH(le_header->extra_headers);
 
+   if (le_header->mode >= SPEEX_NB_MODES || le_header->mode < 0)
+   {
+	   speex_notify("Invalid mode specified in Speex header");
+	   speex_free (le_header);
+	   return NULL;
+   }
+
    return le_header;
 
 }
