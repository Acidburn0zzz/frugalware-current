# Last Modified: Thu, 02 Jun 2005 11:33:58 +0000
# Compiling Time: ~1 SBU
# Maintainer: voroskoi <voroskoi@freemail.hu>

pkgname=ffmpeg
pkgver=0.4.9_pre1
origver=`echo $pkgver |sed 's/_/-/'`
pkgrel=3
pkgdesc="FFMpeg is a complete and free Internet live audio and vide  broadcasting solution for Linux/Unix"
url="http://ffmpeg.sourceforge.net/"
depends=('a52dec' 'lame' 'freetype2' 'faac' 'libvorbis' 'libdc1394')
groups=('multimedia')
archs=('i686' 'x86_64')
up2date="lynx -dump http://sourceforge.net/project/showfiles.php?group_id=16082  |grep ffmpeg.*tar |sed -n -e 's/.*g-\(.*\)\.t.*/\1/;s/-/_/;1 p'"
source=(http://heanet.dl.sourceforge.net/sourceforge/ffmpeg/$pkgname-$origver.tar.gz \
	ffmpeg-gcc34.patch ffmpeg-0.4.9-pre1-misc-fixes.patch ffmpeg-fpic.patch)
md5sums=('ea5587e3c66d50b1503b82ac4179c303' '7bdc2ddedf209d4a9200f66f70c9a786' \
	'49391b9580d1c99d0c1cabd7e425bf23' '741f03db9f5c9539b060f3089206700e')

build() {
	cd $startdir/src/$pkgname-$origver
		mkdir -p $startdir/pkg/usr/bin
		# patch for gcc 3.4.x:
		patch -p0 <../ffmpeg-gcc34.patch || return 1
		Fpatch ffmpeg-0.4.9-pre1-misc-fixes.patch || return 1
		[ "$CARCH" == "x86_64" ] && Fpatch ffmpeg-fpic.patch

		# ffmpeg itself:
		./configure \
			--prefix=/usr \
			--enable-gpl \
			--enable-mp3lame \
			--enable-vorbis \
			--enable-pp \
			--enable-faac \
			--enable-faad \
			--enable-a52 \
			--enable-shared \
			--enable-pthreads 
		make || return 1
		make prefix=$startdir/pkg/usr bindir=$startdir/pkg/usr/bin mandir=$startdir/pkg/usr/man install

		# libpostproc
		cd $startdir/src/$pkgname-$origver/libavcodec/libpostproc
			# libpostproc.a:
			make || return 1
			make prefix=$startdir/pkg/usr install || return 1
			
			# libpostproc.so:
			make SHARED_PP="yes" || return 1
			make prefix=$startdir/pkg/usr \
			SHARED_PP="yes" \
			install || return 1
}

# vim: ft=sh
