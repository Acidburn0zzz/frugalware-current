# Last Modified: Sun, 07 Aug 2005 20:30:02 +0200
# Compiling Time: ~1 SBU
# Maintainer: voroskoi <voroskoi@freemail.hu>

pkgname=ffmpeg
pkgver=0.4.9_pre1
origver=`echo $pkgver |sed 's/_/-/'`
pkgrel=4
pkgdesc="FFMpeg is a complete and free Internet live audio and vide  broadcasting solution for Linux/Unix"
url="http://ffmpeg.sourceforge.net/"
depends=('sdl' 'a52dec' 'freetype2' 'lame' 'faac' 'imlib2' 'libvorbis' 'libdc1394')
groups=('multimedia')
archs=('i686' 'x86_64')
up2date="lynx -dump http://sourceforge.net/project/showfiles.php?group_id=16082  |grep ffmpeg.*tar |sed -n -e 's/.*g-\(.*\)\.t.*/\1/;s/-/_/;1 p'"
source=(http://heanet.dl.sourceforge.net/sourceforge/ffmpeg/$pkgname-$origver.tar.gz \
	ffmpeg-0.4.9-pre1-misc-fixes.patch ffmpeg-fpic.patch \
	ffmpeg-gcc4.patch ffmpeg-config.patch)
sha1sums=('aad00445137520bec19e56bcb042e75a10c53bb3' \
          '01558bef688fc72587911805eda350742d5c2fb0' \
          'fe5e3f3d6ba7401f847e79fcf920eff4fb5ea8d4' \
          'b962d239f22f5817a6f476daf83f986632eee220' \
          '2d55fb081b7b9e3be5912da36b8eda463ebab85a')

build() {
	cd $startdir/src/$pkgname-$origver
		mkdir -p $startdir/pkg/usr/bin
		Fpatch ffmpeg-0.4.9-pre1-misc-fixes.patch || return 1
		[ "$CARCH" == "x86_64" ] && Fpatch ffmpeg-fpic.patch
		Fpatch ffmpeg-gcc4.patch
		Fpatch ffmpeg-config.patch
		Fsed "@VERSION@" "$pkgver" ffmpeg-config.in

		# ffmpeg itself:
		./configure \
			--prefix=/usr \
			--enable-gpl \
			--enable-mp3lame \
			--enable-vorbis \
			--enable-pp \
			--enable-faac \
			--enable-faad \
			--enable-a52 \
			--enable-shared \
			--enable-pthreads 
		make || return 1
		make prefix=$startdir/pkg/usr bindir=$startdir/pkg/usr/bin mandir=$startdir/pkg/usr/man install
		Fexerel ffmpeg-config.in /usr/bin/ffmpeg-config || return 1
		Ffilerel ffmpeg-config.1 /usr/man/man1/ffmpeg-config.1 || return 1

		(chmod +x $Fdestdir/usr/bin/ffmpeg-config)

		# libpostproc
		cd $startdir/src/$pkgname-$origver/libavcodec/libpostproc
			# libpostproc.a:
			make || return 1
			make prefix=$startdir/pkg/usr install || return 1
			
			# libpostproc.so:
			make SHARED_PP="yes" || return 1
			make prefix=$startdir/pkg/usr \
			SHARED_PP="yes" \
			install || return 1
}

# vim: ft=sh

# optimalization OK
