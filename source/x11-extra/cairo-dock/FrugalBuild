# Compiling Time: 1 SBU
# Maintainer: James Buren <ryuo@frugalware.org>

pkgname=cairo-dock
pkgver=20080622
pkgrel=1
pkgdesc="A lightweight dock built with cairo, imitates MacOSX dock."
url="http://www.cairo-dock.org/"
options=('scriptlet' 'nodocs')
depends=('librsvg' 'dbus-glib' 'libxtst' 'libxcomposite')
makedepends=('intltool' 'doxygen' 'alsa-lib' 'vte')
groups=('x11-extra')
archs=('i686' 'x86_64')
_F_archive_name=$pkgname-sources
up2date="Flasttar http://developer.berlios.de/project/showfiles.php?group_id=8724"
source=(http://download.berlios.de/$pkgname/$pkgname-sources-$pkgver.tar.bz2)
sha1sums=('f35c207623d2d74a057e46f1eee479cd61417c04')
subpkgs=("$pkgname-plugins" "$pkgname-themes")
subdescs=("Plugins for $pkgname." "Themes for $pkgname.")
subrodepends=("$pkgname alsa-lib vte" "$pkgname")
subgroups=("x11-extra" "xlib-extra")
subarchs=("i686 x86_64" "i686 x86_64")

build()
{
	Fcd $pkgname
	# generate doxygen docs
	cd doc || Fdie
	./generate-doc.sh || Fdie
	cd .. || Fdie
	# reconfig, and install first component
	Fautoreconf
	Fconf --enable-glitz
	make LDFLAGS="-lXcomposite" || Fdie
	Fmakeinstall
	Fdocrel {INSTALL,LICENSE}
	Fcprel doc/html /usr/share/doc/$pkgname-$pkgver
	# fix execute permissions
	Fdirschmod /usr/bin +x
	# install, and split plugins
	cd ../plug-ins || Fdie
	Fautoreconf
	PKG_CONFIG_PATH="$Fdestdir/usr/lib/pkgconfig"
	Fconf
	make CC="gcc -I$Fdestdir/usr/include/$pkgname -I$Fdestdir/usr/include/$pkgname/$pkgname" || Fdie
	Fmakeinstall
	Fsplit $pkgname-plugins /usr/lib/$pkgname
	for i in $Fdestdir/usr/share/locale/*/LC_MESSAGES/cd-*.mo; do
		Fsplit $pkgname-plugins `echo $i | sed 's|^.*/pkg||'`
	done
	# install, and split themes
	cd ../themes || Fdie
	Fautoreconf
	Fbuild
	Fsplit $pkgname-themes /usr/share/$pkgname/themes
}

# optimization OK
