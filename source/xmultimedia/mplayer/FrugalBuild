# Compiling time: 3.05 SBU
# Contributor: Miklos Vajna <vmiklos@frugalware.org>
# Maintainer: crazy <crazy@frugalware.org>

USE_DEVEL=${USE_DEVEL:-"n"}

pkgname=mplayer
_F_archive_name=MPlayer
pkgver=1.2
pkgrel=4
pkgdesc="The Movie Player"
url="http://www.mplayerhq.hu/"
depends=('a52dec' 'aalib' 'cdparanoia' 'codecs' 'faac' 'faad2' 'gsm' \
         'lame' 'libass' 'libbluray' 'libdv' 'libgif>=5.1.1' \
         'liblirc' 'libmad' 'libpulse>=6.0' 'libtheora' 'libvdpau' 'libvpx' \
         'libxxf86dga' 'lzo' 'openal' 'opencore-amr' 'rtmpdump' 'speex' \
         'v4l-utils' 'x264>=20151115_2245' 'xvidcore')

makedepends=('yasm' 'x11-protos')
groups=('xmultimedia')
backup=('etc/mplayer/mplayer.conf')
conflicts=('mplayer2')
archs=('i686' 'x86_64')
options=('scriptlet')
up2date="Flasttar $url/MPlayer/releases"
source=(http://www.mplayerhq.hu/MPlayer/releases/$_F_archive_name-$pkgver.tar.xz \
	http://www.mplayerhq.hu/MPlayer/releases/fonts/font-arial-cp1250.tar.bz2 \
	http://www.mplayerhq.hu/MPlayer/releases/fonts/font-arial-iso-8859-1.tar.bz2 \
	http://www.mplayerhq.hu/MPlayer/releases/fonts/font-arial-iso-8859-2.tar.bz2 \
	http://www.mplayerhq.hu/MPlayer/releases/fonts/font-arial-iso-8859-7.tar.bz2)

sha1sums=('64fad840dfae466ab5ef3be2b6c74058892cd981' \
          'ccf11dce5d0fb72fd3af97f788b7471cd0cd0b68' \
          '152c40bf20de34aa8802d7f80d34d673b0b67212' \
          '7b99bbe0e9ba89a57eccbea8f93c453c4f268181' \
          '2a3fa8cf54ec3ed4dfa1a0e72f2d207c13507b9d')

if Fuse $USE_DEVEL; then
	pkgver=1.1.35924
	pkgrel=1
	makedepends=(${makedepends[@]} 'git')
	source=(${source[1]} ${source[2]} ${source[3]} ${source[4]} ${source[5]})
	sha1sums=(${sha1sums[1]} ${sha1sums[2]} ${sha1sums[3]} ${sha1sums[4]} ${sha1sums[5]})
	_F_scm_type="subversion"
	_F_scm_url="svn://svn.mplayerhq.hu/mplayer/trunk"
	Finclude scm
fi

# To add v4l support.
# mknod -m 660 /dev/video0 c 81 0

subpkgs=('mencoder')
subdescs=('The Movie Encoder')
subrodepends=("${depends[*]}")
subdepends=('libpng')
subgroups=('xmultimedia')
subarchs=('i686 x86_64')
suboptions=('force')

build()
{
	if Fuse $USE_DEVEL; then
		Funpack_scm
		git clone --depth 1 git://git.videolan.org/ffmpeg.git ffmpeg || Fdie
	else
		Fcd $_F_archive_name-$pkgver
	fi
	unset CFLAGS
	Fpatchall
	Fmake --confdir=/etc/mplayer --disable-gui --language=all \
		--enable-runtime-cpudetection --enable-liblzo \
		--enable-mga --enable-xmga --enable-tdfxfb
	unset MAKEFLAGS
	make DESTDIR=$Fdestdir install || Fdie
	Fmkdir /usr/share/doc/$pkgname-$pkgver
	mv DOCS/* $Fdestdir/usr/share/doc/$pkgname-$pkgver/

	# Fonts.
	Frm /usr/share/mplayer/font
	for i in cp1250 iso-8859-1 iso-8859-2 iso-8859-7
	do
		mv $Fsrcdir/font-arial-$i/font-arial-{14,18,24,28}-$i \
			$Fdestdir/usr/share/mplayer/
	done

	# Install mplayer.conf
	echo stop-xscreensaver=1 >> etc/example.conf
	Ffilerel etc/example.conf /etc/mplayer/mplayer.conf

	# Install default ttf font
	Fln /usr/share/fonts/X11/TTF/DejaVuSans.ttf /usr/share/mplayer/subfont.ttf

	Fsplit mencoder usr/bin/mencoder usr/share/man/man1/mencoder.1
	cd $Fdestdir
	for i in usr/share/man/*/man1/mencoder.1
	do
		[ ! -f "$i" ] && continue
		Fsplit mencoder $i
	done
}

# optimization OK
