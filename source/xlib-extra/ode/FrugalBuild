# Compiling Time: 0.11 SBU
# Maintainer: crazy <crazy@frugalware.org>

pkgname=ode
pkgver=0.5
pkgrel=1
pkgdesc="ODE is an open source, high performance library for simulating rigid body dynamics."
url="http://ode.org/"
depends=('mesa')
groups=('xlib-extra')
options=('nodocs')
archs=('i686' 'x86_64')
up2date="lynx -dump http://sourceforge.net/project/showfiles.php?group_id=24884| grep -m1 '.tgz'|sed 's/.*-\(.*\).tgz .*/\1/'"
source=(http://heanet.dl.sourceforge.net/sourceforge/opende/$pkgname-$pkgver.tgz \
	$pkgname-$pkgver-PIC.patch \
	$pkgname-$pkgver-x86_64_casting_problem.patch)
sha1sums=('f13756f1192d24101b6d1a3c14feb43efbf0b281' \
	  '9afb214904cde3ac1c89754579dff73e7017621e' \
	  '49c10b58b5892736098066100db5b7fbd5979382')

build()
{
	## let us start this weird build :p
	Fcd
	Fsed 'C_FLAGS+=-fomit-frame-pointer -ffast-math' '' \
		config/makefile.unix-gcc
	Fsed 'C_FLAGS=-c -Wall .*' 'C_FLAGS=-c -Wall $(CFLAGS)' \
		config/makefile.unix-gcc
	Fmkdir /usr/lib
	Fmkdir /usr/include
	Fmkdir /usr/share/doc/$pkgname-$pkgver
	patch -p1 -i $Fsrcdir/$pkgname-$pkgver-PIC.patch
	[ "$CARCH" == "x86_64" ] && patch -p1 -i $Fsrcdir/$pkgname-$pkgver-x86_64_casting_problem.patch
	make configure || return 1
	make ode-lib || return 1
	make drawstuff-lib || return 1
	make ode-test || return 1
	make drawstuff-test || return 1
        ## all done ? no no not yet   'make install = mv | cp' for this app  :) 
	mv lib/* $Fdestdir/usr/lib
	mv include/ode $Fdestdir/usr/include/
	mv ode/doc/* $Fdestdir/usr/share/doc/$pkgname-$pkgver/
	## now done ? I hope :)
}

# optimization OK
