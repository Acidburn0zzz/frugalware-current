# Compiling Time: 0.09 SBU
# Maintainer: VMiklos <vmiklos@frugalware.org>

pkgname=swt
pkgver=3.3
date=200706251500
pkgrel=1
pkgdesc="GTK based SWT Library"
url="http://www.eclipse.org/"
depends=('j2re' 'gtk+2' 'atk' 'libxtst' 'libstdc++' 'freetype2' 'pango' 'cairo')
makedepends=('j2sdk' 'apache-ant')
groups=('xlib-extra')
archs=('i686' 'x86_64')
up2date="lynx -dump http://download.eclipse.org/eclipse/downloads/|grep Release|sed -n 's/.*]\([0-9\.]*\) .*/\1/;1 p'"
source=(http://download.eclipse.org/eclipse/downloads/drops/R-$pkgver-$date/swt-$pkgver-gtk-linux-x86.zip \
	build.xml)
sha1sums=('020983352a606ad24738cdaf47360b897efbc856'\
          '3d5befea18ba4c5bc20da80ed067488a16be6585')

build()
{
	# for now build using Sun's javac
	export JAVA_HOME=/usr/lib/java
	if [ "$CARCH" == "i686" ]; then
		export AWT_LIB_PATH=$JAVA_HOME/jre/lib/i386
	elif [ "$CARCH" == "x86_64" ]; then
		export AWT_LIB_PATH=$JAVA_HOME/jre/lib/amd64
	fi
	rm -rf *so *jar about* version*
	mkdir build
	cd build
	Fextract ../src.zip
	cp $Fsrcdir/build.xml ./
	mkdir src
	mv org src
	Fsed '^CFLAGS = .*' 'CFLAGS += \\' make_linux.mak
	for i in awt swt atk glx
	do
		make -f make_linux.mak make_$i || return 1
	done
	ant compile || return 1
	cp version.txt build/version.txt
	cp src/org/eclipse/swt/internal/SWTMessages.properties build/org/eclipse/swt/internal/
	ant jar || return 1
	Ffilerel /usr/share/java/swt.jar
	Fexerel *.so /usr/lib/
	Fdocrel about.html about_files
}

# optimization OK
