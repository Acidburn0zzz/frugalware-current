# Compiling Time: 0.42 SBU
# Maintainer: crazy <crazy@frugalware.org>

pkgname=qscintilla2-python-qt3
ver1=1.73
ver2=2.1
pkgver=${ver1}_${ver2}
origname=QScintilla
pkgrel=3
pkgdesc="QScintilla2 python bindings for QT3"
url="http://www.riverbankcomputing.co.uk/qscintilla"
license="GPL 2"
up2date="lynx -dump $url/download.php|grep -v "gpl-1.7"|grep -m1 'gpl-\(.*\).tar.gz'|sed 's/.*la-//;s/-gpl\(.*\).t.*/\1/;s/-/_/'"
source=(http://www.riverbankcomputing.com/Downloads/${origname}2/$origname-$ver1-gpl-$ver2.tar.gz designer.patch)
groups=('xlib-extra')
archs=('i686' 'x86_64')
depends=("qscintilla2-qt3>=$pkgver-4" 'python' 'libxext' 'libgcc' 'zlib' 'libxrender' \
	'fontconfig' 'libxcb' 'libxxf86vm' 'libxdamage' 'libdrm' 'libxt' 'pyqt')
makedepends=("qscintilla2-qt4>=$pkgver-4" 'pyqt4>=4.3.1-2')
_F_cd_path="$origname-$ver1-gpl-$ver2"
sha1sums=('ca9ac61cc3d537d7b53202ff5d8565365c3f8734'\
          '3fa781182d6a4868f134dc7931d37b346c946245')

subpkgs=('qscintilla2-python-qt4' 'qscintilla2-designer-qt3-plugin' 'qscintilla2-designer-qt4-plugin')
subdescs=('QScintilla2 python bindings for QT4' 'QScintilla2 designer plugin for QT3' 'QScintilla2 designer plugin for QT4')
subdepends=("qscintilla2-qt4>=$pkgver-4 pyqt4>=4.3.1-2" "qscintilla2-qt3>=$pkgver-4" "qscintilla2-qt4>=$pkgver-4")
subgroups=('xlib-extra' 'xlib-extra' 'xlib-extra')
subarchs=('i686 x86_64' 'i686 x86_64' 'i686 x86_64')

build()
{
	Fpatchall
	cp -r Python Python4 || Fdie
	## QT4
	Q3="$QTDIR"
	unset QTDIR
	export QTDIR=/usr
	cd designer-Qt4 || Fdie
        /usr/bin/qmake designer.pro || Fdie
        Fmakeinstall INSTALL_ROOT=$Fdestdir || Fdie
	Fsplit qscintilla2-designer-qt4-plugin /usr
	cd ../Python4 || Fdie
	python configure.py -c -j 8 -p 4 -n /usr/include -o /usr/lib || Fdie
	Fmake
	Fmakeinstall
	Fsplit qscintilla2-python-qt4 /usr
	## QT3
	export QTDIR="$Q3"
	cd ../designer-Qt3 || Fdie
	/usr/lib/qt/bin/qmake designer.pro || Fdie
	make INSTALL_ROOT=$Fdestdir || Fdie
	Fsplit qscintilla2-designer-qt3-plugin /usr
 	cd ../Python || Fdie
	python configure.py -c -j 8 -p 3 -n /usr/lib/qt/include -o /usr/lib/qt/lib || Fdie
	Fmake
	Fmakeinstall
}

# optimization OK
