
# HG changeset patch
# User Tomasz Wasilczyk <twasilczyk@pidgin.im>
# Date 1385395397 -3600
# Node ID ec15aa187aa0d51faea8d13f38220ddd35c6251a
# Parent  2a77da513a0358eff14c6d517489bfd44b0e4551
Gadu-Gadu: fix a possible HTTP Content-Length integer overflow (VRT-2013-1001)

diff --git a/libpurple/protocols/gg/lib/http.c b/libpurple/protocols/gg/lib/http.c
--- a/libpurple/protocols/gg/lib/http.c
+++ b/libpurple/protocols/gg/lib/http.c
@@ -47,6 +47,8 @@
 #include <string.h>
 #include <unistd.h>
 
+#define GG_HTTP_MAX_LENGTH 1000000000
+
 /**
  * Rozpoczyna połączenie HTTP.
  *
@@ -364,6 +366,11 @@
 				h->body_size = left;
 			}
 
+			if (h->body_size > GG_HTTP_MAX_LENGTH) {
+				gg_debug(GG_DEBUG_MISC, "=> http, content-length too big\n");
+				h->body_size = GG_HTTP_MAX_LENGTH;
+			}
+
 			if (left > h->body_size) {
 				gg_debug(GG_DEBUG_MISC, "=> http, oversized reply (%d bytes needed, %d bytes left)\n", h->body_size, left);
 				h->body_size = left;

