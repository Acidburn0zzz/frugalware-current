
# HG changeset patch
# User Daniel Atallah <datallah@pidgin.im>
# Date 1363457151 14400
# Node ID 932b985540e9f32dd852daab76f06d8f7ef91ccd
# Parent  4d139ce8f7ec484e8be9fe1ada0e021000ff00a7
CID 732047 Negative array index write

diff --git a/libpurple/stun.c b/libpurple/stun.c
--- a/libpurple/stun.c
+++ b/libpurple/stun.c
@@ -175,7 +175,7 @@
 	struct sockaddr_in *sinptr;
 
 	len = recv(source, buffer, sizeof(buffer) - 1, 0);
-	if (!len) {
+	if (len < 0) {
 		purple_debug_warning("stun", "unable to read stun response\n");
 		return;
 	}

