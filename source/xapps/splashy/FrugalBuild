# Compiling Time: 0.01 SBU
# Maintainer: Miklos Vajna <vmiklos@frugalware.org>

pkgname=splashy
pkgver=0.3.13
themever=1.4
# see http://alioth.debian.org/project/showfiles.php?group_id=30657
rel_id=2691
pkgrel=11
pkgdesc="A complete user-space boot splash system"
url="http://alioth.debian.org/projects/splashy/"
depends=('glib2' 'directfb-input-keyboard>=1.2.0-1' 'libgcc' 'file')
backup=(etc/splashy/config.xml)
groups=('xapps')
archs=('i686' 'x86_64' 'ppc')
up2date="lynx -dump $url |grep ' splashy ' |sed 's/.*splashy \([0-9.]\+\) .*/\1/'"
source=(http://alioth.debian.org/download.php/$rel_id/splashy-$pkgver.tar.gz \
	splashy-0.3.0-frugalware.diff \
	rc.{zz-,}splash rc.splash-{de,hu,it}.po \
	http://ftp.frugalware.org/pub/other/artwork/splashy-theme/splashy-frugalware-$themever.tar.xz \
	systemd-theme.diff splashy-{halt,kexec,poweroff,quit,reboot,start}.service systemd-splashy)
sha1sums=('c98b6c113155b70de21cda1d23f4ee9320c92153' \
          'fe5c5f6a6085512669fe0a4f9051e4a4ab884fb4' \
          '006d65bb621d1108cbb994fb50712bad4d61b6d0' \
          '77347cea97d5861064c48ecc675c97da24367193' \
          '82c272166e89ecc840169fa76cc3fb45e2236712' \
          'd86d3554aa64b129352e826d1e659a5a4611b47d' \
          'c9da7e70efb6070e61ba2e6908a712ac524ae90b' \
          '25b87e1a16cce20dde0d2c665c20820473676252' \
          'e1055a9018ed70b34c508f31ec46704c3d8134e9' \
          'ca21f18d9aa20a7d1b9f72338301920a85c0a990' \
          'a7ce082e5100abb73884508de94ad9f9d3aee9f2' \
          '0073a24a9d269d6283a1ed732a00032721f106fa' \
          'f2070b7d19e4e11cf3d8127ee60843df92f73d61' \
          'e6da5b4518cff4ecb2ae2d1a080c338f3027b7a6' \
          'f6e18f76f2a2ef42c2adc54d7b639614bd2b3b09' \
          '384d1858bbbc99d155bf0607d714e8c0cd7f91f9')

replaces=('plymouth-utility' 'plymouth-gdm' 'plymouth-theme-spinfinity' 'plymouth-theme-solar' 'plymouth-theme-glow' 'plymouth')

build()
{
	unset MAKEFLAGS
	Fsed '-Werror' '' configure.ac
	autoconf || return 1
	rm -rf themes/frugalware
	mv ../frugalware themes/
	Fpatchall
	Fautoreconf
	Fmake --enable-static
	Fmakeinstall
	Frm /etc/init.d
	Frcd2 splash
	Fexe /etc/rc.d/rc.zz-splash
	Fsed '${prefix}' $Fprefix $Fdestdir/etc/splashy/config.xml

	# systemd
	Ffile /lib/systemd/systemd-splashy
	Fmkdir /lib/systemd/system/{halt,kexec,poweroff,multi-user,reboot,sysinit}.target.wants
	Ffile /lib/systemd/system/splashy-halt.service
	Fln ../splashy-halt.service /lib/systemd/system/halt.target.wants/
	Ffile /lib/systemd/system/splashy-kexec.service
	Fln ../splashy-kexec.service /lib/systemd/system/kexec.target.wants/
	Ffile /lib/systemd/system/splashy-poweroff.service
	Fln ../splashy-poweroff.service /lib/systemd/system/poweroff.target.wants/
	Ffile /lib/systemd/system/splashy-quit.service
	Fln ../splashy-quit.service /lib/systemd/system/multi-user.target.wants/
	Ffile /lib/systemd/system/splashy-reboot.service
	Fln ../splashy-reboot.service /lib/systemd/system/reboot.target.wants/
	Ffile /lib/systemd/system/splashy-start.service
	Fln ../splashy-start.service /lib/systemd/system/sysinit.target.wants/
	# don't run old sysv init script with different name when using systemd
	Fln splashy-start.service /lib/systemd/system/splash.service
	Fln splashy-quit.service /lib/systemd/system/zz-splash.service
}

# optimization OK

