# Compiling Time: 0.50 SBU
# Maintainer: Miklos Vajna <vmiklos@frugalware.org>

_F_archive_name=vim
pkgname=gvim
pkgver=7.4
pkgrel=5
pkgdesc="VIM - GTK+2 GUI"
url="http://www.vim.org"
depends=('gpm>=1.20.5-2' 'gtk+2>=2.20.0-2' 'libxpm' 'libsm' 'libice' 'libxt')
rodepends=('vim')
makedepends+=('python>=2.7.4-1' 'x11-protos')
groups=('xapps')
options=('scriptlet')
archs=('i686' 'x86_64')
backup=(usr/share/vim/vimrc)
up2date="lynx -dump $url/sources.php|grep bz2$|sed 's/.*-\(.*\)\.t.*/\1/;q'"
source=(ftp://ftp.vim.org/pub/vim/unix/$_F_archive_name-$pkgver.tar.bz2 gvim.xpm)
sha1sums=('601abf7cc2b5ab186f40d8790e542f86afca86b7' \
          'f7262c7429c42b7c1ef9cf1eaa6aa12292933525')

_F_desktop_filename='gvim.desktop'
_F_desktop_name='gvim'
_F_desktop_desc='VIM - GTK+2 GUI'
_F_desktop_icon='gvim.xpm'
_F_desktop_exec='gvim'
_F_desktop_categories='Utility;TextEditor;GTK;'

build()
{
	Fcd vim${pkgver/.}
	Fpatchall
	cd src

	# Remove these 2 lines if the linking script is ever fixed.
	# It loops infinitely for me.
	Fexec sed -i '2 i $LINK -Wl,--as-needed' link.sh
	Fexec sed -i '3 i exit $?'           link.sh

	Fmake \
		--prefix=/usr \
		--with-x \
		--enable-gui=gtk2 \
		--enable-multibyte \
		--enable-pythoninterp \
		--with-features=big
	Fexec make DESTDIR=$Fdestdir VIMRTDIR= installvimbin || Fdie

	Fmv /usr/bin/vim /usr/bin/gvim
	Fln /usr/bin/gvim /usr/bin/gview
	Ficon ../gvim.xpm
	Fdesktop2
}
# optimization ok
