# Last modified: Thu, 22 Sep 2005 00:03:54 +0200
# Compiling time: ~51 minutes
# Maintainer: Laszlo Dvornik <dvornik@gnome.hu>
# Contributor: VMiklos <vmiklos@frugalware.org>

pkgname=firefox
pkgver=1.0.7
pkgrel=2
pkgdesc="Mozilla Firefox web browser"
url="http://www.mozilla.org/products/firefox/"
depends=('gtk+2' 'libidl' 'desktop-file-utils')
makedepends=('libgnome' 'zip')
groups=('xapps')
archs=('i686' 'x86_64')
up2date="wget -O - -q ftp://ftp.mozilla.org/pub/mozilla.org/firefox/releases/|grep '>[0-9\.]*/'|sed -n 's|.*>\([0-9\.]*\)/.*|\1|;$ p'"
source=(http://ftp.mozilla.org/pub/mozilla.org/$pkgname/releases/$pkgver/source/$pkgname-$pkgver-source.tar.bz2 \
	# Disable the default application checks.
	01-$pkgname-PR1-default-applications.patch0 \
	# Force use of GTK+2 for Flash player to get better performance.
	02-$pkgname-1.0-gtk+2-flash.patch \
	03-$pkgname-1.0-browsername.patch \
	# Support newer FreeType2.
	04-$pkgname-0.7.3-freetype-compile.patch0 \
	# Autodetect language.
	05-$pkgname-1.0-lang-detection.patch \
	# Download to ~/Desktop, not ~.
	06-$pkgname-1.0-download-to-desktop.patch0 \
	# Some versions of the mime stuff will add whitespace to the end or
	# beginning of the command. Fix this.
	07-$pkgname-PR1-gnome-vfs-default-app.patch \
	08-$pkgname-PR1-stack-direction.patch0 \
	# GTK+2 file chooser fixes.
	09-$pkgname-PR1-gtk+2-file-chooser-more-fixes.patch0 \
	# Don't use --libs since that can do evil things like add
	# -Wl,--export-dynamic
	10-$pkgname-PR1-pkgconfig.patch0 \
	11-$pkgname-1.0-useragent.patch0 \
	12-$pkgname-1.0.6-gcc4.patch \
	browserconfig.properties \
	config \
	ffremote \
	$pkgname.desktop \
	$pkgname.install \
	$pkgname-rebuild-databases.pl \
	generate-chrome.sh)
sha1sums=('ac7549f609db8dbea6db33b2ffb3ae546eea64df' \
          '98dafe42c0878fb935f1109cdc1577abbc1a39d9' \
          '6c14c3d1a557d6ff844fbd27e28a0a043bd5c74f' \
          '5b2c26ee9a94800d87e406c96c77a56171308c27' \
          '9aa67c9947db4550f75464eaf87b8802dd441b8b' \
          '5e4febf530621b440d8d5cb869ff155a5794e1f8' \
          '56abf21ff0a1ef81aa70d17d8539a951891a559e' \
          '7ad741a14a454e2f4ffa4255f18ccc431ad3c87d' \
          'b9c7582622c5a382f053ff6de9c9de1a1bccb2cc' \
          '656fda6fe9e8237adb095fecc1fd701bf053d13c' \
          '14baa5fc68d5745bb178aae05e45f53592ee8e6f' \
          '7815b65d67a725d30ea8d7124429c5bc462a2ab1' \
          '035334857928da20d70c8dbac7f667348f4080dd' \
          'd8f92384f6360873043ea42ab56a682dfd9b32c7' \
          '7628ca9d6cf05735ca0a2a13ae1838ff770be1ec' \
          'a797c04d67d343d068c108b804883a7815f3197b' \
          '5b0724fce7e15b0ba076842884dc90683318cd9a' \
          '2bd9b168a6a683724d29fa63026dcae74f85b3f4' \
          'b234fe25e989d8b0acb52fa370949da1a988da2b' \
          '410e5cf862d8aac631a826ac6e8fa62fe0e916f6')

[ "$CARCH" == "x86_64" ] && \
        source=(${source[@]} 13-$pkgname-1.0.6-amd64_gcc4.patch0 14-firefox-gcc4-crash-fix.patch) && \
	md5sums=(${md5sums[@]} 'ce36d171c6912b4d78a8a3706d216ed7' '200812579d5dcbdc88dcbbc2bb6b400e')
		

build() {
	Fcd mozilla
	sed "s/-march=i686 -O2 -pipe/$CFLAGS/" $startdir/src/config > .mozconfig
	export MOZ_PHOENIX=1
	Fpatchall || return 1

	make -f client.mk build || return 1
	make || return 1

	Fmkdir /usr
	Fmakeinstall

	# Compatibility.
	Fln $pkgname-$pkgver /usr/include/$pkgname
	Fln $pkgname-$pkgver /usr/lib/$pkgname
	Fln $pkgname-$pkgver /usr/share/idl/$pkgname

	# Plugins.
	Fmv /usr/lib/$pkgname/plugins /usr/lib/$pkgname/plugins.orig
	Fln ../mozilla/plugins/ /usr/lib/$pkgname/plugins

	# /usr/share/aclocal/nspr.m4 conflicts with mozilla.
	Frm /usr/share/aclocal

	# Install ffremote.
	Fexe /usr/bin/ffremote

	# Install firefox-rebuild-databases.pl.
	sed "s/VERSION/$pkgver/" $startdir/src/$pkgname-rebuild-databases.pl > \
		$startdir/pkg/usr/lib/$pkgname-$pkgver/$pkgname-rebuild-databases.pl
	chmod 755 $Fdestdir/usr/lib/$pkgname-$pkgver/$pkgname-rebuild-databases.pl

	# Install generate-chrome.sh.
	Fexe /usr/lib/$pkgname-$pkgver/chrome/rc.d/generate-chrome.sh

	# http://frugalware.org/ is the default homepage.
	Ffile /usr/lib/$pkgname-$pkgver/browserconfig.properties

	# Install icon for the menu file.
	Ffilerel $Fdestdir/usr/lib/$pkgname-$pkgver/icons/default.xpm /usr/share/pixmaps/$pkgname.xpm

	# Install menu file.
	Ffile /usr/share/applications/$pkgname.desktop

	# Change the default icons
	cp $Fdestdir/usr/lib/$pkgname-$pkgver/icons/* $Fdestdir/usr/lib/$pkgname-$pkgver/chrome/icons/default/
}

# vim: ft=sh

# optimalization OK
