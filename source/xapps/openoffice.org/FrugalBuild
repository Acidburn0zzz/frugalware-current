# Last modified: Fri, 11 Nov 2005 02:19:11 +0100
# Compiling time: 92.07 SBU
# Maintainer: [x86_64] Christian Hamar alias krix <krics@linuxforum.hu>
# Maintainer: [i686] Janos Kovacs alias janny <janny@frugalware.org>
# Contributor: VMiklos <vmiklos@frugalware.org>

pkgname=openoffice.org
pkgver=2.0.0.1
pkgrel=1
pkgdesc="OpenOffice.org, a full office productivity suite (Version 2)"
url="http://ooo.ximian.com/"
depends=('db>=4.3' 'perl' 'gtk+2' 'gnome-vfs' 'libxml2' 'libart_lgpl' 'libsndfile' \
	'startup-notification' 'fontconfig' 'libpng' 'imagemagick' 'flex' 'firefox' 'neon>=0.24.0' \
	'bison' 'zip' 'unzip' 'expat' 'cups' 'desktop-file-utils' 'perl-archive-zip' 'unixodbc')
makedepends=('findutils' 'curl' 'intltool' 'tcsh' 'gcc' 'pam-headers' 'qt' \
	'kdelibs' 'evolution-data-server' 'boost' 'icu' 'hunspell' 'hunspell-dict' 'pam-headers')
groups=('xapps-extra')
archs=('i686')
install=$pkgname.install
up2date="lynx -dump 'http://ooo.ximian.com/packages/OOO680/?C=M;O=D'|grep tar.gz$|sed -n 's/.*-\(.*\)\.t.*/\1/;1 p'"
source=(http://ooo.ximian.com/packages/OOO680/ooo-build-$pkgver.tar.gz \
	http://go-ooo.org/packages/OOO680/OOO_2_0_0-core.tar.bz2 \
	http://go-ooo.org/packages/OOO680/OOO_2_0_0-system.tar.bz2 \
	http://go-ooo.org/packages/OOO680/OOO_2_0_0-lang.tar.bz2 \
	http://go-ooo.org/packages/SRC680/ooo_crystal_images-6.tar.bz2 \
	http://go-ooo.org/packages/SRC680/ooo_custom_images-13.tar.bz2 \
	http://go-ooo.org/packages/SRC680/extras-2.tar.bz2 \
	ooo-allpatch.diff \
	ooo.applications \
	ooo.keys)

NOEXTRACT=1

sha1sums=('4e2fae82c341af80605e0013ef32c7e6fa750b82' \
	  'a4cc244164deb831356f609fa967f8d14df6116a' \
	  'e1fcccc53ac719ed5189a556547dbf3236ab6405' \
	  '7b2a1943da8cd5a3c39b5d883345c2d65c578d10' \
	  '99ee34dcba96e27296daf159ab2f48c6c2f0364a' \
	  '215cbf28c87a391e15ba9580e8201389ea8b92e4' \
	  '2c7fca93c106e23961f4aaa7cdfcaeb97064eed1' \
	  '5b8ea65b23df1ddd08ef70479f6afe555ea4539b' \
	  '64085b7787739d2e7eb20f4f0358fc213937b0e8' \
	  'e31a1b937707007b90731e809ab8947429d645be')

# nobuild=1

build() {
	# Untar the ooo-build stuff
	tar -xvzf ooo-build-$pkgver.tar.gz || return 1
#	bunzip2 Filter.xcu.bz2 || return 1

	# Note: Requires a running X server for building.
	# Move downloaded tarballs to the correct location. With this
	# ooo-build won't download the tarballs again.
	mv OOO_2_0_0-core.tar.bz2 ooo-build-$pkgver/src || return 1
	mv OOO_2_0_0-system.tar.bz2 ooo-build-$pkgver/src || return 1
	mv OOO_2_0_0-lang.tar.bz2 ooo-build-$pkgver/src || return 1
	mv ooo_crystal_images-6.tar.bz2 ooo-build-$pkgver/src || return 1
	mv ooo_custom_images-13.tar.bz2 ooo-build-$pkgver/src || return 1
	mv extras-2.tar.bz2 ooo-build-$pkgver/src || return 1

	Fcd ooo-build-$pkgver || return 1
	Fpatch ooo-allpatch.diff
	
	# Defined $CARCH config
	if [ "$CARCH" == "x86_64" ]; then
		Fconfopts="$Fconfopts --with-distro=Frugalware64"
	else
		Fconfopts="$Fconfopts --with-distro=Frugalware"
	fi
	Fconf --with-lang=ALL

	./download || return 1

	make || return 1

	make DESTDIR=$Fdestdir install || return 1

	# Install some miscellaneous files into GNOME's prefix.
	Ffile /usr/share/application-registry/ooo.applications
	Ffile /usr/share/mime-info/ooo.keys
	
	# Create i18n tarballs.
	mkdir $startdir/openoffice.org-i18n || return 1
	cd $Fdestdir/usr/lib/ooo-2.0/program/resource || return 1
	for lang in `ls *.res|sed 's/.*680\(.*\)\.res/\1/'|sort|uniq`
	do
		if [ "$lang" != "en-US" ]; then
			tar cvjf openoffice.org-i18n-$lang-$pkgver.tar.bz2 \
				`ls *680$lang.res`
			mv openoffice.org-i18n-$lang-$pkgver.tar.bz2 \
				$startdir/openoffice.org-i18n/
			rm *680$lang.res
		fi
	done
}

# optimalization OK

# vim: ft=sh
