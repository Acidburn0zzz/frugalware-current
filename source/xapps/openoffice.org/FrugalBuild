# Last modified: Sat, 17 Dec 2005 11:48:31 +0100
# Compiling time: 92.07 SBU
# Maintainer: Janos Kovacs alias janny <janny@frugalware.org>
# (x86_64 Maintainer: Christian Hamar alias krix <krics@linuxforum.hu>)
# Contributor: VMiklos <vmiklos@frugalware.org>

# Do *not* upload a new binary package without the explicit permission from the maintainer!

pkgname=openoffice.org
pkgver=2.0.0.2
pkgrel=1
pkgdesc="OpenOffice.org, a full office productivity suite (Version 2)"
url="http://ooo.ximian.com/"
depends=('db>=4.3' 'perl' 'gtk+2' 'gnome-vfs' 'libxml2' 'libart_lgpl' 'libsndfile' \
	'startup-notification' 'fontconfig' 'libpng' 'imagemagick' 'flex' 'firefox' 'neon>=0.24.0' \
	'bison' 'zip' 'unzip' 'expat' 'cups' 'desktop-file-utils' 'perl-archive-zip' 'unixodbc')
makedepends=('findutils' 'curl' 'intltool' 'tcsh' 'gcc' 'pam-headers' 'qt' \
	'kdelibs' 'evolution-data-server' 'boost' 'icu' 'hunspell' 'hunspell-dict' 'pam-headers')
groups=('xapps')
archs=('i686')
install=$pkgname.install
up2date="lynx -dump 'http://ooo.ximian.com/packages/OOO680/?C=M;O=D'|grep tar.gz$|sed -n 's/.*-\(.*\)\.t.*/\1/;1 p'"
source=(http://ooo.ximian.com/packages/OOO680/ooo-build-$pkgver.tar.gz \
	http://go-ooo.org/packages/OOO680/OOO_2_0_0-core.tar.bz2 \
	http://go-ooo.org/packages/OOO680/OOO_2_0_0-system.tar.bz2 \
	http://go-ooo.org/packages/OOO680/OOO_2_0_0-lang.tar.bz2 \
	http://go-ooo.org/packages/SRC680/ooo_crystal_images-6.tar.bz2 \
	http://go-ooo.org/packages/SRC680/ooo_custom_images-13.tar.bz2 \
	http://go-ooo.org/packages/SRC680/extras-2.tar.bz2 \
	http://go-ooo.org/packages/SRC680/cairo-1.0.2.tar.gz \
	http://go-ooo.org/packages/SRC680/glitz-0.4.3.tar.gz \
	http://go-ooo.org/packages/SRC680/mdbtools-0.6pre1.tar.gz \
	http://go-ooo.org/packages/libwpd/libwpd-0.8.3.tar.gz \
	http://go-ooo.org/packages/SRC680/cli_types.dll \		 # only with offline build
	http://go-ooo.org/packages/SRC680/cli_types_bridgetest.dll \	 # only with offline build
	ooo.applications \
	ooo.keys \
	ooo-allpatch.diff)

NOEXTRACT=1

sha1sums=('59d1afe6b5e255f9f4725e9ae53869bc28d47649' \
	  'a4cc244164deb831356f609fa967f8d14df6116a' \
	  'e1fcccc53ac719ed5189a556547dbf3236ab6405' \
	  '7b2a1943da8cd5a3c39b5d883345c2d65c578d10' \
	  '99ee34dcba96e27296daf159ab2f48c6c2f0364a' \
	  '215cbf28c87a391e15ba9580e8201389ea8b92e4' \
	  '2c7fca93c106e23961f4aaa7cdfcaeb97064eed1' \
	  '3a425049499b0b067ed4dc60d94b4d0819c0841b' \
	  '6761c863b251660f0f329402a2d64f0db592f088' \
	  '37a50d623a444ec690d2677b12b59c2f11e497c0' \
	  '397b33bf77a6bfbab71ca3de7e42bc99ab80fdd6' \
	  'b91baf5d09c7dcb9702c824af04f91f048f46bf1' \
	  'f36c332cbe3a60e562ae42265fe0736d8102fea7' \
	  'fdb8d5b9869e6363fe92d24cd4427f9e8e1cbcc2' \
	  'e31a1b937707007b90731e809ab8947429d645be' \
	  'ac3cd728f6b45e36eb2b3bda3974cb0fba8fffd3')

build() {
	# Untar the ooo-build stuff
	tar -xvzf ooo-build-$pkgver.tar.gz || return 1

	# Move downloaded tarballs to the correct location. With this
	# ooo-build won't download the tarballs again.
	mv OOO_2_0_0-core.tar.bz2 ooo-build-$pkgver/src || return 1
	mv OOO_2_0_0-system.tar.bz2 ooo-build-$pkgver/src || return 1
	mv OOO_2_0_0-lang.tar.bz2 ooo-build-$pkgver/src || return 1
	mv ooo_crystal_images-6.tar.bz2 ooo-build-$pkgver/src || return 1
	mv ooo_custom_images-13.tar.bz2 ooo-build-$pkgver/src || return 1
	mv extras-2.tar.bz2 ooo-build-$pkgver/src || return 1
	mv cairo-1.0.2.tar.gz ooo-build-$pkgver/src || return 1
	mv glitz-0.4.3.tar.gz ooo-build-$pkgver/src || return 1
	mv mdbtools-0.6pre1.tar.gz ooo-build-$pkgver/src || return 1
	mv libwpd-0.8.3.tar.gz ooo-build-$pkgver/src || return 1
	mv cli_types.dll ooo-build-$pkgver/src || return 1
	mv cli_types_bridgetest.dll ooo-build-$pkgver/src || return 1

	Fcd ooo-build-$pkgver
	Fpatch ooo-allpatch.diff
	
	# Defined $CARCH config
	if [ "$CARCH" == "x86_64" ]; then
		Fconfopts="$Fconfopts --with-distro=Frugalware64"
	else
		Fconfopts="$Fconfopts --with-distro=Frugalware"
	fi
	Fconf --with-lang=ALL --without-binsuffix

	./download || return 1

	make || return 1

	make DESTDIR=$Fdestdir install || return 1

	# Install some miscellaneous files into GNOME's prefix.
	Ffile /usr/share/application-registry/ooo.applications
	Ffile /usr/share/mime-info/ooo.keys
	
	# Create i18n tarballs.
	mkdir $startdir/openoffice.org-i18n
	cd $Fdestdir/usr/lib/ooo-2.0/program/resource
	for lang in `ls *.res|sed 's/.*680\(.*\)\.res/\1/'|sort|uniq`
	do
		if [ "$lang" != "en-US" ]; then
			tar cvjf openoffice.org-i18n-$lang-$pkgver.tar.bz2 \
				`ls *680$lang.res`
			mv openoffice.org-i18n-$lang-$pkgver.tar.bz2 \
				$startdir/openoffice.org-i18n/
			rm *680$lang.res
		fi
	done
}
# optimalization OK

# vim: ft=sh
