# Last modified: Sun, 19 Mar 2006 03:28:45 +0100
# Compiling time: 92.07 SBU
# Maintainer: Janny <janny@frugalware.org>
# Contributor: Laszlo Dvornik <dvornik@gnome.hu>

# Do *not* upload a new binary package without the explicit permission from the maintainer!

pkgname=openoffice.org
pkgver=2.0.2
ooover=`echo $pkgver|sed 's/\./_/g'`
OOBVER=OOB680
pkgrel=1
pkgdesc="OpenOffice.org, a full office productivity suite (Version 2)"
url="http://ooo.ximian.com/"
depends=('perl' 'gtk+2' 'gnome-vfs' 'libxml2' 'libart_lgpl' 'libsndfile' \
	'startup-notification' 'fontconfig' 'libpng' 'imagemagick' 'flex' 'neon>=0.24.0' \
	'bison' 'zip' 'unzip' 'expat' 'cups' 'desktop-file-utils' 'perl-archive-zip' 'unixodbc' 'libxaw')
makedepends=('curl' 'intltool' 'tcsh' 'pam-headers' 'firefox' \
	'kdelibs' 'evolution-data-server' 'boost' 'icu' 'hunspell' 'imake' 'gccmakedep')
groups=('xapps')
archs=('i686')
up2date="lynx -dump 'http://ooo.ximian.com/packages/OOB680/?C=M;O=A'|Flasttar"
source=(http://ooo.ximian.com/packages/$OOBVER/ooo-build-$pkgver.tar.gz \
	http://go-ooo.org/packages/$OOBVER/OOO_$ooover-core.tar.bz2 \
	http://go-ooo.org/packages/$OOBVER/OOO_$ooover-system.tar.bz2 \
	http://go-ooo.org/packages/$OOBVER/OOO_$ooover-lang.tar.bz2 \
	http://go-ooo.org/packages/SRC680/ooo_crystal_images-1.tar.gz \
	http://go-ooo.org/packages/SRC680/ooo_custom_images-13.tar.bz2 \
	http://go-ooo.org/packages/SRC680/extras-2.tar.bz2 \
	http://go-ooo.org/packages/SRC680/cairo-1.0.2.tar.gz \
	http://go-ooo.org/packages/SRC680/glitz-0.4.3.tar.gz \
	http://go-ooo.org/packages/SRC680/mdbtools-0.6pre1.tar.gz \
	http://go-ooo.org/packages/libwpd/libwpd-0.8.3.tar.gz \
	http://go-ooo.org/packages/SRC680/cli_types.dll \
	http://go-ooo.org/packages/SRC680/cli_types_bridgetest.dll \
	http://go-ooo.org/packages/xt/xt-20051206-src-only.zip \
	ooo.applications \
	ooo.keys \
	$pkgname-$pkgver-frugalware.diff)

sha1sums=('b116cb340102be72e2962d2bb00ad9901f54193b' \
	  'ed87feb8f160bb86d1922b73af6d4b409079798a' \
	  'c209592051095792dc8e8fe8db1f6ef4551db9e4' \
	  '802bdefe7de2667efed48693791ccd59bebfe0f8' \
	  '60c412c7d6e2f1247fadbe26ccf1e3e1f1ca87b8' \
	  '215cbf28c87a391e15ba9580e8201389ea8b92e4' \
	  '2c7fca93c106e23961f4aaa7cdfcaeb97064eed1' \
	  '3a425049499b0b067ed4dc60d94b4d0819c0841b' \
	  '6761c863b251660f0f329402a2d64f0db592f088' \
	  '37a50d623a444ec690d2677b12b59c2f11e497c0' \
	  '397b33bf77a6bfbab71ca3de7e42bc99ab80fdd6' \
	  'b91baf5d09c7dcb9702c824af04f91f048f46bf1' \
	  'f36c332cbe3a60e562ae42265fe0736d8102fea7' \
	  'edaba936383f5e1d6d245b4c826c6207825a8297' \
	  'fdb8d5b9869e6363fe92d24cd4427f9e8e1cbcc2' \
	  'e31a1b937707007b90731e809ab8947429d645be' \
	  'd7e346ec8627e4ad015bf0fd1dfe4369df063f59')

NOEXTRACT=1

# . FrugalBuild
# tar xOjf $pkgname-$pkgver-$pkgrel-`uname -m`.fpm .FILELIST
# echo -n "ooosubpkgs=("; for i in `tar xOjf $pkgname-$pkgver-$pkgrel-$(uname -m).fpm .FILELIST \
# 	|grep share/registry/res/.*/org |sed 's|.*res/\([^/]*\)/org.*|\1|'|sort -u`; do echo -n " '$i'"; done; echo ")"

ooosubpkgs=('af' 'ar' 'be-BY' 'bg' 'bn' 'bn-BD' 'bn-IN' 'br' 'bs' 'ca' 'cy' 'cs' 'da' 'de' 'el' 'en-GB' 'en-ZA' 'eo' 'es' 'et' 'eu' 'fi' 'fr' 'ga' 'gl' 'gu-IN' 'he' 'hi-IN' 'hr' 'hu' 'it' 'ja' 'km' 'kn-IN' 'ko' 'lo' 'lt' 'lv' 'mk' 'ms' 'nb' 'ne' 'nl' 'nn' 'nr' 'ns' 'pa-IN' 'pl' 'pt' 'pt-BR' 'ru' 'rw' 'sh-YU' 'sk' 'sl' 'sr-CS' 'ss' 'st' 'sv' 'sw' 'sw-TZ' 'sx' 'ta-IN' 'th' 'tn' 'tr' 'ts' 've' 'vi' 'xh' 'zh-CN' 'zh-TW' 'zu' 'fa')

# for i in "${ooosubpkgs[@]}"
# do
# desc=`lynx -source -dump http://l10n.openoffice.org/languages.html |grep -4 "\">$i</"|sed 's|.*">\([^0-9]\+\)</F.*|\1|;q'`
# echo -n " '$desc'"
# done
# echo

ooosubdescs=('Afrikaans' 'Arabic' 'Belarusian' 'Bulgarian' 'Bengali' 'Bengali (Bangladesh)' 'Bengali (India)' 'Breton' 'Bosnian' 'Catalan' 'Welsh' 'Czech' 'Danish' 'German' 'Greek' 'English (GB)' 'English (South Africa)' 'Esperanto' 'Spanish' 'Estonian' 'Basque' 'Finnish' 'French' 'Irish' 'Galician' 'Gujarati' 'Hebrew' 'Hindi' 'Croatian' 'Hungarian' 'Italian' 'Japanese' 'Khmer (Cambodia)' 'Kannada' 'Korean' 'Lao' 'Lithuanian' 'Latvian' 'Macedonian' 'Malay' 'Norwegian Bokmal' 'Nepali' 'Dutch' 'Norwegian Nynorsk' 'Ndebele, South' 'NorthernSotho/Sepedi' 'Punjabi' 'Polish' 'Portuguese' 'Brazil (Port.)' 'Russian' 'Kinyarwanda' 'Serbian Latin' 'Slovak' 'Slovenian' 'Serbian Cyrillic' 'Swati' 'Sotho' 'Swedish' 'Swahili' 'Swahili ' 'South Georgian' 'Tamil' 'Thai' 'Tswana' 'Turkish' 'Tsonga' 'Venda' 'Vietnamese' 'Xhosa' 'Chinese (simplified)' 'Chinese (traditional)' 'Zulu' 'Persian')

if [ ${#ooosubpkgs[@]} -ne ${#ooosubdescs[@]} ]; then
	error '${#ooosubpkgs[@]} != ${#ooosubdescs[@]}'
	Fdie
fi

i=0
while [ $i -lt ${#ooosubpkgs[@]} ]
do
	subpkgs=("${subpkgs[@]}" "openoffice.org-i18n-${ooosubpkgs[$i]}")
	subdescs=("${subdescs[@]}" "${ooosubdescs[$i]} Localization for OpenOffice.org.")
	i=$(($i+1))
done

i=0
while [ $i -lt ${#ooosubpkgs[@]} ]
do
	subdepends=("${subdepends[@]}" "openoffice.org>=$pkgver")
	subgroups=("${subgroups[@]}" "locale-extra")
	i=$(($i+1))
done

build() {
	unset MAKEFLAGS
	# Untar the ooo-build stuff
	tar -xvzf ooo-build-$pkgver.tar.gz || return 1

	# Move downloaded tarballs to the correct location. With this
	# ooo-build won't download the tarballs again.
	mv OOO_$ooover-core.tar.bz2 ooo-build-$pkgver/src || return 1
	mv OOO_$ooover-system.tar.bz2 ooo-build-$pkgver/src || return 1
	mv OOO_$ooover-lang.tar.bz2 ooo-build-$pkgver/src || return 1
	mv ooo_crystal_images-1.tar.gz ooo-build-$pkgver/src || return 1
	mv ooo_custom_images-13.tar.bz2 ooo-build-$pkgver/src || return 1
	mv extras-2.tar.bz2 ooo-build-$pkgver/src || return 1
	mv cairo-1.0.2.tar.gz ooo-build-$pkgver/src || return 1
	mv glitz-0.4.3.tar.gz ooo-build-$pkgver/src || return 1
	mv mdbtools-0.6pre1.tar.gz ooo-build-$pkgver/src || return 1
	mv libwpd-0.8.3.tar.gz ooo-build-$pkgver/src || return 1
	mv cli_types.dll ooo-build-$pkgver/src || return 1
	mv cli_types_bridgetest.dll ooo-build-$pkgver/src || return 1
	mv xt-20051206-src-only.zip ooo-build-$pkgver/src || return 1

	Fcd ooo-build-$pkgver
	Fpatchall
	
	# Defined $CARCH config
	if [ "$CARCH" == "x86_64" ]; then
		Fconfopts="$Fconfopts --with-distro=Frugalware64"
	else
		Fconfopts="$Fconfopts --with-distro=Frugalware"
	fi
	Fconf --with-lang=ALL --without-binsuffix

	./download || return 1

	make || return 1

	make DESTDIR=$Fdestdir install || return 1

	# Install some miscellaneous files into GNOME's prefix.
	Ffile /usr/share/application-registry/ooo.applications
	Ffile /usr/share/mime-info/ooo.keys

	# Split out the i18n stuff
	for i in "${ooosubpkgs[@]}"
	do
		Fsplit openoffice.org-i18n-$i usr/lib/ooo-2.0/share/registry/res/$i/
		Fsplit openoffice.org-i18n-$i usr/lib/ooo-2.0/share/template/$i/
		Fsplit openoffice.org-i18n-$i usr/lib/ooo-2.0/program/resource/*680$i.res
	done
}
# optimalization OK
