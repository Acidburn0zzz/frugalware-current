# Compiling Time: 0.64 SBU
# Maintainer: Christian Hamar alias krix <krics@linuxforum.hu>

pkgname=mjpegtools
pkgver=1.8.0
pkgrel=2
pkgdesc="The mjpeg programs are a set of tools that can do recording of videos and playback, simple cut-and-paste editing and the MPEG compression of audio and video under Linux."
_F_sourceforge_dirname="mjpeg"
Finclude sourceforge
url="http://mjpeg.sourceforge.net/"
depends=('libjpeg' 'libpng' 'sdl_gfx' 'libquicktime' 'libxxf86dga')
groups=('xapps')
options=('scriptlet')
archs=('i686' 'x86_64')
up2date="lynx -dump 'http://prdownloads.sourceforge.net/mjpeg/?sort_by=date&sort=desc'|grep mjpegtools-[0-9\.]*.tar.gz|sed -n 's/.*-\(.*\).t.*/\1/;1 p'"
source=($source http://ftp.frugalware.org/pub/other/sources/mjpegtools/mjpegtools.patch no-archflags.patch)
sha1sums=('e11d68298a64b52f98724dbf3fd14f168e140290' \
          '14abe0ec5f5578503fc166f18c30069402b55c5e' \
          '7ae8bdb1669b05042f5c2065550c24c0705e0734')

if [ "$CARCH" == "x86_64" ]; then
	confopts="--with-pic"
fi

build() {
	Fcd
	Fpatchall
	./autogen.sh || Fdie
	if [ "$CARCH" == "x86_64" ]; then
		export CFLAGS="$CFLAGS -fPIC"
	fi
	Fconf --with-dv-yv12 --enable-largefile $confopts
	for i in `find . -name Makefile`
        do
                Fsed "-O3" "" $i
        done
	make || return 1
	Fmakeinstall
}

# optimization OK
