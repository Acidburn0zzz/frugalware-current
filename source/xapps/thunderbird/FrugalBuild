# Compiling time: 7.93 SBU
# Maintainer: crazy <crazy@frugalware.org>
# Contributor: Krisztian VASAS <iron@frugalware.org>

pkgname=thunderbird
pkgver=3.1.9
pkgrel=2
pkgdesc="Mozilla Thunderbird mail and newsgroup client"
url="http://www.mozilla.org/products/thunderbird/"
depends=('alsa-lib' 'curl' 'cairo>=1.8.10-2' 'dbus-glib' 'gtk+2>=2.20.0-2' 'libpng>=1.4.1' 'nss>=3.12.7' \
	'nspr>=4.8.7' 'pango>=1.28.0-2' 'wireless_tools' 'libstdc++' 'libxt>=1.0.5' 'libidl' 'sqlite3>=3.6.23.1' 'libnotify')
makedepends=('zip')
groups=('xapps')
archs=('i686' 'x86_64' 'ppc')
options=('scriptlet')
up2date="Flastarchive http://releases.mozilla.org/pub/mozilla.org/thunderbird/releases/latest/source '\.source\.tar\.bz2'"
source=(http://releases.mozilla.org/pub/mozilla.org/$pkgname/releases/$pkgver/source/$pkgname-$pkgver.source.tar.bz2 \
	$pkgname.desktop \
	thunderbird-locale.patch \
	thunderbird-shared-error.patch \
	libpng14.patch)
signatures=("${source[0]}.asc" '' '' '' '')

build()
{
	unset MAKEFLAGS
	Fcd comm-1.9.*

	## and again > -Os broken weird .. use -O2 here *again*
	export CFLAGS="${CFLAGS[@]/-Os/-O2}"
	export CXXFLAGS="${CXXFLAGS[@]/-Os/-O2}"

	export MOZILLA_OFFICIAL=1
	export BUILD_OFFICIAL=1

	# Let jars get compressed.
	Fsed '\-0' '\-9' mozilla/config/make-jars.pl

	Fpatchall

	 ## ac_cv_visibility_pragma=no Fmake \
		Fmake \
		--disable-accessibility \
		--disable-activex \
		--disable-activex-scripting \
		--disable-calendar \
		--disable-debug \
		--disable-dtd-debug \
		--disable-installer \
		--disable-libxul \
		--disable-javaxpcom \
		--disable-jsd \
		--disable-logging \
		--disable-optimize \
		--disable-pedantic \
		--disable-profilesharing \
		--disable-static \
		--disable-tests \
		--disable-toolkit-gtk \
		--disable-toolkit-qt \
		--disable-toolkit-xlib \
		--disable-xinerama \
		--disable-xprint \
		--enable-application=mail \
		--enable-canvas \
		--enable-crypto \
		--enable-default-toolkit=cairo-gtk2 \
		--enable-image-decoders=all \
		--enable-image-encoders=all \
		--enable-ipv6 \
		--enable-necko-protocols=all \
		--enable-pango \
		--enable-reorder \
		--enable-svg \
		--enable-system-cairo \
		--enable-system-sqlite \
		--enable-xft \
		--enable-xsl \
		--with-distribution-id=Frugalware \
		--with-pthreads \
		--with-system-bz2 \
		--with-system-jpeg \
		--with-system-mng \
		--with-system-nspr \
		--with-system-nss \
		--with-system-png \
		--with-system-zlib


	# Does not use Fmakeinstall here because DESDIR is not found in root Makefile
	Fexec make DESTDIR="$Fdestdir" install || Fdie

	# Get rid of versions in path names and files.
	Fmv /usr/lib/$pkgname-$pkgver /usr/lib/$pkgname
	Fln $pkgname /usr/lib/$pkgname-$pkgver
	Fsed "$pkgname-$pkgver" "$pkgname" $Fdestdir/usr/lib/$pkgname/$pkgname

	# Fixing symlinks
	Frm /usr/bin/$pkgname
	Fln /usr/lib/$pkgname/$pkgname /usr/bin/$pkgname

	# Install icon for the menu file.
	Finstallrel 0644 ./other-licenses/branding/thunderbird/mailicon256.png \
		/usr/share/pixmaps/$pkgname.png

	# Install menu file.
	Ffile /usr/share/applications/$pkgname.desktop
}

# optimization OK
