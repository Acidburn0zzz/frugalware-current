# Last modified: Sat, 30 Jul 2005 13:29:05 +0200
# Compiling time: ~33 minutes
# Maintainer: IroNiQ <iron@ironiq.hu>
# Modified by Laszlo Dvornik <dvornik@gnome.hu>

pkgname=thunderbird
pkgver=1.0.7
pkgrel=1
pkgdesc="Mozilla Thunderbird mail and newsgroup client"
url="http://www.mozilla.org/products/thunderbird/"
depends=('gtk+2' 'libidl')
makedepends=('zip')
groups=('xapps')
archs=('i686' 'x86_64')
install=$pkgname.install
up2date="lynx -dump 'http://ftp.mozilla.org/pub/mozilla.org/thunderbird/releases/?C=M;O=A' | grep releases/ | sed -n 's|.*s/\(.*\)/$|\1|; $ p'"
#up2date="wget -O - -q ftp://ftp.mozilla.org/pub/mozilla.org/thunderbird/releases/|grep '>[0-9\.]*/'|sed -n 's|.*>\([0-9\.]*\)/.*|\1|;$ p'"
source=(http://ftp.mozilla.org/pub/mozilla.org/$pkgname/releases/$pkgver/source/$pkgname-$pkgver-source.tar.bz2 \
	00-$pkgname-0.8-progname.patch \
	01-$pkgname-check-default-mailer.patch \
	02-$pkgname-locale.patch \
	03-$pkgname-myspell.patch \
	04-$pkgname-1.0-quiet-extensions.patch \
	05-$pkgname-1.0-fix-extension-manager.patch \
	06-$pkgname-0.7.3-freetype-compile.patch0 \
	07-$pkgname-0.7.3-gnome-uriloader.patch \
	08-firefox-1.0-prdtoa.patch0 \
	09-$pkgname-0.8-default-applications.patch \
	10-firefox-PR1-gnome-vfs-default-app.patch \
	11-$pkgname-0.8.0-stack-direction.patch0 \
	12-firefox-PR1-gtk-file-chooser-more-fixes.patch0 \
	13-$pkgname-0.8.0-pkgconfig.patch0 \
	14-$pkgname-1.0-useragent.patch0 \
	15-$pkgname-1.0.2-destdir-fix.patch \
	16-$pkgname-1.0.6-gcc4.patch \
	mozilla-$pkgname.desktop \
	$pkgname.desktop
	$pkgname-frugalware-default-prefs.js \
	$pkgname.install \
	$pkgname.png \
	$pkgname-rebuild-databases.pl.in \
	$pkgname.sh.in)

sha1sums=('a51640d4d15611374d08dbe6cbf87b1072c66c29' \
	  '1c3e66758975db0879f71d6bb1f029ac17a82363' \
	  'e6e902bbeff38239aa66598adf6c3fc940801d2e' \
	  '1224ac1a7460dca57e02b1bac1df99732b1bb7d0' \
	  '8bae623022ace1b5b882398af899bc71ecedb1ab' \
	  '9d081aabb52baf781d1a055efe7d6a2f5448274d' \
	  '933722417a01cc45fc9ad3c7b93ee4c67b4a33a3' \
	  '9aa67c9947db4550f75464eaf87b8802dd441b8b' \
	  '1c35f6e08a4fe2ab50b21259b27b7e0d411da553' \
	  '188229b9f72e5b791a5acce00c59c7dd5c756331' \
	  '58f29c90e38c3a4bfe486791a2b463ae571fe0da' \
	  '7ad741a14a454e2f4ffa4255f18ccc431ad3c87d' \
	  'b9c7582622c5a382f053ff6de9c9de1a1bccb2cc' \
	  '656fda6fe9e8237adb095fecc1fd701bf053d13c' \
	  '14baa5fc68d5745bb178aae05e45f53592ee8e6f' \
	  '975ac2b3ef0c92d212d8e18107e9336c0b39e920' \
	  '9e6c6fa5102b73c2c51ee0c37c0eedad42e8d81b' \
	  '035334857928da20d70c8dbac7f667348f4080dd' \
	  '88870eb3d0ed0110e4e2901ec4c51586226fb626' \
	  '4989ab706d6b8457ed1b59912aeeec06fcc59cac' \
	  '5e2278a200779038f6319bce4c8143f02f7ef2dc' \
	  'f7903470874b6e43ca12cb14837b929b9acbaad0' \
	  'a6bdab1f905c6897c0db145d5e0dc2abbad784d4' \
	  'bd40526b29b8c1b484808159aafd25f9cfc1c6cc' \
	  '9d70fbcadfdff4d1825c8b8f49a3614c3d68f145')

#md5sums=('a0ddcc8bd5ee2c9be724b6963ad27111' \
#	'b8820072bd97d501b980f432730ab30c' \
#	'8421a59ba73b8c872d0dc0736687383d' \
#	'3fa0eb0b2142942571677ee439114f8d' \
#	'a72bc6693d742b52d0f595211e99159b' \
#	'e26956632643894acd8927586889aae5' \
#	'885c18150df5998d9dfdab5c8a2c6d07' \
#	'd53fccb9616e19ac0302cf6c65b19d00' \
#	'c8efa922e35563165090a7c563d00d3d' \
#	'5effa3338ee98e4c2ff4aec5c2035a85' \
#	'2b80e997bac34ff90af7b64d3f66c144' \
#	'1a719de92d68be02ba18f7cb59e2ec46' \
#	'5b28e0fe4f229230cc0fea5afcaae413' \
#	'54d3aaec464df6aeaf5db8ca45429517' \
#	'ddeb23a4941dd256d6a13a6075392ce4' \
#	'311f6320beb546b9cd39ac899aee7f22' \
#	'96baf4dbedc993370f79502903a30a20' \
#	'a3ab6ae2213780c0e20c5b9aa8f018e9' \
#	'538a2638a8a647fff70ef5dbf164995d' \
#	'922bff4cd6301583f43aab75f5f5d597' \
#	'e6586c6f54cb29d62802dcc327102846' \
#	'40a2550201f75f351a7bdd4cba9b1d72' \
#	'22e9921d9d89e8e9ec4a849dd6be7d68' \
#	'1d063924b9c473d655a78cbb845ab330' \
#	'65f982e2a07a64fbfc053b48070a2817')
#
[ "$CARCH" == "x86_64" ] && \
	source=(${source[@]} 17-$pkgname-1.0.6-amd64_gcc4.patch0) && \
	sha1sums=(${sha1sums[@]} 'ce4dcca293b1858d548198068339e1587b217d8d')
#	md5sums=(${md5sums[@]} 'ce36d171c6912b4d78a8a3706d216ed7')

build()
{
	Fcd mozilla
	export MOZ_THUNDERBIRD="1"
	Fpatchall

	# Let jars get compressed.
	Fsed '\-0' '\-9' config/make-jars.pl

	# For better reading...
	Fmake --with-system-jpeg \
	--with-system-zlib \
	--with-system-png \
	--with-system-mng \
	--disable-calendar \
	--enable-xft \
	--disable-pedantic \
	--disable-svg \
	--enable-mathml \
	--enable-xsl \
	--enable-crypto \
	--disable-xinerama \
	--disable-xprint \
	--with-pthreads \
	--with-default-mozilla-five-home=/usr/lib/thunderbird-$pkgver \
	--disable-jsd \
	--disable-accessibility \
	--disable-profilesharing \
	--disable-necko-disk-cache \
	--disable-activex-scripting \
	--disable-installer \
	--disable-activex \
	--disable-debug \
	--disable-tests \
	--disable-strip \
	--disable-dtd-debug \
	--disable-logging \
	--enable-reorder \
	--enable-strip-libs \
	--enable-xterm-updates \
	--disable-toolkit-qt \
	--disable-toolkit-xlib \
	--enable-extensions=wallet,spellcheck,xmlextras,webservices \
	--enable-necko-protocols=http,file,jar,viewsource,res,data \
	--enable-image-decoders=png,gif,jpeg,bmp \
	--enable-toolkit-gtk2 \
	--enable-default-toolkit=gtk2 \
	--disable-toolkit-gtk \
	--enable-ipv6 \
	--enable-freetype2 \
	--enable-single-profile \
	--disable-official-branding

	Fmakeinstall

	Fmkdir /usr/lib/$pkgname-$pkgver/chrome/lang
	Fcp /usr/lib/$pkgname-$pkgver/chrome/installed-chrome.txt \
		/usr/lib/$pkgname-$pkgver/chrome/lang/installed-chrome.txt

	# Install RSS feed support.
	Ffilerel mail/extensions/newsblog/rss.rdf \
		/usr/lib/$pkgname-$pkgver/defaults/isp/rss.rdf

	# Compatibility.
	Fln $pkgname-$pkgver /usr/include/$pkgname
	Fln $pkgname-$pkgver /usr/lib/$pkgname
	Fln $pkgname-$pkgver /usr/share/idl/$pkgname

	Fmkdir /usr/include/$pkgname-$pkgver/nss
	cp -Lf dist/private/nss/*.h dist/public/nss/*.h \
		$Fdestdir/usr/include/$pkgname-$pkgver/nss
	chown -R root:root $Fdestdir/usr/include/$pkgname-$pkgver/nss

	# Install thunderbird-rebuild-databases.pl
	sed "s/VERSION/$pkgver/" $Fsrcdir/$pkgname-rebuild-databases.pl.in > \
		$Fdestdir/usr/lib/$pkgname-$pkgver/$pkgname-rebuild-databases.pl
	chmod 755 $Fdestdir/usr/lib/$pkgname-$pkgver/$pkgname-rebuild-databases.pl

	# Install thunderbird.sh.
	Fmv /usr/bin/$pkgname /usr/lib/$pkgname-$pkgver/
	sed "s/VERSION/$pkgver/" $Fsrcdir/$pkgname.sh.in > \
		$Fdestdir/usr/bin/$pkgname
	chmod 755 $Fdestdir/usr/bin/$pkgname

	# Install thunderbird-frugalware-default-prefs.js.
	sed "s/FW_VR/$pkgver-$pkgrel/" $Fsrcdir/$pkgname-frugalware-default-prefs.js > \
		$Fdestdir/usr/lib/$pkgname-$pkgver/greprefs/all-frugalware.js
	Fcp /usr/lib/$pkgname-$pkgver/greprefs/all-frugalware.js \
		/usr/lib/$pkgname-$pkgver/defaults/pref/all-frugalware.js

	# Install icon for the menu file.
	Ffile /usr/share/pixmaps/$pkgname.png

	# Install GNOME menu file.
	Ffile /usr/share/applications/$pkgname.desktop

	# Install KDE menu file.
	Ffile /usr/share/applnk/Internet/mozilla-$pkgname.desktop

	Fmv /usr/bin/defaults/profile/prefs.js \
		/usr/lib/thunderbird-$pkgver/defaults/profile
	Frm /usr/bin/defaults
}

# vim: ft=sh

# optimalization OK
