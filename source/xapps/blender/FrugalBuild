# Last Modified: Sun, 12 Feb 2006 03:47:17 +0100
# Compiling Time: 2.81 SBU
# Maintainer: Zsolt Szalai <xbit@frugalware.org>

pkgname=blender
pkgver=2.41
pkgextraver=
pkgrel=1
pkgdesc="A 3D modeling/rendering/animation/gaming application"
url="http://blender3d.org"
depends=('sdl' 'freetype2' 'gettext' 'libjpeg' 'libpng' 'mesa' 'libtiff' \
	 'openal')
groups=('xapps')
archs=('i686' 'x86_64')
makedepends=('scons' 'ftgl')
up2date="lynx -dump 'http://download.blender.org/source/?C=M;O=D;5~'|grep tar.gz$|sed -ne 's/.*r-\(.*\)\.tar.gz/\1/' -e s/$pkgextraver// -e '1 p'"
source=("http://download.blender.org/source/$pkgname-$pkgver$pkgextraver.tar.gz" 'blender.diff' 'blender.desktop' 'blender.png' \
	'blender64.diff')
sha1sums=('839dfece3b6efbf10694ac535d88e3745c3253ec' \
	  '2e881480ac0949cb3d3d12b277893f8cbde25ee2' \
	  '44ee67a0ed814481aacca0dfc8cf45ae7a48eed5' \
	  '5d2583d847735c913c26c96ace8192a646323da8' \
	  '31b131b783325e819e2da722c48d1823fc62ca2d')

build() {
	Fcd $pkgname
	[ "$CARCH" == "x86_64" ] && Fpatch blender64.diff
	[ "$CARCH" != "x86_64" ] && Fpatch blender.diff
	scons || Fdie
	install -d ./release/plugins/include || Fdie
	install -m 644 source/blender/blenpluginapi/*.h ./release/plugins/include || Fdie
	chmod +x ./release/plugins/bmake || Fdie
	make -C ./release/plugins || Fdie

	Fmkdir /usr/bin/
	install -m 755 blender ../../pkg/usr/bin/blender || Fdie
	install -m 755 blenderplayer ../../pkg/usr/bin/blenderplayer || Fdie

	install -d ../../pkg/usr/lib/blender/plugins/sequence || Fdie
	install -d ../../pkg/usr/lib/blender/plugins/texture || Fdie
	install -m 644 ./release/plugins/sequence/*.so ../../pkg/usr/lib/blender/plugins/sequence || Fdie
	install -m 644 ./release/plugins/texture/*.so ../../pkg/usr/lib/blender/plugins/texture || Fdie

#	cp -a ./release/bpydata ../../pkg/usr/lib/blender || Fdie
	cp -a ./release/scripts ../../pkg/usr/lib/blender || Fdie
	cp -a ./bin/.blender/locale ../../pkg/usr/lib/blender || Fdie
	install -m 644 ./release/VERSION ../../pkg/usr/lib/blender || Fdie
	install -m 644 ./bin/.blender/.Blanguages ../../pkg/usr/lib/blender || Fdie
	install -m 644 ./bin/.blender/.bfont.ttf ../../pkg/usr/lib/blender || Fdie
	Ffile /usr/share/pixmaps/blender.png
	Ffile /usr/share/applications/blender.desktop
}
