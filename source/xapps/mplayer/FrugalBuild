# Last Modified: Fri, 29 Jul 2005 17:33:37 +0200
# Compiling Time: ~16 minutes
# Maintainer: VMiklos <mamajom@axelero.hu>

pkgname=mplayer
pkgver=1.0pre7
pkgextraver=
pkgrel=5
pkgdesc="The Movie Player"
depends=('esd' 'lame' 'libtheora' 'libdv' 'cdparanoia' 'termcap' 'libmad' \
	 'libungif' 'xvidcore' 'aalib' 'lzo' 'sdl' 'ffmpeg' 'libjpeg')
[ "$CARCH" == "i686" ] && depends=(${depends[@]} 'codecs')
groups=('xapps')
archs=('i686' 'x86_64')
up2date="lynx -dump http://www.mplayerhq.hu/homepage/design7/dload.html|grep 'MPlayer v'|sed -n \"s/.*MPlayer v\(.*\) source.*/\1/;s/$pkgextraver//;1 p\""
source=(http://www.mplayerhq.hu/MPlayer/releases/MPlayer-$pkgver$pkgextraver.tar.bz2 \
	http://www.mplayerhq.hu/MPlayer/Skin/Blue-1.4.tar.bz2 \
	http://www.mplayerhq.hu/MPlayer/releases/fonts/{font-arial-cp1250.tar.bz2,font-arial-iso-8859-1.tar.bz2,font-arial-iso-8859-2.tar.bz2,font-arial-iso-8859-7.tar.bz2} \
	$pkgname-$pkgver-gcc4.patch $pkgname-$pkgver-gcc4-amd64.patch.gz mplayer-1.0pre7-lzo2.patch.bz2)
md5sums=('5fadd6957d3aab989cd760ff38fb8fdf' '05dd8e4f11a715c9e5d2abf1cdeb907c'\
         'd0afd83cd04c29a714a62b427aace5c5' '1ecd31d17b51f16332b1fcc7da36b312'\
         '7b47904a925cf58ea546ca15f3df160c' '956a9d9ea51970e057f0deb7b2e25889'\
         '3d94fd5886df3b60fe2606c4dee9d1dd' 'b4572e6e04df4e155b33d8db132de63e'\
         '21e99979297d1e96c8edc8b437cfc33f')

# to add v4l support
# mknod -m 660 /dev/video0 c 81 0

build()
{
	Fcd MPlayer-$pkgver$pkgextraver
	[ "$CARCH" != "x86_64" ] && Fpatch $pkgname-$pkgver-gcc4.patch
	[ "$CARCH" == "x86_64" ] && Fpatch $pkgname-$pkgver-gcc4-amd64.patch
	Fpatch mplayer-1.0pre7-lzo2.patch
	Fmake --enable-gui --language=all --enable-runtime-cpudetection --enable-liblzo \
		--disable-arts --disable-smb || return 1
	make DESTDIR=$Fdestdir install
	Fmkdir /usr/share/doc/$pkgname-$pkgver
	mv DOCS/* $Fdestdir/usr/share/doc/$pkgname-$pkgver/
	
	# skin
	Fmkdir /usr/share/mplayer/Skin
	mv $Fsrcdir/Blue $Fdestdir/usr/share/mplayer/Skin/default
	chown -R root.root $Fdestdir/usr/share/mplayer/Skin
	
	# fonts
	Frm /usr/share/mplayer/font
	for i in cp1250 iso-8859-1 iso-8859-2 iso-8859-7
	do
		mv $Fsrcdir/font-arial-$i/font-arial-{14,18,24,28}-$i \
			$Fdestdir/usr/share/mplayer/
	done
	
}

# vim: ft=sh

# optimalization OK
