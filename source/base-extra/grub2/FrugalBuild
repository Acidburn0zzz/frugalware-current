# Compiling time: 0.29 SBU
# Maintainer: Michel Hermier <hermier@frugalware.org>

USE_DEVEL=${USE_DEVEL:-"n"}

pkgname=grub2
_F_archive_name=grub
pkgver=1.99
pkgrel=1
pkgdesc="The GNU GRand Unified Bootloader"
url="http://www.gnu.org/software/grub/"
conflicts=('grub')
depends=('lzo')
[ "$CARCH" == "i686" ] && depends=(${depends[@]} 'freetype2' 'mktemp' 'ncurses')
[ "$CARCH" == "x86_64" ] && makedepends=(${makedepends[@]} 'freetype2' 'ncurses' 'mktemp')
#rodepends=('grub-theme-frugalware')
groups=('base-extra')
archs=('i686' 'x86_64')
options=('nobuild')

if ! Fuse DEVEL; then
	up2date="Flasttar ftp://ftp.gnu.org/gnu/grub/"
	source=("ftp://ftp.gnu.org/gnu/grub/$_F_archive_name-$pkgver$pkgextraver.tar.xz")
	signatures=("${source[@]}.sig")
else
	pkgver="$pkgver.bzr3092"
	_F_scm_type="bzr"
	_F_scm_url="http://bzr.savannah.gnu.org/r/grub/trunk/grub/"
	Finclude scm

	makedepends=("${makedepends[@]}" 'autogen')
fi

build()
{
	if Fuse DEVEL; then
		Funpack_scm
		./autogen.sh || Fdie
	fi
	# see http://savannah.gnu.org/bugs/?func=detailitem&item_id=14874
	CFLAGS=${CFLAGS/O?/O2}
	# note that this should NOT build on a real x86_64 box
	[ "$CARCH" == "x86_64" ] && CFLAGS="$CFLAGS -static"

	# netboot
	Fbuild --libdir=/lib --datadir=/usr/lib/grub --exec-prefix=/
}

# optimization OK

