# Compiling Time: 0.20 SBU
# Maintainer: Elentir <elentir@frugalware.org>

pkgname=u-boot
pkgver=2010.12
pkgrel=1
pkgdesc="A boot loader for embedded systems"
archs=('arm')
depends=()
url="http://www.denx.de/wiki/U-Boot"
groups=('base-extra')
source=(ftp://ftp.denx.de/pub/$pkgname/$pkgname-$pkgver.tar.bz2)
up2date="Flasttar http://ftp.denx.de/pub/u-boot/"
sha1sums=('ba848b6762b79c25d61b8b4641944ec0ada56507')
export LDFLAGS=""

subpkgs=('u-boot-tools')
subdescs=('Tools for Das U-Boot')
subdepends=('')
subgroups=('apps-extra')
subarchs=('arm')

build() {
  Fcd
  PLATFORMS="dockstar"
  for i in $PLATFORMS; do
    make $i || Fdie
    Fmkdir usr/lib/u-boot/$i
    Finstall 644 $_F_cd_path/u-boot* $Fdestdir/usr/lib/u-boot/$i/
  done
  make CONFIG_CMD_LOADS=y tools-all || Fdie

  Fmkdir usr/bin
  Finstall 755 $pkgname-$pkgver/tools/mkimage usr/bin/
  Finstall 755 $pkgname-$pkgver/tools/{bmp_logo,gen_eth_addr,img2srec,env/fw_printenv,easylogo/easylogo} usr/bin/
  Fmkdir etc/
  Finstall 644 $pkgname-$pkgver/tools/env/fw_env.config etc/

  Fsplit u-boot-tools usr/bin/
  Fsplit u-boot-tools etc/
}
