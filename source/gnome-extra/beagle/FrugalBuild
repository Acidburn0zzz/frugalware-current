# Compiling time: 1.24 SBU
# Maintainer: AlexExtreme <alex@alex-smith.me.uk>

pkgname=beagle
pkgver=0.2.17
pkgrel=1
pkgdesc="Search tool that ransacks your personal information space"
url="http://beagle-project.org"
depends=('gecko-sharp' 'gmime>=2.2.3-1' 'libexif' 'sqlite3' 'libxscrnsaver' 'perl-xml' \
	'wv' 'gnome-sharp' 'gsf-sharp' 'galago-sharp')
makedepends=('intltool' 'pygtk' 'zip' 'unzip' 'evolution-sharp' 'python>=2.5' 'thunderbird' 'scrnsaverproto')
backup=('etc/beagle/crawl-applications' 'etc/beagle/crawl-documentation' 'etc/beagle/crawl-windows')
groups=('gnome-extra')
archs=('i686' 'x86_64')
Finclude gnome mono python
sha1sums=('d761bd185bcd1bd9c0652ee3f08ff2a8ec5cb7d8')

subpkgs=("$pkgname-evolution" "lib$pkgname" "$pkgname-gui" "$pkgname-thunderbird" "$pkgname-mozilla")
subdescs=('Beagle evolution bindings.' 'Beagle client library.' 'Desktop Search Application.' 'Beagle backend for thunderbird' 'Beagle extension for Mozilla')
subdepends=("$pkgname=$pkgver evolution-sharp" 'libxml2 glib2 glibc python>=2.5' "$pkgname=$pkgver" "$pkgname=$pkgver thunderbird" "$pkgname=$pkgver")
subgroups=('gnome-extra' 'lib-extra' 'gnome-extra' 'gnome-extra' 'gnome-extra')
suboptions=('scriptlet' 'scriptlet' 'scriptlet' 'scriptlet' 'scriptlet')
subarchs=('i686 x86_64' 'i686 x86_64' 'i686 x86_64' 'i686 x86_64' 'i686 x86_64')

build()
{
	Fmonoexport
	
	Fbuild --enable-inotify --disable-schemas-install --enable-python --enable-thunderbird
	
	# OnlyShowIn values so we don't get the Gnome GUI's showing in KDE
	echo 'OnlyShowIn=GNOME;' >> $Fdestdir/usr/share/applications/beagle-search.desktop
	echo 'OnlyShowIn=GNOME;' >> $Fdestdir/usr/share/applications/beagle-settings.desktop
	
	# Move autostart files to the correct location
	Fmv /etc/xdg /usr/share/gnome
	
	# This is for the system-wide indexing
	Fmkdir /var/cache/beagle
	
	# "Install" the Mozilla extension
	Fmkdir /usr/share/doc/$pkgname-$pkgver/mozilla-extension
	cp mozilla-extension/beagle.xpi $Fdestdir/usr/share/doc/$pkgname-$pkgver/mozilla-extension/ || Fdie
	cp mozilla-extension/README $Fdestdir/usr/share/doc/$pkgname-$pkgver/mozilla-extension/ || Fdie
	
	# Split out the packages
	Fsplit $pkgname-evolution usr/lib/beagle/Backends/EvolutionBackends.*
	Fsplit $pkgname-thunderbird usr/lib/beagle/Backends/ThunderbirdBackends.*
	Fsplit lib$pkgname usr/include/libbeagle
	Fsplit lib$pkgname usr/lib/libbeagle.*
	Fsplit lib$pkgname $_F_python_libdir
	Fsplit lib$pkgname usr/lib/pkgconfig/libbeagle-*
	Fsplit $pkgname-gui usr/bin/beagle-{imlogviewer,search,settings}
	Fsplit $pkgname-gui usr/lib/beagle/{Images.dll*,UiUtil.dll*,ImLogViewer.exe*,Search.exe*,Settings.exe*,libbeagleuiglue*}
	Fsplit $pkgname-gui usr/share/applications/*.desktop
	Fsplit $pkgname-gui usr/share/pixmaps/
	Fsplit $pkgname-gui usr/share/gnome/autostart/beagle-search-autostart.desktop
	Fsplit $pkgname-mozilla usr/share/doc/$pkgname-$pkgver/mozilla-extension
	
	Fmonocleanup
}

# optimization OK
