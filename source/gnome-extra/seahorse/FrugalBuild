# Compiling Time: 0.36 SBU
# Maintainer: Priyank Gosalia <priyankmg@gmail.com>

pkgname=seahorse
pkgver=1.0.1
pkgrel=3
pkgdesc="A GNOME application for managing PGP keys."
url="http://www.seahorse.sourceforge.net/"
depends=('gtksourceview' 'gnupg' 'gpgme' 'libsoup' 'dbus' \
	'dbus-glib' 'libsoup' 'libxml2' 'libnotify' \
	'openssh' 'gconf' 'avahi')
makedepends=('gettext' 'openldap' 'intltool' 'pkgconfig' 'gnome-doc-utils' \
	'nautilus>=2.18.3' 'gedit>=2.18.2' 'gnome-applets>=2.18.0')
groups=('gnome-extra')
archs=('i686' 'x86_64')
_F_gnome_schemas=('/etc/gconf/schemas/seahorse-gedit.schemas'
        '/etc/gconf/schemas/seahorse.schemas')
_F_gnome_scrollkeeper="y"
_F_gnome_desktop="y"
_F_gnome_iconcache="y"
Finclude gnome gnome-scriptlet
source=(${source[@]} seahorse-1.0.1-setuid-agent.patch)
sha1sums=('03e5232d47e0d9d16fe7a713b00533859583a8d8'\
          '5675eace4c9293f1b1b6b2c41beb0290600247d0')

subpkgs=("$pkgname-gedit" "$pkgname-nautilus" "$pkgname-applet")
subdescs=('seahorse encryption plugin for gedit' \
	'seahorse encryption extension for nautilus' \
	'seahorse panel applet for GNOME')
subdepends=("$pkgname=$pkgver gedit>=2.18.2" "$pkgname=$pkgver nautilus>=2.18.3" "$pkgname=$pkgver gnome-applets>=2.18.0")
subgroups=('gnome-extra' 'gnome-extra' 'gnome-extra')
subarchs=('i686 x86_64' 'i686 x86_64' 'i686 x86_64')

build()
{
	unset MAKEFLAGS
	Fsed 'chmod u+s $(bindir)' 'chmod u+s $(DESTDIR)$(bindir)' agent/Makefile.in
	Fsed 'mkdir -p $(datadir).*' '' plugins/nautilus/Makefile.in
	Fsed 'update-mime-database $(datadir).*' '' plugins/nautilus/Makefile.in
	Fpatchall

	Fconf --enable-ldap --enable-hkp --enable-gedit --enable-nautilus \
	--enable-agent --enable-libnotify --with-keyserver --enable-ssh \
	--enable-nautilus --enable-dbus --enable-avahi --enable-sharing \
	--enable-gnome-keyring --disable-epiphany

	cd libcryptui
	make || return 1
	cd ..

	cd libseahorse
	make || return 1
	cd ..

	make || return 1
	Fmakeinstall GCONF_DISABLE_MAKEFILE_SCHEMA_INSTALL=1 DESTDIR=$Fdestdir
	Fbuild_gnome_scriptlet

	Fsplit $pkgname-gedit usr/lib/gedit-2/
	Fsplit $pkgname-nautilus usr/lib/nautilus/
	Fsplit $pkgname-applet usr/lib/seahorse/seahorse-applet
	Fsplit $pkgname-applet usr/share/omf/seahorse-applet/
	Fsplit $pkgname-applet usr/share/gnome/help/seahorse-applet/
	Fsplit $pkgname-applet usr/share/pixmaps/seahorse-applet.svg
	Fsplit $pkgname-applet usr/share/seahorse/glade/seahorse-applet-preferences.glade
	Fsplit $pkgname-applet usr/share/pixmaps/seahorse/22x22/seahorse-applet-encrypted.png
	Fsplit $pkgname-applet usr/share/pixmaps/seahorse/22x22/seahorse-applet-key.png
	Fsplit $pkgname-applet usr/share/pixmaps/seahorse/22x22/seahorse-applet-signed.png
	Fsplit $pkgname-applet usr/share/pixmaps/seahorse/22x22/seahorse-applet-text.png
	Fsplit $pkgname-applet usr/share/pixmaps/seahorse/22x22/seahorse-applet-unknown.png
	Fsplit $pkgname-applet usr/share/pixmaps/seahorse/48x48/seahorse-applet-encrypted.png
	Fsplit $pkgname-applet usr/share/pixmaps/seahorse/48x48/seahorse-applet-key.png
	Fsplit $pkgname-applet usr/share/pixmaps/seahorse/48x48/seahorse-applet-signed.png
	Fsplit $pkgname-applet usr/share/pixmaps/seahorse/48x48/seahorse-applet-text.png
	Fsplit $pkgname-applet usr/share/pixmaps/seahorse/48x48/seahorse-applet-unknown.png
	Fsplit $pkgname-applet usr/share/pixmaps/seahorse/48x48/seahorse-applet.png
	Fsplit $pkgname-applet usr/share/pixmaps/seahorse/scalable/seahorse-applet-encrypted.svg
	Fsplit $pkgname-applet usr/share/pixmaps/seahorse/scalable/seahorse-applet-key.svg
	Fsplit $pkgname-applet usr/share/pixmaps/seahorse/scalable/seahorse-applet-signed.svg
	Fsplit $pkgname-applet usr/share/pixmaps/seahorse/scalable/seahorse-applet-text.svg
	Fsplit $pkgname-applet usr/share/pixmaps/seahorse/scalable/seahorse-applet-unknown.svg
	Fsplit $pkgname-applet usr/share/pixmaps/seahorse/scalable/seahorse-applet.svg
}

# optimization OK
