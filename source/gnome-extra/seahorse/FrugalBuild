# Compiling Time: 0.34 SBU
# Maintainer: Priyank Gosalia <priyankmg@gmail.com>

pkgname=seahorse
pkgver=1.0.1
pkgrel=2
pkgdesc="A GNOME application for managing PGP keys."
url="http://www.seahorse.sourceforge.net/"
depends=('gtksourceview' 'gnupg' 'gpgme' 'libsoup' 'dbus' \
	'dbus-glib' 'libsoup' 'libxml2' 'libnotify' \
	'openssh' 'gconf' 'avahi')
makedepends=('gettext' 'openldap' 'intltool' 'pkgconfig' 'gnome-doc-utils' \
	'nautilus>=2.18.3' 'gedit>=2.18.2')
groups=('gnome-extra')
archs=('i686' 'x86_64')
_F_gnome_schemas=('/etc/gconf/schemas/seahorse-gedit.schemas'
        '/etc/gconf/schemas/seahorse.schemas')
_F_gnome_scrollkeeper="y"
_F_gnome_desktop="y"
Finclude gnome gnome-scriptlet
source=(${source[@]} seahorse-1.0.1-setuid-agent.patch)
sha1sums=('03e5232d47e0d9d16fe7a713b00533859583a8d8'\
          '5675eace4c9293f1b1b6b2c41beb0290600247d0')

subpkgs=("gedit-encryption")
subdescs=('gedit encryption plugin')
subdepends=("$pkgname=$pkgver gedit>=2.18.2")
subgroups=('gnome-extra')
subarchs=('i686 x86_64')

subpkgs=("$pkgname-nautilus")
subdescs=('Nautilus encryption extension')
subdepends=("$pkgname=$pkgver nautilus>=2.18.3")
subgroups=('gnome-extra')
subarchs=('i686 x86_64')

build()
{
	unset MAKEFLAGS
	Fsed 'chmod u+s $(bindir)' 'chmod u+s $(DESTDIR)$(bindir)' agent/Makefile.in
	Fsed 'mkdir -p $(datadir).*' '' plugins/nautilus/Makefile.in
	Fsed 'update-mime-database $(datadir).*' '' plugins/nautilus/Makefile.in
	Fpatchall

	Fconf --enable-ldap --enable-hkp --enable-gedit --enable-nautilus \
	--enable-agent --enable-libnotify --with-keyserver --enable-ssh \
	--enable-nautilus --enable-dbus --enable-avahi --enable-sharing \
	--enable-gnome-keyring --disable-epiphany

	cd libcryptui
	make || return 1
	cd ..

	cd libseahorse
	make || return 1
	cd ..

	make || return 1
	Fmakeinstall GCONF_DISABLE_MAKEFILE_SCHEMA_INSTALL=1 DESTDIR=$Fdestdir
	Fbuild_gnome_scriptlet

	Fsplit gedit-encryption usr/lib/gedit-2/
	Fsplit $pkgname-nautilus usr/lib/nautilus/
}

# optimization OK

