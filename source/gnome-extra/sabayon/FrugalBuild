# Compiling Time: 0.81 SBU
# Maintainer: AlexExtreme <alex@alex-smith.me.uk>

pkgname=sabayon
pkgver=2.12.4
pessver=2.16.1
pkgrel=4
pkgdesc="Sabayon is a user profile system for Gnome"
url="http://www.gnome.org/projects/sabayon"
groups=('gnome-extra')
archs=('i686' 'x86_64')
depends=('gnome-desktop' 'xorg-server' 'gnome-python' 'python-ldap' 'pessulus')
makedepends=('intltool' 'gnome-doc-utils')
Finclude gnome
source=(${source[@]} http://ftp.gnome.org/pub/gnome/sources/pessulus/2.16/pessulus-$pessver.tar.bz2 01_desktop.patch0)
sha1sums=('59d165b874ed3d12422b2bedad2b553a3fe48412' \
	  'e07aececdfd42ab06cb385ee49d06dac14a48ba6' \
	  '0e9a673f8d837bd5c95b8f76f116625afd433954')
install=sabayon.install

build() {
	Fcd
	Fpatchall
	Fconf --with-prototype-user=sabayon --with-distro=frugalware
	
	# Update pessulus to the latest version
	make -C admin-tool/lockdown PESSULUSDIR=../../../pessulus-$pessver update || Fdie
	
	make || Fdie
	Fmakeinstall
	
	# Install missing icon
	Fmkdir /usr/share/pixmaps
	cp admin-tool/sabayon.png $Fdestdir/usr/share/pixmaps/
	
	# Do some weird GConf stuff
	Fmkdir /etc/gconf/2
	echo 'include "$(HOME)/.gconf.path.defaults"'  > $Fdestdir/etc/gconf/2/local-defaults.path
	echo 'include "$(HOME)/.gconf.path.mandatory"' > $Fdestdir/etc/gconf/2/local-mandatory.path
}

# optimization OK
