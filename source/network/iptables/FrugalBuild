# Compiling Time: ~0.2 SBU
# Contributor: VMiklos <vmiklos@frugalware.org>
# Maintainer: Zsolt Szalai <xbit.lists@chello.hu>

pkgname=iptables
pkgver=1.3.7
pkgrel=1
pkgdesc="IP packet filter administration"
url="http://www.iptables.org/"
depends=('glibc')
groups=('network')
archs=('i686' 'x86_64')
backup=(etc/sysconfig/{firewall,iptables})
up2date="lynx -dump http://www.iptables.org/projects/iptables/downloads.html|grep bz2$|sed 's/.*-\(.*\)\.t.*/\1/;q'"
source=(http://www.iptables.org/projects/iptables/files/iptables-$pkgver.tar.bz2 \
	rc.firewall rc.firewall-hu.po iptables firewall)

# As you can see, the /etc/sysconfig/firewall file was generated by
# iptables-save. I used the following commands before using iptables-save:
# 
# iptables -P INPUT DROP
# # iptables -A INPUT -p tcp --dport 22 -j ACCEPT
# iptables -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT
# iptables -A INPUT -i lo -j ACCEPT

build()
{
	Fsed '/usr/local' '/usr' Makefile
	Fsed '^\(COPT_FLAGS:=\)-O2$' "\1$CFLAGS" Makefile

	make KERNEL_DIR=/usr || return 1

	make PREFIX=$Fdestdir/usr KERNEL_DIR=/usr install install-devel
	Ffile /etc/sysconfig/iptables
	Finstall 600 /etc/sysconfig/firewall
	Frcd2 firewall
}

# optimization OK
sha1sums=('2f25e7a81fb3e81f92b0121d9dcd5a536854dc60' \
	  '8d817150509f677370561bd412f49d2868f1eeef' \
	  '0f8f613fe2daac570bece0df8711b4b6546a9e34' \
	  '57af04722d7b42f128b96119ffa97fd3924f80b1' \
	  '56ff89ba4ef72b0a203a1210e4fe9ea869e89ff5')
