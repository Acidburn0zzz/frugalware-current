# Last Modified: Sat Aug 28 20:10:57 CEST 2004
# Compiling Time: ~3 minutes
# Maintainer: VMiklos <mamajom@axelero.hu>

pkgname=openssh
pkgver=3.9p1
pkgrel=2
pkgdesc='Secure Shell daemon and clients'
backup=('etc/ssh/ssh_config' 'etc/ssh/sshd_config')
depends=('openssl' 'zlib')
install=$pkgname.install
up2date=`lynx -dump 'http://ftp.bit.nl/mirror/openssh/?C=M;O=D'|grep 'openssh-[0-9].*tar.gz '|sed -n -e 's/.*openssh-\(.*\)\.tar\.gz .*/\1/' -e '1 p'`
source=(ftp://ftp.openbsd.org/pub/OpenBSD/OpenSSH/portable/$pkgname-$pkgver.tar.gz rc.sshd)
md5sums=('8e1774d0b52aff08f817f3987442a16e' 'e8c5b95c074862ff09267960fc7300e4')

build() {
	cd $startdir/src/$pkgname-$pkgver
	./configure --prefix=/usr --sysconfdir=/etc/ssh --without-pam \
		    --with-md5-passwords --with-tcp-wrappers --with-default-path=/usr/local/sbin:/usr/sbin:/sbin:/usr/local/bin:/usr/bin:/bin \
		    --with-ipv4-default --with-privsep-path=/var/empty \
		    --with-privsep-user=sshd 

	make || return 1

	make DESTDIR=$startdir/pkg install
	mkdir -p $startdir/pkg/var/empty
	rm -f $startdir/pkg/etc/ssh/ssh_host_{dsa_key,dsa_key.pub,rsa_key,rsa_key.pub,key,key.pub}
	mkdir -p $startdir/pkg/etc/rc.d/rc.messages
	install -m755 $startdir/rc.sshd $startdir/pkg/etc/rc.d/rc.sshd
	install -m644 $startdir/messages/sshd.* \
		$startdir/pkg/etc/rc.d/rc.messages
}

# vim: ft=sh
