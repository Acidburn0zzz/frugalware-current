# Last Modified: Thu, 01 Sep 2005 17:30:35 +0200
# Compiling Time: ~3 minutes
# Contributor: VMiklos <vmiklos@frugalware.org>
# Maintainer: Zsolt Szalai <xbit.lists@chello.hu>

pkgname=openssh
pkgver=4.2p1
pkgrel=1
pkgdesc='Secure Shell daemon and clients'
backup=('etc/ssh/ssh_config' 'etc/ssh/sshd_config')
depends=('openssl=0.9.8' 'zlib')
makedepends=('tcp_wrappers')
groups=('network')
archs=('i686' 'x86_64')
install=$pkgname.install
up2date="lynx -dump 'http://ftp.bit.nl/mirror/openssh/?C=M;O=D'|grep 'openssh-[0-9].*tar.gz '|sed -n -e 's/.*openssh-\(.*\)\.tar\.gz .*/\1/' -e '1 p'"
source=(ftp://ftp.openbsd.org/pub/OpenBSD/OpenSSH/portable/$pkgname-$pkgver.tar.gz rc.sshd)
sha1sums=('5e7231cfa8ec673ea856ce291b78fac8b380eb78' \
	  '6dcd5c052a3b354c3320dc3cb9e7297f8ff8c88e')

build()
{
	Fbuild --sysconfdir=/etc/ssh --datadir=/usr/share/openssh --without-pam --with-md5-passwords \
		--with-tcp-wrappers --with-default-path=/usr/local/sbin:/usr/sbin:/sbin:/usr/local/bin:/usr/bin:/bin \
		--with-ipv4-default --with-privsep-path=/var/empty \
		--with-privsep-user=sshd

	Fmkdir /var/empty
	Frm /etc/ssh/ssh_host_{dsa_key,dsa_key.pub,rsa_key,rsa_key.pub,key,key.pub}
	Frcd sshd
	Fsed '^#PermitRootLogin yes$' 'PermitRootLogin no' $Fdestdir/etc/ssh/sshd_config
	Fsed '^#X11Forwarding no$' 'X11Forwarding yes' $Fdestdir/etc/ssh/sshd_config
	Fsed '#   ForwardX11 no' 'ForwardX11Trusted yes' $Fdestdir/etc/ssh/ssh_config
}

# vim: ft=sh

# optimalization OK
