diff --git a/driver/ntoskernel.h b/driver/ntoskernel.h
index a2de9e4..2930053 100644
--- a/driver/ntoskernel.h
+++ b/driver/ntoskernel.h
@@ -875,7 +875,7 @@ static inline struct nt_slist *PopEntrySList(nt_slist_header *head,
 #define u64_low_32(x) ((u32)x)
 #define u64_high_32(x) ((u32)(x >> 32))
 
-#if LINUX_VERSION_CODE < KERNEL_VERSION(2,6,31)
+#if LINUX_VERSION_CODE <= KERNEL_VERSION(2,6,32)
 static inline u64 cmpxchg8b(volatile u64 *ptr, u64 old, u64 new)
 {
 	u64 prev;
