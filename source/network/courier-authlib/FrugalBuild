# Last Modified: Sun, 27 Mar 2005 15:27:00 +0000
# Compiling Time: ~10 minutes
# Maintainer: Zoltan Kiss <djsmiley@inflame.hu>

pkgname=courier-authlib
pkgver=0.55
pkgrel=1
pkgdesc="The Courier authentication library & daemon"
depends=('expect')
groups=('network')
backup=('etc/courier/authdaemonrc')
makedepends=('openldap' 'mysql' 'postgresql')
up2date="lynx -dump 'http://www.courier-mta.org/download.php'|grep authlib|sed -n 's/.*-\(.*\)\.t.*/\1/;1 p'"
source=(http://dl.sourceforge.net/$pkgname/$pkgname-$pkgver.tar.bz2 rc.courier-authlib authdaemonrc.frugal README.frugalware)
md5sums=('eb57aefb8460106709d560c40cccaa41' 'ec05d0028fa38de6d7f78d86cd753c5c' '140bd6ed28419f055ef66f1516795157' 'e484a46ea43b738d2ae805e4ea7f60e2')

build() {
	cd $startdir/src/$pkgname-$pkgver
	./configure --prefix=/usr \
	--mandir=/usr/share/man \
	--sysconfdir=/etc/courier \
	--libexecdir=/usr/libexec \
	--datadir=/usr/lib \
	--with-authshadow \
	--localstatedir=/var/lib/courier \
	--with-db=gdbm \
	--without-authpam \
	--with-authldaprc=/etc/courier/authldaprc \
	--with-authpgsqlrc=/etc/courier/authpgsqlrc \
	--with-pgsql-libs=/usr/lib/postgresql/ \
	--with-pgsql-includes=/usr/include/postgresql/ \
	--with-authmysqlrc=/etc/courier/authmysqlrc \
	--with-mysql-libs=/usr/lib/mysql/ \
	--with-mysql-includes=/usr/lib/mysql/ \
	--with-authdaemonrc=/etc/courier/authdaemonrc \
	--with-authdaemonvar=/var/run/courier \
	--with-mailuser=daemon \
	--with-mailgroup=daemon

	make || return 1

	mkdir -p $startdir/usr/
	make DESTDIR=$startdir/pkg/ install
	
        # remove original courier rc scripts (we don't need them :P )
        rm $startdir/pkg/usr/sbin/authdaemond

	# config files
	Fmkdir /usr/share/doc/$pkgname-$pkgver/examples
	mv $startdir/pkg/etc/courier/* $startdir/pkg/usr/share/doc/$pkgname-$pkgver/examples/
	# all .dist configfiles moved out from /etc/courier
	
	# place my sample config file in confdir
	Ffile authdaemonrc.frugal /etc/courier/authdaemonrc	
	Ffile README.frugalware /usr/share/doc/$pkgname-$pkgver/
	
	#init scripts
	Frcd courier-authlib
	
}

# vim: ft=sh
