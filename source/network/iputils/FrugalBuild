# Last modified: Thu, 13 Oct 2005 23:06:28 +0200
# Compiling Time: 0.03 SBU
# Maintainer: VMiklos <vmiklos@frugalware.org>

pkgname=iputils
pkgver=021109_try
pkgrel=2
[ "$CARCH" == "x86_64" ] && pkgrel=3
pkgdesc="The ping program for checking to see if network hosts are alive."
url="ftp://ftp.inr.ac.ru/ip-routing/"
depends=('glibc' 'netkit-base')
groups=('network')
archs=('i686' 'x86_64')
up2date="lynx -dump 'http://public.www.planetmirror.com/pub/ip-routing/?M=D'|grep iputils|sed -n -e 's/.*iputils-\(.*\)\.tar\..*/\1/' -e 's/ss//' -e 's/-/_/' -e '1 p'"
source=(http://www.tux.org/pub/net/ip-routing/$pkgname-`echo -n ss;echo $pkgver|sed 's/_/-/'`.tar.bz2 \
	iputils-big-patches.patch)
#md5sums=('dd10ef3d76480990a2174d2bb0daddaf' '704b3a3feadf137afc3f72db41d5afdb')
sha1sums=('8e695eb45d7f63fe2321b59b8cb64bff1078a03a' \
	  'be834ef533655b048fff79f266626428e991a983')
	  

build() {
	cd $startdir/src/iputils
	Fpatchall || return 1

        sed -i \
            -e "/^CCOPT=/s:-O2:${CFLAGS}:" \
            -e "/^CC=/s:.*::" \
            -e '/^all:/s:check-kernel::' \
            -e 's:-I$(KERNEL_INCLUDE)::' \
            -e 's:-I/usr/src/linux/include::' \
            Makefile || return 1

	make || return 1

	for i in rarpd rdisc tracepath tracepath6 traceroute6 arping clockdiff \
		tftpd; do
		install -D -m755 $i $startdir/pkg/usr/sbin/$i
	done
	for i in ping ping6; do
		install -D -m4755 $i $startdir/pkg/bin/$i
	done
	cd doc
	for i in *.8; do
		install -D -m644 $i $startdir/pkg/usr/man/man8/$i
	done

	rm $startdir/pkg/usr/man/man8/tftpd.8
}

# optimalization OK

# vim: ft=sh
