# Last Modified: Thu, 27 Jul 2006 16:26:17 +0100
# Compiling Time: 0.54 SBU
# Maintainer: AlexExtreme <alex.extreme2@gmail.com>

pkgname="avahi"
pkgver=0.6.12
pkgrel=2
pkgdesc="A multicast/unicast DNS-SD framework"
archs=('i686' 'x86_64')
url="http://www.avahi.org"
groups=('network')
depends=('dbus' 'libcap' 'nss-mdns' 'gdbm' 'libdaemon')
makedepends=('mono' 'pygtk' 'qt')
backup=(etc/avahi/avahi-daemon.conf)
conflicts=('mdnsresponder')
replaces=('mdnsresponder')
provides=('mdnsresponder')
up2date="lynx -dump http://www.avahi.org/download | grep 'avahi-[0-9]' | Flasttar"
options=('scriptlet')
source=(http://www.avahi.org/download/${pkgname}-${pkgver}.tar.gz \
	rc.avahi-daemon{,-hu.po} rc.avahi-dnsconfd{,-hu.po} README.Frugalware)
sha1sums=('678d9878d560dc3a1b3d641828af3c5f6cdc76a9' \
	  'f66dd6671c303d5e5ba137b023786af3336957f0' \
	  '5f6b99e4917458b24736519bdd1e510763310589' \
	  '723e2e691d35063bd8aefeaf1063fdba812a9249' \
	  'b31a9b9bf972739d2976ef510690968851e8b588' \
	  '892fb0aab3b1a1cb243773e81006ac07fd613f0a')
subpkgs=('avahi-glib' 'avahi-sharp' 'avahi-qt3' 'avahi-python' 'avahi-compat' 'avahi-gtk2')
subdescs=('Glib bindings for Avahi' 'Mono C# bindings for Avahi' 'QT3 bindings for Avahi' \
	  'Python bindings for Avahi' 'mDNSresponder and Howl compatibility libraries/headers for Avahi' \
	  'GUI GTK based tools for Avahi')
subdepends=("glib2 $pkgname=$pkgver" "mono $pkgname=$pkgver" "qt $pkgname=$pkgver" "python $pkgname=$pkgver" "$pkgname=$pkgver" \
	    "avahi-python=$pkgver libglade pygtk avahi-glib=$pkgver")
subgroups=('network' 'gnome' 'kde' 'network' 'network' 'xapps')
subarchs=('i686 x86_64' 'i686 x86_64' 'i686 x86_64' 'i686 x86_64' 'i686 x86_64' 'i686 x86_64')

build() {
	[ -z "${QTDIR}" ] && . /etc/profile.d/qt.sh
	
	# Diediedie, Mono shared shit
	export MONO_SHARED_DIR=$Fsrcdir/monocrap
	mkdir -p $MONO_SHARED_DIR
	
	Fmake --disable-qt4 \
		--disable-monodoc \
		--disable-doxygen-doc \
		--disable-xmltoman \
		--enable-compat-libdns_sd \
		--enable-compat-howl \
		--with-distro=none
	Fmakeinstall
	
	rm -rf $MONO_SHARED_DIR
	
	Fdoc README.Frugalware
	Frm usr/bin/avahi-bookmarks
	Frm usr/man/man1/avahi-bookmarks.*
	
	# Compatibility stuff
	Fln avahi-compat-libdns_sd/dns_sd.h usr/include
	Fln avahi-compat-howl usr/include/howl
	Fln avahi-compat-howl.pc usr/lib/pkgconfig/howl.pc
	
	# Lots and lots of splits :O
	# Lets start with avahi-glib
	Fsplit avahi-glib usr/include/avahi-glib
	Fsplit avahi-glib usr/lib/libavahi-glib*
	Fsplit avahi-glib usr/lib/pkgconfig/avahi-glib.pc
	
	# Now avahi-sharp
	Fsplit avahi-sharp usr/lib/mono
	Fsplit avahi-sharp usr/lib/pkgconfig/avahi-sharp.pc
	
	# avahi-qt3
	Fsplit avahi-qt3 usr/include/avahi-qt3
	Fsplit avahi-qt3 usr/lib/libavahi-qt3*
	Fsplit avahi-qt3 usr/lib/pkgconfig/avahi-qt3.pc
	
	# avahi-python
	Fsplit avahi-python usr/lib/python*
	
	# avahi-compat
	Fsplit avahi-compat usr/lib/libhowl*
	Fsplit avahi-compat usr/lib/libdns_sd*
	Fsplit avahi-compat usr/include/avahi-compat*
	Fsplit avahi-compat usr/include/dns_sd.h
	Fsplit avahi-compat usr/include/howl
	Fsplit avahi-compat usr/lib/pkgconfig/avahi-compat*
	Fsplit avahi-compat usr/lib/pkgconfig/howl.pc
	
	# avahi-gtk2
	Fsplit avahi-gtk2 usr/bin/avahi-discover{,-standalone}
	Fsplit avahi-gtk2 usr/share/man/man1/avahi-discover.*
	Fsplit avahi-gtk2 usr/share/applications
	Fsplit avahi-gtk2 usr/share/avahi/interfaces
	
	# Install the init scripts
	Frcd2 avahi-daemon
	Frcd2 avahi-dnsconfd
}

# optimization OK
