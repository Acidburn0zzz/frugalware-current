# Last Modified: Mon, 09 Jan 2006 20:30:41 +0100
# Compiling Time: 1.90 SBU
# Maintainer: VMiklos <vmiklos@frugalware.org>

pkgname=php
pkgver=5.1.1
pkgrel=2
pkgdesc="A widely-used general-purpose scripting language"
url="http://www.php.net"
backup=(etc/{php.ini,httpd/conf/modules.d/$pkgname.conf})
depends=('openssl' 'libjpeg' 'freetype2' 'libpng' 'gdbm' 'libxslt' 'curl' \
	 'libxml2')
makedepends=('apache' 'mysql' 'imap' 'postgresql' 'bzip2' 'zziplib' 'mta' 'openldap')
groups=('devel')
archs=('i686' 'x86_64')
install=$pkgname.install
up2date="lynx -dump http://www.php.net/downloads.php |grep 'Complete Source Code' -3|sed -n 's/.*P \(.*\)/\1/;2 p'"
source=(http://www.php.net/distributions/$pkgname-$pkgver.tar.gz \
	http://pecl.php.net/get/zip-1.0.tgz php.ini php.conf)
sha1sums=('88e48e47c11351b2fa9d5649343f839800acb1bf' \
	  '0ac6f2d25385eb2c74af82c7a54639eb531d8414' \
	  '6e79ce079b6a021f6a6c99a06aa123160a604fd7' \
	  '0850ef23512a02e8460dc36f08f453d148dcd9df')

build()
{
	mv $Fsrcdir/zip-1.0 $Fsrcdir/$pkgname-$pkgver/ext/zip
	touch $Fsrcdir/$pkgname-$pkgver/ext/zip/*
	Fcd
	./buildconf --force
	Fmake --with-config-file-path=/etc \
		--with-apxs2 --with-ttf --enable-mailparse \
		--enable-bcmath=shared --enable-calendar=shared \
		--enable-ftp=shared --enable-gd-native-ttf \
		--enable-ldap=shared  \
		--enable-magic-quotes --enable-posix=shared  \
		--enable-session --enable-shared --enable-shmop=shared \
		--enable-sysvsem=shared --enable-sysvshm=shared \
		--enable-track-vars --enable-trans-sid --enable-safe-mode \
		--enable-sockets=shared --with-bz2=shared --without-db2 \
		--without-db3 --with-freetype-dir=/usr --with-gd --with-gdbm \
		--enable-exif --with-jpeg-dir=/usr --with-mysql=shared,/usr \
		--with-mysql-sock=/tmp/mysql.sock --with-openssl \
		--with-gettext --with-pear=/usr/share/pear --with-dom \
		--with-dom-xslt --with-png-dir=/usr --with-regex=php \
		--with-zlib --with-pgsql=shared \
		--with-pgsql-sock=/tmp/pgsql.sock \
		--with-mysqli --enable-sigchild --enable-pcntl \
		--with-curl=/usr/bin --enable-memory-limit --enable-sysvmsg \
		--with-xmlrpc --enable-yp --enable-dbx \
		--enable-mbstring --with-imap=shared --with-imap-ssl=shared \
		--with-zip --with-zip=shared
	Fmkdir /usr/lib/apache
	Fsed "-i -a -n php5" "-i -n php5" Makefile
	make INSTALL_ROOT=$Fdestdir EXTENSION_DIR=/usr/lib/php
	make INSTALL_ROOT=$Fdestdir install-su
	Ffile /etc/httpd/conf/modules.d/$pkgname.conf

	touch pear/PEAR/RunTest.php
	sapi/cli/php -n -dshort_open_tag=0 -dsafe_mode=0 \
		pear/install-pear.php -d $Fdestdir/usr/share/pear \
		-b $Fdestdir/usr/bin pear/package-*.xml
	sapi/cli/php -n -dshort_open_tag=0 -dsafe_mode=0 \
		pear/install-pear.php -d $Fdestdir/usr/share/pear \
		-b $Fdestdir/usr/bin pear/packages/*.tar
	Fsed "$Fdestdir" "" $Fdestdir/usr/{bin/pear,share/pear/pearcmd.php}

	Ffile /etc/php.ini
	Fln /etc/php.ini /usr/lib/php.ini
}

# vim: ft=sh

# optimalization OK
