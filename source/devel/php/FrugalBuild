# Last Modified: Sat Oct 30 12:58:58 CEST 2004
# Compiling Time: ~12 minutes
# Maintainer: VMiklos <mamajom@axelero.hu>

pkgname=php
pkgver=5.0.2
pkgrel=2
pkgdesc="A widely-used general-purpose scripting language"
url="http://www.php.net"
backup=(etc/php.ini)
depends=('openssl' 'libjpeg' 'freetype2' 'libpng' 'gdbm' 'libxslt')
makedepends=('apache' 'mysql' 'imap' 'postgresql' 'bzip2')
up2date=`lynx -dump http://www.php.net/downloads.php |grep 'Complete Source Code' -3|grep tar.bz2|sed -ne 's/.*P \(.*\) (.*/\1/' -e '2 p'`
source=(http://www.php.net/distributions/$pkgname-$pkgver.tar.gz php.ini)
md5sums=('5467327e0cab6de76a90266933322b59' '7f1854998deed154af487303f1ab4b67')
install=$pkgname.install

build() {
	cd $startdir/src/$pkgname-$pkgver
	./configure --prefix=/usr --with-config-file-path=/etc \
		--with-apxs2 --with-ttf --enable-mailparse \
		--enable-bcmath=shared --enable-calendar=shared \
		--enable-ftp=shared --enable-gd-native-ttf \
		--enable-magic-quotes --enable-posix=shared  \
		--enable-session --enable-shared --enable-shmop=shared \
		--enable-sysvsem=shared --enable-sysvshm=shared \
		--enable-track-vars --enable-trans-sid --enable-safe-mode \
		--enable-sockets=shared --with-bz2=shared --without-db2 \
		--without-db3 --with-freetype-dir=/usr --with-gd --with-gdbm \
		--enable-exif --with-jpeg-dir=/usr --with-mysql=shared,/usr \
		--with-mysql-sock=/tmp/mysql.sock --with-openssl \
		--with-gettext --with-pear=/usr/share/pear --with-dom \
		--with-dom-xslt --with-png-dir=/usr --with-regex=php \
		--with-zlib \
		--with-pgsql=shared --with-pgsql-sock=/tmp/pgsql.sock
	
	make || return 1
	
	mkdir -p $startdir/pkg/usr/lib/apache
	sed -i "s|-i -a -n php5|-i -n php5|g" Makefile
	make INSTALL_ROOT=$startdir/pkg EXTENSION_DIR=/usr/lib/php install
	install -D -m644 $startdir/src/php.ini $startdir/pkg/etc/php.ini
	cd $startdir/pkg/usr/lib && ln -sf /etc/php.ini php.ini
}

# vim: ft=sh
