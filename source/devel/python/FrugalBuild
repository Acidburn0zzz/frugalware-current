# Last Modified: Thu, 12 Oct 2006 13:48:50 +0200
# Compiling Time: 0.96 SBU
# Maintainer: VMiklos <vmiklos@frugalware.org>

pkgname=python
pkgver=2.4.3
shortpkgver=2.4 # 2.3 if $pkgver=2.3.4
pkgrel=5
pkgdesc="A high-level scripting language"
url="http://www.python.org"
depends=('glibc' 'db>=4.5.20' 'bzip2' 'gdbm' 'openssl' 'glib2')
makedepends=('tk' 'gtk+2')
groups=('devel' 'devel-core')
archs=('i686' 'x86_64' 'ppc')
options=('scriptlet')
up2date="lynx -dump $url/download/|grep current|sed 's/.*n \(.*\)\. .*/\1/;q'"
source=($url/ftp/$pkgname/$pkgver/Python-$pkgver.tar.bz2 python2.4-2.4.3_unicodeobject.c.diff)

subpkgs=("$pkgname-tools")
subdescs=("Optional development tools to extending Python")
subgroups=('devel')
subdepends=('python')
subarchs=('i686 x86_64')

[ "$CARCH" == "x86_64" ] && export CFLAGS="$CFLAGS -fPIC"

build()
{
	Fcd Python-$pkgver
	Fpatchall
	Fconf --prefix=/usr --with-threads --enable-shared --enable-ipv6 || return 1
	#Fsed '^\(OPT=\).*' "\1\t\t$CFLAGS" Makefile
	Fsed 'mozilla-firefox' 'firefox' Lib/webbrowser.py
	make || return 1
	Fmakeinstall || return 1
	Frm /usr/bin/python$shortpkgver
	Fln python /usr/bin/python$shortpkgver
	# subpkg python-tools
	for f in Tools/* ; do
		if [ -d $f ] ; then
			Fcpr Python-$pkgver/$f /usr/lib/python$shortpkgver/site-packages/ || Fdie
			Fsplit $pkgname-tools usr/lib/python$shortpkgver/site-packages/`echo $f|sed 's|Tools/||'`
		fi
	done
	Fln /usr/lib/python$shortpkgver/site-packages/i18n/msgfmt.py /usr/bin/msgfmt.py
	Fln /usr/lib/python$shortpkgver/site-packages/i18n/pygettext.py /usr/bin/pygettext.py
	Fln /usr/lib/python$shortpkgver/site-packages/modulator/modulator.py /usr/bin/modulator.py
	Fln /usr/lib/python$shortpkgver/site-packages/pynche/pynche /usr/bin/pynche
	Fsplit $pkgname-tools usr/bin/{{msgfmt,pygettext,modulator}.py,pynche}
}

# optimization OK

sha1sums=('d6b81e1aec0045b5acff99676f2abe303da1b384' \
	  'be2170c807d960e0716ba575f26ecb5248aeab1a')
