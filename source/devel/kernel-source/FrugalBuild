# Last Modified: Fri Oct  8 21:24:32 CEST 2004
# Compiling Time: ~5 minute
# Maintainer: VMiklos <mamajom@axelero.hu>

pkgname=kernel-source
pkgver=2.6.9
bsver=3.1.4
pkgrel=1
pkgdesc="Linux kernel source"
url="http://www.kernel.org"
depends=()
install=$pkgname.install
up2date=`lynx -dump http://www.kernel.org/kdist/finger_banner |tr -s ' ' |cut -d ' ' -f 10 |sed -n '1 p'`
source=(ftp://ftp.kernel.org/pub/linux/kernel/v2.6/linux-$pkgver.tar.bz2 \
        ftp://ftp.suse.com/pub/people/stepan/bootsplash/kernel/bootsplash-$bsver-$pkgver.diff config linux-$pkgver-nvidia.diff linux-$pkgver-gcc34.diff)
md5sums=('e921200f074ca97184e150ef5a4af825' 'e772193143c48d94ea185474aa649552' \
         '58193bbc62ab4a10ebfeae3adbd59a9a' '99e4719deb2412f68e7389aecbe76a6d' \
         'f07d47d2ea0c738f6044743264c74962')

build() {
	cd $startdir/src/linux-$pkgver
        #patch -p1 < $startdir/src/linux-$pkgver-memleak.diff
        #patch -p1 < $startdir/src/linux-$pkgver-usercd.diff
        #patch -p1 < $startdir/src/linux-$pkgver-audiocd.diff
        patch -p1 < $startdir/src/linux-$pkgver-gcc34.diff
        patch -p1 < $startdir/src/linux-$pkgver-nvidia.diff
        patch -p1 < $startdir/src/bootsplash-$bsver-$pkgver.diff
	# config uses -march optimalization
	# cat ../config | sed "s|686|`echo $CARCH | sed 's|i||'`|g" >./.config
	cat ../config | sed "s|686|486|g" >./.config
	yes "" | make config
	# mv .config config
	
	cd ..
	mkdir -p $startdir/pkg/usr/src/
	mv linux-$pkgver $startdir/pkg/usr/src/
	cd $startdir/pkg/usr/src/
	ln -s linux-$pkgver linux
	# these are required for later builds (nvidia, etc)
	cd linux
	make include/linux/version.h
	ln -sf asm-i386 include/asm
	make scripts
}

# vim: ft=sh
