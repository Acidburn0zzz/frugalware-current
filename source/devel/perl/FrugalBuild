# Last Modified: Thu Jul 29 03:12:12 CEST 2004
# Compiling Time: ~13 minutes
# Maintainer: VMiklos <mamajom@axelero.hu>

pkgname=perl
pkgver=5.8.5 # don't forget to update the version in perl-mysql as well
pkgrel=1
pkgdesc="Practical Extraction and Report Language"
url="http://www.perl.org"
depends=('glibc' 'coreutils' 'gdbm' 'db')
up2date=`lynx -dump http://www.cpan.org/src/README.html|grep 'stable release'|sed -n -e 's/.* \(.*\)\. .*/\1/' -e '1 p'`
source=(http://www.cpan.org/src/5.0/$pkgname-$pkgver.tar.gz \
	$pkgname-$pkgver.diff)
install=$pkgname.install
md5sums=('49baa8d7d29b4a9713c06edeb81e6b1b' '5d2aae48a809c06660f4abd7f95dec43')

# based on the PKGBUILD script from ArchLinux

build() {
	cd $startdir/src/$pkgname-$pkgver
	patch -p1 < $startdir/src/$pkgname-$pkgver.diff
	./Configure -de -Dprefix=/usr -Dinstallprefix=$startdir/pkg/usr \
		    -Dman1dir=/usr/man/man1 -Dman3dir=/usr/man/man3 \
		    -Dcccdlflags='-fPIC' -Doptimize="$CFLAGS"

	make || return 1

	make install
	(cd $startdir/pkg/usr/bin; mv perl$pkgver perl; ln -sf c2ph pstruct)
	(cd $startdir/pkg/usr/bin; ln -sf s2p psed)
	(cd $startdir/pkg/usr/lib/perl5; mv $pkgver current)
	(cd $startdir/pkg/usr/lib/perl5/site_perl; mv $pkgver current)
	find $startdir/pkg -type f | xargs grep -l "$startdir/pkg" | \
		xargs -n1 perl -i -p -e "s|$startdir/pkg||g;"
}
