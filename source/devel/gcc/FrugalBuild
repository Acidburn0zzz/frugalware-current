# Last Modified: Sat, 18 Feb 2006 20:47:53 +0100
# Compiling Time: 7.65 SBU
# Maintainer: VMiklos <vmiklos@frugalware.org>

pkgname=gcc
pkgver=4.0.2
pkgrel=2
pkgdesc="The GNU Compiler Collection"
url="http://gcc.gnu.org"
depends=('glibc' 'binutils' 'libstdc++' 'gcc-lib')
provides=('c-compiler')
groups=('devel' 'devel-core')
archs=('i686' 'x86_64' 'ppc')
up2date="lynx -dump $url |grep 4.0|sed 's/.*C \(.*\) (.*/\1/;q'"
source=(ftp://gcc.gnu.org/pub/gcc/releases/gcc-$pkgver/$pkgname-$pkgver.tar.bz2 \
	$pkgname-3.4.3-no_multilib_amd64.patch0 \
	$pkgname-$pkgver-pr23190.diff \
	README.Frugalware)
sha1sums=('f1b714c6398393d8f7f4ad5be933b462a95b075d' \
	  '883ae944eb9aeca85d9adc54b3e16eab8f4a51c3' \
	  'f609dc301ee9f6ec79686f1b9488ff8886c5cba5' \
	  '27cc00050d9b88b6e2649c406243769dc66593f5')
[ "$CARCH" == "x86_64" ] && Fconfopts="$Fconfopts --libdir=/usr/lib --disable-multilib"

build()
{
	Fpatchall
	mkdir ../$pkgname-build
	cd ../$pkgname-build
	../$pkgname-$pkgver/configure $Fconfopts --enable-shared \
		--enable-languages=c,c++,objc --enable-threads=posix \
		--enable-__cxa_atexit
	
	make bootstrap || return 1
	
	Fmakeinstall

	# include/ contains install-tools/include/* and headers that were fixed
	# up by fixincludes, we don't want former
	for i in `find $Fdestdir/usr/lib/gcc/$CHOST/$pkgver/include/ -name \*.h`
	do
		if grep -q 'It has been auto-edited by fixincludes from' \
			$i; then
			rm -f $i
		fi
	done

	Frm /usr/bin/c++filt /usr/lib/libiberty.a
	Fmkdir /lib
	Fln ../usr/bin/cpp /lib/cpp
	Fln gcc /usr/bin/cc
	Fln g++ /usr/bin/c++
	Fdoc README.Frugalware
	# conflicts with libstdc++
	Frm '/usr/lib/libstdc++.*'
	Frm '/usr/lib/libsupc++.*'
	Frm /usr/share/locale/*/LC_MESSAGES/libstdc++.mo
	# conflicts with gcc-lib
	Frm '/usr/lib/libgcc_*'
}

# vim: ft=sh

# optimalization OK
