# Last Modified: Thu, 28 Jul 2005 23:04:40 +0200
# Compiling Time: 7.65 SBU
# Maintainer: VMiklos <mamajom@axelero.hu>

pkgname=gcc
pkgver=4.0.1
pkgrel=2
pkgdesc="The GNU Compiler Collection"
url="http://gcc.gnu.org"
depends=('glibc' 'binutils' 'libstdc++' 'gcc-lib')
provides=('c-compiler')
groups=('devel')
up2date="lynx -dump $url |grep Current|sed 's/.*C \(.*\) (.*/\1/'"
source=(ftp://gcc.gnu.org/pub/gcc/releases/gcc-$pkgver/$pkgname-$pkgver.tar.bz2 $pkgname-3.4.3-no_multilib_amd64.patch0)
# lynx -dump ftp://gcc.gnu.org/pub/gcc/releases/gcc-$pkgver/md5.sum|grep gcc-$pkgver.tar.bz2$|sed 's/^\([^ ]*\) .*/\1/'
md5sums=('947416e825a877a0d69489be1be43be1' '088e0807e677010cafe4e590e8711be1')
[ "$CARCH" == "x86_64" ] && libopts="--libdir=/usr/lib --disable-multilib"

build()
{
	Fcd
	[ "$CARCH" == "x86_64" ] && Fpatchall
	mkdir ../$pkgname-build
	cd ../$pkgname-build
	../$pkgname-$pkgver/configure --prefix=/usr --enable-shared \
		--enable-languages=c,c++,objc --enable-threads=posix \
		--enable-__cxa_atexit $libopts
	
	make bootstrap || return 1
	
	Fmakeinstall

	# include/ contains install-tools/include/* and headers that were fixed
	# up by fixincludes, we don't want former
	for i in `find $Fdestdir/usr/lib/gcc/$CHOST/$pkgver/include/ -name \*.h`
	do
		if grep -q 'It has been auto-edited by fixincludes from' \
			$i; then
			rm -f $i
		fi
	done

	Frm /usr/bin/c++filt /usr/lib/libiberty.a
	Fmkdir /lib
	Fln ../usr/bin/cpp /lib/cpp
	Fln gcc /usr/bin/cc
	Fln g++ /usr/bin/c++
	# conflicts with libstdc++
	Frm '/usr/lib/libstdc++.*'
	Frm '/usr/lib/libsupc++.*'
	Frm /usr/share/locale/*/LC_MESSAGES/libstdc++.mo
	# conflicts with gcc-lib
	Frm '/usr/lib/libgcc_*'
}

# vim: ft=sh

# optimalization OK
