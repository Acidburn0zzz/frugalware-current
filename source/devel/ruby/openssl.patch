diff -Naur ruby-1.8.2.orig/ext/digest/md5/md5ossl.h ruby-1.8.2/ext/digest/md5/md5ossl.h
--- ruby-1.8.2.orig/ext/digest/md5/md5ossl.h	2002-09-26 18:27:23.000000000 +0200
+++ ruby-1.8.2/ext/digest/md5/md5ossl.h	2005-07-30 12:17:47.000000000 +0200
@@ -3,6 +3,7 @@
 #ifndef MD5OSSL_H_INCLUDED
 #define MD5OSSL_H_INCLUDED
 
+#include <sys/types.h>
 #include <openssl/md5.h>
 
 void MD5_End(MD5_CTX *pctx, unsigned char *hexdigest);
diff -Naur ruby-1.8.2.orig/ext/digest/rmd160/rmd160ossl.h ruby-1.8.2/ext/digest/rmd160/rmd160ossl.h
--- ruby-1.8.2.orig/ext/digest/rmd160/rmd160ossl.h	2002-09-26 19:26:46.000000000 +0200
+++ ruby-1.8.2/ext/digest/rmd160/rmd160ossl.h	2005-07-30 12:26:42.000000000 +0200
@@ -3,6 +3,7 @@
 #ifndef RMD160OSSL_H_INCLUDED
 #define RMD160OSSL_H_INCLUDED
 
+#include <sys/types.h>
 #include <openssl/ripemd.h>
 
 #define RMD160_CTX	RIPEMD160_CTX
diff -Naur ruby-1.8.2.orig/ext/digest/sha1/sha1ossl.h ruby-1.8.2/ext/digest/sha1/sha1ossl.h
--- ruby-1.8.2.orig/ext/digest/sha1/sha1ossl.h	2002-09-26 19:44:33.000000000 +0200
+++ ruby-1.8.2/ext/digest/sha1/sha1ossl.h	2005-07-30 12:26:58.000000000 +0200
@@ -3,6 +3,7 @@
 #ifndef SHA1OSSL_H_INCLUDED
 #define SHA1OSSL_H_INCLUDED
 
+#include <sys/types.h>
 #include <openssl/sha.h>
 
 #define SHA1_CTX	SHA_CTX
diff -Naur ruby-1.8.2.orig/ext/openssl/openssl_missing.c ruby-1.8.2/ext/openssl/openssl_missing.c
--- ruby-1.8.2.orig/ext/openssl/openssl_missing.c	2004-07-01 05:01:07.000000000 +0200
+++ ruby-1.8.2/ext/openssl/openssl_missing.c	2005-07-30 12:27:31.000000000 +0200
@@ -11,6 +11,7 @@
 
 #if !defined(OPENSSL_NO_HMAC)
 #include <string.h> /* memcpy() */
+#include <sys/types.h>
 #include <openssl/hmac.h>
 
 #if !defined(HAVE_HMAC_CTX_COPY)
diff -Naur ruby-1.8.2.orig/ext/openssl/ossl.h ruby-1.8.2/ext/openssl/ossl.h
--- ruby-1.8.2.orig/ext/openssl/ossl.h	2003-12-11 13:29:08.000000000 +0100
+++ ruby-1.8.2/ext/openssl/ossl.h	2005-07-30 12:27:56.000000000 +0200
@@ -20,6 +20,7 @@
  * The only supported are:
  * 	OpenSSL >= 0.9.7
  */
+#include <sys/types.h>
 #include <openssl/opensslv.h>
 
 #ifdef HAVE_ASSERT_H
diff -Naur ruby-1.8.2.orig/ext/openssl/ossl_x509store.c ruby-1.8.2/ext/openssl/ossl_x509store.c
--- ruby-1.8.2.orig/ext/openssl/ossl_x509store.c	2004-12-19 09:28:32.000000000 +0100
+++ ruby-1.8.2/ext/openssl/ossl_x509store.c	2005-07-30 12:05:56.000000000 +0200
@@ -538,7 +538,7 @@
 
     if(NIL_P(time)) {
 	GetX509StCtx(self, store);
-	store->flags &= ~X509_V_FLAG_USE_CHECK_TIME;
+	store->param->flags &= ~X509_V_FLAG_USE_CHECK_TIME;
     }
     else {
 	long t = NUM2LONG(rb_Integer(time));
