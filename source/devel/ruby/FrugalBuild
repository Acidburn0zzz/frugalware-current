# Compiling time: 1.53 SBU
# Contributor: Bence Nagy <nagybence@tipogral.hu>
# Maintainer: voroskoi <voroskoi@frugalware.org>

pkgname=ruby
pkgver=1.9.2
pkgpatch=320
pkgrel=3arcturus1
pkgdesc="An object-oriented programming language."
url="http://www.ruby-lang.org/"
depends=('libxml2>=2.7.8' 'zlib' 'db>=4.7.25-2' 'readline' 'openssl>=1.0.0' 'gdbm>=1.10')
makedepends=('tk')
groups=('devel')
archs=('i686' 'x86_64' 'arm')
up2date="lynx -dump http://www.ruby-lang.org/en/downloads/|sed 's/-p$pkgpatch//' |Flasttar"
source=(ftp://ftp.ruby-lang.org/pub/ruby/1.9/ruby-${pkgver}-p$pkgpatch.tar.bz2)
sha1sums=('f4892311ea4ca2a6c979c9fd3a03c8e473998315')
replaces=('rake' 'rubygems' 'eruby')
provides=('rake' 'rubygems')
conflicts=('rake' 'rubygems')


# FSA fix ***
source=(${source[@]} CVE-2014-4975.patch CVE-2014-8080.patch CVE-2014-8090.patch)
sha1sums=(${sha1sums[@]} '6e6464e622d6ff6e30a8964e29f6ce473a2ac8b9' \
                         '96d5e99d94b37607e5563b80a3ba84144ee382b3' \
                         'b5611e44b111963809cca57f8795e6338ae24ab9')
# ***********

build() {
	Fcd ruby-$pkgver-p$pkgpatch
	Fbuild --enable-shared --enable-pthread
	# fix for kdebindings, maybe others too
	# XXX: tinyver in version.h is still 1
	Fln ../${CARCH}-linux/ruby/config.h ${Fprefix}/include/ruby-1.9.1/ruby/config.h
	Fmakeinstall install-doc
}

# optimization OK
