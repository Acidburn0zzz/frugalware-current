# Compiling time: 2.57 SBU
# Maintainer: crazy <crazy@frugalware.org>

USE_TK=${USE_TK:-"y"}

pkgname=ruby
pkgver=2.3.1
rubyver=2.3.0
#TODO remove this after upstream fixes packaging
pkgpatch=
pkgrel=1
pkgdesc="An object-oriented programming language."
url="http://www.ruby-lang.org/"
depends=('libxml2>=2.9.3-2' 'zlib>=1.2.8-3' 'db>=6.1.26' 'readline>=6.3-7' \
	'openssl>=1.0.2-2' 'gdbm>=1.11-2' 'libffi>=3.2.1' 'ncurses>=6.0-3' 'gmp>=6.1.0-2')
groups=('devel')
archs=('i686' 'x86_64' 'arm')
_F_archive_grepv="preview"
up2date="Flasttar ftp://ftp.ruby-lang.org/pub/ruby/"
source=(ftp://ftp.ruby-lang.org/pub/ruby/ruby-${pkgver}$pkgpatch.tar.xz)
sha1sums=('83499c14c674cf2d88e495031434a94c06330879')
replaces=('rake' 'racc' 'rdoc')
provides=("${replaces[@]}")
conflicts=("${replaces[@]}")

options+=('static')

if Fuse $USE_TK; then
	makedepends+=('x11-protos')
	subpkgs+=("$pkgname-tk")
	subdescs+=("Ruby support for tk/tcl")
	subgroups+=('xlib-extra')
	subdepends+=('tk>=8.6.4')
	subrodepends+=("$pkgname>=$pkgver")
	subarchs=('i686 x86_64 arm')
fi


build() {

	Fcd ruby-$pkgver$pkgpatch
	Fbuild \
		--enable-shared --enable-pthread

	if Fuse $USE_TK; then
		Fsplit $pkgname-tk  usr/lib/$pkgname/$rubyver/{tk/,tkextlib/}
		Fsplit $pkgname-tk  usr/lib/$pkgname/$rubyver/*tk*.rb
		Fsplit $pkgname-tk  usr/lib/$pkgname/$rubyver/*-linux/*tk*.so
	fi
}

# optimization OK
