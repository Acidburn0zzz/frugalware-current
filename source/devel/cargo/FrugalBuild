# Compiling Time: 0.11 SBU
# Maintainer: crazy <crazy@frugalware.org>

pkgname=cargo
pkgver=0.15.0
pkgrel=1
pkgdesc="The Rust package manager."
url="https://crates.io/"
depends=('rust>=1.14.0' 'curl' 'openssl')
makedepends=('curl' 'python' 'perl' 'jemalloc' 'git' 'llvm>=3.9.0' 'cmake')
groups=('devel')
archs=("x86_64")
_F_github_author="rust-lang"
_F_github_tag="yes"
Finclude github
## we use this to bootstrap.. withoout we need have an makedepnd on self ... weird..
#source+=(https://static.rust-lang.org/cargo-dist/cargo-nightly-x86_64-unknown-linux-gnu.tar.gz)
source+=(https://static.rust-lang.org/cargo-dist/2016-09-01/cargo-nightly-x86_64-unknown-linux-gnu.tar.gz)
sha1sums=('9b7db61f914851ee904b48a2e9e0bed5cfb5e3b4' \
          '5f5e33bd67354f6d6669c5843888029c671da539')
options+=('static' 'nostrip' 'noversrc')

build() {

	## such a ..
	Fcd
	## fix installer stuff missing from tarball
	Fexec cd src || Fdie
	Fexec rm -rfv rust-installer || Fdie
	git clone https://github.com/rust-lang/rust-installer.git

	## let us try now :)
	Fexec cd .. || Fdie

	CARGO_BIN="cargo-nightly-x86_64-unknown-linux-gnu/cargo/bin/cargo"

	### set verbose
	_F_make_opts+=" VERBOSE=1"

	Fbuild  \
		--rustc=/usr/bin/rustc \
		--rustdoc=/usr/bin/rustdoc \
		--cargo=$Fsrcdir/$CARGO_BIN \
		--sysconfdir=/etc \
		--disable-debug \
		--disable-verify-install \
		--disable-cross-tests \
		--enable-optimize \
		--local-rust-root=/usr \
		--build=x86_64-unknown-linux-gnu \
		--target=x86_64-unknown-linux-gnu \
		--host=x86_64-unknown-linux-gnu

	## conflicts
	Frm usr/lib/rustlib

	## broken PATH
	Fmv usr/etc etc

}

# optimization ok
