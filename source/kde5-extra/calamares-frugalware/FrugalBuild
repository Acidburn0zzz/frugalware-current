# Compiling Time: 0.42 SBU
# Maintainer: DeX77 <dex77@frugalware.org>

pkgname=calamares-frugalware
pkgver=3.1.6
pkgrel=2
pkgdesc="Distribution-independent installer framework"
archs=("x86_64")
groups=('kde5-extra')
_F_github_name="calamares"
_F_github_tag_v=y
_F_kde_defaults=0
Finclude kf5 github
source+=(calamares-locale.service  \
	calamares-locale-setup \
	calamares-frugalware.svg \
	49-nopasswd_calamares.rules \
	0001-packages-virtualbox-and-pacman-flags-workarounds.patch \
	0002-workaround-vbox-with-efi.patch \
	https://github.com/abucodonosor/calamares/commit/85ceb5d150a72bc12316a2d7e8884b6a6c5d135d.patch \
	https://github.com/abucodonosor/calamares/commit/cd38084fecc0603170f639c17f04c5fd90d61158.patch \
	0001-import-chrootcfg-from-artix-with-some-changes.patch \
	0002-chrootcfg-our-pacman-doesn-t-have-cachedir-args.patch \
	0003-chrootcfg-remove-dbpatch-too.patch \
	0004-chrootcfg-added-noarch-noprogressbar-to-install.patch \
	0005-chrootcfg-remove-stuff-we-cannot-yet-use.patch \
	0006-chrootcfg-move-Vbox-hack-over-from-packages.patch)
depends=('kpmcore>=3.1.2' 'qt5-webengine>=5.9.1' 'pyqt5-python3>=5.9' 'libboost' \
	"kcoreaddons>=$_F_kf5_full" "kconfig>=$_F_kf5_full" \
	"ki18n>=$_F_kf5_full" "kiconthemes>=$_F_kf5_full" \
	"kio>=$_F_kf5_full" "kservice>=$_F_kf5_full" "kparts>=$_F_kf5_full")
makedepends+=('qt5-tools>=5.9.1' 'boost' 'yaml-cpp')
rodepends=('rsync' 'squashfs')
_F_cd_path="calamares-$pkgver"
sha1sums=('45c3078cfe04f1c6e6b041687c16709a587b5f5f' \
          'a496ee65a14fad4c96fe2a51d59f5769a9286411' \
          'abd9098e0b3f988182a4b0f3173bffb9f0f7c215' \
          '134ca1a53f3b628ba459ec450e84ea0b4f0c11f2' \
          'ac15c2fdb3c1bd2116b72f21e9ac2fd5828d1290' \
          '67fead29419ba303c096a0473d23b701e321e760' \
          '8ea80c581ca29a49e685c4809bac03e8c607e555' \
          '8b11b503288d4c947cf2042fb2c4278a215b88aa' \
          '37b9dee3185a49709aa2660dcabf115e341f983a' \
          '9896ed56fecd29ec603359e175b04c550193a4ef' \
          '3e44e12215cc8fd4bf60797574fa713307f519ad' \
          'da189d57e1a4ed6608b8b6c3b80730fb2187910c' \
          '299b99bd9f449aa33f619d471c774d575863e051' \
          'ee910ad3a82ff3d63e9f099fbddbb0199fcf34c7' \
          '145eca3d6b7e49bf88cb45bafdc186b25584eb82')

## don't install stuff we never need..
## - dummy* -- no need to be installed
## - initcpio* -- Arch stuff
## - initram* -- Debian stuff
## - plymouthcfg -- not supported by us

build() {

	Fcd
	## fix sessions localtion
	Fsed 'usr/share/xsessions' 'etc/X11/sessions' src/modules/displaymanager/main.py
	KDE_build -DSKIP_MODULES="dummycpp dummyprocess dummypython dummypythonqt initcpio initcpiocfg initramfs initramfscfg plymouthcfg"

	## stuff we need for live
	Finstall 0644 etc/polkit-1/rules.d/49-nopasswd_calamares.rules

	Finstall 644 lib/systemd/system/calamares-locale.service
	Finstall 755 usr/lib/fvbe/calamares-locale-setup

	## remove desktop file we add an custom one
	Frm usr/share/applications/calamares.desktop

	## E is special need to Fsed in fvbe .. grmpf
	Finstall 0644 usr/share/icons/hicolor/scalable/apps/calamares-frugalware.svg

	## sudo to exec cala
	Fmkdir /etc/sudoers.d
	Fexec echo "live ALL=(ALL) NOPASSWD: ALL" > $pkgname-live
	Finstallrel 440 /etc/sudoers.d/$pkgname-live

}
# optimization OK

