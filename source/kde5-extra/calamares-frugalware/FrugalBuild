# Compiling Time: 0.42 SBU
# Maintainer: DeX77 <dex77@frugalware.org>

pkgname=calamares-frugalware
pkgver=3.1.3
pkgrel=4
pkgdesc="Distribution-independent installer framework"
archs=("x86_64")
groups=('kde5-extra')
_F_github_name="calamares"
_F_github_tag_v=y
_F_kde_defaults=0
Finclude kf5 github
source+=(calamares-locale.service  \
	calamares-locale-setup \
	0001-packages-rework-workaround-patch.patch \
	calamares-frugalware.desktop \
	calamares-frugalware.svg 49-nopasswd_calamares.rules)
depends=('kpmcore>=3.1.2' 'qt5-webengine>=5.9.1' 'pyqt5-python3>=5.9' 'libboost' \
	"kcoreaddons>=$_F_kf5_full" "kconfig>=$_F_kf5_full" \
	"ki18n>=$_F_kf5_full" "kiconthemes>=$_F_kf5_full" \
	"kio>=$_F_kf5_full" "kservice>=$_F_kf5_full" "kparts>=$_F_kf5_full")
makedepends+=('qt5-tools>=5.9.1' 'boost' 'yaml-cpp')
rodepends=('rsync' 'squashfs')
_F_cd_path="calamares-$pkgver"
sha1sums=('7cf6eaff31538e3ea91d49a69ef96dee172e5739' \
          'a496ee65a14fad4c96fe2a51d59f5769a9286411' \
          'abd9098e0b3f988182a4b0f3173bffb9f0f7c215' \
          '420f3ee3cef0549dc2230853720174619c4a803f' \
          '10a6590d410507c48ed84876ff2ebd380c793034' \
          '134ca1a53f3b628ba459ec450e84ea0b4f0c11f2' \
          '02e4c49a4ff57712ffa94dbb79abc1dd701692c7')

build() {

	Fcd
	## fix sessions localtion
	Fsed 'usr/share/xsessions' 'etc/X11/sessions' src/modules/displaymanager/main.py
	KDE_build

	## stuff we need for live
	Finstall 0644 etc/polkit-1/rules.d/49-nopasswd_calamares.rules

	Finstall 644 lib/systemd/system/calamares-locale.service
	Finstall 755 usr/lib/fvbe/calamares-locale-setup

	## remove desktop file we add an custom one
	Frm usr/share/applications/calamares.desktop

	## E is special need to Fsed in fvbe .. grmpf
	Finstall 0644  usr/share/applications/calamares-frugalware.desktop
	Finstall 0644 usr/share/icons/hicolor/scalable/apps/calamares-frugalware.svg

	## sudo to exec cala .. pkexec doesn't work on gnome for some reason
	Fmkdir /etc/sudoers.d
	Fexec echo "guest ALL=(ALL) NOPASSWD: /usr/bin/calamares" > $pkgname-guest
	Finstallrel 440 /etc/sudoers.d/$pkgname-guest
	# FIXME-> touch files we use in fvbe so -R $pkgname will clean these

}
# optimization OK

