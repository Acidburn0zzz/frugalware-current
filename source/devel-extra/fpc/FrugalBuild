# Compiling Time: 1.14 SBU
# Maintainer: Christian Hamar alias krix <krics@linuxforum.hu>

pkgname=fpc
pkgver=2.2.4
pkgrel=2
pkgdesc="FreePascal Compiler"
url="http://www.freepascal.org"
depends=('gpm>=1.20.5-2')
makedepends=('fpc-bin' 'tetex' 'gtk+2')
groups=('devel-extra')
conflicts=('fpc-bin')
archs=('i686' 'x86_64')
up2date="lynx -dump $url |grep 'latest stable' |sed 's/.*Version \(.*\) is.*/\1/'"
backup=('etc/fpc.cfg')
source=(ftp://ftp.freepascal.org/pub/fpc/dist/$pkgver/source/${pkgname}build-$pkgver.tar.gz fpc.cfg)
sha1sums=('9ea373ad4be152b67a249784f69cfd23702e61fe'\
          'be0efabb7ece8efcbf9b05bf7449cfa26c2d0c2e')

build() {
	unset MAKEFLAGS
	# define binary name
	if [ "$CARCH" == "x86_64" ]; then
		ppcname="ppcx64"
	else
		ppcname="ppc386"
	fi
	Fcd ${pkgname}build-${pkgver}
	NEWPP=`pwd`/fpcsrc/compiler/$ppcname
	NEWFPDOC=`pwd`/fpcsrc/utils/fpdoc/fpoc
        make NOGDB=1 all || Fdie
	NEWPP=`pwd`/fpcsrc/compiler/$ppcname
	INSTALLOPTS="FPC=${NEWPP} INSTALL_PREFIX=$Fdestdir/usr"
        make $INSTALLOPTS NOGDB=1 install || Fdie
        Fln /usr/lib/fpc/$pkgver/$ppcname /usr/bin/$ppcname
	Ffile /etc/fpc.cfg
}

# optimization OK
