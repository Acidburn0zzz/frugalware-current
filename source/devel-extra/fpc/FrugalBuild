# Last Modified: Sun, 18 Sep 2005 01:13:30 +0200
# Compiling Time: ~1.01 SBU
# Maintainer: Christian Hamar alias krix <krics@linuxforum.hu>

pkgname=fpc
pkgver=2.0.0
pkgrel=1
pkgdesc="FreePascal Compiler"
url="http://www.freepascal.org"
depends=('gpm')
makedepends=('fpc-bin' 'tetex')
groups=('devel-extra')
conflicts=('fpc-bin')
archs=('i686' 'x86_64')
up2date="lynx -dump $url |grep 'latest stable' |sed 's/.*Version \(.*\) is.*/\1/'"
source=(ftp://ftp.freepascal.org/pub/fpc/dist/source-$pkgver/$pkgname-$pkgver.source.tar.gz)
sha1sums=('074dc87fdc866c0380e8b836be9b16d1931d8228')
GZIP=1

build()
{
# define ppc
if [ "$CARCH" == "x86_64" ]; then
	ppcname="ppcx86"
  else
	ppcname="ppc386"
fi
	Fcd $pkgname || return 1
# making fpc all component
	NEWPP=`pwd`/compiler/$ppcname || return 1 
	NEWFPDOC=`pwd`/utils/fpdoc/fpdoc || return 1
        make compiler_cycle || return 1
        make rtl_clean rtl_smart FPC=${NEWPP} || return 1
        make packages_base_smart FPC=${NEWPP} || return 1
        make fcl_smart FPC=${NEWPP} || return 1
        make fv_smart FPC=${NEWPP} || return 1
        make packages_extra_smart FPC=${NEWPP} || return 1
        make ide_all FPC=${NEWPP} || return 1
        make utils_all FPC=${NEWPP} || return 1
	make demo FPC=${NEWPP} || return 1
if [ -z ${NODOCS} ]; then
        make -C docs pdf FPC=${NEWPP} FPDOC=${NEWFPDOC} || return 1
fi
# installing component
	NEWPP=`pwd`/compiler/$ppcname 
	INSTALLOPTS="FPC=${NEWPP} INSTALL_PREFIX=$Fdestdir/usr" || return 1
        make compiler_distinstall ${INSTALLOPTS} || return 1
        make rtl_distinstall ${INSTALLOPTS} || return 1
        make packages_distinstall ${INSTALLOPTS} || return 1
        make fcl_distinstall ${INSTALLOPTS} || return 1
        make fv_distinstall ${INSTALLOPTS} || return 1
        make ide_distinstall ${INSTALLOPTS} || return 1
        make utils_distinstall ${INSTALLOPTS} || return 1
        make doc_install ${INSTALLOPTS} || return 1
        make man_install ${INSTALLOPTS} INSTALL_MANDIR=$Fdestdir/usr/man || return 1
if [ -z ${NODOCS} ]; then
        make -C docs pdfinstall ${INSTALLOPTS} INSTALL_DOCDIR=$Fdestdir/usr/share/doc/$pkgname-$pkgver || return 1
fi
# create symlink
        Fln /usr/lib/fpc/$pkgver/$ppcname /usr/bin/$ppcname 
}

# optimalization OK

# vim: ft=sh
