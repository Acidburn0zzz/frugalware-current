# Compiling Time: 0.27 SBU
# Maintainer: DeX77 <dex77@frugalware.org>

pkgname=lucene
pkgver=6.0.1
pkgrel=1
pkgdesc="High-performance, full-featured text search engine written entirely in Java"
url="http://jakarta.apache.org/$pkgname/"
Finclude openjava
depends=(${depends[@]} 'apache-ivy' 'hamcrest' 'icu4j' 'commons-codec')
makedepends=(${makedepends[@]} 'junit')
groups=('devel-extra')
archs=('i686' 'x86_64')
up2date="Flastverdir http://apache.openmirror.de/$pkgname/java/ "
source=(http://apache.openmirror.de/$pkgname/java/$pkgver/$pkgname-$pkgver-src.tgz)
sha1sums=('dd2cf427f86be53c3d15a33ab55d84ff3608b387')

replaces=('lucene3')
conflicts=('lucene3')
provides=('lucene3')

build() {
        Fcd lucene-$pkgver
        Fjavacleanup

	#fixing these so it's won't "resolve" anything
        Fsed 'depends="resolve"' 'depends="ivy-availability-check,ivy-fail"' common-build.xml

	for i in $(find -name build.xml)
	do
	        Fsed 'resolve-icu,' '' $i
	done

	Fant
	cd analysis || Fdie
	Fant -v common kuromoji smartcn stempel
	
	cd .. || Fdie
        for i in $(find build -name *.jar)
        do
                nover=$(echo $i|sed 's/-[0-9\.]*-SNAPSHOT//')
                mv $i $nover
                Fjar $nover
        done
}

# optimization OK
