# Compiling Time: 6.34 SBU
# Maintainer: VMiklos <vmiklos@frugalware.org>

pkgname=sbcl
pkgver=1.0.15
pkgrel=1
pkgdesc="Steel Bank Common Lisp"
url="http://sbcl.sourceforge.net/"
depends=('glibc')
makedepends=('sbcl')
groups=('devel-extra')
archs=('i686' 'x86_64')
_F_sourceforge_ext="-source.tar.bz2"
Finclude sourceforge
source=($source no_local_lib_please.patch)
sha1sums=('4d3357f56e6f600cae0ac3f78111fccd5aeb7473' \
          '29df2f80163179eb2c38d22836e9ed8c0778bfd2')

build()
{
	Fcd
	Fpatchall
	find . -name "CVS" | xargs rm -rf 
	find . -name "*cvsignore"  | xargs rm -rf
	export INSTALL_ROOT=$Fdestdir/usr
	Fmkdir /usr/share/man/man1
	Fsed '\(CFLAGS =\)  -g -Wall -O3' "\1 $CFLAGS" src/runtime/GNUmakefile
	# remove broken modules
	rm -rf contrib/{sb-bsd-sockets,sb-simple-streams,asdf-install}

	sh make.sh || Fdie

	unset SBCL_HOME
	sh install.sh
	Fmv /usr/share/doc/$pkgname /usr/share/doc/$pkgname-$pkgver
}

# optimization OK
