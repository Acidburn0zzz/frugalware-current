# Compiling Time: 0.96 SBU
# Maintainer: Miklos Vajna <vmiklos@frugalware.org>

USE_GUI=${USE_GUI:-"y"}

pkgname=python-2.5
pkgver=2.5.4
shortpkgver=2.5 # 2.3 if $pkgver=2.3.4
pkgrel=1
pkgdesc="A high-level scripting language"
url="http://www.python.org"
depends=('glibc>=2.8-3' 'db>=4.7.25-2' 'bzip2>=1.0.5-2' 'gdbm>=1.8.3-5' 'openssl>=0.9.8-14' 'glib2>=2.16.4-2' 'sqlite3')
Fuse $USE_GUI && makedepends=('tk>=8.5' 'gtk+2')
groups=('devel-extra')
archs=('i686' 'x86_64' 'ppc')
options=('scriptlet')
up2date="lynx -dump $url/download/|grep '2\.5'|sed -n 's|.*/\(.*\)/|\1|;$ p'"
source=(http://www.python.org/ftp/python/$pkgver/Python-$pkgver.tar.bz2 \
	Python-2.4.1-gdbm-1.patch \
	insecure_pathnames.diff)
sha1sums=('0f2e819d6381f72f26c734e00a6780b3933ea404' \
          '1921b4b797df9ab180991879f8091c7f2de589e1' \
          '70906abf73dae83a02fbd39abbf40ff551a5a2ab')

[ "$CARCH" == "x86_64" ] && export CFLAGS="$CFLAGS -fPIC"

build()
{
	Fcd Python-$pkgver
	Fpatchall
	# if this is no longer necessary, don't remove it, just comment, it's
	# required regularly
	Fsed 'max_db_ver = (4, 5)' 'max_db_ver = (4, 6)' setup.py
	Fconf --prefix=/usr --with-threads --enable-shared --enable-ipv6 || return 1
	Fsed 'mozilla-firefox' 'firefox' Lib/webbrowser.py
	make || return 1
	Fmakeinstall
	Frm /usr/bin/python
	for i in idle pydoc python-config smtpd.py
	do
		Fmv /usr/bin/$i{,$shortpkgver}
	done
	Fmv /usr/share/man/man1/python{,$shortpkgver}.1
	for f in Tools/* ; do
		if [ -d $f ] ; then
			Fcp Python-$pkgver/$f /usr/lib/python$shortpkgver/site-packages/ || Fdie
		fi
	done
}

# optimization OK
