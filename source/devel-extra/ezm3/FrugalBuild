# Compiling Time: 0.01 SBU
# Maintainer: VMiklos <vmiklos@frugalware.org>

pkgname=ezm3
target=LINUXLIBC6
pkgver=1.2
pkgrel=1
pkgdesc="Stripped down m3 compiler for building cvsup"
url="ftp://ftp.freebsd.org/pub/FreeBSD/development/CVSup/ezm3/"
depends=('glibc')
groups=('devel-extra')
archs=('i686' '!x86_64')
up2date="lynx -dump $url |grep src.tar.bz2$ |sed -n 's/.*-\(.*\)-.*/\1/;$ p'"
source=($url/$pkgname-$pkgver-src.tar.bz2 \
	$url/$pkgname-$pkgver-$target-boot.tar.bz2)
sha1sums=('2a284baac3be18a17e1fa49ab3b0b346f1a5dd68' \
          'de6080f0e3e2bf6c2ac8a26f975b1cfe6789f483')

# will NOT build on amd64: x86 and ppc only

build()
{
	Fsed '^#!/bin/sh' '#!/bin/bash' \
		language/modula3/m3compiler/m3cc/gcc/configure
	Fsed '/usr/local' "/usr" m3config/src/$target
	echo "M3CC_MAKE = [\"make\", \"BISON=yacc\"]" >> m3config/src/$target
	Fsed '/usr/local' '/usr' m3config/src/COMMON
	Fsed 'touch' 'ranlib' m3config/src/COMMON
	# higher optimizations would cause issues
	CFLAGS=`echo $CFLAGS|sed 's/-O./-O/'`
	
	make exportall || return 1
	
	cp -a binaries/$target/usr $Fdestdir/
}

# optimalization ok
