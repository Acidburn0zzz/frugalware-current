From 015fab69f597de2ff909ec7a7a07f7fa0007f4d9 Mon Sep 17 00:00:00 2001
From: Michael Koziarski <michael@koziarski.com>
Date: Wed, 13 Nov 2013 16:14:07 +1300
Subject: [PATCH] Escape the unit value provided to number_to_currency

Fixes CVE-2013-6415

--- ruby-actionpack-3.2.orig/lib/action_view/helpers/number_helper.rb
+++ ruby-actionpack-3.2/lib/action_view/helpers/number_helper.rb
@@ -144,7 +144,7 @@ module ActionView
 
         begin
           value = number_with_precision(number, options.merge(:raise => true))
-          format.gsub(/%n/, value).gsub(/%u/, unit).html_safe
+          format.gsub(/%n/, ERB::Util.html_escape(value)).gsub(/%u/, ERB::Util.html_escape(unit)).html_safe
         rescue InvalidNumberError => e
           if options[:raise]
             raise
