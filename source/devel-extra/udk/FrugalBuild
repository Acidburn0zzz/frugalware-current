# Compiling Time: 1 SBU
# Maintainer: James Buren <ryuo@frugalware.org>

pkgname=udk
pkgver=20131105
pkgrel=1
pkgdesc="UEFI Development Kit from TianoCore Project"
url="http://tianocore.sourceforge.net"
depends=('iasl' 'python-sqlite3')
options=('nomirror')
groups=('devel-extra')
archs=('!i686' 'x86_64')
up2date="$pkgver"
source=(http://ftp.frugalware.org/pub/other/sources/$pkgname/$pkgname-$pkgver.tar.xz qemu-uefi config.patch)
sha1sums=('2e50d89c8b9319d95e7a157e6e1796f90492a512' \
          'fdb3256b91800012e5f2037d3c425bd8e025ed44' \
          '81c94be96713e32150ae577712812dbc8f723591')

subpkgs=("qemu-uefi")
subdescs=("Binary images for UEFI emulation in QEMU.")
subgroups=("lib-extra")
subrodepends=("qemu")
subarchs=("${archs[*]}")

# As these are not regular binaries, DISABLE OUR BUILD FLAGS.
unset CFLAGS
unset CXXFLAGS
unset LDFLAGS
unset MAKEFLAGS

build()
{
	Fcd $pkgname
	Fpatchall
	Fmkdir -p /usr/src/udk
	for i in *; do
		Fcprel $i /usr/src/udk
	done
	Fexec source edksetup.sh || Fdie
	Fexec make -C BaseTools || Fdie
	Fexec BaseTools/BinWrappers/PosixLike/build -p MdeModulePkg/MdeModulePkg.dsc || Fdie
	Fexec BaseTools/BinWrappers/PosixLike/build -p OvmfPkg/OvmfPkgX64.dsc || Fdie
	Ffilerel Build/OvmfX64/RELEASE_GCC47/FV/OVMF.fd /usr/share/qemu/uefi.bin
	Fexe /usr/bin/qemu-uefi
	Fsplit qemu-uefi /usr/share/qemu
}

# optimization OK
