# Compiling Time: 0.36 SBU
# Maintainer: VMiklos <vmiklos@frugalware.org>

pkgname=git
pkgver=1.5.2.3
pkgrel=2
pkgdesc="the stupid content tracker"
url="http://www.kernel.org/pub/software/scm/git/"
depends=('curl>=7.16.0' 'openssl')
makedepends=('asciidoc' 'docbook-xsl' 'docbook-xml' 'sgml-common' 'xmlto')
groups=('devel-extra')
archs=('i686' 'x86_64')
up2date="lynx -dump '$url/?C=M;O=D'|grep bz2$|sed -n 's/.*-\(.*\)\.t.*/\1/;1 p'"
source=($url/$pkgname-$pkgver.tar.bz2 \
gitweb.modules.d gitweb.conf README.Frugalware)
signatures=(${source[0]}.sign '' '' '')
options=('scriptlet')

subpkgs=('gitweb' 'gitk')
subdescs=('Web interface for Git.' 'Tk based git repository browser')
subdepends=("git=$pkgver" "git=$pkgver tk")
subbackup=('etc/gitweb.conf etc/httpd/conf/modules.d/gitweb.conf' '')
subgroups=('network-extra' 'xapps-extra')
subarchs=('i686 x86_64' 'i686 x86_64')

build()
{
	Fsed '^\(CFLAGS =\) .*' "\1 $CFLAGS" Makefile
	# fix path, we do not put the contrib dir to the documentation folder
	Fsed 'doc/' '' templates/hooks--post-receive
	make configure || return 1
	Fmkdir /usr/bin
	Fpatchall
	Fconf
	make ASCIIDOC8=YesPlease all doc || return 1
	Fmakeinstall install-doc
	make -C Documentation WEBDOC_DEST=$Fdestdir/usr/share/doc/$pkgname-$pkgver/html install-webdoc || return 1
	Fdocrel Documentation/SubmittingPatches
	Fdocrel Documentation/technical

	# libgit
	Ffilerel /usr/lib/libgit.a
	Ffilerel *.h /usr/include/git/

	# contrib dir
	Fcprrel contrib /usr/share/git-core/

	# gitweb
	Fmkdir /var/www/gitweb
	cp gitweb/git* $Fdestdir/var/www/gitweb
	Ffile gitweb.modules.d /etc/httpd/conf/modules.d/gitweb.conf
	Ffile /etc/gitweb.conf
	Fsplit gitweb /etc /var
	Fdoc README.Frugalware

	# gitk
	Fsplit gitk usr/bin/gitk
}


# optimization OK
