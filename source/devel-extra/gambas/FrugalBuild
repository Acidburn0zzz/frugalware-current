# Compiling Time: 10 SBU
# Maintainer: Marius Cirsta <mcirsta@frugalware.org>
# Contributor: James Buren <ryuo@frugalware.org>


## FIXME please please FIXME -- crazy --
## Qt5 - missing ( core , gui , webkit )
## gst-1 missing so no gambas-media
## gst1-video - missing
## gtk3 missing along other stuff
## openal missing..
## Qt4 - DIE DIE DIE
## WTF THIS Faddsubpkg ? Who added this at ALL .. plese fix
## sdl2 doesn replace sdl these are 2 different modules
## MAYBE more but ...

pkgname=gambas
pkgver=3.9.0
pkgrel=1
pkgdesc="A full-featured object language built on a BASIC interpreter."
depends=('dbus' 'libffi>=3.2.1' 'llvm>=3.4.2-2')
groups=('devel-extra')
archs=('i686' 'x86_64')
_F_sourceforge_name=${pkgname}3
_F_sourceforge_ext=.tar.bz2
Finclude sourceforge
sha1sums=('191a1bc273e13771334affdb7de56fb3c8bba402')
makedepends=('postgresql' 'x11-protos')

replaces=("$pkgname-v4l" "$pkgname-ide")
provides=("$pkgname-v4l" "$pkgname-ide")

Faddsubpkg "$pkgname-compress"      "$pkgname compress component"      "zlib bzip2"                                              "$pkgname"
Faddsubpkg "$pkgname-cairo"         "$pkgname cairo component"         "cairo bzip2 libxdamage"                                  "$pkgname"
Faddsubpkg "$pkgname-crypt"         "$pkgname crypt component"         "glibc"                                                   "$pkgname"
Faddsubpkg "$pkgname-db-mysql"      "$pkgname db sql component"        "libmysqlclient libstdc++"                                "$pkgname"
Faddsubpkg "$pkgname-db-odbc"       "$pkgname db odbc component"       "unixodbc"                                                "$pkgname"
Faddsubpkg "$pkgname-db-postgresql" "$pkgname db postgresql component" "libpq"                                                   "$pkgname"
Faddsubpkg "$pkgname-db-sqlite3"    "$pkgname db sqlite3 component"    "sqlite3>=3.13.0 libstdc++"                               "$pkgname"				"$pkgname-db-sqlite2"	"$pkgname-db-sqlite2"
Faddsubpkg "$pkgname-desktop"       "$pkgname desktop component"       "libxtst libsm libgnome-keyring>=3.10.1-2"                "$pkgname"
Faddsubpkg "$pkgname-gtk"           "$pkgname gtk component"           "gtk+2 librsvg"                                           "$pkgname"
Faddsubpkg "$pkgname-image-io"      "$pkgname image io component"      "gdk-pixbuf2"                                             "$pkgname"
Faddsubpkg "$pkgname-image-imlib"   "$pkgname image imlib component"   "imlib2"                                                  "$pkgname"
Faddsubpkg "$pkgname-net"           "$pkgname net component"           "curl>=7.50.1 glib2"                                      "$pkgname"
Faddsubpkg "$pkgname-opengl"        "$pkgname opengl component"        "glew>=2.0.0 libdrm libxdamage"                           "$pkgname"
Faddsubpkg "$pkgname-pcre"          "$pkgname pcre component"          "pcre"                                                    "$pkgname"
Faddsubpkg "$pkgname-pdf"           "$pkgname pdf component"           "poppler>=0.46.0 bzip2"                                   "$pkgname"
Faddsubpkg "$pkgname-qt4"           "$pkgname qt4 component"           "libqtopengl libqtwebkit libqt3support bzip2 libqtscript" "$pkgname"
Faddsubpkg "$pkgname-sdl2"          "$pkgname sdl component"           "sdl2 sdl2_ttf sdl2_image sdl2_mixer glew>=2.0.0 bzip2"   "$pkgname"				"$pkgname-sdl"		"$pkgname-sdl"
Faddsubpkg "$pkgname-xml"           "$pkgname xml component"           "libxslt"                                                 "$pkgname"

Fconfopts="	--enable-v4l=false"

build()
{
	split_component()
	{
		Fsplit "$pkgname-$1" /usr/{lib/${pkgname}3,share/${pkgname}3/info}/gb.${1/-/.}\*
	}

	Fcd ${pkgname}3-$pkgver
	for i in $(grep -rl '\-Os' *); do
		Fsed "-Os" "$CFLAGS" $i
	done

	Fautoreconf
	Fmake
	Fmakeinstall -j1 XDG_UTILS=''

	Ffilerel app/desktop/${pkgname}3.png     /usr/share/pixmaps/${pkgname}3.png
	Ffilerel app/desktop/${pkgname}3.desktop /usr/share/applications/${pkgname}3.desktop
	split_component compress
	split_component cairo
	split_component crypt
	split_component db-mysql
	split_component db-odbc
	split_component db-postgresql
	split_component db-sqlite3
	split_component desktop
	Fsplit $pkgname-desktop /usr/share/${pkgname}3/control/gb.desktop
	split_component gtk
	split_component image-io
	split_component image-imlib
	split_component net
	split_component opengl
	split_component pcre
	split_component pdf
	split_component qt4
	split_component sdl2
	split_component xml
}

# optimization OK
