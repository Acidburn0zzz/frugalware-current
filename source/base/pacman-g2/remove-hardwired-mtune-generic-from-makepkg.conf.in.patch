From d11f69810d0b6c470127ca41a6015ad41ffa462e Mon Sep 17 00:00:00 2001
From: Miklos Vajna <vmiklos@frugalware.org>
Date: Tue, 12 Aug 2008 19:06:29 +0200
Subject: [PATCH] remove hardwired -mtune=generic from makepkg.conf.in

move it to configure.ac, as it's x86-specific
---
 configure.ac        |   47 +++++++++++------------------------------------
 etc/makepkg.conf.in |    4 ++--
 2 files changed, 13 insertions(+), 38 deletions(-)

diff --git a/configure.ac b/configure.ac
index 12b0483..31cadc6 100644
--- a/configure.ac
+++ b/configure.ac
@@ -93,48 +93,24 @@ AC_ARG_WITH(chost, AC_HELP_STRING([--with-chost], [Build with a specific CHOST (
 
 dnl Check for architecture
 case "$host" in
-	i686-*) AC_DEFINE_UNQUOTED([CARCH], ["i686"], [Architecture])
-		AC_DEFINE_UNQUOTED([CARCHFLAGS], ["i686"], [Architecture])
-		AC_DEFINE_UNQUOTED([MARCHFLAG], ["march"], [Architecture])
-		CARCH="i686"
-		CARCHFLAGS="i686"
-		MARCHFLAG="march"
+	i686-*) CARCH="i686"
+		CARCHFLAGS="-march=i686 -mtune=generic"
 		;;
-	x86_64-*) AC_DEFINE_UNQUOTED([CARCH], ["x86_64"], [Architecture])
-		AC_DEFINE_UNQUOTED([CARCHFLAGS], ["x86-64"], [Architecture])
-		AC_DEFINE_UNQUOTED([MARCHFLAG], ["march"], [Architecture])
-		CARCH="x86_64"
-		CARCHFLAGS="x86-64"
-		MARCHFLAG="march"
+	x86_64-*) CARCH="x86_64"
+		CARCHFLAGS="-march=x86-64 -mtune=generic"
 		;;
-	ia64-*) AC_DEFINE_UNQUOTED([CARCH], ["ia64"], [Architecture])
-		AC_DEFINE_UNQUOTED([CARCHFLAGS], ["ia64"], [Architecture])
-		AC_DEFINE_UNQUOTED([MARCHFLAG], ["march"], [Architecture])
-		CARCH="ia64"
-		CARCHFLAGS="ia64"
-		MARCHFLAG="march"
+	ia64-*) CARCH="ia64"
+		CARCHFLAGS="-march=ia64 -mtune=generic"
 		;;
-	sparc-*) AC_DEFINE_UNQUOTED([CARCH], ["sparc"], [Architecture])
-		AC_DEFINE_UNQUOTED([CARCHFLAGS], ["v9"], [Architecture])
-		AC_DEFINE_UNQUOTED([MARCHFLAG], ["mcpu"], [Architecture])
-		CARCH="sparc"
-		CARCHFLAGS="v9"
-		MARCHFLAG="mcpu"
+	sparc-*) CARCH="sparc"
+		CARCHFLAGS="-mcpu=v9"
 		;;
 	ppc-* | powerpc-*)
-		AC_DEFINE_UNQUOTED([CARCH], ["ppc"], [Architecture])
-		AC_DEFINE_UNQUOTED([CARCHFLAGS], ["750"], [Architecture])
-		AC_DEFINE_UNQUOTED([MARCHFLAG], ["mcpu"], [Architecture])
 		CARCH="ppc"
-		CARCHFLAGS="750"
-		MARCHFLAG="mcpu"
+		CARCHFLAGS="-mcpu=powerpc -mtune=powerpc"
 		;;
-	i386-*) AC_DEFINE_UNQUOTED([CARCH], ["i386"], [Architecture])
-		AC_DEFINE_UNQUOTED([CARCHFLAGS], ["i386"], [Architecture])
-		AC_DEFINE_UNQUOTED([MARCHFLAG], ["march"], [Architecture])
-		CARCH="i386"
-		CARCHFLAGS="i386"
-		MARCHFLAG="march"
+	i386-*) CARCH="i386"
+		CARCHFLAGS="-march=i386 -mtune=generic"
 		;;
 	*)
 		AC_MSG_ERROR([Your architecture is not supported])
@@ -150,7 +126,6 @@ fi
 
 AC_SUBST(CARCH)
 AC_SUBST(CARCHFLAGS)
-AC_SUBST(MARCHFLAG)
 AC_SUBST(CHOST)
 
 dnl Build with Werror
diff --git a/etc/makepkg.conf.in b/etc/makepkg.conf.in
index 9b97afe..b8910a3 100644
--- a/etc/makepkg.conf.in
+++ b/etc/makepkg.conf.in
@@ -17,8 +17,8 @@ export CHOST="@CHOST@"
 # will use the P6 instruction set and only run on P6+ systems)
 # As of GCC 4.2 -mtune=generic can be used to generate code running well on
 # common x86 chips.
-export CFLAGS="-@MARCHFLAG@=@CARCHFLAGS@ -mtune=generic -O2 -pipe"
-export CXXFLAGS="-@MARCHFLAG@=@CARCHFLAGS@ -mtune=generic -O2 -pipe"
+export CFLAGS="@CARCHFLAGS@ -O2 -pipe"
+export CXXFLAGS="@CARCHFLAGS@ -O2 -pipe"
 
 # SMP Systems
 #export MAKEFLAGS="-j2"
-- 
1.5.4.3

