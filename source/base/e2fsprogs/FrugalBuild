# Compiling time: 0.18 SBU
# Maintainer: crazy <crazy@frugalware.org>
# Contributor: Miklos Vajna <vmiklos@frugalware.org>

pkgname=e2fsprogs
pkgver=1.43
pkgrel=1
pkgdesc="Utilities needed to create and maintain ext2 and ext3 filesystems"
depends=('glibc>=2.22-7' 'libuuid>=2.27.1-3' 'libblkid>=2.27.1-3')
makedepends=('util-linux>=2.27.1-3')
rodepends=('coreutils>=8.24-4' 'util-linux>=2.27.1-3')
groups=('base' 'chroot-core')
archs=('i686' 'x86_64')
_F_sourceforge_prefix="libs-"
_F_archive_grepv="WIP"
Finclude sourceforge
source+=(testsuite.patch)
url="http://e2fsprogs.sourceforge.net/"
signatures=("$source.asc" '')

build()
{
	Fcd
	Fpatchall
	Fmake \
		--enable-elf-shlibs \
		--enable-symlink-install \
		--enable-relative-symlinks \
		--enable-symlink-build \
		--with-root-prefix="" \
		--disable-libblkid \
		--disable-libuuid \
		--disable-uuidd \
		--disable-fsck \
		--disable-e2initrd-helper \
		--enable-threads=posix

	## DO NOT BUMP BEFORE enabling this local
	## sometimes it hangs the chroot so we just test local
	## before pushing
	## make check || Fdie

	make DESTDIR=$Fdestdir install install-libs || Fdie

	# conflicts with util-linux
	Frm usr/sbin/uuidd usr/share/man/man8/uuidd.8
}

# optimization OK
