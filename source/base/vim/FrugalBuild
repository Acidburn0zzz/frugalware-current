# Compiling Time: 0.50 SBU
# Maintainer: Miklos Vajna <vmiklos@frugalware.org>

pkgname=vim
pkgver=7.4
pkgrel=6
pkgdesc="VIM - Vi IMproved console"
url="http://www.vim.org"
depends=('ncurses>=6.0-12' 'xfsprogs-acl>=2.2.52-5')
makedepends=('python>=2.7.12-2')
groups=('base')
archs=('i686' 'x86_64')
backup=(usr/share/vim/vimrc)
up2date="lynx -dump $url/sources.php|grep bz2$|sed 's/.*-\(.*\)\.t.*/\1/;q'"
source=(ftp://ftp.vim.org/pub/vim/unix/$pkgname-$pkgver.tar.bz2 README.Frugalware \
		vim-vimrc.diff frugalware.diff)
sha1sums=('601abf7cc2b5ab186f40d8790e542f86afca86b7' \
          '50e139d94557b2ca361fed2130af103c47a8d654' \
          '985911e5902d495897105cdd1570dfe47adfa254' \
          '2a13f115db21d458a03c60e90945ef026eb24ca2')

build()
{
	Fcd vim${pkgver/.}
	Fpatchall
	cd src

	# Remove these 2 lines if the linking script is ever fixed.
	# It loops infinitely for me.
	Fexec sed -i '2 i $LINK -Wl,--as-needed' link.sh
	Fexec sed -i '3 i exit $?'           link.sh

	Fmake \
		--localstatedir=/var/lib/$pkgname \
		--disable-gpm \
		--without-x \
		--prefix=/usr \
		--enable-gui=no \
		--enable-multibyte \
		--enable-pythoninterp \
		--with-features=big
	make DESTDIR=$Fdestdir VIMRTDIR= install || return 1

	Fcp /usr/share/vim/vimrc_example.vim /usr/share/vim/vimrc
	Fdoc README.Frugalware

}
# optimization ok
