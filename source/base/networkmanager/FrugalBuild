# Compiling Time: 1.46 SBU
# Maintainer: Baste <baste@frugalware.org>
# Contributor: bouleetbil <bouleetbil@frogdev.info>

pkgname=networkmanager
_F_gnome_name=NetworkManager
pkgver=1.8.0
pkgrel=1
pkgdesc="Network Management daemon"
depends=('wireless_tools>=29-5' 'iproute2>=4.7.0-2' 'nss>=3.21-2' 'libgcrypt>=1.7.3-2' \
	'libnl>=3.2.9-2' 'ppp>=2.4.7-3' 'wpa_supplicant>=2.5-4' 'iptables' 'polkit>=0.113-9' 'ca-certificates' \
	'modemmanager>=1.6.0-2' 'libarchive>=3.0.3-2' 'dbus-glib>=0.108-2' 'libndp>=1.5-4' 'newt>=0.52.19-2' 'jansson')
makedepends=('perl-xml-parser' 'intltool' 'gobject-introspection' 'dhcpcd' 'dhclient>=4.3.3' \
	'ppp>=2.4.7-3' 'bluez' 'dnsmasq' 'pygobject3' 'pygobject3-cairo' 'gtk-doc')
rodepends=('mobile-broadband-provider-info') ## some 4G modems won't work without
groups=('base')
archs=('x86_64')
_F_gnome_ext=.tar.xz
_F_gnome_devel="n"
Finclude gnome

options+=('scriptlet')
backup=('etc/NetworkManager/NetworkManager.conf')
sha1sums=('ef387c30c8fc0a1aea7c11dc6ef20afbb8c9616c')
_F_cd_path=$_F_gnome_name-$pkgver

_F_systemd_units=(NetworkManager=e)
_F_cross32_simple="true"
_F_cross32_subdepends=('lib32-nss' 'lib32-glib2' 'lib32-libgudev' 'lib32-libnl' 'lib32-libndp' 'lib32-modemmanager' 'lib32-polkit' 'lib32-newt' 'lib32-dbus-glib' 'lib32-jansson')
_F_cross32_delete=('lib/' 'usr/share' 'usr/lib' 'var/')
Finclude systemd cross32

replaces=('cnetworkmanager')
provides=("${replaces[@]}")
conflicts=("${replaces[@]}")

Fconfopts="	--with-distro=frugalware \
		--with-crypto=nss \
		--with-systemdsystemunitdir=/lib/systemd/system \
		--with-system-ca-path=/etc/ssl/certs \
		--with-dbus-sys-dir=/etc/dbus-1/system.d \
		--enable-introspection=yes \
		--with-session-tracking=systemd \
		--with-nmtui=yes \
		--with-pppd-plugin-dir=/usr/lib/pppd/2.4.7 \
		--with-modem-manager-1 --disable-concheck"

F32confopts+=" --enable-bluez5-dun=no --enable-introspection=no"

build() {
	Fbuild_cross32

	Fmkdir etc/NetworkManager/system-connections
	Fmkdir etc/NetworkManager/dispatcher.d
	Fmkdir etc/NetworkManager/dnsmasq.d
	cat > $Fdestdir/etc/NetworkManager/NetworkManager.conf << EOF
[main]
plugins = keyfile
dhcp = internal
EOF
	Fgenscriptlet
}


# optimization OK
