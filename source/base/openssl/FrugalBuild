# Compiling Time: 0.84 SBU
# Contributor: Miklos Vajna <vmiklos@frugalware.org>
# Maintainer: voroskoi <voroskoi@frugalware.org>

pkgname=openssl
pkgver=1.0.2
pkgextraver=h
pkgrel=7
pkgdesc="The Open Source toolkit for Secure Sockets Layer and Transport Layer Security"
url="http://www.openssl.org/source/"
groups=('base' 'chroot-core')
archs=('i686' 'x86_64')
depends=('glibc>=2.22-7')
makedepends=('util-linux>=2.27.1-3')
_F_archive_grepv="beta"
## check for extra pkgver when you bump this
up2date="lynx -dump -listonly ftp://ftp.openssl.org/source/ | egrep -v '(beta|pre)' | Flasttar"
source=($url$pkgname-$pkgver$pkgextraver.tar.gz \
	http://caunter.ca/ssl.certs.shar \
	man_symlinks.diff)
signatures=("$source.asc" '' '')


build()
{
	unset MAKEFLAGS
	# optimize the build
	Fsed "-O3" "$CFLAGS" Configure
	./config $Fconfopts --prefix=/usr --openssldir=/etc/ssl shared || Fdie

	Fpatchall
	make || Fdie
	make INSTALL_PREFIX=$Fdestdir MANDIR=/usr/share/man install
	[ "$CARCH" == "x86_64" ] && Fmv /usr/lib{64,}

	Frm usr/lib/*.a
	cd ${Fdestdir}/etc/ssl/certs || Fdie
	sh ${Fsrcdir}/ssl.certs.shar || Fdie

	Fln libssl.so.1.0.0 /usr/lib/libssl.so.1  # look out!!
	Fln libcrypto.so.1.0.0 /usr/lib/libcrypto.so.1  # look out!!

	(cd $Fdestdir/usr/share/man/man1 && rename '' openssl_ *)
	(cd $Fdestdir/usr/share/man/man3 && rename '' openssl_ *)
	(cd $Fdestdir/usr/share/man/man5 && rename '' openssl_ *)
	(cd $Fdestdir/usr/share/man/man7 && rename '' openssl_ *)
}

# optimization OK
