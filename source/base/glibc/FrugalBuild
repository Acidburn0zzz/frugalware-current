# Last modified: Fri, 04 Nov 2005 22:38:41 +0100
# Compiling time: 10.43 SBU
# Maintainer: VMiklos <vmiklos@frugalware.org>
# Modified by zleho <zleho@index.hu> and Laszlo Dvornik <dvornik@gnome.hu>

pkgname=glibc
pkgver=2.3.6
pkgrel=1
pkgdesc="GNU C Library"
url="http://www.gnu.org/software/libc/libc.html"
depends=()
groups=('base' 'chroot-core')
archs=('i686' 'x86_64')
up2date="lynx -dump 'http://ftp.gnu.org/pub/gnu/glibc/?M=D'|grep linuxthreads|sed -n 's/.*-\(.*\).t.*/\1/;1 p'"
source=(http://ftp.gnu.org/pub/gnu/$pkgname/$pkgname-$pkgver.tar.bz2 \
	http://ftp.gnu.org/pub/gnu/$pkgname/$pkgname-linuxthreads-$pkgver.tar.bz2 \
	$pkgname-2.3.5-dlopen.diff)
sha1sums=('82d0487419f1bdbf2dee439c344e89d6af47e558' \
	  '10190168bf948556afdfff46f87f9208402d810f' \
	  '6d7c5506c789a172acac364223e41363cb85df7c'
	 )
[ "$CARCH" == "x86_64" ] && \
	source=(${source[@]} $pkgname-2.3.5-lib64_to_lib.diff) && \
	sha1sums=(${sha1sums[@]} '7a0dc8514f754249e713557daf7f82dbbce81ffa')

build()
{
	mv $Fsrcdir/{linuxthreads,linuxthreads_db} $Fsrcdir/$pkgname-$pkgver
	Fpatchall

	mkdir ../glibc-build
	cd ../glibc-build
	../$pkgname-$pkgver/configure --prefix=/usr --with-tls --with-__thread \
	    --enable-add-ons=nptl --enable-kernel=2.6.6 --enable-bind-now --without-cvs

	make || return 1

	make install_root=$Fdestdir install
	make install_root=$Fdestdir localedata/install-locales
	Frm /etc/ld.so.cache /etc/localtime

	# Man pages.
	cd $Fsrcdir/$pkgname-$pkgver/linuxthreads/man
	make || return 1
	Fmkdir /usr/man/man3
	Ffilerel *.3thr /usr/man/man3
	Ffile $pkgname-$pkgver/nscd/nscd.conf /etc/nscd.conf
	Frm /usr/info/dir
}

# optimalization ok

# vim: ft=sh
