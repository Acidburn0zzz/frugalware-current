# Last modified: Fri, 19 May 2006 18:23:31 +0200
# Compiling time: 9.79 SBU
# Maintainer: VMiklos <vmiklos@frugalware.org>

pkgname=glibc
pkgver=2.4
pkgrel=2
pkgdesc="GNU C Library"
url="http://www.gnu.org/software/libc/libc.html"
depends=()
rodepends=('bash' 'chkconfig' 'coreutils' 'frugalware' 'grep' 'sed' 'udev')
groups=('base' 'chroot-core')
archs=('i686' 'x86_64' 'ppc')
up2date="lynx -dump http://ftp.gnu.org/pub/gnu/glibc/|grep tar.bz2$|sed -n 's/.*-\(.*\)\.t.*/\1/;$ p'"
source=(http://ftp.gnu.org/pub/gnu/glibc/glibc-$pkgver.tar.bz2 2569.diff)
sha1sums=('35c636e4b474cda0f06e361d5e9caec092fd73d3' \
	'2e72c5bd23e87b9c4362b816a1362d275bf8b3e1')
[ "$CARCH" == "ppc" ] && \
	source=(${source[@]} glibc-nptl-ppc.patch \
		glibc-20051107-localedef_segfault-1.patch \
		glibc-__bind-fix.patch \
		glibc-2.3.6-__lround-fix.patch) && \
	sha1sums=(${sha1sums[@]} 'da3ef3fa1cc550213013f423840ac62ad8b1cdb3' \
		'ac908ef021764e90443e7cf7d72de87fe6168c38' \
		'15a3e65724f5fcedc39e80a3b3f4d068676117c8' \
		'16bb138bfab5baaf195a767f0d1ee502387ae00d')

build()
{
	# no multilib thanks
	Fsed 'x86_64 \| ' '' sysdeps/unix/sysv/linux/configure{,.in}
	Fpatchall
	Ffilerel nscd/nscd.conf /etc/nscd.conf

	mkdir ../glibc-build
	cd ../glibc-build
	../glibc-$pkgver/configure --prefix=/usr --with-tls --with-__thread \
	    --enable-add-ons=nptl --enable-kernel=2.6.12 --enable-bind-now --without-cvs

	make || return 1

	make install_root=$Fdestdir install
	make install_root=$Fdestdir localedata/install-locales
	Frm /etc/ld.so.cache /etc/localtime

	Frm /usr/info/dir
}

# optimization ok
