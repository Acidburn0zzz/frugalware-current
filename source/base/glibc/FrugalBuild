# Last modified: Wed, 18 May 2005 16:14:31 +0200
# Compiling time: ~4.316 hours
# Maintainer: VMiklos <mamajom@axelero.hu>
# Modified by zleho <zleho@index.hu> and Laszlo Dvornik <dvornik@gnome.hu>

pkgname=glibc
pkgver=2.3.5
pkgrel=1
pkgdesc="GNU C Library"
url="http://www.gnu.org/software/libc/libc.html"
depends=()
groups=('base')
archs=('i686' 'x86_64')
up2date="lynx -dump 'http://ftp.gnu.org/pub/gnu/glibc/?M=D'|grep linuxthreads|sed -n 's/.*-\(.*\).t.*/\1/;1 p'"
source=(http://ftp.gnu.org/pub/gnu/$pkgname/$pkgname-$pkgver.tar.bz2 \
	http://ftp.gnu.org/pub/gnu/$pkgname/$pkgname-linuxthreads-$pkgver.tar.bz2 \
	$pkgname-$pkgver-dlopen.diff)
md5sums=('93d9c51850e0513aa4846ac0ddcef639' '77011b0898393c56b799bc011a0f37bf' \
	'0863001ef3fa8492cf0741de3c9a7096')
[ "$CARCH" == "x86_64" ] && \
	source=(${source[@]} $pkgname-$pkgver-lib64_to_lib.diff) && \
	md5sums=(${md5sums[@]} '86ece2940a80fa62ccf81e91c2cc69b5')

build()
{
	mv $Fsrcdir/{linuxthreads,linuxthreads_db} $Fsrcdir/$pkgname-$pkgver
	Fpatchall || return 1

	mkdir ../glibc-build
	cd ../glibc-build
	../$pkgname-$pkgver/configure --prefix=/usr --enable-add-ons=nptl \
		--enable-kernel=2.6.0

	make || return 1

	make install_root=$Fdestdir install
	make install_root=$Fdestdir localedata/install-locales
	Frm /etc/ld.so.cache /etc/localtime

	# Man pages.
	cd $Fsrcdir/$pkgname-$pkgver/linuxthreads/man
	make || return 1
	Fmkdir /usr/man/man3
	Ffilerel *.3thr /usr/man/man3
	Ffile $pkgname-$pkgver/nscd/nscd.conf /etc/nscd.conf
	Frm /usr/info/dir
}

# optimalization ok

# vim: ft=sh
