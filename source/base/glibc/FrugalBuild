# Last modified: Mon, 25 Jul 2005 13:23:11 +0200
# Compiling time: ~4.316 hours
# Maintainer: VMiklos <vmiklos@frugalware.org>
# Modified by zleho <zleho@index.hu> and Laszlo Dvornik <dvornik@gnome.hu>

pkgname=glibc
pkgver=2.3.5
pkgrel=3
pkgdesc="GNU C Library"
url="http://www.gnu.org/software/libc/libc.html"
depends=()
groups=('base' 'chroot-core')
archs=('i686' 'x86_64')
up2date="lynx -dump 'http://ftp.gnu.org/pub/gnu/glibc/?M=D'|grep linuxthreads|sed -n 's/.*-\(.*\).t.*/\1/;1 p'"
source=(http://ftp.gnu.org/pub/gnu/$pkgname/$pkgname-$pkgver.tar.bz2 \
	http://ftp.gnu.org/pub/gnu/$pkgname/$pkgname-linuxthreads-$pkgver.tar.bz2 \
	$pkgname-$pkgver-dlopen.diff $pkgname-$pkgver-gcc4_{1,2,3,4}.patch)
md5sums=('93d9c51850e0513aa4846ac0ddcef639' '77011b0898393c56b799bc011a0f37bf' \
	 '0863001ef3fa8492cf0741de3c9a7096' 'c5bb3c5fc202677fa5f9255b14aa0ceb' \
	 '56dbfef8c0c51acc4d86b30d0706ee02' '029d0ec04624684ae8d6de1b662d7e50' \
	 '516908844d251b483c229a2ca56e0e49')
[ "$CARCH" == "x86_64" ] && \
	source=(${source[@]} $pkgname-$pkgver-lib64_to_lib.diff glibc-2.3.5-gcc4_4_1-amd64.patch) && \
	md5sums=(${md5sums[@]} '86ece2940a80fa62ccf81e91c2cc69b5' 'bcd844c0046a89327272c749864724a2')
  

build()
{
	mv $Fsrcdir/{linuxthreads,linuxthreads_db} $Fsrcdir/$pkgname-$pkgver
	Fpatchall

	mkdir ../glibc-build
	cd ../glibc-build
	../$pkgname-$pkgver/configure --prefix=/usr --enable-add-ons=nptl \
		--enable-kernel=2.6.0

	make || return 1

	make install_root=$Fdestdir install
	make install_root=$Fdestdir localedata/install-locales
	Frm /etc/ld.so.cache /etc/localtime

	# Man pages.
	cd $Fsrcdir/$pkgname-$pkgver/linuxthreads/man
	make || return 1
	Fmkdir /usr/man/man3
	Ffilerel *.3thr /usr/man/man3
	Ffile $pkgname-$pkgver/nscd/nscd.conf /etc/nscd.conf
	Frm /usr/info/dir
}

# optimalization ok

# vim: ft=sh
