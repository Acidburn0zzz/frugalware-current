#!/bin/sh

# (c) 2003-2004 Vajna Miklos <vmiklos@frugalware.org>
# timeconfig for Frugalware
# distributed under GPL License
# Copyright 1993-2003 Patrick J. Volkerding, All rights reserved
# Patrick J. Volkerding's scripts were distributed under an OSI approved
# BSD License, which can be found in the COPYRIGHT file.

. /var/lib/frugalware/messages/rc.messages

### strings
timebacktitle="$settime - FrugalWare `cat /etc/frugalware-release |cut -d ' ' -f 2` $setup"

### functions
askhow()
{
	howf=`mktemp`
	dialog --backtitle "$timebacktitle" --title "$modet" --aspect 20 --menu "$moded" 0 0 0 "$not" "$nod" "$yest" "$yesd" 2>$howf || exit 0
	[ "`cat $howf`" == "$not" ] && mode=localtime || mode=UTC
	rm $howf
}

hwclockconf()
{
	echo -e "# /etc/hardwareclock\n"
	echo -e "# this file is generated by timeconfig\n"
	echo "$1"
}

askzone()
{
	setzonef=`mktemp`
	chmod +x $setzonef
	zonef=`mktemp`
	echo "dialog --backtitle \"$timebacktitle\" --title \"$timezt\" --menu \"$timezd\" 0 0 0 \\" >$setzonef
	( for i in `find /usr/share/zoneinfo/ |grep -v '\(\.tab$\|localtime\)'|sed 's|/usr/share/zoneinfo/||'`
	do
		echo "\"$i\" \"   \" \\"
	done ) |sort >>$setzonef
	echo "2> $zonef">>$setzonef
	$setzonef || exit 0
	rm $setzonef
	zone=`cat $zonef`
	rm $zonef
}

setzone()
{
	cd /etc
	ln -sf /usr/share/zoneinfo/$1 localtime
}

### main

askhow # mode is now stored in $mode
hwclockconf $mode >/etc/hardwareclock
askzone # selected zone is in $zone
setzone $zone
