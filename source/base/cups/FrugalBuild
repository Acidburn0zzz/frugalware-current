# Last Modified: Mon, 30 May 2005 14:16:52 +0000
# Compiling Time: ~5 minutes
# Maintainer: VMiklos <mamajom@axelero.hu>

pkgname=cups
pkgver=1.1.23
pkgrel=2
pkgdesc="The CUPS Printing System"
url="http://www.cups.org/"
depends=('openssl' 'libtiff' 'libjpeg' 'libpng')
groups=('base')
archs=('i686' 'x86_64')
backup=(etc/cups/{printers.conf,classes.conf,client.conf,cupsd.conf,mime.types,mime.convs,ppds.dat} etc/printcap)
install=$pkgname.install
up2date="lynx -dump http://www.cups.org/software.php|grep tar.bz2$|sed -n 's/.*-\(.*\)\-.*/\1/;1 p'"
source=(ftp://ftp.rz.tu-bs.de/pub/mirror/ftp.easysw.com/ftp/pub/$pkgname/$pkgver/cups-$pkgver-source.tar.bz2 \
	rc.cups printcap ppds.dat.gz)
md5sums=('4ce09b1dce09b6b9398af0daae9adf63' '6d2b38afba6e0ccf85f751e3c8e97982' \
	 '7874f10c10b5f1ec9a347d66cf0a5cc2' '9109931f8f149a718209421dfbd0da37')

build() {
	cd $startdir/src/$pkgname-$pkgver
	./configure --prefix=/usr --sysconfdir=/etc --localstatedir=/var \
		    --with-logdir=/var/log/cups \
		    --with-docdir=/usr/share/cups/doc --enable-ssl=yes \
		    --disable-pam

	make || return 1

	make BUILDROOT=$startdir/pkg install
	install -m644 $startdir/src/ppds.dat $startdir/pkg/etc/cups/
	# init scripts
	rm -rf $startdir/pkg/etc/rc.d/{init.d,rc?.d}
	mkdir -p $startdir/pkg/etc/rc.d/rc.messages
	install -m755 $startdir/rc.$pkgname $startdir/pkg/etc/rc.d/rc.$pkgname
	install -m644 $startdir/messages/$pkgname.* \
		$startdir/pkg/etc/rc.d/rc.messages/
	# printcap
	install -m644 $startdir/src/printcap $startdir/pkg/etc/
	mkdir $startdir/pkg/usr/etc
	( cd $startdir/pkg/usr/etc && ln -sf /etc/printcap printcap )
	# samba support
	( cd $startdir/pkg/usr/lib/cups/backend
	  if [ ! -r smb ]; then
	  ln -sf /usr/bin/smbspool smb
	  fi )
	# fix perms on /var/spool
	chmod 755 $startdir/pkg/var/spool
	
	# remove 'cat?'
	cd $startdir/pkg
	for i in `find * -type d -name cat?`
	do
		rm -rf $i
	done
}

# vim: ft=sh
