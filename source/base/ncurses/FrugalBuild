# Compiling Time: 0.01 SBU
# Maintainer: James Buren <ryuo@frugalware.org>
# Contributor: Miklos Vajna <vmiklos@frugalware.org>

pkgname=ncurses
pkgver=6.0
pkgrel=3
pkgdesc="A System V curses emulation library"
url="http://www.gnu.org/software/ncurses/ncurses.html"
depends=('glibc>=2.22-3')
makedepends=('gcc>=5.2.0-3')
groups=('base' 'chroot-core')
archs=('i686' 'x86_64' 'arm')
Fup2gnugz
source=(ftp://ftp.gnu.org/pub/gnu/$pkgname/$pkgname-$pkgver.tar.gz)
#signatures=(${source[0]}.sig)
sha1sums=('acd606135a5124905da770803c05f1f20dd3b21c')

build()
{
	cp -R $pkgname-$pkgver ${pkgname}w-$pkgver || Fdie
	ncurses_conf="--with-shared \
		     --with-normal \
		     --without-debug \
		     --with-install-prefix=$Fdestdir \
		     --libdir=/lib \
		     --enable-pc-files"
	## just in case you wonder why this first is because the 'normal'
	## ncurses will overwrite the 'conflicting' files on make install.
	## the /share/ stuff and so is not needed -- crazy --

	## widec version
	cd ${pkgname}w-$pkgver
	Fmake ${ncurses_conf} \
		--enable-widec \
		--includedir=/usr/include/ncursesw \
		--program-suffix="w"
	make install || Fdie

	## normal version
	cd ../$pkgname-$pkgver
	Fmake ${ncurses_conf}
	make install || Fdie

	## strange .6 is same as .5 anyway we rebuild with .6 but to allow bumpimg
	## in chroot we symlink for now
	warning "Strange hack to allow re-building.. WEIRD!"
	local i
	for i in libncurses libpanel libmenu libform
	do
		Fln  ${i}.so.6.0 /lib/${i}.so.5.0
		Fln  ${i}.so.6  /lib/${i}.so.5
		Fln  ${i}w.so.6.0 /lib/${i}w.so.5.0
		Fln  ${i}w.so.6 /lib/${i}w.so.5
	done
}

# optimization ok
