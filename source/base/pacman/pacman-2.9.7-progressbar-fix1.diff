diff -Naur pacman-2.9.7.orig/src/pacman.c pacman-2.9.7/src/pacman.c
--- pacman-2.9.7.orig/src/pacman.c	2005-10-18 14:42:41.729782500 +0200
+++ pacman-2.9.7/src/pacman.c	2005-10-18 15:55:47.787894000 +0200
@@ -122,18 +122,15 @@
 int neednl = 0; /* for cleaner message output */
 
 static int disp_progress(char *pkgname, int percent) {
-	/* char *pkgn[25]; */
 	int i, hash;
     
 	hash = percent/6.25;
 
-	/* snprintf(pkgn, 25, "%s", pkgname); */
-	/* printf(" %s ", pkgn); */
-
-	if (strlen(pkgname)<25)
-	    for (i=25-strlen(pkgname)-1; i>0; i--)
+	printf("%s", pkgname);
+	if (strlen(pkgname)<35)
+	    for (i=35-strlen(pkgname)-1; i>0; i--)
 		printf(" ");
-	
+
 	printf("[");
 	for (i = 16; i > 0; i--) {
 	    if (i >= 16 - hash)
@@ -143,6 +140,7 @@
 	}
 	printf("] %3d%%\r", percent);
 	fflush(stdout);
+/*	sleep(1); */ /* Just for testing */
 	return(1);
 }
 
@@ -1588,6 +1586,7 @@
 	char expath[PATH_MAX];
 	char pm_install[PATH_MAX];
 	char rm_fname[PATH_MAX];
+	char *what;
 	pkginfo_t *info = NULL;
 	struct stat buf;
 	PMList *targ, *lp, *j, *k, *remove_list;
@@ -1877,7 +1876,8 @@
 			if(is_pkgin(info, pm_packages)) {
 				int retcode;
 
-				printf("upgrading %s... ", info->name);
+/*				printf("upgrading %s... ", info->name); */
+				asprintf(&what, "upgrading %s ", info->name);
 				neednl = 1;
 
 				/* we'll need the full record for backup checks later */
@@ -1912,7 +1912,8 @@
 		}
 		
 		if(!pmo_upgrade) {
-			printf("installing %s... ", info->name);
+/*			printf("installing %s ", info->name); */
+			asprintf(&what, "installing %s ", info->name);
 			neednl = 1;
 			/* pre_install scriptlet */
 			if(info->scriptlet) {
@@ -1937,10 +1938,6 @@
 		chdir(pmo_root);
 
 		for(i = 0; archive_read_next_header (archive, &entry) == ARCHIVE_OK; i++) {
-                        if (info->usize != 0) { /* prevent division by zero */
-			    percent = (double)archive_position_uncompressed(archive) / info->usize;
-			    disp_progress(info->name, (int)(percent * 100));
-			}
 			int nb = 0;
 			int notouch = 0;
 			char *md5_orig = NULL;
@@ -1948,6 +1945,10 @@
 			char pathname[PATH_MAX];
 			strncpy(pathname, archive_entry_pathname (entry), PATH_MAX);
 
+		        info->usize = info->size; /* Progress bar thing. Bad hack for usize.. */
+		        percent = (double)archive_position_uncompressed(archive) / info->usize;
+		        disp_progress(what, (int)(percent * 100));
+
 			if(!strcmp(pathname, ".PKGINFO") || !strcmp(pathname, ".FILELIST")) {
 				archive_read_data_skip (archive);
 				continue;
@@ -2138,7 +2139,7 @@
 				}
 				archive_entry_set_pathname (entry, expath);
 				if (archive_read_extract (archive, entry, ARCHIVE_EXTRACT_FLAGS) != ARCHIVE_OK) {
-					printf ("%d\n",ARCHIVE_OK);
+					vprint("%d\n", ARCHIVE_OK);
 					logaction(stderr, "could not extract %s: %s", expath, strerror(errno));
 					errors++;
 				}
@@ -2168,7 +2169,6 @@
 			}
 		}
 		archive_read_finish (archive);
-		/* free (archive); */
 		
 		if(errors) {
 			ret = 1;
@@ -2255,9 +2255,10 @@
 				freepkg(depinfo);
 			}
 
-                        disp_progress(info->name, 100); /* Put progressbar to 100% */
+                        disp_progress(what, 100); /* Put progressbar to 100% */
                         printf("\n");
 			fflush(stdout);
+			FREE(what);
 
 			/* run the post-install/upgrade script if it exists  */
 			snprintf(pm_install, PATH_MAX, "%s%s/%s/%s-%s/install", pmo_root, pmo_dbpath, db->treename, info->name, info->version);
