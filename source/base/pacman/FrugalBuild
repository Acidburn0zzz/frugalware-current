# Last Modified: Sun, 07 Aug 2005 19:36:22 +0200
# Compiling Time: 0.02 SBU
# Maintainer: VMiklos <vmiklos@frugalware.org>

pkgname=pacman
pkgver=2.9.6
pkgrel=11
pkgdesc="A .tar.gz based package manager with dependency support"
url="http://www.archlinux.org/pacman"
backup=(etc/{makepkg,pacman}.conf etc/pacman.d/{frugalware,frugalware-current,extra,extra-current})
depends=('zlib')
groups=('base')
archs=('i686' 'x86_64')
makedepends=('libtar')
up2date="lynx -dump http://www.archlinux.org/pacman/|grep released|sed -n -e 's/.* v\(.*\) .*/\1/' -e '1 p'"
source=(ftp://ftp.archlinux.org/other/pacman/$pkgname-$pkgver.tar.gz \
	pacman.conf \
	$pkgname-$pkgver-backup.diff \
	$pkgname-$pkgver-remove_array.patch \
	$pkgname-$pkgver-lastmod.diff \
	$pkgname-$pkgver-fwmakepkg.patch \
	$pkgname-$pkgver-doc.diff \
	$pkgname-$pkgver-chkdep.diff \
	$pkgname-$pkgver-nobuild.diff \
	$pkgname-$pkgver-arch.diff \
	$pkgname-$pkgver-install.diff \
	$pkgname-$pkgver-up2date.diff \
	$pkgname-$pkgver-pacman_source.diff \
	$pkgname-$pkgver-x86_64-md5-fix.patch \
	$pkgname-$pkgver-use-memsetcpy.patch \
	$pkgname-$pkgver-sbu.diff \
	$pkgname-$pkgver-rodepends.diff \
	$pkgname-$pkgver-optimalization_and_logging.diff \
	$pkgname-$pkgver-sudo.diff \
	$pkgname-$pkgver-sha1.diff \
	$pkgname-$pkgver-noccache.diff \
	$pkgname-$pkgver-changelog.diff)
sha1sums=('93d9ec990ab84fb75cd8eb335c8ac17108a9db25' \
          'ce129ca8b1e9f658e3314e11205c7d992eb13e00' \
          '7d98e6cf6115d99c641d8dfc99d4d7c479ee7cca' \
          '33027bf7672a0f8c5689056acdefcf62cf944166' \
          '47b76dc685622209e83a816eca013fc2e2c9174c' \
          '328281fdf087307dc5af42ad922a66ec3edfc346' \
          'b41d947177a7e988c5bb2cd6d4a23c18f317d1b1' \
          '63999fea87005e0f2bf0ff6549dcb92a8f437b01' \
          '240438df583d6a9878d00b6dbd0f79f6c5daac56' \
          '294d31bebc1b274929c1ec3b8a9bbaed9969279b' \
          '1e64efdbf592431b1f4f194421e08194199c3dfa' \
          'a4ab169cef6889f280d55668154db294138aab4b' \
          'eb5e8a8327846419639022f6eebd218130ab8aad' \
          'd467635ec08d9ba3a5a4277084ca9fea727c381d' \
          '9414e9c2d685377852ece6559f703d53d141684f' \
          'b9a032de48cc38ffc8a427045be8bccfa82e5f02' \
          'bebd2f317f3c8c9d1b1d52441986e0353e112879' \
          '5a2ee7dd863d1b3453729497b5d7af76e048fc1f' \
          'b93c0423619b1a72eb9367441b9303242ae5b12d' \
          '29e54ce7df28dee1abdf302da73063e714f1f85c' \
          'dd8d4ad13ad23971022963de2ff3ca8bfeb91714' \
          '7c661913d501cc1bf7ebd81ea2e55422a518b931')

build()
{
	Fcd
	# begin patching
	for i in `grep -R pkg.tar.gz *|cut -d : -f 1|sort -u`
	do
		Fsed 'pkg.tar.gz' 'fpm' $i
	done
	for i in `grep -R db.tar.gz *|cut -d : -f 1|sort -u`
	do
		Fsed 'db.tar.gz' 'fdb' $i
	done
	Fsed '^export USE_COLOR="n"' 'export USE_COLOR="y"' etc/makepkg.conf
	Fsed 'Arch Linux (http://www.archlinux.org)' \
		'Frugalware Linux (http://www.frugalware.org)' scripts/makepkg
	for i in `grep -R PKGBUILD *|cut -d : -f 1|sort -u`
	do
		Fsed 'PKGBUILD' 'FrugalBuild' $i
	done
	# english dates
	Fsed '\(umask [0-9]*$\)' '\1\nunset LC_ALL LANG' scripts/makepkg
	# modify version
	Fsed "^PACVER = $pkgver$" "PACVER = $pkgver-fw$pkgrel" Makefile.in
	# strip unneeded flags
	Fsed ' -Wl,-O1' '' etc/makepkg.conf
	# end of patching
	Fsed "\"i686\"" "\"$CARCH\"" etc/makepkg.conf
	[ "$CARCH" == "x86_64" ] && Fsed "i686-pc" "x86_64-unknown" etc/makepkg.conf
	[ "$CARCH" == "x86_64" ] && Fsed "-march=i686" "-march=k8" etc/makepkg.conf
	
	Fbuild
	
	Ffile pacman.conf /etc/pacman.conf
	Ffile ../conf/* /etc/pacman.d/
	for i in $Fdestdir/etc/pacman.d/*
	do
		Fsed 'frugalware$' "frugalware-$CARCH" $i
	done
}

# optimalization ok

# vim: ft=sh
