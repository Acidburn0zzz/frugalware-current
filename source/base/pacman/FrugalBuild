# Last Modified: Sun, 26 Jun 2005 01:43:44 +0200
# Compiling Time: 0.02 SBU
# Maintainer: VMiklos <mamajom@axelero.hu>

pkgname=pacman
pkgver=2.9.6
pkgrel=2
pkgdesc="A .tar.gz based package manager with dependency support"
url="http://www.archlinux.org/pacman"
backup=(etc/{makepkg,pacman}.conf etc/pacman.d/{frugalware,frugalware-current,extra,extra-current})
depends=('zlib')
groups=('base')
archs=('i686' 'x86_64')
makedepends=('libtar')
up2date="lynx -dump http://www.archlinux.org/pacman/|grep released|sed -n -e 's/.* v\(.*\) .*/\1/' -e '1 p'"
source=(ftp://ftp.archlinux.org/other/pacman/$pkgname-$pkgver.tar.gz \
	pacman.conf \
	$pkgname-$pkgver-backup.diff \
	$pkgname-$pkgver-remove_array.patch \
	$pkgname-$pkgver-lastmod.diff \
	$pkgname-$pkgver-fwmakepkg.patch \
	$pkgname-$pkgver-doc.diff \
	$pkgname-$pkgver-chkdep.diff \
	$pkgname-$pkgver-nobuild.diff \
	$pkgname-$pkgver-arch.diff \
	$pkgname-$pkgver-install.diff \
	$pkgname-$pkgver-up2date.diff \
	$pkgname-$pkgver-pacman_source.diff \
	$pkgname-$pkgver-x86_64-md5-fix.patch \
	$pkgname-$pkgver-use-memsetcpy.patch \
	$pkgname-$pkgver-sbu.diff \
	$pkgname-$pkgver-rodepends.diff)
md5sums=('0afe69083435e0d804214ba79c1227dd' 'a6c42c6d38098733bced460b1172657a' \
	 'b0b05fea5c867dc326daa10222b2c5cb' '4f3339512198dab8405c9c48e9f68d66' \
	 'bce4050da8f909294e95e1b3f71d30a2' 'a8794135357019ae338c66439c2901cb' \
	 '48f495e2994f0e4dcc0d8cc5f86a0f4a' '6aae21280e38cda257bf43233472219d' \
	 'd17df23fc6cd746885d9ce6ceff2ffd0' '0f40245530b5bdc370375660c238a9e5' \
	 'f372ee650966fc1ebede866fe60d3880' '82aa3ea44a71c8c6945d2c041cbeda00' \
	 '22b86c1cf0c0cca2941555d3187b4faa' '00b50dee4eadb72de82c4e6d4b4bb8db' \
	 'f842f42916bc0f710aab286da20c8d86' '7a73029bb1d87e0227970501f7209672' \
	 'cf70aa157375d37596d8646b902da3ab')

build()
{
	Fcd
	# begin patching
	for i in `grep -R pkg.tar.gz *|cut -d : -f 1|sort -u`
	do
		Fsed 'pkg.tar.gz' 'fpm' $i
	done
	for i in `grep -R db.tar.gz *|cut -d : -f 1|sort -u`
	do
		Fsed 'db.tar.gz' 'fdb' $i
	done
	Fsed '^export USE_COLOR="n"' 'export USE_COLOR="y"' etc/makepkg.conf
	Fsed 'Arch Linux (http://www.archlinux.org)' \
		'Frugalware Linux (http://www.frugalware.org)' scripts/makepkg
	for i in `grep -R PKGBUILD *|cut -d : -f 1|sort -u`
	do
		Fsed 'PKGBUILD' 'FrugalBuild' $i
	done
	# english dates
	Fsed '\(umask [0-9]*$\)' '\1\nunset LC_ALL LANG' scripts/makepkg
	# modify version
	Fsed "^PACVER = $pkgver$" "PACVER = $pkgver-fw$pkgrel" Makefile.in
	# strip unneeded flags
	Fsed ' -Wl,-O1' '' etc/makepkg.conf
	# end of patching
	[ "$CARCH" == "x86_64" ] && Fsed "\"i686\"" "\"x86_64\"" etc/makepkg.conf
	[ "$CARCH" == "x86_64" ] && Fsed "i686-pc" "x86_64-unknown" etc/makepkg.conf
	[ "$CARCH" == "x86_64" ] && Fsed "-march=i686" "-march=k8" etc/makepkg.conf
	
	Fbuild || return 1
	
	Ffile pacman.conf /etc/pacman.conf
	Ffile ../conf/* /etc/pacman.d/
	for i in $Fdestdir/etc/pacman.d/*
	do
		Fsed 'frugalware$' "frugalware-$CARCH" $i
	done
}

# optimalization ok

# vim: ft=sh
