#!/bin/bash

# (c) 2004 Vajna Miklos <mamajom@axelero.hu>
# checkworld for pacman
# distributed under GPL License

version=0.2
countpkg=0

echo "checkworld $version (C) 2004 Miklos Vajna <mamajom@axelero.hu>"

function usage()
{
	cat <<EOF
Usage: `basename $0` [options] [category1 category2] ...

Options:
-v	be verbose
-h	this help

if you defines categories, it doesn't check all categories
this should be run from the 'source' directory of FST
EOF
}

function check_category()
{
	i=$1
	cd $i
		for j in *
		do
			if [ -d $j ]; then
				cd $j
					. FrugalBuild
					countpkg=$(($countpkg+1))
					if [ "$pkgver" != "$up2date" ]; then
						echo -n "Checking for $j's newer version... "
						echo "Newer version available! ($pkgver < $up2date)"
					else
						if [ "$verbose" == "1" ]; then
						echo -n "Checking for $j's newer version... "
							echo "Passed"
						fi
					fi
				cd ..
			fi
		done
	cd ..

}

case $1 in
	-v)
		verbose=1
		shift 1
		;;
	-h)
		usage
		exit 1
		;;
esac

if [ `pwd|tr '/' '\n'|tail -1` != "source" ]; then
	echo "Where are you?"
	usage
	exit 1
fi

if [ $# -le 0 ]; then
	for i in *
	do
		if [ -d $i ]; then
			check_category $i
		fi
	done
else
	for i in $*
	do
		check_category $i
	done
fi

echo "Total packages checked: $countpkg. "
