# Last Modified: Sun Mar 21 12:14:51 CET 2004
# Compiling Time: ~1 minute
# Maintainer: VMiklos <mamajom@axelero.hu>

pkgname=apmd
pkgver=3.0.2
pkgrel=2
pkgdesc="Set of tools for managing notebook power consumption"
depends=('glibc')
up2date=`lynx -dump  http://www.worldvisions.ca/~apenwarr/apmd |grep current|tr -s ' '|sed 's/\. / /'|cut -d ' ' -f 9`
source=(http://www.worldvisions.ca/~apenwarr/apmd/$pkgname-$pkgver.tar.gz \
  rc.apmd $pkgname-$pkgver.diff)
md5sums=('23ce275766441c59b6b47c002f9098eb' '6f8e2252c06f1561d3fb8753d0fe508c' \
	 'dd20986f62a4b56f992f834f7cbe931d')

# compiling only with kernel-headers 2.4 :-(

build() {
	cd $startdir/src/$pkgname
	patch -p1 < $startdir/src/$pkgname-$pkgver.diff
	sed -i 's|-I/usr/src/linux/include|-I/usr/include|' Makefile

	make || return 1

	mkdir -p $startdir/pkg/{usr,etc}
	make PREFIX=$startdir/pkg/usr APMD_PROXY_DIR=$startdir/pkg/etc install
	mkdir -p $startdir/pkg/etc/rc.d/rc.messages
	install -m755 $startdir/rc.$pkgname $startdir/pkg/etc/rc.d/rc.$pkgname
	install -m644 $startdir/messages/$pkgname.* \
		$startdir/pkg/etc/rc.d/rc.messages
}
