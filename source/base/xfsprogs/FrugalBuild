# Last Modified: Tue, 26 Jul 2005 19:16:08 +0200
# Compiling Time: ~5 minutes
# Maintainer: VMiklos <mamajom@axelero.hu>

pkgname=xfsprogs
pkgver=2.6.25
pkgrel=1
pkgdesc="XFS filesystem-specific static libraries and headers."
url="http://oss.sgi.com/projects/xfs/"
depends=('e2fsprogs')
makedepends=('xfsprogs-attr')
groups=('base')
archs=('i686' 'x86_64')
replaces=('xfsprogs-base')
up2date="wget --passive-ftp -O - -q ftp://oss.sgi.com/projects/xfs/cmd_tars/MD5SUMS|grep $pkgname|cut -d ' ' -f 3|sed 's/.src.tar.gz//'|cut -d - -f 2"
source=(ftp://oss.sgi.com/projects/xfs/cmd_tars/$pkgname-$pkgver.src.tar.gz \
	xfsprogs-2.6.25-gcc4.patch.gz xfsprogs-sharedlibs.patch.gz)
md5sums=('65fbf692f348b57f21edd4813733d9ae' '84800ae4d44a5e00e9072693d59aea7a'\
         '2c4ed116c324815205707b221ac4e948')


build()
{
	Fpatchall
	DEBUG="-DNDEBUG"
	OPTIMIZER="${CFLAGS}"
        sed -i \
            -e '/^GCFLAGS/s:-O1::' \
            -e "/^PKG_DOC_DIR/s:=.*:= /usr/share/doc/${pkgname}-${pkgver}:" \
            include/builddefs.in \
            || Fdie "sed include/builddefs.in failed"
        sed -i -e '/PLATFORM/d' configure || Fdie "sed PLATFORM"
        sed -i -e '/INSTALL.* -S .*LIBNAME/d' include/buildmacros || Fdie "sed symlinks"
	unset CFLAGS
	Fmake --bindir=/bin --sbindir=/sbin --libexecdir=/usr/lib
	make DIST_ROOT=$Fdestdir install install-dev || return 1
	Fmkdir /lib
	Fmv usr/lib/lib*so* /lib/
	Fln libhandle.so.1 /lib/libhandle.so
	# Stolen from gentoo. :) Need for some linking problems.
	cat > "$Fdestdir/usr/lib/libhandle.so" <<-END_LDSCRIPT
	/* GNU ld script */
	GROUP ( /lib/libhandle.so )
	END_LDSCRIPT
	chmod a+x $Fdestdir/usr/lib/libhandle.so
}

# optimalization OK

# vim: ft=sh
