# Last Modified: Sat, 12 Nov 2005 20:18:31 +0100
# Compiling Time: 0.02 SBU
# Maintainer: VMiklos <vmiklos@frugalware.org>

pkgname=sysvinit
pkgver=2.86
pkgrel=10
pkgdesc="Init, the parent of all processes"
depends=('shadow' 'util-linux' 'coreutils' 'glibc' 'gawk')
groups=('base')
archs=('i686' 'x86_64')
backup=(etc/{inittab,rc.d/rc.local})
install=$pkgname.install
up2date="wget --passive-ftp -O - -q ftp://ftp.cistron.nl/pub/people/miquels/sysvinit/|grep tar.gz|tail -n 1|sed 's/.*sysvinit-\(.*\)\.tar\.gz.*/\1/'"
source=(ftp://ftp.cistron.nl/pub/people/miquels/$pkgname/$pkgname-$pkgver.tar.gz \
        functions functions-{de,hu,it}.po inittab rc.4 rc.4-de.po rc.6 rc.{de,en,hu,it}\
	rc.functions rc.K rc.local rc.M rc.messages rc.reboot rc.reboot-{de,hu}.po \
	rc.S rc.single rc.single-{de,hu}.po rc.sysvinit sysvinit-2.86.diff)
sha1sums=('3e78df609a2ff0fea6304cb662a7f10298d03667' \
          '36fc6f584a3fe6429ce6c94790dfe8d5e8cee157' \
          '7b4d4bbcc7686185031f353a60bca5cda8b5538f' \
          '83e5879898d7750b157552606a62f0f7bf1f0c97' \
          'b43af93e8b4a350a9d00024e0cb9716cf59f6e13' \
          '7bcd997c7da95785feb21bc169a539429393942f' \
          '45a9efeab506127f83eb0e19136ba9610983998f' \
          '513b3fe42c714738af40596987a4fae71ae820d6' \
          '173c5d41d3fe58ba9a12711d63dfab31c2db8f09' \
          '36528cbafed0ace3294e16e8d164e5867cf0712e' \
          '60366ffb899965987a6d04abe2acd9c4c4e918fd' \
          'f44c9f10517078cbf5ff14383c90564c90d1a218' \
          'c1f1fa8609eb908db65301bb930c22123c9e52f0' \
          'a6e4b2fe78f666e1de1f02e8f57a65fb5ee35f53' \
          '0128bd09abf2c49d42949e92c2822bacfc148d7a' \
          '5adafd4851d987ac5310b8a2ca214c82dec87224' \
          '6947c8fe272e268207587b48b8de3c3ebefd0ad5' \
          'c2075ca5be14e318cac2abd2c424715e399d7bfd' \
          '27775564ff7af689e7d745dfad0e317986d86197' \
          'a18793387318c7bb99a85a6f7ddc531cca884822' \
          'f6aebaf0a7e953f64c38d32206a1ea4893879559' \
          '61d3ebdae6366e9c41a0887278cb2bbefd972eca' \
          '6de6eff549d75f29db2eeb456af045b3baccf02c' \
          '64db4a11baebe28eaf5d71119c2cb5f091170957' \
          'aa911a93c7ab733b1729f6a9c174b687aa2db58d' \
          'ed8885dda1864325d279bdc39cc50617ca3a878d' \
          '837541969bec9e391bd77a2c1a0cca5f7fb20e9b')

build()
{
	
	Fcd $pkgname-$pkgver/src
	patch -p2 <$Fsrcdir/sysvinit-2.86.diff
	Fmkdir /bin /sbin /usr/{bin,include} /usr/man/man{1,5,8}

	Fsed '-O2' "$CFLAGS" Makefile
	Fmake
	Fmakeinstall MANDIR=/usr/man ROOT=$Fdestdir

	Frm /usr/bin/wall
	Ffile /lib/initscripts/functions

	for i in $Fsrcdir/functions-*.po ; do
		slang=`basename $i .po|sed 's|functions-||'`
		llang=${slang}_`echo $slang | tr [:lower:] [:upper:]`
		Fmkdir /lib/initscripts/messages/$llang/LC_MESSAGES
		msgfmt -o $Fdestdir/lib/initscripts/messages/$llang/LC_MESSAGES/functions.mo $i
	done

	Ffile /etc/inittab
	Fexe /etc/rc.d/rc.4

	for i in $Fsrcdir/rc.4-*.po ; do
		slang=`basename $i .po | sed 's|rc.4-||'`
		llang=${slang}_`echo $slang | tr [:lower:] [:upper:]`
		Fmkdir /lib/initscripts/messages/$llang/LC_MESSAGES
		msgfmt -o $Fdestdir/lib/initscripts/messages/$llang/LC_MESSAGES/4.mo $i
	done

	Fexe rc.{6,functions,K,local,M} /etc/rc.d/
	Ffile rc.{messages,de,en,hu,it} /etc/rc.d/rc.messages/

	Fexe /etc/rc.d/rc.reboot

	for i in $Fsrcdir/rc.reboot-*.po ; do
		slang=`basename $i .po | sed 's|rc.reboot-||'`
		llang=${slang}_`echo $slang | tr [:lower:] [:upper:]`
		Fmkdir /lib/initscripts/messages/$llang/LC_MESSAGES
		msgfmt -o $Fdestdir/lib/initscripts/messages/$llang/LC_MESSAGES/reboot.mo $i
	done

	Fexe rc.{S,single} /etc/rc.d/

	for i in $Fsrcdir/rc.single-*.po ; do
		slang=`basename $i .po | sed 's|rc.single-||'`
		llang=${slang}_`echo $slang | tr [:lower:] [:upper:]`
		Fmkdir /lib/initscripts/messages/$llang/LC_MESSAGES
		msgfmt -o $Fdestdir/lib/initscripts/messages/$llang/LC_MESSAGES/single.mo $i
	done

	Fexe /etc/rc.d/rc.sysvinit
	Fln rc.6 /etc/rc.d/rc.0
	Fln rc.reboot /etc/rc.d/rc.halt
}

# vim: ft=sh

# optimalization OK
