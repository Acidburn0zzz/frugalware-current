# Last Modified: Fri, 14 Oct 2005 13:13:08 +0200
# Compiling Time: ~1 minute
# Maintainer: VMiklos <vmiklos@frugalware.org>

pkgname=kbd
pkgver=1.12
pkgrel=10
pkgdesc="Keyboard maps and console fonts"
up2date="lynx -dump 'http://www.ibiblio.org/pub/Linux/system/keyboards/?M=D'|grep kbd.*tar.gz$|sed -n 's/.*d-\(.*\)\.t.*/\1/;1 p'"
depends=('sed' 'bash' 'glibc' 'bootsplash')
groups=('base')
archs=('i686' 'x86_64')
backup=(etc/sysconfig/{font,keymap})
install=$pkgname.install
source=(ftp://ftp.win.tue.nl/pub/linux-local/utils/$pkgname/$pkgname-$pkgver.tar.gz \
        fontconfig rc.font rc.keymap font)
sha1sums=('d4917da308e01e74d67d7b814bf527063b3919fc' \
	  '45e7873f885568afc79ddc3bb76043f6b6f70d2e' \
	  '6cc2260c08c916cf8d8f189f2f490f93d1e43baf' \
	  'ffb715102c5c0ce95f656bf3653b915c6fb09c0b' \
	  '15fd1cccf548b0f0e4eb1a3132c609fd9425a453')

build() {
	cd $startdir/src/$pkgname-$pkgver
	./configure
	
	make || return 1
	
	make DESTDIR=$startdir/pkg install
	
	# init script
	mkdir -p $startdir/pkg/etc/rc.d/rc.messages
	install -m755 $startdir/src/rc.{font,keymap} $startdir/pkg/etc/rc.d/
	cp -a $startdir/messages/{font.*,keymap.*} \
		$startdir/pkg/etc/rc.d/rc.messages/
	
	# setup
	install -D -m755 ../fontconfig \
		$startdir/pkg/var/lib/frugalware/system/fontconfig
	mkdir -p $startdir/pkg/var/lib/frugalware/messages/
	cp -a $startdir/messages/fontconfig.* \
		$startdir/pkg/var/lib/frugalware/messages/
	
	# wrapper script
	mkdir $startdir/pkg/usr/sbin
	cd $startdir/pkg/usr/sbin
	echo -e '#!/bin/bash\n\n/var/lib/frugalware/system/font $1' >fontconfig
	chmod 755 fontconfig
	
	# config
	install -D -m644 $startdir/src/font $startdir/pkg/etc/sysconfig/font
}

# vim: ft=sh
