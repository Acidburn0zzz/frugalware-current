# Compiling Time: 0 SBU
# Maintainer: James Buren <ryuo@frugalware.org>

Finclude kernel-version

# WARNING: DO NOT BUMP THIS DIRECTLY.
# Various buildservers have bugged their chroots repeatedly
# and produce a bad initrd. Proper checks should be done
# before merging any initrd rebuild.

pkgname=kernel-initrd
pkgver=$_F_kernelver_ver
pkgrel=1
pkgdesc="The initrd for the Frugalware Linux Kernel."
url="http://www.frugalware.org"
rodepends=('scriptlet-core')
depends=("kernel=$_F_kernelver_ver-$_F_kernelver_rel")
makedepends=('dracut>=044' 'linux-firmware>=20160113.g40e9ae8' 'xz' 'less' 'xfsprogs>=4.3.0-4' \
	'jfsutils>=1.1.15-5' 'reiserfsprogs>=3.6.24-2' 'mdadm>=3.3.4-3' 'lvm2>=2.02.140' 'systemd>=229' \
	'kmod>=22-3' 'btrfs-progs>=4.4.1' 'terminus-font-console' 'cryptsetup-luks>=1.7.0-4' \
	 'keyutils>=1.5.9-5' 'coreutils>=8.24-4' 'e2fsprogs>=1.42.13-4' )
groups=('base')
archs=('i686' 'x86_64')
up2date="$_F_kernelver_ver"

OMITTED_MODULES="multipath"
ADDED_MODULES="dmsquash-live"

build()
{
	_UNAME="$_F_kernelver_ver-fw$_F_kernelver_rel"
	_INITRD="initrd-$_UNAME"
	Fmkdir /boot
	Fexec /usr/bin/dracut 	-N \
				--xz \
				--no-hostonly-i18n \
				--force \
				-o "$OMITTED_MODULES" \
				-a "$ADDED_MODULES" \
				$Fdestdir/boot/$_INITRD \
				$_UNAME || Fdie
	Ffileschmod /boot 0644
	Fln $_INITRD /boot/initrd
}

# optimization OK
