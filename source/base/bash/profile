# /etc/profile: This file contains system-wide defaults used by
# all Bourne (and related) shells.

guess_shell() {
	if [ -z "$GUESSED_SHELL" ]; then
		GUESSED_SHELL='unknown'

		if [ -n "$BASH_VERSION" ]; then
			GUESSED_SHELL='bash'
		fi
		if [ -n "$ZSH_VERSION" ]; then
			GUESSED_SHELL='zsh'
		fi
	fi

	echo "$GUESSED_SHELL"
}

isset() {
	case "$(guess_shell)" in
	bash)
		local i
		for i in "$@"; do
			if [ ! -v "$i" ]; then
				return 1
			fi
		done
		return 0
		;;
  	*)
		(
		for i in "$@"; do
			eval : "\${${i:?}?}"
		done
		) >/dev/null 2>&1
		return $?
	esac
}

# Set the locale first
if [ -s /etc/locale.conf -a -z "$LANG" ]; then
	. /etc/locale.conf
	for i in				\
			LANG			\
			LANGUAGE		\
			LC_ADDRESS		\
			LC_COLLATE		\
			LC_CTYPE		\
			LC_IDENTIFICATION	\
			LC_MEASUREMENT		\
			LC_MESSAGES		\
			LC_MONETARY		\
			LC_NAME			\
			LC_NUMERIC		\
			LC_PAPER		\
			LC_TELEPHONE		\
			LC_TIME			\
		; do
		if isset "$i"; then
			export "$i"
		else
			unset "$i"
		fi
	done
fi

# Set HOSTNAME if not already set.
if [ -s /etc/hostname -a -z "$HOSTNAME" ]; then
	HOSTNAME="$(cat /etc/hostname)"
fi
export HOSTNAME

# Set INPUTRC for readline.
if [ -r "$HOME/.inputrc" ]; then
	INPUTRC="$HOME/.inputrc"
else
	INPUTRC="/etc/inputrc"
fi
export INPUTRC

# Set the default system PATH
PATH="/usr/local/bin:/usr/bin:/bin"

# For root users, ensure that all system binaries directories are in PATH.
if [ "$(id -u)" -eq 0 ]; then
	PATH="/usr/local/sbin:/usr/sbin:/sbin:$PATH"
fi
export PATH

# Set TERM if it's an invalid value.
if [ "$TERM" = "" -o "$TERM" = "unknown" ]; then
	TERM="linux"
fi
export TERM

# Set a default shell prompt
#PS1='`hostname`:`pwd`$ '
if [ "$SHELL" = "/bin/zsh" ]; then
	PS1='%n@%m:%~%# '
elif [ "$SHELL" = "/bin/mksh" ]; then
	PS1='$ '
else
	PS1='\u@\h:\w\$ '
fi
export PS1 PS2='> '

# Default umask.  A umask of 022 prevents new files from being created group
# and world writable.
umask 022

if [ "$TERM" = "linux" ]; then
# support for /etc/sysconfig/keymap and /etc/sysconfig/font can be dropped after 1.8
  if [ ! -e /etc/vconsole.conf -a -e /etc/sysconfig/font ]; then
    . /etc/sysconfig/font
    setfont $font
  fi
fi

# Notify user of incoming mail.  This can be overridden in the user's
# local startup file (~/.bash.login or whatever, depending on the shell)
if [ -x /usr/bin/biff ]; then
	biff y
fi

# TODO: Remove after Frugalware >= 1.2, default /etc/limits should be functionnal and avoid forkbombs.
# No forkbombs, please.
ulimit -u 256

# export DISPLAY if it's set
if [ -n "$DISPLAY" ]; then
	export DISPLAY
fi

# Append any additional sh scripts found in /etc/profile.d
for i in /etc/profile.d/*.sh; do
	if [ -x "$i" ]; then
		. "$i"
	fi
done

# Unset local variables
unset i
