# Compiling Time: 0.01 SBU
# Maintainer: Miklos Vajna <vmiklos@frugalware.org>

pkgname=pcmciautils
pkgver=015
pkgrel=3
pkgdesc="Contains the initialization tools necessary to allow the PCMCIA subsystem to behave as every other hotpluggable bus system."
url="http://kernel.org/pub/linux/utils/kernel/pcmcia/pcmcia.html"
depends=('sysfsutils>=2.1.0-3' 'module-init-tools>=3.4-7' 'udev>=124-2')
groups=('base')
backup=('etc/pcmcia/config.opts' 'etc/udev/rules.d/60-pcmcia.rules')
archs=('i686' 'x86_64' 'ppc')
up2date="lynx -dump $url |grep '\.tar.bz2$'|sed 's/.*-\(.*\)\.t.*/\1/;q'"
source=(http://kernel.org/pub/linux/utils/kernel/pcmcia/pcmciautils-$pkgver.tar.bz2 \
	http://ftp.frugalware.org/pub/other/sources/$pkgname/cis-cs-3.2.8.tar.gz)
signatures=("${source[0]}.sign" '')

build() {
	unset MAKEFLAGS
	Fsed 'CFLAGS := -pipe' "CFLAGS := $CFLAGS" Makefile
	# don't try to load the pcmcia module, it's built in
	Fsed '/sbin/modprobe' '/bin/echo' udev/rules-base
	Fbuild
	# pcmcia.rules searches for these under /lib/udev
	Fmkdir /lib/udev
	Fmv /sbin/pcmcia-check-broken-cis /lib/udev
	Fmv /sbin/pcmcia-socket-startup /lib/udev
	Fmkdir /lib/firmware
	Ffilerel $Fsrcdir/lib/firmware/*.cis /lib/firmware
	Fln pccardctl /sbin/lspcmcia
}
