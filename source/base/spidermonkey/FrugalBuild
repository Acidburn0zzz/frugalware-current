# Compiling time: 0.14 SBU
# Maintainer: crazy <crazy@frugalware.org>

pkgname=spidermonkey
pkgver=17.0.0
pkgrel=1
pkgdesc="Mozilla's C implementation of JavaScript."
url="http://www.mozilla.org/js/spidermonkey/"
license="GPL"
depends=('glibc>=2.22-3' 'nspr>=4.11-3' 'zlib>=1.2.8-3' 'libstdc++>=5.3.0-2' \
	'readline>=6.3-7' 'ncurses>=6.0-4' 'libffi>=3.2.1')
makedepends=('zip' 'perl>=5.22.1')
archs=('i686' 'x86_64' 'arm')
groups=('base')
options+=('force')
up2date="$pkgver" ## no way to get something valid
source=(http://ftp.mozilla.org/pub/mozilla.org/js/mozjs$pkgver.tar.gz \
	mozjs-fixes-1.patch)
sha1sums=('7805174898c34e5d3c3b256117af9944ba825c89' \
          'fecd9d1bcc153c2ce58eb7e451acba41df3d2c2a')

if [ "$CARCH" = "arm" ]; then
	Fconfopts="--with-cpu-arch=armv5te" ## ?!?
fi

build() {

	Fcd mozjs$pkgver
	Fpatchall

	cd js/src || Fdie
	Fconf \
		--with-system-nspr \
		--enable-threadsafe \
		--enable-jemalloc \
		--enable-system-ffi \
		--enable-readline
	make || Fdie
	make DESTDIR=$Fdestdir install || Fdie

}


# optimization OK
