# Last Modified: Sun Dec 27 13:10:32 CEST 2004
# Compiling Time: ~1 minute
# Maintainer: VMiklos <mamajom@axelero.hu>
# Modified by Adam Zlehovszky

pkgname=hotplug
pkgver=2004_09_23
pkgrel=1
pkgdesc="Lets you plug in new USB and PCI devices and use them immediately"
depends=()
url="http://telia.dl.sourceforge.net/sourceforge/linux-hotplug/"
backup=(etc/hotplug/{usb.usermap,usb.handmap,usb.distmap,blacklist})
install=$pkgname.install
up2date=`lynx -dump 'http://www.kernel.org/pub/linux/utils/kernel/hotplug/?C=M;O=D'|grep 'hotplug-[0-9_]*\.tar.gz$' |sed -n 's/.*-\(.*\)\.t.*/\1/;1 p'`
source=(ftp://ftp.kernel.org/pub/linux/utils/kernel/hotplug/$pkgname-$pkgver.tar.gz rc.$pkgname $pkgname-$pkgver-interfaces.diff $pkgname-$pkgver-silent.diff) 
md5sums=('1542af9cbe1053cfde9421007f702cf2' '11ec26c3de32e57c25ef55673f5c99de'\
         'ccf343b02d2e98d472536fe9e82267ed' '006811b1bbde166364f4bf1f3589e08d')

build() {
	cd $startdir/src/$pkgname-$pkgver
	patch -p1 < $startdir/src/$pkgname-$pkgver-silent.diff
	patch -p1 < $startdir/src/$pkgname-$pkgver-interfaces.diff

	make prefix=$startdir/pkg install

	cp $startdir/src/$pkgname-$pkgver/etc/hotplug/pnp.distmap $startdir/pkg/etc/hotplug/
	mv $startdir/pkg/etc/init.d/hotplug $startdir/pkg/etc/hotplug/
	rmdir $startdir/pkg/etc/init.d
	mkdir -p $startdir/pkg/etc/rc.d/rc.messages
	install -m755 $startdir/rc.$pkgname $startdir/pkg/etc/rc.d/rc.$pkgname
	install -m644 $startdir/messages/$pkgname.* \
		$startdir/pkg/etc/rc.d/rc.messages
	mkdir -p $startdir/pkg/var/lock/subsys
}
