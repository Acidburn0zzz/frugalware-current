# Compiling Time: 0.35 SBU
# Maintainer: VMiklos <vmiklos@frugalware.org>

pkgname=shadow
pkgver=4.0.18.1
pkgrel=5
pkgdesc="Shadow password file utilities"
url="http://shadow.pld.org.pl"
backup=(etc/{login.defs,group,passwd,shadow,adduser.conf} etc/limits)
depends=('glibc')
rodepends=('frugalware') # for /etc/issue
groups=('base' 'chroot-core')
archs=('i686' 'x86_64' 'ppc')
up2date="lynx -dump ftp://ftp.pld.org.pl/software/shadow|grep tar.bz2$|sed 's/.*-\(.*\)\.t.*/\1/;q'"
source=(ftp://ftp.pld.org.pl/software/$pkgname/$pkgname-$pkgver.tar.bz2 \
        adduser group passwd shadow $pkgname-4.0.13-login_defs.diff \
	shadow-4.0.16-useradd.diff shadow-4.0.18.1-groups.diff adduser.conf)
sha1sums=('1a30458e9db05560bfc82529048bd5d60b45cf9b' \
	  '0a66f80c88fba31e5666dd9c986871f0d6468bb1' \
	  'fcdfccf5e6741d2f310e18c2bfa26b205832240a' \
	  'e1554d118f582a978b4b14c348c155af957a1368' \
	  'a70e741ccea2d2f81b25b8b608a5fc3d3ab83ebe' \
	  'a3bcae5d8a4cf64c13599d047d963801962b6f4e' \
	  '2edf92c64691c775f8b5962ae6092aa8352ae627' \
	  'c13cf8b5c566e129d4fc62ad3ac08b6c856c992e' \
	  '6a5096d7c64c1c9be7c5408a35b125914b2715f7')

build()
{
	Fbuild --enable-static=yes --enable-shared=no --disable-desrpc \
		--mandir=/usr/man --without-selinux
	Frm /bin/{vigr,sg}
	Frm /lib/lib{misc,shadow}.{a,la}
	Ffilerel etc/login.defs /etc/login.defs
	Ffilerel etc/login.access /etc/login.access
	Fexe /usr/sbin/adduser
	Ffile /etc/group
	Ffile /etc/passwd
	Fsed '\(#sysadm  -\)' '\1\n# max number of processes for users\n* U 256/' etc/limits
	Ffilerel etc/limits /etc/limits
	Finstall 600 /etc/shadow
	Ffile /etc/adduser.conf
}

# optimization ok

