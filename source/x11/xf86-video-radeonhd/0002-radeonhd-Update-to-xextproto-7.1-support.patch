From b22e7a21a589b5205ad61a8cf39a61c8e5ca5791 Mon Sep 17 00:00:00 2001
From: Peter Hutterer <peter.hutterer@who-t.net>
Date: Thu, 16 Jul 2009 13:27:21 +1000
Subject: [PATCH] radeonhd: Update to xextproto 7.1 support.

DPMS header was split into dpms.h (client) and dpmsconst.h (server). Drivers
need to include dpmsconst.h if xextproto 7.1 is available.

Signed-off-by: Peter Hutterer <peter.hutterer@who-t.net>
---
 configure.ac          |    4 ++++
 src/rhd_biosscratch.c |    5 +++++
 src/rhd_driver.c      |    5 +++++
 src/rhd_randr.c       |    5 +++++
 4 files changed, 19 insertions(+), 0 deletions(-)

diff --git a/configure.ac b/configure.ac
index 7680a3d..c2f06cf 100644
--- a/configure.ac
+++ b/configure.ac
@@ -79,6 +79,10 @@ XORG_DRIVER_CHECK_EXT(DPMSExtension, xextproto)
 # @@@@ need to check for the right server version once RandR 1.2 is in.
 # @@@ do we really need fontsproto here?
 PKG_CHECK_MODULES(XORG, [xorg-server xproto fontsproto $REQUIRED_MODULES])
+PKG_CHECK_MODULES(XEXT, [xextproto >= 7.0.99.1],
+                  HAVE_XEXTPROTO_71="yes"; AC_DEFINE(HAVE_XEXTPROTO_71, 1, [xextproto 7.1 available]),
+                  HAVE_XEXTPROTO_71="no")
+AM_CONDITIONAL(HAVE_XEXTPROTO_71, [ test "$HAVE_XEXTPROTO_71" = "yes" ])
 sdkdir=$(pkg-config --variable=sdkdir xorg-server)
 
 
diff --git a/src/rhd_biosscratch.c b/src/rhd_biosscratch.c
index d2a905c..87cbd4c 100644
--- a/src/rhd_biosscratch.c
+++ b/src/rhd_biosscratch.c
@@ -43,8 +43,13 @@
 #  include <stdio.h>
 # endif
 
+#ifdef HAVE_XEXTPROTO_71
+# include "X11/extensions/dpmsconst.h"
+#else
 # define DPMS_SERVER
 # include "X11/extensions/dpms.h"
+#endif
+
 
 # include "rhd.h"
 
diff --git a/src/rhd_driver.c b/src/rhd_driver.c
index ba60253..a208978 100644
--- a/src/rhd_driver.c
+++ b/src/rhd_driver.c
@@ -66,8 +66,13 @@
 /* Needed by Resources Access Control (RAC) */
 #include "xf86RAC.h"
 
+#ifdef HAVE_XEXTPROTO_71
+#include "X11/extensions/dpmsconst.h"
+#else
 #define DPMS_SERVER
 #include "X11/extensions/dpms.h"
+#endif
+
 
 /* int10 - for now at least */
 #include "xf86int10.h"
diff --git a/src/rhd_randr.c b/src/rhd_randr.c
index 1ed9562..3fc2f14 100644
--- a/src/rhd_randr.c
+++ b/src/rhd_randr.c
@@ -48,8 +48,13 @@
 # include "xf86RandR12.h"
 # include "xaa.h"
 # include "exa.h"
+#ifdef HAVE_XEXTPROTO_71
+# include "X11/extensions/dpmsconst.h"
+#else
 # define DPMS_SERVER
 # include "X11/extensions/dpms.h"
+#endif
+
 # include "X11/Xatom.h"
 #endif /* RANDR_12_SUPPORT */
 
-- 
1.6.3.3

