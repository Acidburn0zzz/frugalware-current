# Last Modified: Wed, 03 May 2006 21:48:38 +0200
# Compiling Time: 6.34 SBU
# Maintainer: Christian Hamar alias krix <krics@linuxforum.hu>

pkgname=xorg-server
pkgver=1.0.2
pkgrel=2
mesaver=6.4.2
pkgdesc="X.Org X server"
url="http://xorg.freedesktop.org"
groups=('x11' 'xorg-core')
archs=('i686' 'x86_64')
depends=('libxfont' 'libx11' 'xtrans' 'libxau' 'libxext' 'libxkbfile' 'libxdmcp' 'libxmu' 'libxrender' 'libxi' 'freetype2' 'mesa' 'font-cursor-misc' 'font-misc-misc' 'xbitmaps' 'xkbdata' 'iceauth' 'rgb' 'xauth' 'xinit' 'libxaw' 'libxpm' 'libxxf86misc' 'libxxf86vm' 'libxkbui' 'liblbxutil' 'xorg-cf-files' 'libxtst' 'font-alias')
makedepends=('randrproto' 'renderproto' 'fixesproto' 'damageproto' 'xextproto' 'xproto' 'xf86dgaproto' 'xf86miscproto' 'xf86rushproto' 'xf86vidmodeproto' 'xf86bigfontproto' 'compositeproto' 'recordproto' 'resourceproto' 'videoproto' 'scrnsaverproto' 'evieext' 'trapproto' 'xineramaproto' 'fontsproto' 'kbproto' 'inputproto' 'bigreqsproto' 'xcmiscproto' 'glproto' 'xf86driproto' 'libdrm' 'printproto' 'mkfontdir' 'mkfontscale' 'fontcacheproto')
rodepends=('xf86-input-mouse' 'xf86-input-keyboard' 'xf86-video-vga')
provides=('xorg-compat')
replaces=('xorg-compat')
backup=('etc/sysconfig/desktop')
Finclude xorg
source=(${source[@]} http://dl.sourceforge.net/sourceforge/mesa3d/MesaLib-$mesaver.tar.bz2 \
	http://xorg.freedesktop.org/releases/X11R7.0/patches/xorg-server-1.0.x-mitri.diff \
	01-kernel-headers-fix.patch \
	02-access_c_skip_null_addresses.patch \
	03-black-background.patch \
	desktop \
	rc.xprint \
	xorg-server-1.0.1-amd64-fix-for-glx.patch)
sha1sums=('b2257e984c5111093ca80f1f63a7a9befa20b6c0' \
	  '4f042bdf38c9eb62e04660bd18566e7ca50d8640' \
	  'd6eba2bddac69f12f21785ea94397b206727ba93' \
	  'f31702e0029b2d68018598e73ed55c4d6c58367b' \
	  '859b98a4049400be152032fc09ceff2afe9e6dcf' \
	  '863ad92892785c3785b122bf54d0def4d4d2732c' \
	  '937809482a6b5625c1e6af704654c2d2b5c6b48b' \
	  '4713d46b31eafbde58a1fafe8269642df6a12d77' \
	  'cb1044491f63105e166899439fc0ba250133305a')

# BUILD HANDY HACK: 
# You need to put a /etc/mtab into the chroot to build propeply...

build() {
	cd $Fsrcdir/Mesa-$mesaver || Fdie
	[ "$CARCH" == "x86_64" ] && Fpatch xorg-server-1.0.1-amd64-fix-for-glx.patch

	cd $Fsrcdir/$pkgname-$pkgver || Fdie
	Fpatch 01-kernel-headers-fix.patch
	Fpatch 02-access_c_skip_null_addresses.patch
	Fpatch 03-black-background.patch
	Fpatch xorg-server-1.0.x-mitri.diff

	Fmake --disable-static \
		--enable-ipv6 \
		--enable-dri \
		--enable-xprint \
		--enable-xcsecurity \
		--enable-xorg \
		--enable-xtrap \
		--enable-xevie \
		--enable-vfb \
		--sysconfdir=/etc/X11 \
		--localstatedir=/var \
		--disable-static \
		--enable-multibuffer \
		--with-mesa-source=$Fsrcdir/Mesa-$mesaver \
		--with-vendor-web="http://www.frugalware.org" \
		--with-os-name="Linux" \
		--with-os-vendor="Frugalware" \
		--with-xkb-output=/var/lib/xkb
	Fmakeinstall

	Ffile /etc/sysconfig/desktop
	Frcd xprint
}

# optimization OK
