# Compiling Time: 0.05 SBU
# Maintainer: Christian Hamar alias krix <krics@linuxforum.hu>

USE_DEVEL=${USE_DEVEL:-"n"}

pkgname=libdrm
pkgver=2.4.17
pkgrel=3
pkgdesc="X.Org Userspace interface to kernel DRM services"
url="http://xorg.freedesktop.org/"
depends=('libpthread-stubs')
archs=('i686' 'x86_64' 'ppc')
groups=('x11' 'xorg-core' 'xorg-libs')
if Fuse $USE_DEVEL; then
	pkgver=$pkgver.g2d9990c
	_F_scm_type="git"
	_F_scm_url="git://anongit.freedesktop.org/mesa/drm"
	Finclude scm
else
	up2date="Flasttar http://dri.freedesktop.org/libdrm/"
	source=("http://dri.freedesktop.org/libdrm/libdrm-$pkgver.tar.bz2")
	sha1sums=('52f12fc75ecf3d0c2e89579b7454f040ac515aa6')

	# Remove after kernel>=2.6.34 and the following temporary fix
	# 2.4.17 is required for nouveau with kernel 2.6.33
	source=("${source[@]}" 'nouveau_class.h')
	sha1sums=("${sha1sums[@]}" '8f25600294ea685cfceb6e0a1c2623c241fb13db')
	subrodepends=('kernel<=2.6.33')
	Fconfopts="${Fconfopts[@]} --enable-radeon-experimental-api"
	options=('force')
fi

build()
{
	if Fuse $USE_DEVEL; then
		Funpack_scm
		./autogen.sh
	else
		# Temporary fix
		Fcd
		Fexec cp -f $Fsrcdir/nouveau_class.h nouveau/
	fi
	Fbuild \
		--enable-libkms \
		--enable-intel \
		--enable-radeon \
		--enable-nouveau-experimental-api \
		--enable-vmwgfx-experimental-api
}

# optimization OK
