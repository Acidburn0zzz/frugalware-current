# Compiling Time: 0.44 SBU
# Maintainer: crazy <crazy@frugalware.org>
# Contributor: bouleetbil <bouleetbil@frogdev.info>

USE_DEVEL=${USE_DEVEL:-"n"}

pkgname=xf86-video-ati
pkgver=7.8.0
Fuse $USE_DEVEL && pkgver=6.15.gb5cf9bd
pkgrel=2
pkgdesc="X.Org driver for ATI cards"
url="http://xorg.freedesktop.org"
groups=('x11' 'xorg-core' 'xorg-drivers')
archs=('i686' 'x86_64')
depends=('xorg-server>=1.18.4-5')
Finclude xorg
## remove all these for 7.8.1++
source+=(0002-Use-DRM_MODE_PAGE_FLIP_TARGET_ABSOLUTE-RELATIVE-flag.patch \
	0003-Enable-glamor-by-default-with-R600-and-Xorg-1.18.3.patch \
	0004-Don-t-install-Flush-EventCallback-for-GPU-screens.patch \
	0005-Pass-fb_id-into-drmmode_page_flip_target_absolute-re.patch \
	0006-fix-build-for-xserver-1.13.patch \
	0007-Add-radeon_is_gpu_screen-helper.patch \
	0008-Take-current-scanout_id-into-account-everywhere-invo.patch \
	0009-Fix-radeon_scanout_extents_intersect-for-GPU-screens.patch \
	0010-Call-ValidateGC-after-ChangeClip-in-radeon_sync_scan.patch \
	0011-Call-radeon_drm_abort_entry-on-failure-to-flip-to-a-.patch)

sha1sums=('30c4470d1252eade1d5c5998e42b66b0ac80a638' \
          'eb297050b44287c447723151e16913404522988c' \
          'e6324b46f0acb3358a08114d5b197ea5630543d7' \
          '2cb9673b10388ec503fab0e699ae7d4be356bf3b' \
          '05951c1cc40b2c3e827d1fb987aec9239c33c367' \
          '5921a6d2ae14c4128b131d44e053ea3106b9a8df' \
          'bd34d4d5e8f37ff6927109ddda96941e6bbe435b' \
          'f5dd96cb14767b4e96c5184bf0810c8daca4c9a4' \
          '3666b88593e516311f81bcbfd6578be8b7dfb075' \
          'dc411fb669f1073cd7b656eca2b262e171916114' \
          'e1fd9e0e853e59bfc36c5d0dd0ca54c066574b71')

replaces=('xf86-video-radeonhd')
conflicts=('xf86-video-radeonhd')

# NOTE: TVout interface not available on x86_64
# NOTE: Do not panic if you see at configure time "Only PCI cards" or similary. That is for
#       not using ISA detection code.. So PCI and AGP works too :)

if Fuse $USE_DEVEL; then
	unset source sha1sums
	_F_scm_type="git"
	_F_scm_url="git://anongit.freedesktop.org/xorg/driver/xf86-video-ati"
	Finclude scm
	makedepends=(${makedepends[@]} 'util-macros')
fi

Fconfopts+="	--enable-glamor
		--enable-udev"
build() {
	if Fuse $USE_DEVEL; then
		Funpack_scm
		Fautoreconf
	fi
	Fbuild
}

# optimization OK
