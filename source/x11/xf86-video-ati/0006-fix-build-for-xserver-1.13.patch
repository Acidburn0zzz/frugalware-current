From 487aa62a2a23b86e4ea4714fdfd465c9e513141f Mon Sep 17 00:00:00 2001
From: Jochen Rollwagen <joro-2013@t-online.de>
Date: Thu, 24 Nov 2016 18:44:01 +0100
Subject: [PATCH 06/11] fix build for xserver < 1.13
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

same procedure every few patches.....

Fixes: 13c6bc5e3827 ("Don't install Flush/EventCallback for GPU screens")
Reviewed-by: Michel DÃ¤nzer <michel.daenzer@amd.com>
---
 src/radeon_kms.c | 6 +++++-
 1 file changed, 5 insertions(+), 1 deletion(-)

diff --git a/src/radeon_kms.c b/src/radeon_kms.c
index dcf41578..d0a474e0 100644
--- a/src/radeon_kms.c
+++ b/src/radeon_kms.c
@@ -360,7 +360,11 @@ static Bool RADEONCreateScreenResources_KMS(ScreenPtr pScreen)
 	radeon_glamor_create_screen_resources(pScreen);
 
     info->callback_event_type = -1;
-    if (!pScreen->isGPU && (damage_ext = CheckExtension("DAMAGE"))) {
+    if (
+#ifdef RADEON_PIXMAP_SHARING
+	!pScreen->isGPU &&
+#endif
+	(damage_ext = CheckExtension("DAMAGE"))) {
 	info->callback_event_type = damage_ext->eventBase + XDamageNotify;
 
 	if (!AddCallback(&FlushCallback, radeon_flush_callback, pScrn))
-- 
2.11.0

