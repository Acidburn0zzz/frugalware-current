# Last Modified: Fri, 27 Jan 2006 02:36:51 +0100
# Compiling Time: 1.14 SBU
# Maintainer: crazy <malagarax@gmx.net>

pkgname=mesa
origname=Mesa
pkgver=6.4.1
pkgrel=1
pkgdesc="Mesa is a 3D graphics library"
url="http://mesa3d.sourceforge.net/"
depends=('expat' 'libx11' 'libxext' 'libxxf86vm' 'libxi' 'libxmu' 'libice' 'libdrm')
makedepends=('makedepend' 'glproto' 'xf86vidmodeproto')
archs=('i686' 'x86_64')
groups=('x11' 'xorg-core' 'xorg-libs')
provides=('opengl')
up2date="lynx -dump $url/news.html|grep stable|sed 's/.*a \(.*\) h.*/\1/;q'"
source=(http://heanet.dl.sourceforge.net/sourceforge/mesa3d/MesaLib-$pkgver.tar.bz2 \
	libGL.la libGLU.la)
sha1sums=('efb70276ccd9cd13dbd7d5e581213a5ca3e4ef25' \
	  '650973d708466f5c4c21e70c1f1f6c118b27e614' \
	  '12c57ac5e7e8a94d4d41b0f37b0fb3f470791c39')

build()
{
	Fcd $origname-$pkgver

	[ "$CARCH" == "i686" ] && CONFIG=linux-dri-x86
	[ "$CARCH" == "x86_64" ] && CONFIG=linux-dri-x86-64 && dripath=64
	[ "$CARCH" == "ppc" ] && CONFIG=linux-dri-ppc
	HOSTCONF="configs/${CONFIG}"

	Fsed "MKDEP = /usr/X11R6/bin/makedepend" "MKDEP = /usr/bin/makedepend" configs/linux-dri
	Fsed '#define DEFAULT_DRIVER_DIR "/usr/X11R6/lib/modules/dri"' '#define DEFAULT_DRIVER_DIR "/usr/lib/xorg/modules/dri"' src/glx/x11/dri_glx.c

	echo "OPT_FLAGS = ${CFLAGS}" >> ${HOSTCONF}
	echo "SRC_DIRS = glx/x11 mesa glu glw" >> ${HOSTCONF}
	echo "USING_EGL = 0" >> ${HOSTCONF}
	echo "PROGRAM_DIRS =" >> ${HOSTCONF}
	
	make ${CONFIG} || return 1

	Fmkdir /usr

	make DESTDIR=$Fdestdir/usr install

	Fmkdir /usr/share/doc/$pkgname-$pkgver
	cp -r docs/{README.*,*.html,RELNOTES-$pkgver,COPYING,VERSIONS} \
		$Fdestdir/usr/share/doc/$pkgname-$pkgver/
	
	Fmkdir /usr/lib/xorg/modules/dri
	cp -ar $Fsrcdir/$origname-$pkgver/lib$dripath/*_dri.so $Fdestdir/usr/lib/xorg/modules/dri
	cp -ar $Fsrcdir/libGLU.la $Fdestdir/usr/lib
	cp -ar $Fsrcdir/libGL.la $Fdestdir/usr/lib
	
	Fln libGLU.so.1.3.060401 /usr/lib/libGLU.so.1.3
	Fln libGLw.so.1.0.0 /usr/lib/libGLw.so.1.0
}

# optimalization OK
