# Compiling time: 24.85 SBU
# Maintainer: voroskoi <voroskoi@frugalware.org>

pkgname=seamonkey
pkgver=2.1
pkgrel=1
pkgdesc="Seamonkey all-in-one internet application suite"
url="http://www.mozilla.org/projects/seamonkey/"
depends=('libstdc++' 'gtk+2>=2.20.0-2' 'libxau>=1.0.4' 'libxdmcp' 'libxdamage' 'libxml2' 'libidl' 'libxt' 'libice' 'nss>=3.12.9' 'libxft' 'dbus-glib' 'alsa-lib' \
        'ibnotify')
makedepends=('zip')
options=('scriptlet')
groups=('xapps-extra')
archs=('i686' 'x86_64' 'ppc')
up2date="lynx -dump $url |grep SeaMonkey -m4 |sed -ne 's/.*Monkey \(.*\)/\1/;$ p'"
source=(http://releases.mozilla.org/pub/mozilla.org/$pkgname/releases/$pkgver/source/$pkgname-$pkgver.source.tar.bz2 \
	config $pkgname.desktop)

build()
{
	unset MAKEFLAGS
	Fcd comm-2.0
	Fsed "png_voidp_NULL" "NULL" mozilla/modules/libpr0n/encoders/png/nsPNGEncoder.cpp
	export CFLAGS="$CFLAGS -fno-strict-aliasing"
	export CXXFLAGS="$CXXFLAGS -fno-strict-aliasing"
	sed "s/-march=i686 -O2 -pipe/$CFLAGS/" $startdir/src/config > .mozconfig
	Fpatchall

	make -f client.mk build || Fdie
	make || Fdie

	Fmkdir /usr
	Fmakeinstall

	# Get rid of versions in path names.
	Fmv /usr/lib/$pkgname-$pkgver /usr/lib/$pkgname
	Fln $pkgname /usr/lib/$pkgname-$pkgver

	# Plugins.
	Fmv /usr/lib/$pkgname/plugins /usr/lib/$pkgname/plugins.orig
	Fln ../mozilla/plugins/ /usr/lib/$pkgname/plugins

	# Install icon for the menu file.
	Fmkdir /usr/share/pixmaps/
	Ffile comm-1.9.1/suite/branding/icons/gtk/$pkgname.png /usr/share/pixmaps/$pkgname.png

	# Install menu file.
	Ffile /usr/share/applications/$pkgname.desktop

	#broken link
	Frm usr/bin/seamonkey
	Fwrapper '/usr/lib/seamonkey/seamonkey $@' $pkgname
}
sha1sums=('8d48aaf5ff3a5e88bf8c93b8414776a085f370d5' \
          '1864fa4117650bb9a576664943aaf4ab56b7d248' \
          'b0e0bdd676758e19cac4a0429257a92183328f0e')

# optimization OK
