# Compiling Time: ~5.97 SBU
# Maintainer: CSÉCSY László <boobaa@frugalware.org>

options+=('asneeded')

pkgname=wireshark
pkgver=1.8.15
pkgrel=1arcturus2
pkgdesc="The world's most popular network protocol analyzer"
url="http://www.wireshark.org/"
depends=('libkrb5' 'gtk+2>=2.20.0-2' 'libpcap' 'gnutls>=2.12.12' 'openssl>=1.0.0')
makedepends=('krb5')
groups=('xapps-extra')
archs=('i686' 'x86_64')
options=('scriptlet')
_F_gnome_iconcache="y"
_F_gnome_desktop="y"
Finclude gnome-scriptlet
up2date="lynx -dump http://www.wireshark.org/download.html | grep stable -m1 | sed 's/.*is \(.*\)\. .*/\1/'"
source=(http://www.wireshark.org/download/src//all-versions/$pkgname-$pkgver.tar.bz2)
sha1sums=('0c5d87db77acb4508819d4d5d3674265a7444f49')

## TODO: split GUI / utils

# FSA fix ***
source=(${source[@]} CVE-2014-5161-5162.patch CVE-2014-5163.patch
                     CVE-2014-5164.patch CVE-2014-5165.patch CVE-2014-8710.patch
                     CVE-2014-8711.patch CVE-2014-8712.patch CVE-2014-8713.patch
                     CVE-2014-8714.patch)
sha1sums=(${sha1sums[@]} 'c6041fcb35ce7bda66f4185f37d4ec44d5b8861b' \
                         'f0894ed02dd2c165dd5af72db14ac8dede1ae9d6' \
                         '5b53305699847d21bd21991639756d1a932043cf' \
                         '29d9cfb8f381fe85374168f1c48e7a8716da7443' \
                         '6e1a14a5e48bb3b5e9629c6ff7a2f01902fd683b' \
                         'b54cfe0f961a5bc4dc785f12a5e0246addd8c6d8' \
                         '843ad111b868ddf2e7e3b7cf1fa477e8ddd01225' \
                         'f2bad25d4e1e24e9906f98a9c1eff0a6c4629980' \
                         '311ce10f11d07d163e0e3f3d302f1159c4dd21e8')
# ***********


build()
{
	Fbuild --with-ssl
	## install icons and create a desktop file
	for i in 16 32 48
	do
		Ffilerel image/hi${i}-app-wireshark.png \
			/usr/share/icons/hicolor/${i}x$i/apps/$pkgname.png
		Ffilerel image/lo${i}-app-wireshark.png \
                        /usr/share/icons/locolor/${i}x$i/apps/$pkgname.png
	done

	## GNOME/XFCE one
	_F_desktop_name="Wireshark"
	_F_desktop_categories="Qt;Gtk;Network;"
	_F_desktop_exec="gksu $pkgname"
	_F_desktop_icon="$pkgname.png"
	_F_desktop_show_in="XFCE;GNOME;"
	Fdesktop2
	## KDE one
	_F_desktop_name="Wireshark"
	_F_desktop_categories="Qt;Gtk;Network;"
	_F_desktop_exec="kdesu $pkgname"
	_F_desktop_icon="$pkgname.png"
	_F_desktop_filename="$pkgname-kde"
	_F_desktop_show_in="KDE;"
	Fdesktop2
	Fbuild_gnome_scriptlet
}

# optimization OK
