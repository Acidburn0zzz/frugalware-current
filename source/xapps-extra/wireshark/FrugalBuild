# Compiling Time: ~5.97 SBU
# Maintainer: crazy <crazy@frugalware.org>

pkgname=wireshark
pkgver=2.0.5
pkgrel=1
pkgdesc="The world's most popular network protocol analyzer."
url="http://www.wireshark.org/"
depends=('glib2' 'lua' 'c-ares' 'gnutls' 'libkrb5' 'geoip' 'libpcap' 'libusb1' 'dbus' 'libnl')
makedepends=('krb5' 'x11-protos')
groups=('xapps-extra')
archs=('i686' 'x86_64')
options+=('scriptlet')
up2date="lynx -dump http://www.wireshark.org/download.html | grep stable -m1 | sed 's/.*is \(.*\)\. .*/\1/'"
source=(https://2.na.dl.wireshark.org/src/all-versions/$pkgname-$pkgver.tar.bz2 \
	wireshark-2.0.5-lua_5_3.patch \
	stop-using-junk-in-version-string.patch \
	qt5.7-c++11.patch)
## without the patch we have (SVN Rev Unknown from unknown) in version string
sha1sums=('ab77c632d8babf731bf0ecac0876fe3ff2923d04' \
          'd3a6c790eeeb89db288134577b0ce0b733bfa404' \
          '4d9de6843cdb6ccb0c50d18b404752c6b022968f' \
          '2ec8a4382096b4c76427b90dd3eb280417186da5')

subpkgs+=("$pkgname-gtk")
subdescs+=("$pkgdesc (Gtk3 frontend)")
subdepends+=('sbc portaudio gtk+3 libnl lua c-ares geoip')
subrodepends+=("$pkgname>=$pkgver")
subgroups+=('xapps-extra')
subarchs+=('i686 x86_64')

subpkgs+=("$pkgname-qt")
subdescs+=("$pkgdesc (Qt5 frontend)")
subdepends+=('sbc qt5-base qt5-multimedia libnl lua c-ares geoip')
subrodepends+=("$pkgname>=$pkgver")
subgroups+=('xapps-extra')
subarchs+=('i686 x86_64')


build()
{
	Fcd
	Fpatchall
	Fautoreconf
	Fmake \
		--with-ssl \
		--with-qt=5 \
		--with-gtk3=yes \
		--with-dumpcap-group=netdev
	Fmakeinstall

	Fsplit $pkgname-gtk  usr/bin/$pkgname-gtk
	Fsplit $pkgname-gtk  usr/share/applications/$pkgname-gtk.desktop
	Fsplit $pkgname-qt   usr/bin/$pkgname
	Fsplit $pkgname-qt   usr/share/applications/$pkgname.desktop
}

# optimization OK
