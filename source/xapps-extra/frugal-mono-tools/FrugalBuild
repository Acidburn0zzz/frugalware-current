# Compiling Time: 0.02 SBU
# Maintainer: bouleetbil <bouleetbil@frogdev.info>

pkgname=frugal-mono-tools
pkgver=0.1.4
pkgrel=1
url="http://ftp.frugalware.org/pub/other/people/bouleetbil/frugal-mono-tools/"
up2date="Flasttar $url/releases/"
source=($url/releases/$pkgname-$pkgver.tar.gz rc.frugal-mono-tools \
	$url/releases/frugal-python-tools-$pkgver.tar.gz)
pkgdesc="C# Frugalware configuration utility"
depends=('gtk2-sharp' 'notify-sharp' 'webkit-sharp>=0.3' 'vte-python')
rodepends=('gtk-usermode')
options=('scriptlet')
groups=('xapps-extra')
archs=('i686' 'x86_64' 'ppc')
Finclude mono
sha1sums=('c205c15b4283fbb43659f799ed86b1cc41db4a0d' \
          '73fbee331e5d48cfcb20496d3e298567faddb034' \
          'fb3fc4cac9bb94f6167f5edd668f7aaad232531f')

build() {
	Fcd
	Fmonoexport
	Fmkdir usr/share/pixmaps
	Fmkdir etc/xdg/autostart/
	Fmkdir usr/share/applications/
	Fbuild
	#For start it with Xsession
	Fcp $pkgname-$pkgver/frugal-mono-tools.desktop \
		etc/xdg/autostart/frugal-mono-tools.desktop
	Fcp $pkgname-$pkgver/frugal-mono-tools/fw.png usr/share/pixmaps/FrugalTools.png
	#python terminal
	Fcp frugal-mono-tools/PyUtils/PyVTE.py /usr/bin/PyFrugalVTE
	#irc python client for join #frugalware
	Fcp frugal-mono-tools/PyUtils/irc.py /usr/bin/PyFrugalIRC
	
	#for can start it wit root user
	_F_desktop_exec="sucontrolcenter"
	_F_desktop_name="frugalware configuration"
	_F_desktop_desc="Tools to configure Frugalware"
	_F_desktop_icon="FrugalTools.png"
	_F_desktop_categories="Application;GTK;System;"
	Fdesktop2

	Fmkdir usr/share/apps/sucontrolcenter
	Fmkdir etc/pam.d
	Fmkdir etc/security/console.apps

cat > $Fdestdir/usr/share/apps/sucontrolcenter/sucontrolcenter << "EOF"
#!/bin/sh
exec frugal-mono-tools
EOF

	chmod +x $Fdestdir/usr/share/apps/sucontrolcenter/sucontrolcenter || Fdie

cat > $Fdestdir/etc/pam.d/sucontrolcenter << "EOF"
#%PAM-1.0
auth        include     config-control-center
account     include     config-control-center
session     include     config-control-center
EOF

cat > $Fdestdir/etc/pam.d/config-control-center << "EOF"
#%PAM-1.0
auth		sufficient	pam_rootok.so
auth		sufficient	pam_timestamp.so
auth		include		system-auth
account		required	pam_permit.so
session		required	pam_permit.so
session		optional	pam_xauth.so
session		optional	pam_timestamp.so
EOF

cat >  $Fdestdir/etc/security/console.apps/sucontrolcenter << "EOF"
USER=root
PROGRAM=/usr/share/apps/sucontrolcenter/sucontrolcenter
SESSION=true
EOF

	Fln /usr/bin/consolehelper /usr/bin/sucontrolcenter

	Fmonocleanup
	Frcd2
}
