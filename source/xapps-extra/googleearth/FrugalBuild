# Compiling Time: 0.09 SBU
# Maintainer: Miklos Vajna <vmiklos@frugalware.org>

pkgname=googleearth
pkgver=5.0
pkgrel=5
pkgdesc="A 3D interface to the planet"
url="http://earth.google.com/"
depends=('mesa' 'libsm' 'openssl' 'curl' 'libstdc++' 'libxcursor' 'libmng' 'libxft' 'libpng')
groups=('xapps-extra')
archs=('i686')
up2date="lynx -dump http://earth.google.com/download-earth.html|grep 'Download Google Earth'|sed 's/.* \([0-9\.]\+\) .*/\1/;q'"
source=(http://dl.google.com/earth/client/current/GoogleEarthLinux.bin)
sha1sums=('784a9568f9c89682bb787a93644ce03052a0cfea')
options=('nobuild' 'nostrip' 'noversrc')

build()
{
	Funpack_makeself GoogleEarthLinux.bin
	Fcd GoogleEarthLinux
	Fsed '$SETUP_INSTALLPATH/' '' postinstall.sh
	Fsed ' --user' ' --system' postinstall.sh
	Fsed '$SETUP_INSTALLPATH' '1' postinstall.sh
	Fsed '/usr' "$Fdestdir/usr" linux/xdg/xdg-{mime,desktop-menu}
	Fsed '-x $x/update-mime' '-d junk' linux/xdg/xdg-{mime,desktop-menu}
	Fsed '-x $x/update-desktop' '-d junk' linux/xdg/xdg-{mime,desktop-menu}
	Fmkdir /usr/{bin,share/{appl{ications,nk},gnome/apps,mime/packages}}
	./postinstall.sh || return 1
	Ficonrel googleearth-icon.png
	Fdocrel README.linux
	cd bin
	tar xpf ../googleearth-linux-x86.tar
	Fexerel * /usr/lib/googleearth/
	cd $Fdestdir/usr/lib/googleearth
	tar xpf $Fsrcdir/GoogleEarthLinux/googleearth-data.tar
	Fln /usr/lib/googleearth/googleearth /usr/bin/googleearth
	# see #3628
	Frm /usr/lib/googleearth/libcrypto.so.0.9.8
}
