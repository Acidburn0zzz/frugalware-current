# Compiling Time: 2.54 SBU
# Maintainer: Zsolt Szalai <xbit.lists@chello.hu>
# Modified by: Christian Hamar alias krix <krics@linuxforum.hu>

pkgname=tetex
pkgver=3.0
pkgrel=10
pkgdesc="teTeX is a complete TeX distribution for UNIX compatible systems - base files, librarys, fonts"
url="http://www.tug.org/teTeX/"
depends=('libstdc++' 'libxp' 'libxmu' 'libxft' 'libxpm' 'freetype2' 'fontconfig' 'expat' 'lesstif' 'zlib' 'libpng' 'tetex-kpathsea')
makedepends=('bison' 'flex' 'ncurses')
groups=('xapps-extra')
archs=('i686' 'x86_64')
up2date="lynx --dump 'ftp://dante.ctan.org/tex-archive/systems/unix/teTeX/current/distrib/'|grep \"tar.gz\" |sed -e 's/.*tetex-src-\(.*\).tar.*/\1/;q'"
source=(ftp://dante.ctan.org/tex-archive/systems/unix/teTeX/current/distrib/tetex-texmf-$pkgver.tar.gz ftp://dante.ctan.org/tex-archive/systems/unix/teTeX/current/distrib/tetex-src-$pkgver.tar.gz)
sha1sums=('10f7d2fa007c95ca066d899fca0e9a8446108824' \
	  '7637789f7f4929694aed1b89820f5bad4753e8fc')
backup=('/usr/share/texmf/web2c/texmf.cnf')
removes=('/usr/share/texmf/web2c/latex.fmt' '/usr/share/texmf/web2c/latex.log')
replaces=('tetex-base' 'tetex-bin')
conflicts=('tetex-base' 'tetex-bin')
provides=('tetex-base' 'tetex-bin')
NOEXTRACT=1 # important, src not tared as a single directory 

build() {
	[ "$CARCH" == "x86_64" ] && CFLAGS="$CFLAGS -fPIC -DPIC"
	cd $startdir/src
	mkdir texmf
	tar xzf tetex-texmf-$pkgver.tar.gz -C ./texmf
	rm -f $startdir/src/tetex-texmf-$pkgver.tar.gz
	install -d $startdir/pkg/usr/share/texmf
	cd texmf
	mv doc/latex/general/lshort.pdf $startdir/src/
	rm -rf doc/*
	cat << EOF >doc/README.frugalware
The contents of the doc directory is removed to tetex-docs package, what is
availabe in xbit's repository:
	http://wiki.frugalware.org/DRs
EOF
	mv $startdir/src/lshort.pdf doc/
	mv `ls` $startdir/pkg/usr/share/texmf
	cd ..
	rmdir texmf
	
###SRC

	tar xzf tetex-src-$pkgver.tar.gz
	cd tetex-src-$pkgver
	./configure --prefix=/usr \
		    --sysconfdir=/etc \
		    --datadir=/usr/share \
		    --enable-shared \
		    --disable-multiplatform \
		    --without-texinfo \
		    --without-dialog \
		    --without-texi2html \
		    --with-x \
		    --enable-ipc \
		    --with-system-zlib \
		    --with-system-pnglib \
		    --with-system-ncurses
	make all texmf=$startdir/pkg/usr/share/texmf || return 1

	Fmv usr/share/texmf/ls-R usr/share/texmf/ls-R.tetex-texmf.orig

	make install prefix=$startdir/pkg/usr texmf=$startdir/pkg/usr/share/texmf

	Fmv usr/share/texmf/ls-R usr/share/texmf/ls-R.tetex-bin.orig
	
	#cp $startdir/src/haltp.tex $startdir/pkg/usr/share/texmf/doc
	Frm usr/info/dir

	# Remove conflicting files with texet-kpathsea
	Frm usr/bin/{kpseaccess,kpsereadlink,kpsestat,kpsewhich,mktexlsr,mktexmf,mktexpk,mktextfm}
	Frm usr/include/kpathsea
	Frm usr/info/kpathsea.info
	Frm usr/lib/libkpathsea.*
	Frm usr/man/man1/{kpseaccess,kpsereadlink,kpsestat,kpsewhich,mktexlsr,mktexmf,mktexpk,mktextfm}.*
}

# optimalization OK

# vim: ft=sh
