From b513a493dc265854bcfe3b4c784b414f5c0ee0db Mon Sep 17 00:00:00 2001
From: bouleetbil <bouleetbil@frogdev.info>
Date: Thu, 13 Jan 2011 22:02:15 +0100
Subject: [PATCH] *fixes red icon when system is updated

---
 frugal-tweak-vala/src/MainClient.vala |    6 +++++-
 frugal-tweak-vala/src/systray.vala    |   12 ++++++------
 2 files changed, 11 insertions(+), 7 deletions(-)

diff --git a/frugal-tweak-vala/src/MainClient.vala b/frugal-tweak-vala/src/MainClient.vala
index 12de4f9..576bbc6 100644
--- a/frugal-tweak-vala/src/MainClient.vala
+++ b/frugal-tweak-vala/src/MainClient.vala
@@ -51,9 +51,13 @@ void* func()
 			pacman pacmang2 = new pacman();
 			if(pacmang2.CheckUpdate())
 			{
-				//delegateInform InformUpdate = informUpdate;
 				informUpdate();
 			}
+			else
+			{
+				Systray.Change_Ico change_ico = systrayIcon.SetIco;
+				change_ico(Systray.defaultIco);
+			}
 		}
 		Thread.usleep(1800000000);	//1/2 hour
 		//roadmap.GetDateRelease();
diff --git a/frugal-tweak-vala/src/systray.vala b/frugal-tweak-vala/src/systray.vala
index 6108f10..7daa2d1 100644
--- a/frugal-tweak-vala/src/systray.vala
+++ b/frugal-tweak-vala/src/systray.vala
@@ -22,26 +22,26 @@ using GLib;
 
 public class Systray
 {
+	public static const string defaultIco = "/usr/share/frugalware-tweak/pictures/frugalware-tweak.png";
 	private StatusIcon _trayicon ;
 	private Menu _popup;
 	private Window _window;
-	private string _defaultIco = "/usr/share/frugalware-tweak/pictures/frugalware-tweak.png";
 	private string _ico ="";
 	private Configuration conf = new Configuration();
 	public Systray()
 	{
 		_window = GtkObj.MainWindow;
-		_ico=_defaultIco;
+		_ico=defaultIco;
 		 /* Create tray icon */
 		try
 		{
-			_trayicon =new StatusIcon.from_file(_defaultIco);
-			_window.set_icon_from_file(_defaultIco);
+			_trayicon =new StatusIcon.from_file(_ico);
+			_window.set_icon_from_file(_ico);
 		}
 		catch(GLib.Error err)
 		{
 			var msg = new Gtk.MessageDialog(null,Gtk.DialogFlags.MODAL,Gtk.MessageType.ERROR,
-										Gtk.ButtonsType.OK,"Failed to load "+_defaultIco+"\n"+err.message);
+										Gtk.ButtonsType.OK,"Failed to load "+_ico+"\n"+err.message);
 			msg.run();
 			msg.destroy();
 		}
@@ -103,7 +103,7 @@ public class Systray
 		catch(GLib.Error err)
 		{
 			var msg = new Gtk.MessageDialog(null,Gtk.DialogFlags.MODAL,Gtk.MessageType.ERROR,
-										Gtk.ButtonsType.OK,"Failed to load "+_defaultIco+"\n"+err.message);
+										Gtk.ButtonsType.OK,"Failed to load "+_ico+"\n"+err.message);
 			msg.run();
 		}
 	}
-- 
1.6.5.3

