# Compiling Time: 13.15 SBU
# Maintainer: Pingax <pingax@frugalware.org>
# Contributor: darknekros <darknekros@gmail.com>

pkgname=atom
pkgver=1.13.0
pkgrel=2
pkgdesc="Atom is a hackable text editor for the 21st century from GitHub."
depends=('libgnome-keyring' 'nodejs>=6.3.1-2' 'gconf' 'python' 'git' 'alsa-lib' 'libcups' \
	'libnotify' 'libxtst' 'nss' 'gtk+2-libs')
makedepends=('ca-certificates' 'gtk+2' 'cups' 'x11-protos' 'libxkbfile')
groups=('xapps-extra')
archs=('i686' 'x86_64')
source=("${source[@]}" \
	use_newer_apm.patch)
sha1sums=('0cfd9761fbcd6cbacc19274a3837c6be945e765c' \
          '835319c4c414200ba7e86a341d93e1e42efd1690')
_F_github_tag_v=$pkgver
Finclude github

build() {
	export CC=gcc CXX=g++ || Fdie
	Fcd
	Fpatchall
	Fsed  "path.join('/usr', 'local')"  "\"$Fdestdir/usr\"" script/lib/install-application.js

	Fexec cd script || Fdie
	Fexec npm install || Fdie
	Fexec ./build --build-dir "$Fsrcdir/atom-build" --install|| Fdie
	Fcp "atom-$pkgver/resources/app-icons/stable/png/*.png" "usr/share/atom/resources"
	Fsed "/var/tmp/fst/pkg/usr/share/atom/atom" "/usr/bin/atom" $Fdestdir/usr/share/applications/${pkgname}.desktop
	Fsed "/var/tmp/fst/pkg/usr/share/atom/resources/app/resources/atom.png" "/usr/share/atom/resources/atom.png" $Fdestdir/usr/share/applications/${pkgname}.desktop
}

# optimization OK
