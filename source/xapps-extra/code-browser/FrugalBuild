# Compiling Time: 0.06 SBU
# Maintainer: James Buren <ryuo@frugalware.org>

pkgname=code-browser
pkgver=3.14
pkgrel=2
pkgdesc="A folding text editor designed especially for source code."
url="http://tibleiz.net/code-browser"
up2date="Flastarchive $url/download.html -src.tar.gz"
source=(http://tibleiz.net/download/$pkgname-$pkgver-src.tar.gz
         $pkgname-frugalbuild.patch)
options=('scriptlet')
depends=('gtk+2' 'glibc' 'libxau' 'libxdmcp' 'libxext' 'libxdamage' 'libxml2')
makedepends=('imagemagick')
groups=('xapps-extra')
archs=('i686' 'x86_64')
sha1sums=('faa847d0dda7ca386cfc9b2e582ff5fe695da57c' \
          'f015e1cf4519ae6165b73f789a15cda1ca57c64d')
_F_desktop_name="Code Browser"
_F_desktop_icon="$pkgname"
_F_desktop_categories="GTK;Development;Utility;TextEditor;"
unset MAKEFLAGS

build() {
    Fsed "-O2" "${CFLAGS}" {.,zinc}/Makefile
    Fsed "/usr/local" "/usr" Makefile
    # bypass Fpatch because it breaks this patch
    patch -Np1 < ../$pkgname-frugalbuild.patch || Fdie
    Fmake
    Fmkdir /usr/bin
    Fmakeinstall
    Ffileschmod /usr/share/code-browser-3 0644
    # convert icon to one we can use
    convert res/cb.ico $pkgname.png || Fdie
    mv $pkgname-1.png $pkgname.png || Fdie
    Ficonrel $pkgname.png
    Fdesktop2
}

# optimization OK
