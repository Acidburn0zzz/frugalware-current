# Compiling Time: 0.05 SBU
# Maintainer: James Buren <ryuo@frugalware.org>

pkgname=textadept
pkgver=2.1
pkgrel=1
pkgdesc='An extremely extensible Text Editor, uses a modified version of Scintilla.'
_F_googlecode_sep='_'
_F_googlecode_ext='.src.zip'
Finclude googlecode
source=(${source[@]} $pkgname-frugalbuild.patch frugalbuild.lua)
depends=('gtk+2' 'libxau' 'libxdmcp' 'libstdc++' 'libxext' 'libxdamage' 'libxml2')
rodepends=('ctags')
options=('nodocs' 'scriptlet')
groups=('xapps-extra')
archs=('i686' 'x86_64')
_F_desktop_name="Textadept"
_F_desktop_icon="$pkgname"
_F_desktop_categories="GTK;Development;Utility;TextEditor;"
sha1sums=('1719a8a99d0935969f9715fef7fb15df06a9ed8c' \
          '9140fd8366f6cf877301c885877531c4e12f7537' \
          '38b85c9588f62bd9933797ed6d0fd2d2bb93544f')

build() {
  # Enforce our CFLAGS
  Fsed "-Os\?" "$CFLAGS" src/Makefile

  # Compile main binary
  make -C src || Fdie

  # Modify to use exuberant-ctags
  Fsed "ctags -f" "exuberant-ctags -f" core/ext/pm/ctags_browser.lua

  # Patch for frugalbuild syntax hightlighting
  Fpatchall

  # Create necessary directories
  Fmkdir /usr/lib/$pkgname /usr/share/doc/$pkgname-$pkgver

  # Setup the main directory
  Fcprel . /usr/lib/$pkgname
  Fdirschmod /usr/lib/$pkgname 0755
  Ffileschmod /usr/lib/$pkgname 0644

  # Relocate documentation
  Fmv /usr/lib/$pkgname/LICENSE /usr/share/doc/$pkgname-$pkgver
  Fmv /usr/lib/$pkgname/doc/* /usr/share/doc/$pkgname-$pkgver

  # Set permissions for main binary
  Ffileschmod /usr/lib/$pkgname/$pkgname 0755

  # Strip symbols from main binary
  strip -s $Fdestdir/usr/lib/$pkgname/$pkgname || Fdie

  # Install desktop file
  Fdesktop2

  # Install frugalbuild lexer
  Ffile /usr/lib/$pkgname/lexers/frugalbuild.lua

  # Remove leftover clutter
  Frm /usr/lib/$pkgname/{src,doc}

  # Setup compatibility symlinks
  Fln /usr/share/doc/$pkgname-$pkgver /usr/lib/$pkgname/doc
  Fln /usr/lib/$pkgname/core/images/ta_128x128.png /usr/share/pixmaps/$pkgname.png

  # Setup binary wrapper
  Fwrapper "cd /usr/lib/$pkgname;exec ./$pkgname \"\$@\"" $pkgname
}

# optimization OK
