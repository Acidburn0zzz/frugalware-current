diff -Naur mupdf-1.1-source/xps/xps_common.c mupdf-1.1-source.new/xps/xps_common.c
--- mupdf-1.1-source/xps/xps_common.c	2012-08-16 15:55:20.000000000 +0200
+++ mupdf-1.1-source.new/xps/xps_common.c	2014-06-06 09:42:36.926296937 +0200
@@ -89,7 +89,7 @@
 		if (scb_color_att)
 		{
 			fz_colorspace *colorspace;
-			float samples[32];
+			float samples[FZ_MAX_COLORS];
 			xps_parse_color(doc, base_uri, scb_color_att, &colorspace, samples);
 			opacity = opacity * samples[0];
 		}
@@ -274,6 +274,11 @@
 		*p++ = 0;
 		n = count_commas(p) + 1;
 		i = 0;
+		if (n > FZ_MAX_COLORS)
+		{
+			fz_warn("ignoring %d color components (max %d allowed)", n - FZ_MAX_COLORS, FZ_MAX_COLORS);
+			n = FZ_MAX_COLORS;
+		}
 		while (i < n)
 		{
 			samples[i++] = fz_atof(p);
diff -Naur mupdf-1.1-source/xps/xps_glyphs.c mupdf-1.1-source.new/xps/xps_glyphs.c
--- mupdf-1.1-source/xps/xps_glyphs.c	2012-08-16 15:55:20.000000000 +0200
+++ mupdf-1.1-source.new/xps/xps_glyphs.c	2014-06-06 09:43:25.272596433 +0200
@@ -587,7 +587,7 @@
 
 	if (fill_att)
 	{
-		float samples[32];
+		float samples[FZ_MAX_COLORS];
 		fz_colorspace *colorspace;
 
 		xps_parse_color(doc, base_uri, fill_att, &colorspace, samples);
diff -Naur mupdf-1.1-source/xps/xps_gradient.c mupdf-1.1-source.new/xps/xps_gradient.c
--- mupdf-1.1-source/xps/xps_gradient.c	2012-08-16 15:55:20.000000000 +0200
+++ mupdf-1.1-source.new/xps/xps_gradient.c	2014-06-06 09:44:07.473044212 +0200
@@ -38,7 +38,7 @@
 	struct stop *stops, int maxcount)
 {
 	fz_colorspace *colorspace;
-	float sample[8];
+	float sample[FZ_MAX_COLORS];
 	float rgb[3];
 	int before, after;
 	int count;
diff -Naur mupdf-1.1-source/xps/xps_path.c mupdf-1.1-source.new/xps/xps_path.c
--- mupdf-1.1-source/xps/xps_path.c	2012-08-16 15:55:20.000000000 +0200
+++ mupdf-1.1-source.new/xps/xps_path.c	2014-06-06 09:45:06.635122151 +0200
@@ -825,7 +825,7 @@
 
 	fz_stroke_state *stroke = NULL;
 	fz_matrix transform;
-	float samples[32];
+	float samples[FZ_MAX_COLORS];
 	fz_colorspace *colorspace;
 	fz_path *path;
 	fz_path *stroke_path = NULL;
