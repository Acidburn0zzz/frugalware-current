# Compiling Time: 5.03 SBU
# Contributor: Zsolt Szalai <xbit@frugalware.org>
# Maintainer: voroskoi <voroskoi@frugalware.org>

# FIXME: ffmpeg, player

pkgname=blender
pkgver=2.49
pkgextraver=
pkgrel=3
pkgdesc="A 3D modeling/rendering/animation/gaming application"
url="http://blender.org"
Finclude python
depends=('libjpeg>=8a' 'libpng>=1.4.1' 'freetype2' \
	'freealut>=1.1.0-3' 'openexr' 'openal>=1.7.411' \
	"python>=2.7" 'libtiff' 'sdl>=1.2.13-2')
groups=('xapps-extra')
archs=('i686' 'x86_64' 'ppc')
makedepends=('cmake' 'ftgl')
up2date="Flasttar http://www.blender.org/download/source-code/"
source=(http://download.blender.org/source/$pkgname-$pkgver$pkgextraver.tar.gz \
	blender.desktop blender.png blender-2.48a-cve-2008-4863.patch)
sha1sums=('75bc00cb9b0d106e4cd1d6c25534c1d139aa88d7' \
          '44ee67a0ed814481aacca0dfc8cf45ae7a48eed5' \
          '5d2583d847735c913c26c96ace8192a646323da8' \
          '0d54c1c1acff478fd2bb3adcc1f8296a9692da51')

build() {
	Fpatchall
	mkdir -p ../build || Fdie
	cd ../build || Fdie
	cmake ../$pkgname-$pkgver -DCMAKE_INSTALL_PREFIX=$Fprefix \
		-DWITH_BULLET=ON -DWITH_ELBEEM=ON -DWITH_FFMPEG=OFF -DWITH_GAMEENGINE=ON \
		-DWITH_INTERNATIONAL=ON -DWITH_OPENAL=ON -DWITH_OPENEXR=ON \
		-DWITH_PLAYER=OFF -DWITH_QUICKTIME=OFF -DWITH_VERSE=ON -DYESIAMSTUPID=ON || Fdie
	make || Fdie

	Fmkdir $Fprefix/lib/blender
	mv bin/.blender/* $Fdestdir/$Fprefix/lib/blender || Fdie
	Fexerel bin/blender $Fprefix/bin/blender
	#Fexerel bin/blenderplayer $Fprefix/bin/blenderplayer
	Ffile $pkgname-$pkgver/source/blender/blenpluginapi/*.h $Fprefix/lib/blender/plugins/include
	Ffile /usr/share/pixmaps/blender.png
	Ffile /usr/share/applications/blender.desktop
	Ffilerel lib/* $Fprefix/lib
	cd - >/dev/null
	Fcprel release/plugins $Fprefix/lib/blender
	chmod +x $Fdestdir/$Fprefix/lib/blender/plugins/bmake || Fdie
	make -C $Fdestdir/$Fprefix/lib/blender/plugins || Fdie
	Fdocrel release/text/*
}

# optimization OK
