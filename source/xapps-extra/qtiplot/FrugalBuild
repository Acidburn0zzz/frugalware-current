# Compiling Time: 3.53 SBU
# Maintainer: Elentir <elentir@frugalware.org>

pkgname=qtiplot
pkgver=0.9.8.3
pkgrel=1
pkgdesc="QtiPlot is a professional scientific data analysis and visualisation solution"
depends=('libboost-mt>=1.39.0' 'pyqt4' 'muparser' 'gsl' 'libglu' 'libqtassistantclient' 'libglu' 'libqt3support' 'libqtopengl')
makedepends=('boost>=1.39.0')
groups=('xapps-extra')
archs=('i686' 'x86_64')
_F_berlios_ext=".tar.bz2"
Finclude berlios
url="http://soft.proindependent.com/qtiplot.html"
_F_desktop_icon="qtiplot.png"
_F_desktop_name="Qtiplot"
_F_desktop_categories="Qt;Education;Science;"
_F_desktop_mimetypes="application/x-qtiplot-project;application/x-qtiplot-project-compressed;application/x-qtiplot-project-backup"
source=($source build.conf qtiplot.xml \
	http://download.berlios.de/qtiplot/QTeXEngine-0.2-opensource.zip)
up2date="Flasttar http://soft.proindependent.com/download.html"
sha1sums=('e5ffdd25f1f69611f3f39a0b22e8c23959ab51e1' \
          'db5d65a0e368875b38713060295954c680aa2da4' \
          '285f57d865956d93250ec548288c5bface096b6b' \
          'b484a4da7a0f3103e188539bfa6c1910dc9b55ca')

build() {
	Fcd
	cp -a ../QTeXEngine ./3rdparty/ || Fdie
	cp ../build.conf ./ || Fdie

	cd ./3rdparty/qwt || Fdie
	qmake || Fdie
	make || Fdie

	cd ../qwtplot3d || Fdie
	qmake || Fdie
	make || Fdie
	
	cd ../QTeXEngine || Fdie
	qmake || Fdie
	make || Fdie
	
	cd ../../qtiplot || Fdie
	## fix some path
	Fsed "pythonconfig.path = /usr/local/qtiplot" "pythonconfig.path = /usr/share/qtiplot" qtiplot.pro
	Fsed "/usr/local/" "/usr/" qtiplot.pro
	Fsed "doc/qtiplot/" "doc/qtiplot-$pkgver" qtiplot.pro
	Fsed "d_python_config_folder + \"" "\"/usr/share/qtiplot" src/core/ApplicationWindow.cpp
	qmake || Fdie
	make || Fdie
	INSTALL_ROOT=${Fdestdir} make install || Fdie

	Fmkdir usr/share/{pixmaps,mime/packages}
	Finstall 644 $_F_cd_path/${pkgname}_logo.png usr/share/pixmaps/${pkgname}.png
	Finstall 644 ${pkgname}.xml usr/share/mime/packages/qtiplot.xml
	Fdesktop2

	## fix doc
	Frm usr/share/doc/qtiplot-${pkgver}manual
	Frm usr/share/doc/qtiplot
	Fdoc $_F_cd_path/gpl_licence.txt
}

# optimization OK
