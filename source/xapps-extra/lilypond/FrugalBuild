# Compiling time: 17.32 SBU
# Maintainer: CSÉCSY László <boobaa@frugalware.org>

pkgname=lilypond
pkgver=2.12.3
pkgrel=1
pkgdesc="Music notation for everyone"
url="http://lilypond.org/web/"
depends=('guile>=1.8.8' 'python' 'pango' 'ghostscript')
makedepends=('netpbm' 'imagemagick' 'texi2html' 'texlive-fonts-extra' 'texinfo' 'mftrace' 'zip' 'fontforge' 'urw-fonts')
groups=('xapps-extra')
archs=('i686' 'x86_64')
up2date="lynx -dump 'http://lilypond.org/web/' | grep 'Stable.*Docum' | sed 's/.* \([0-9\.]\+\) .*/\1/'"
source=(http://download.linuxaudio.org/lilypond/sources/v2.12/$pkgname-$pkgver.tar.gz \
	lilypond-gcc45.patch)
options=('scriptlet')
sha1sums=('f36072d5f57b2a3d3877e82879be375d548aa951' \
          '6fe457590499c93fb0581a40d3b8c29eac56c77e')

subpkgs=('lilypond-doc')
subdescs=('Documentation for LilyPond')
subdepends=('lilypond')
subgroups=('xapps-extra')
subarchs=('i686 x86_64')

build()
{
	# fix issue with bibtex configuration
	Fsed "tempfile = tempfile.mktemp ('bib2html')" "tempfile = tempfile.mktemp ('bib2html', dir=os.path.relpath('.'))" $Fsrcdir/$pkgname-$pkgver/scripts/build/bib2html.py

	# don't build parallel
	unset MAKEFLAGS
	Fbuild --with-ncsb-dir=/usr/share/ghostscript/fonts
	make doc || Fdie
	make DESTDIR=$Fdestdir/ docdir=usr/share/doc/$pkgname-$pkgver install-doc || Fdie
	Frm usr/share/doc/$pkgname-*/VERSION
	Fsplit lilypond-doc usr/share/doc/$pkgname-$pkgver/
}

# optimization OK
