# Compiling Time: 0 SBU
# Maintainer: DeX77 <dex77@frugalware.org>

_F_lib32_name=libedit
pkgver=20160618_3.1_3
rodepends=('lib32-ncurses')
sha1sums=('fae4b69b11bfa7a89dc691e5f2945fd4030a0bb8')
Finclude lib32

source=(http://ftp.frugalware.org/pub/frugalware/frugalware-current/frugalware-i686/$_F_archive_name-20160618_3.1-3-i686.fpm)

build()
{
        local old new IFS

        # Extract fpm.
        tar -xf "$_F_archive_name-20160618_3.1-3-i686.fpm" || Fdie

        # Copy and map all directories to their new name.
        IFS=$' '
        for i in "${_F_lib32_dirs[@]}"
        do
                old="${i%:*}"
                new="${i#*:}"
                if [ -d "$old/" ]
                then
                        Fmkdir `dirname "$new/"`
                        Fcprel "$old/" "$new/"
                fi
        done

        # Try to fix broken symlinks between lib and usr/lib.
        # This at least solves issues with glibc.
        IFS=$'\n'
        for i in `find -L "$Fdestdir" -type l`
        do
                target=`readlink "$i"`
                for j in "${_F_lib32_dirs[@]}"
                do
                        old="${j%:*}"
                        new="${j#*:}"
                        if [[ "$target" =~ "/$old/" ]]
                        then
                                Fln "${target/$old/$new}" "${i/$Fdestdir/}"
                                break
                        fi
                done
        done
}
