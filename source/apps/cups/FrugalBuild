# Last Modified: Thu, 13 Oct 2005 13:20:31 +0200
# Compiling Time: 0.42 SBU
# Maintainer: VMiklos <vmiklos@frugalware.org>

pkgname=cups
pkgver=1.1.23
pkgrel=4
pkgdesc="The CUPS Printing System"
url="http://www.cups.org/"
depends=('openssl' 'libtiff' 'libpng' 'espgs')
groups=('apps')
archs=('i686' 'x86_64')
backup=(etc/cups/{printers.conf,classes.conf,client.conf,cupsd.conf,mime.types,mime.convs,ppds.dat} etc/printcap)
install=$pkgname.install
up2date="lynx -dump http://www.cups.org/software.php|grep tar.bz2$|sed -n 's/.*-\(.*\)\-.*/\1/;2 p'"
source=(ftp://ftp.rz.tu-bs.de/pub/mirror/ftp.easysw.com/ftp/pub/$pkgname/$pkgver/cups-$pkgver-source.tar.bz2 \
	rc.cups printcap ppds.dat.gz \
	cups-gcc4-amd64.patch)
sha1sums=('32d5bfb44c4edc1b54ccb014b5a44499295c6c5c' \
	  '0ce4a500a3fcd1129c3dc856afeb94f05fe3c456' \
	  '2a27795cc4eaee7ba39425585ef470ae220adb07' \
	  '07542c757de8226fef9dc0dffa4c6711834c060c' \
	  '9e23ed973685c279edfee76fc0a7a9c6fd94a103')

build() {
	Fcd
	[ "$CARCH" == "x86_64" ] && Fpatch cups-gcc4-amd64.patch
	Fmake --with-logdir=/var/log/cups \
		--with-docdir=/usr/share/cups/doc --enable-ssl=yes \
		--disable-pam
	make BUILDROOT=$startdir/pkg install
	Ffile /etc/cups/ppds.dat

	# init scripts
	Frm /etc/rc.d/{init.d,rc?.d}
	Fmkdir /etc/rc.d/rc.messages
	Fexe /etc/rc.d/rc.$pkgname
	Ffile ../messages/$pkgname.* /etc/rc.d/rc.messages/

	# printcap
	Ffile /etc/printcap
	Fmkdir /usr/etc
	Fln /etc/printcap /usr/etc/printcap

	# samba support
	( if [ ! -r $Fdestdir/usr/lib/cups/backend/smb ]; then
       		Fln /usr/bin/smbspool /usr/lib/cups/backend/smb
	fi )

	# fix perms on /var/spool
	chmod 755 $Fdestdir/var/spool

	# remove 'cat?'
	for i in `find $Fdestdir -type d -name cat?`
	do
		Frm $i
	done
}

# optimalization OK

# vim: ft=sh
