# Last Modified: Fri, 06 Oct 2006 12:46:56 +0200
# Compiling Time: 3.42 SBU
# Contributor: VMiklos <vmiklos@frugalware.org>
# Maintainer: Christian Hamar alias krix <krics@linuxforum.hu>

pkgname=rpm
pkgver=4.4.6
pkgrel=2
pkgdesc="Red Hat Package Manager"
url="http://www.rpm.org/"
depends=('bzip2' 'libgcc' 'sqlite3' 'popt' 'neon>=0.26.1' 'db>=4.5.20')
groups=('apps')
archs=('i686' 'x86_64')
makedepends=('beecrypt')
up2date="4.4.6"
source=(ftp://jbj.org/pub/$pkgname-4.4.x/$pkgname-$pkgver.tar.gz \
	rpm-4.4.6-beecrypt.diff)
sha1sums=('33221f95189671d1a083b4f140bcf9a88ecd4374' \
	  'cd0efab5812eb82c0e0261340a194e2301913f75')
[ "$CARCH" == "x86_64" ] && \
	source=(${source[@]} rpm_fix_lib64.patch) && \
	sha1sums=(${sha1sums[@]} 'ce35b5405edd9b2ea491ba933177f21f2b1bde75')

build()
{
	unset MAKEFLAGS
	Fpatchall
	Fconf --without-selinux --without-python
	make staticLDFLAGS="" || return 1
	Fmakeinstall

	# conflicts with popt
	Frm /usr/include/popt.h  /usr/lib/libpopt.*
	Frm /usr/man/man3/popt.3
	Frm /usr/share/locale/*/LC_MESSAGES/popt.mo
	# Fixes symlink bug
	Fln /usr/lib/rpm/rpmpopt-$pkgver /usr/lib/rpm/rpmpopt
	# fixes bug "can't create transaction lock"
	Fmkdir /var/lock/rpm
}

# optimization OK
