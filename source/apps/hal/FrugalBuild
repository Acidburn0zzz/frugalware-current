# Compiling time: 0.44 SBU
# Maintainer: crazy <crazy@frugalware.org>
# Contributor: Christian Hamar alias krix <krics@linuxforum.hu>

pkgname=hal
pkgver=0.5.10
pkgrel=1
pkgdesc="Hardware Abstraction Layer"
url="http://www.freedesktop.org/wiki/Software/hal"
depends=('dbus-glib>=0.74' 'udev>=100' 'glib2' 'libcap' 'dbus>=1.1.2' \
	'libusb' 'popt' 'pciutils' 'parted>=1.8.8' 'shadow>=4.0.18.1-2' \
	'dmidecode' 'usbutils' 'zlib')
makedepends=('pkgconfig' 'perl-xml' 'intltool')
rodepends=('hal-info>=20071030')
groups=('apps')
replaces=('submount')
options=('scriptlet')
archs=('i686' 'x86_64')
up2date="lynx -dump 'http://hal.freedesktop.org/releases/?C=M;O=A'|grep -v 'hal-info'|grep -v 'gnome'|grep -v PolicyKit|Flasttar"
source=(http://hal.freedesktop.org/releases/$pkgname-$pkgver.tar.gz \
	rc.hald \
	01-parted.patch \
	hal.conf.in.patch \
	hal-device-manager.desktop \
	ntfs-3g.patch \
	hal-performance_pci.ids_v5.diff)
sha1sums=('8d67499df61590c11fd3203004d69e8a45abb8fa' \
          'ab629a3ea7df51df48abad30731590b8e86e908f' \
          '1d411b592b781336c5ff7ca2b4a2ad208af5acbe' \
          'be12d1327ca93e1830c5784f395e904b107f1947' \
          '0c4968cbb842bdae350901728d81eed9895445fa' \
          '2273e77c0c3c52aca31294b2b1a829937d0a3c18' \
          '654235977c83f76433f9737f37b8a18f04136b35')


build()
{
	Fcd
	Fpatchall
	Fautoreconf
	#autoreconf -v -i -f -d --warnings=all || return 1
	## TODO: figure this acpi stuff
	Fconf \
		--with-pid-file=/var/run/hald.pid \
		--with-hal-user=hald \
		--with-hal-group=hald \ \
		--with-pci-ids=/usr/share/misc \
		--with-usb-ids=/usr/share/usbutils \
		--disable-policy-kit \
		--disable-docbook-docs \
		--enable-parted \
		--with-macbookpro=no \
		--prefix=/usr \
		--datadir=/usr/share \
		--libexecdir=/usr/lib/$pkgname \
		--disable-acpi-acpid \
		--enable-acpi-proc \
		--with-os-type=Frugalware \
		--with-backend=linux \
		--host=${CHOST} \
		--build=${CHOST}
	# TODO: package pm-tools and libsmbios ..
	### BLAHHHHHHHHHHHHH
	Fmakeinstall
	Frm /etc/hotplug.d
	Fmkdir /media
	Frcd hald
}

# optimization OK
