#!/bin/sh

# (c) 2004-2005 Laszlo Dvornik <dvornik@gnome.hu>
# rc.hald for Frugalware
# distributed under GPL License

# chkconfig: 2345 98 02
# description: This is a daemon for collecting and maintaining information \
#              about hardware from several sources.

source /lib/initscripts/functions

daemon=$"HAL daemon"
actions=(start stop restart status)
pid="pidof -o %PPID /usr/sbin/hald"

rc_start()
{
	start_msg
	if [ ! -z "$(eval $pid)" ]; then
		ok 999
	else
		## need be here without this use hal does not work
		if ! grep -q '^hald:' /etc/group; then
        	echo -n "Adding hald group..."
        	groupadd -g 39 hald
        	echo -e "done."
		fi
		
		if ! grep -q '^hald:' /etc/passwd; then
        	echo -n "Adding hald user..."
        	useradd -c 'HAL Daemon' -u 39 -g hald -G cdrom,floppy,camera,storage -d '/' -s /bin/false hald
        	## kill password
        	passwd -l hald
        	echo -e "done."
		fi
		
		if [ ! -d /var/run/hald ]; then
			mkdir -p /var/run/hald
			chown hald:hald /var/run/hald
		else
			chown hald:hald /var/run/hald
		fi

	 	/usr/sbin/hald --daemon=yes
		ok $?
	fi
}

rc_stop()
{
	stop_msg
	if [ -n "$(eval $pid)" ] ; then
		kill "$(eval $pid)"
		ok $?
	else
		ok 999
	fi
}

rc_exec $1

