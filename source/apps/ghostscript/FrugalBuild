# Compiling Time: 24.09 SBU
# Maintainer: voroskoi <voroskoi@frugalware.org>
# Contributor: DeX77 <dex77@frugalware.org>


## FIXME: - we need build with --enable/--with-{system}-foo
##        - remove xghostscript and built ghostscript with
##          X/mesa/glu .. maybe add GTK3 GUI

## TODO: split the dam lib(s) -- crazy --
pkgname=ghostscript
pkgver=9.20
pkgrel=1
pkgdesc="An interpreter for the PostScript language."
depends=('libcups>=2.2.0-2' 'openssl>=1.0.2-8' 'libkrb5>=1.14.4' 'gnutls>=3.4.15-2')
rodepends=('foomatic-filters>=4.0.17-5' 'urw-fonts')
makedepends=('libxt>=1.1.5-3' 'libxext>=1.3.3-3' 'cups>=2.2.0-2' 'krb5>=1.14.4' 'x11-protos')
groups=('apps')
archs=("x86_64")
license="GPLv2"
url="http://www.ghostscript.com/"
up2date="lynx -dump -source http://www.ghostscript.com/download/gsdnld.html | grep -m1 'ghostscript-\(.*\).tar.gz' | sed 's/.*script-\(.*\).tar.*/\1/'"
#source=(http://downloads.ghostscript.com/public/$pkgname-$pkgver.tar.gz)
source=(https://github.com/ArtifexSoftware/ghostpdl-downloads/releases/download/gs${pkgver/./}/ghostscript-${pkgver}.tar.xz)
sha1sums=('ed63f43482f5af60dff52e81b2d9478da3ad1e3e')

subpkgs=('xghostscript')
subdescs=('A graphical interpreter for the PostScript language.')
subdepends=("libxt>=1.1.5-3 libxext>=1.3.3-3 cups>=2.2.0-2 urw-fonts")
subrodepends=("foomatic-filters>=4.0.17-5")
subgroups=('xapps')
subarchs=("x86_64")
subconflicts=('ghostscript')
subprovides=('ghostscript')


build() {

	CFLAGS="$CFLAGS -fPIC"
	Fcd
	Fpatchall
	Fmake
	make -j1 DESTDIR=${Fdestdir} install-so install || Fdie
	# remove filters that are now maintained in cups-filters as upstream home
        Frm usr/lib/cups/filter/gstopxl
        Frm usr/lib/cups/filter/gstoraster
	Fsplit xghostscript /\*
	make clean || Fdie
	Fmake --without-x
	make -j1 DESTDIR=${Fdestdir} install-so install || Fdie
	# remove filters that are now maintained in cups-filters as upstream home
	Frm usr/lib/cups/filter/gstopxl
	Frm usr/lib/cups/filter/gstoraster
}

# optimization OK
