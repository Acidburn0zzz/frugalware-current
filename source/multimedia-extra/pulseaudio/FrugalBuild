# Compiling Time: 0.96 SBU
# Maintainer: bouleetbil <bouleetbil@frogdev.info>

pkgname=pulseaudio
pkgver=0.9.15
pkgrel=1
pkgdesc="PulseAudio is a sound server with an advanced plugin system"
url="http://pulseaudio.org/"
depends=('speex' 'liboil' 'audiofile' 'libsndfile' 'libtool' 'libatomic_ops' 'libsamplerate' 'flac' 'glib2' \
	'alsa-lib' 'libtool' 'libasyncns')
makedepends=('avahi' 'gnome-audio' 'bluez-utils' 'jack' 'intltool' 'hal' 'gconf' \
		'libsm' 'libx11' 'libice' 'libxtst')
groups=('multimedia-extra')
archs=('i686' 'x86_64' 'ppc')
up2date="Flasttar http://pulseaudio.org/wiki/DownloadPulseAudio#Sourcecode"
source=(http://0pointer.de/lennart/projects/$pkgname/$pkgname-$pkgver.tar.gz \
	rc.pulseaudio pulseaudio.sysconfig README.Frugalware \
	pulseaudio-0.9.15-CVE-2009-1894.patch automake111.diff)
sha1sums=('56fb71e4e88c901d9941d85bfe142612c30e5c8e' \
          '484a26a79dc9c66807fcd3edb91ea98513cc95cb' \
          'e95d0cd97ae6b68029487080ba460c412afa0ca0' \
          '6d77f76a4d5566001b8a3214232b19f037c751d7' \
          '1b9106e52c063e83b8577434360edaf3be81351d' \
          'd59ff20515cb3109bed4e1b30ca7eb93f411d6a9')

subpkgs=("pulseaudio-hal" "pulseaudio-esd" "pulseaudio-bluetooth" "pulseaudio-x11" \
	"pulseaudio-avahi" "pulseaudio-jack" "pulseaudio-gconf")
subdescs=('HAL device detection module for PulseAudio sound server' \
	'PulseAudio ESD compatibility layer' 'PulseAudio bluetooth' 'x11 module for PulseAudio sound server' \
	'avahi module for PulseAudio sound server' 'jack module for PulseAudio sound server' \
	'gconf module for PulseAudio sound server')
subrodepends=("pulseaudio=$pkgver hal" "pulseaudio=$pkgver" \
	"pulseaudio=$pkgver bluez-utils" "pulseaudio=$pkgver libx11 libxtst" "pulseaudio=$pkgver avahi" \
	"pulseaudio=$pkgver jack" "pulseaudio=$pkgver gconf")
subgroups=('multimedia-extra' 'multimedia-extra' 'multimedia-extra' \
	'xmultimedia-extra' 'multimedia-extra' 'multimedia-extra' 'gnome-extra')
subarchs=('i686 x86_64 ppc' 'i686 x86_64 ppc' 'i686 x86_64 ppc' 'i686 x86_64 ppc' 'i686 x86_64 ppc' 'i686 x86_64 ppc' 'i686 x86_64 ppc')

if [ "$CARCH" != "ppc" ]; then
	makedepends=("${makedepends[@]}" 'lirc')
	subpkgs=("${subpkgs[@]}" 'pulseaudio-lirc')
	subdescs=("${subdescs[@]}" 'lirc module for PulseAudio sound server')
	subrodepends=("${subrodepends[@]}" "$pkgname=$pkgver lirc")
	subgroups=("${subgroups[@]}" 'multimedia-extra')
	subarchs=("${subarchs[@]}" 'i686')
fi

Fconfopts="$Fconfopts --with-system-user=pulse --with-realtime-group=realtime \
	--with-access-group=pulse-access \
	--with-system-group=pulse --disable-polkit  --localstatedir=/var \
	--disable-per-user-esound-socket --disable-solaris --enable-largefile \
	--disable-static --enable-x11"

install=$pkgname.install
backup=(etc/pulse/client.conf etc/pulse/daemon.conf \
	etc/pulse/default.pa etc/pulse/system.pa)

build() {
	Fcd
	Fpatchall
 	Fautoreconf
	libtoolize --copy --force --install || Fdie
        Fmake || Fdie
	Fmakeinstall

	Fsplit $pkgname-hal usr/lib/pulse-$pkgver/modules/module-hal-detect.so

	if [ "$CARCH" != "ppc" ]; then
		Fsplit $pkgname-lirc usr/lib/pulse-$pkgver/modules/module-lirc.so
	fi

	Fsplit $pkgname-esd usr/bin/esdcompat
	Fsplit $pkgname-esd usr/lib/pulse-$pkgver/modules/libprotocol-esound.so
	Fsplit $pkgname-esd usr/lib/pulse-$pkgver/modules/module-esound-compat-spawnfd.so
	Fsplit $pkgname-esd usr/lib/pulse-$pkgver/modules/module-esound-compat-spawnpid.so
	Fsplit $pkgname-esd usr/lib/pulse-$pkgver/modules/module-esound-protocol-tcp.so
	Fsplit $pkgname-esd usr/lib/pulse-$pkgver/modules/module-esound-protocol-unix.so
	Fsplit $pkgname-esd usr/lib/pulse-$pkgver/modules/module-esound-sink.so

	Fsplit $pkgname-bluetooth usr/lib/pulse-$pkgver/modules/libbluetooth-ipc.so
	Fsplit $pkgname-bluetooth usr/lib/pulse-$pkgver/modules/libbluetooth-sbc.so
	Fsplit $pkgname-bluetooth usr/lib/pulse-$pkgver/modules/module-bluetooth-device.so
	Fsplit $pkgname-bluetooth usr/lib/pulse-$pkgver/modules/module-bluetooth-discover.so
	Fsplit $pkgname-bluetooth usr/lib/pulse-$pkgver/modules/module-bluetooth-proximity.so
	Fsplit $pkgname-bluetooth usr/libexec/pulse/proximity-helper

	Fsplit $pkgname-x11 usr/lib/pulse-$pkgver/modules/module-x11-xsmp.so
	Fsplit $pkgname-x11 usr/lib/pulse-$pkgver/modules/module-x11-publish.so
	Fsplit $pkgname-x11 usr/lib/pulse-$pkgver/modules/module-x11-cork-request.so
	Fsplit $pkgname-x11 usr/lib/pulse-$pkgver/modules/module-x11-bell.so
	Fsplit $pkgname-x11 usr/bin/pax11publish
	Fsplit $pkgname-x11 usr/bin/start-pulseaudio-x11
	Fsplit $pkgname-x11 etc/xdg

	Fsplit $pkgname-avahi usr/lib/pulse-$pkgver/modules/libavahi-wrap.so
	Fsplit $pkgname-avahi usr/lib/pulse-$pkgver/modules/module-zeroconf-discover.so
	Fsplit $pkgname-avahi usr/lib/pulse-$pkgver/modules/module-zeroconf-publish.so
	Fsplit $pkgname-avahi usr/lib/pulse-$pkgver/modules/libraop.so
	Fsplit $pkgname-avahi usr/lib/pulse-$pkgver/modules/module-raop-discover.so
	Fsplit $pkgname-avahi usr/lib/pulse-$pkgver/modules/module-raop-sink.so
	Fsplit $pkgname-avahi usr/lib/libpulse-browse.so.*

	Fsplit $pkgname-jack usr/lib/pulse-$pkgver/modules/module-jack-sink.so
	Fsplit $pkgname-jack usr/lib/pulse-$pkgver/modules/module-jack-source.so

	Fsplit $pkgname-gconf usr/lib/pulse-$pkgver/modules/module-gconf.so
	Fsplit $pkgname-gconf usr/libexec/pulse/gconf-helper

	Fmkdir etc/sysconfig
	Ffile pulseaudio.sysconfig /etc/sysconfig/pulseaudio
	Frcd2 pulseaudio
}

# optimization OK
