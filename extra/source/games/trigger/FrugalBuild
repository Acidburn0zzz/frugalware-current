# Last Modified: Sun, 11 Jun 2006 00:08:45 +0530
# Compiling Time: 0.37 SBU
# Maintainer: Priyank <priyankmg@gmail.com>

pkgname=trigger
pkgver=0.5.2
pkgrel=2
pkgdesc="Trigger is a free rally car racing game"
url="http://www.positro.net/trigger/"
makedepends=('jam')
depends=('libx11' 'sdl' 'sdlimage' 'sdl_mixer' 'openal' 'physfs' 'freealut' 'mesa' 'libxt')
groups=('games-extra')
archs=('i686')
up2date="lynx -dump http://www.positro.net/trigger/ | grep Latest | sed 's/.*: \(.*\)/\1/'"
source=(http://files.scapecaster.com/posit/$pkgname-$pkgver-src.tar.bz2 \
	$pkgname-$pkgver-data.tar.bz2 \
	trigger-0.5.2-freealut.patch)
sha1sums=('57589368606ec1b4b972bb32fc62cca09af049b1' \
	  '8a18241630509d6d7dc54b609d17b1b5c77051a8' \
	  '40aa9774930c6a0ded7984d3418ed737091f9b10')

build() {
	Fcd $pkgname-$pkgver-src

  	# Apply fixes
	Fsed '#include <GL/glew.h>' '#include "glew.h"' src/glew/glew.cpp
	Fsed '#include <GL/glew.h>' '#include "glxew.h"' src/glew/GL/glxew.h
	Fsed 'TiXmlDeclaration::TiXmlDeclaration' 'TiXmlDeclaration' src/pengine/tinyxml.h
	patch -Np0 -i $Fsrcdir/trigger-0.5.2-freealut.patch || return 1

	# Build trigger
	./autogen.sh || return 1
	Fconf --datadir=/usr/share/trigger
	jam || return 1
	Finstallrel 755 trigger usr/bin/trigger

	# Install trigger data files
	Fmkdir usr/share/trigger
	Fmessage "Copying trigger data files..."
	cd $Fsrcdir/$pkgname-$pkgver-data
	cp -R * $Fdestdir/usr/share/trigger

	# Fix permissions for some files
	Ffileschmod /usr/share/trigger 644
}

# optimization OK
