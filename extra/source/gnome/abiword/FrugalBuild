# Last Modified: Wed, 03 Aug 2005 09:31:45 +0200
# Compiling Time: ~3.01 SBU
# Maintainer: Christian Hamar alias krix <krics@linuxforum.hu>

pkgname=abiword
pkgver=2.2.9
pkgrel=1
pkgdesc="AbiWord is a free word processing program similar to Microsoft(R) Word."
url="http://www.abisource.com"
groups=('gnome-extra')
archs=('i686' 'x86_64')
depends=('termcap' 'librsvg' 'readline' 'fribidi' 'gucharmap' 'enchant' \
	 'libgnomeprintui')
makedepends=('imagemagick')
up2date="lynx -dump $url/download/ | grep tar.gz | cut -d '/' -f 6"
source=($url/downloads/$pkgname/$pkgver/source/$pkgname-$pkgver.tar.bz2 \
	abiword-2.2.8-fix-abidist.patch)
sha1sums=('ad7a78d179be6844542c837454f47e4efcfc195f' '83346252055f3abf4739dd73d613d3e5222f9488')
license="GPL2"

build()
{
	# NOTE: I don't know why, but Fcd did not great at here. So please no replace :)
	### AbiWord main
	cd $Fsrcdir/$pkgname-$pkgver || return 1
	Fpatch abiword-2.2.8-fix-abidist.patch
	cd $Fsrcdir/$pkgname-$pkgver/abi || return 1
	Fmake --enable-bidi --enable-threads --enable-scripting --enable-gnome \
		--enable-extra-optimization --with-ImageMagick=/usr all-recursive || return 1
	cd $Fsrcdir/$pkgname-$pkgver/abi || return 1
	Fmakeinstall || return 1

	### AbiWord plugins
	cd $Fsrcdir/$pkgname-$pkgver/abiword-plugins
	libtoolize --copy --force
	./nextgen.sh
	Fmake --with-abiword=../abi --enable-gnome --with-ImageMagick=/usr --enable-all --disable-gda || return 1
	cd $Fsrcdir/$pkgname-$pkgver/abiword-plugins
	Fmakeinstall DESTDIR=$Fdestdir || return 1

	### AbiWord help files
	cd $Fsrcdir/$pkgname-$pkgver/abiword-docs
	ABI_DOC_PROG=$(pwd)/../abi/src/wp/main/unix/AbiWord-2.2 ./make-html.sh
	mkdir -p $Fdestdir/usr/share/AbiSuite-2.2/AbiWord/help
	cp -rp help/* $Fdestdir/usr/share/AbiSuite-2.2/AbiWord/help/
	# Fix some wrong permission on help files
	find $Fdestdir/usr/share/AbiSuite-2.2/AbiWord/help/ -type d -exec chmod -c o+rx {} \;
}

# optimalization OK

# vim: ft=sh
