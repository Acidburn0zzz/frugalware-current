# Last Modified: Fri, 09 Dec 2005 13:09:00 +0100
# Compiling Time: 0.01 SBU
# Maintainer: Krisztian VASAS <iron@ironiq.hu>
# Contributor: VMiklos <vmiklos@frugalware.org>

pkgname=nvidia
pkgver=1.0_8174
nvver=`echo $pkgver|sed 's/_/-/'`
pkgrel=1
#[ "$CARCH" == "x86_64" ] && pkgrel=2
pkgdesc="3d accelerated display driver for Nvidia cards"
url="http://www.nvidia.com/object/linux_display_archive.html"
depends=('gcc' 'make' 'kernel-source')
groups=('x11-extra')
archs=('i686' 'x86_64')
up2date="lynx -dump http://www.nvidia.com/object/linux_display_archive.html|grep Version:|sed -n 's/.*: \(.*\)/\1/;s/-/_/;1 p'"
[ "$CARCH" == "x86_64" ] && jarch=x86_64 && sha1=88320ea9ebe074d54b99d7a710ce14474ba6a3cf
echo "$CARCH" | grep -q 'i.86' && jarch=x86 && sha1=cf0baafe267b561d5e5fa29dc7bb4ccc0239bf78
source=(http://download.nvidia.com/XFree86/Linux-$jarch/$nvver/NVIDIA-Linux-$jarch-$nvver-pkg0.run)
sha1sums=($sha1)

# There is a "bug" in Linux kernel >= 2.6.11, you can read about this here: 
# http://www.nvnews.net/vbulletin/showthread.php?s=7e1693908c1f4132be653c1715ae3d53&t=57990
# This is a workaround, maybe will be corrected in 2.6.14
#[ "$CARCH" == "x86_64" ] && source=(${source[@]} NVIDIA_kernel-1.0-7676-1386866.diff.txt) && sha1sums=(${sha1sums[@]} 81eb27d8cb5f81aef81cebe12eee5d188cb5e3b8)

install=$pkgname.install

build() {  
	cd $startdir/src/
	chmod +x NVIDIA-Linux-$jarch-$nvver-pkg0.run
	
	mkdir -p $startdir/pkg/tmp/.$pkgname
	chmod 1777 $startdir/pkg/tmp
	cp NVIDIA-Linux-$jarch-$nvver-pkg0.run $startdir/pkg/tmp/.$pkgname/

	# Remove this line (and from nvidia.install) if kernel will upgrade to 2.6.14
#	[ "$CARCH" == "x86_64" ] && cp NVIDIA_kernel-1.0-7676-1386866.diff.txt $startdir/pkg/tmp/.$pkgname/
}

# vim: ft=sh
