# Last Modified: Tue, 21 Feb 2006 09:06:59 +0100
# Compiling Time: 6.34 SBU
# Maintainer: Christian Hamar alias krix <krics@linuxforum.hu>

pkgname=xgl
pkgver=20060220
mesaver=20060220
mesaname=Mesa-cvs
pkgrel=1
pkgdesc="OpenGL accelerated X server"
url="http://www.freedesktop.org/Software/Xgl"
groups=('x11-extra')
archs=('x86_64')
depends=('glitz>=0.5.3' 'libxfont' 'libxdmcp' 'libxau' 'mesa-cvs' 'libxrandr' 'libxrender')
makedepends=('randrproto' 'renderproto' 'fixesproto' 'damageproto' 'xextproto' 'xproto' 'xf86dgaproto' 'xf86miscproto' 'xf86rushproto' 'xf86vidmodeproto' 'xf86bigfontproto' 'compositeproto' 'recordproto' 'resourceproto' 'videoproto' 'scrnsaverproto' 'evieext' 'trapproto' 'xineramaproto' 'fontsproto' 'kbproto' 'inputproto' 'bigreqsproto' 'xcmiscproto' 'xf86driproto' 'libdrm' 'printproto' 'mkfontdir' 'mkfontscale' 'fontcacheproto' \
    'sgml-common' 'util-macros' 'glproto' 'libxkbfile' 'xorg-cf-files' 'libxxf86misc' 'libxkbui' 'libxaw' 'libxpm')
up2date=$pkgver
source=(http://frugalware.org/~krix/CVS/$pkgname-$pkgver.tar.bz2 \
	http://frugalware.org/~krix/CVS/$mesaname-$mesaver.tar.bz2 \
	01-kernel-headers-fix.patch \
	02-access_c_skip_null_addresses.patch \
	03-black-background.patch \
	xgl-slang-library-noise.diff \
	autogen-no-run-configure.patch)
sha1sums=('f43f29fffb17298c4350fc126b42d537f477077d' \
	  '44266d7eda07b824cf02b24dec90a9f00ea14e7b' \
	  'f31702e0029b2d68018598e73ed55c4d6c58367b' \
	  '859b98a4049400be152032fc09ceff2afe9e6dcf' \
	  '863ad92892785c3785b122bf54d0def4d4d2732c' \
	  '1e509e700f29cad75fecffbec1c19787cbdbf712' \
	  '9080a863743aa22710edb4ca5e5552b48db00e6f')

build() {
	cd $Fsrcdir/$pkgname-$pkgver || Fdie
	Fpatch 01-kernel-headers-fix.patch
	Fpatch 02-access_c_skip_null_addresses.patch
	Fpatch 03-black-background.patch
	Fpatch xgl-slang-library-noise.diff
	Fpatch autogen-no-run-configure.patch

	./autogen.sh || Fdie

	Fmake --disable-static \
		--enable-ipv6 \
		--sysconfdir=/etc/X11 \
		--localstatedir=/var \
		--with-xkb-output=/var/lib/xkb \
		--enable-multibuffer \
		--with-mesa-source=$Fsrcdir/$mesaname-$mesaver \
		--with-vendor-web="http://www.frugalware.org" \
		--with-os-name="Linux" \
		--with-os-vendor="Frugalware" \
		--enable-glx \
		--enable-dri \
		--enable-xgl \
		--enable-xglx \
		--enable-xkb \
		--disable-xprint \
		--disable-xorg \
		--disable-xvfb \
		--disable-xnest \
		--disable-dmx
	Fmakeinstall

	# conflicts with xorg-server
	Frm usr/share/aclocal/xorg-server.m4
	Frm usr/lib/xserver/SecurityPolicy
	Frm usr/lib/pkgconfig/xorg-server.pc
	Frm usr/man/man1/Xserver.1x*
	Frm var/lib/xkb/README.compiled

	find $Fdestdir -name '*.la' -exec rm {} \;
}

# optimalization OK
