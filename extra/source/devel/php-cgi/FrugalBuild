# Last Modified: Sun, 07 May 2006 01:08:54 +0200
# Compiling Time: 3.39 SBU
# Maintainer: VMiklos <vmiklos@frugalware.org>
# Contributor: Priyank M.G <priyankmg@gmail.com>

pkgname=php-cgi
pkgver=5.1.4
pkgrel=1
pkgdesc="cgi binary for php and its libs"
url="http://www.php.net"
depends=('php' 'libxslt' 'gdbm' 'curl' 'libxml2' 'imap')
archs=('i686' 'x86_64')
groups=('devel-extra')
makedepends=('apache' 'mysql' 'bzip2' 'gd' 'unixodbc' 'mta' 'sqlite3')
up2date="lynx --dump http://www.php.net/downloads.php|grep 'Complete
Source Code' -3|sed -n 's/.*P \(.*\)/\1/;2 p'" 
source=(http://www.php.net/distributions/php-$pkgver.tar.gz \
	README.Frugalware)

build() {
	
    Fmkdir /usr/lib/php
    Fcd php-$pkgver
    Fmake --prefix=/usr --enable-fastcgi --enable-cgi \
    --enable-discard-path --enable-force-cgi-redirect \
    --sysconfdir=/etc --with-layout=PHP \
    --with-ttf --enable-mailparse --with-config-file-scan-dir=/etc \
    --enable-bcmath=shared --enable-calendar=shared --enable-ftp=shared \
    --enable-gd-native-ttf --enable-magic-quotes --enable-posix=shared \
    --enable-session --enable-shared --enable-shmop=shared --enable-pdo=static \
    --enable-sockets=shared --enable-xml\
    --enable-sysvsem=shared --enable-sysvshm=shared --enable-sysvmsg=shared \
    --enable-track-vars --enable-trans-sid --enable-safe-mode \
    --with-imap --with-imap-ssl --with-ncurses --with-readline \
    --with-bz2=shared --with-curl --with-mime-magic \
    --with-freetype-dir=/usr --with-gd=shared --enable-exif --with-jpeg-dir=/usr \
    --enable-dba --without-db2 --without-db3 --with-inifile --with-flatfile \
    --with-gdbm  --with-openssl --with-gettext \
    --with-unixODBC=shared,/usr --with-pdo-odbc=shared,unixODBC,/usr \
    --with-mysqli=shared --with-mysql-sock=/tmp/mysql.sock \
    --with-pdo-mysql=shared,/usr --with-mysql=shared,/usr \
    --with-pear=/usr/share/pear --with-dom --with-dom-xslt --with-xsl \
    --with-png-dir=/usr --with-regex=php --with-zlib \
    --enable-mbstring=all --enable-mbregex

  # fixes a build error in sqlite support
  ln -s main/php_config.h ./config.h

  make INSTALL_ROOT=$Fdestdir EXTENSION_DIR=`php-config --extension-dir` install || return 1

  # Cleanup unwanted stuff
  Fcd $Fdestdir
  Frm etc ./{.registry,.channels,.depdb*,.lock,.file*} usr/{include,share,lib,man}
  Frm usr/bin/{phpize,php-config,pecl,pear*}

  Fmv usr/bin/php usr/bin/php-cgi

  Fdoc README.Frugalware
}

# optimization OK

sha1sums=('a44c06d5954b29a6e33d3c803a78765d8fc6e993' \
	  'c080133b017d5d6f50511e19d7590dc2600ac51a')
