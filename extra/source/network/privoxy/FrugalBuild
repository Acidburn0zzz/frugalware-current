# Last Modified: Sat, 24 Sep 2005 13:42:50 +0200
# Compiling Time: 0.18 SBU
# Maintainer: BMH1980 <bmh1980de@yahoo.de>

pkgname=privoxy
pkgver=3.0.3_2
realver=`echo $pkgver | tr _ -`
pkgrel=1
pkgdesc="Privoxy is a web proxy with advanced filtering capabilities."
url="http://www.privoxy.org/"
license="GPL2"
install=$pkgname.install
up2date="lynx -dump 'http://sourceforge.net/project/showfiles.php?group_id=11118&package_id=10571'|grep 'privoxy-.*src.tar.gz'|grep -o '[0-9][0-9\.\-]\+-stable'|sed 's|-stable||'|sort|tail -n 1|tr - _"
source=(http://dl.sourceforge.net/sourceforge/ijbswa/$pkgname-$realver-stable.src.tar.gz \
        rc.$pkgname)
sha1sums=('cb4416bf38cc552b2658cf4ed405fb3a02fde9bb' \
          '69236527d57be2d8dec3e0d64728bc1d20acd2f0')
groups=('network-extra')
archs=('i686')
depends=('glibc')
backup=(etc/privoxy/config etc/privoxy/{default,standard,user}.action \
        etc/privoxy/default.filter etc/privoxy/trust)

build()
{
	Fcd $pkgname-`echo $pkgver | cut -d _ -f 1`-stable
	autoheader || return 1
	autoconf || return 1
	Fmake --sysconfdir=/etc/$pkgname --disable-dynamic-pcre
	# Installing executable and man page
	Fexerel /usr/sbin/$pkgname
	Ffilerel /usr/man/man1/$pkgname.1
	# Installing config files
	Ffilerel /etc/privoxy/config
	Fsed "confdir ." "confdir /etc/privoxy" $Fdestdir/etc/privoxy/config
	Fsed "logdir ." "logdir /var/log/privoxy" $Fdestdir/etc/privoxy/config
	Ffilerel *.{action,filter} /etc/privoxy/
	Ffilerel /etc/privoxy/trust
	Ffilerel templates/* /etc/privoxy/templates/
	# Installing log directory
	Fmkdir /var/log/privoxy
	touch $Fdestdir/var/log/privoxy/{logfile,jarfile}
	chown -R privoxy:privoxy $Fdestdir/var/log/privoxy
	# Installing documentation
	Ffilerel doc/webserver/developer-manual/* \
		/usr/share/doc/$pkgname-$pkgver/developer-manual/
	Ffilerel doc/webserver/faq/* /usr/share/doc/$pkgname-$pkgver/faq/
	Ffilerel doc/webserver/images/* /usr/share/doc/$pkgname-$pkgver/images/
	Ffilerel doc/webserver/man-page/privoxy-man-page.html \
		/usr/share/doc/$pkgname-$pkgver/man-page/privoxy-man-page.html
	Ffilerel doc/webserver/user-manual/* \
	/usr/share/doc/$pkgname-$pkgver/user-manual/
	Ffilerel doc/webserver/index.html /usr/share/doc/$pkgname-$pkgver/
	# Remove unneded directories
	Frm /var/run
	# Create rc.d environment
	Frcd
}

# vim: ft=sh

# optimalization OK
