# Last Modified: Wed, 27 Jul 2005 20:08:37 +0200
# Compiling Time: ~0.08 SBU
# Maintainer: BMH1980 <bmh1980de@yahoo.de>

pkgname=hpoj
pkgver=0.91
pkgrel=1
pkgdesc="HP OfficeJet Linux driver"
url="http://hpoj.sourceforge.net/"
license="GPL"
install=$pkgname.install
up2date="lynx -dump $url/download.shtml | grep -m 1 'hpoj.*.tgz' | cut -d - -f 2 | sed 's|.tgz||'"
source=(http://dl.sourceforge.net/sourceforge/$pkgname/$pkgname-$pkgver.tgz \
	$pkgname-$pkgver-gcc4.patch $pkgname-$pkgver-kernel26.patch \
	$pkgname-optflags.patch)
md5sums=('0e083aeab9b00495aa433fa9465456e0' '347bb155c5dde443a93d92d8e64579a2'\
         '18481d3dcf6e9cadf0a3d196ee164e37' '0db22a132b7d7c5dc7c21a5ca7fe9f8f')
groups=('lib-extra')
archs=('i686')
depends=('qt' 'libusb')

build()
{
	Fpatchall
	Fmake
	# <Some ugly fixes>
	Fsed "prefix=" "prefix=\${DESTDIR}" Makefile
	Fsed "exec_prefix=\${DESTDIR}" "exec_prefix=" Makefile
	Fsed "CUPS_BACKEND_DIR=" "CUPS_BACKEND_DIR=\${DESTDIR}" Makefile
	Fsed "SANE_BACKEND_DIR=" "SANE_BACKEND_DIR=\${DESTDIR}" Makefile
	Fsed "SANE_ETC_DIR=" "SANE_ETC_DIR=\${DESTDIR}" Makefile
	Fsed ">/etc/profile.d/hpoj.sh" "> /dev/null" Makefile
	Fsed ">/etc/profile.d/hpoj.csh" "> /dev/null" Makefile
	sed -i '/chmod +x \/etc\/profile.d\/hpoj.sh \/etc\/profile.d\/hpoj.csh ; \\/ d' Makefile || return 1
	sed -i '/echo hpoj >>$(SANE_ETC_DIR)\/dll.conf ; \\/ d' Makefile || return 1
	sed -i '/ldconfig ; \\/ d' Makefile || return 1
	sed -i '/echo $(libdir) >>\/etc\/ld.so.conf ; \\/ d' Makefile || return 1
	# </Some ugly fixes>
	Fmkdir /etc/{profile,rc}.d /usr/lib/{cups/backend,sane}
	Fmakeinstall
	echo "export PATH=/usr/bin:/usr/sbin:\$$PATH" > \
		$Fdestdir/etc/profile.d/$pkgname.sh || return 1
	echo "setenv PATH /usr/bin:/usr/sbin:\$$PATH" > \
		$Fdestdir/etc/profile.d/$pkgname.csh || return 1
	chmod +x $Fdestdir/etc/profile.d/$pkgname.[c]sh || return 1
	Fln /usr/sbin/ptal-init /etc/rc.d/rc.ptal
	Fln /usr/sbin/ptal-cups /usr/lib/cups/backend/ptal
	Fln /usr/lib/libsane-hpoj.so /usr/lib/sane/libsane-hpoj.so.1
	Fmv /usr/share/doc/$pkgname /usr/share/doc/$pkgname-$pkgver
}

# vim: ft=sh

# optimalization OK
