NOEXTRACT=1 # important, src not tared as a single directory 

# Last Modified: Thu, 17 Mar 2005 14:51:51 +0100
# Compiling Time: ~2 SBU
# Maintainer: Zsolt Szalai <xbit.lists@chello.hu>
# Category: xapps-extra

pkgname=tetex
pkgver=3.0
pkgrel=6
pkgdesc="teTeX is a complete TeX distribution for UNIX compatible systems - base files, librarys, fonts"
url="http://www.tug.org/teTeX/"
depends=('glibc' 'freetype2' 'x' 'fontconfig' 'expat' 'lesstif' 'zlib' 'gcc' 'libpng')
makedepends=('bison' 'flex' 'ncurses' 'zlib' 'libpng' 'x')
groups=('xapps-extra')
archs=('i686')
up2date="lynx --dump 'ftp://dante.ctan.org/tex-archive/systems/unix/teTeX/current/distrib/'|grep \"tar.gz\" |sed -e 's/.*tetex-src-\(.*\).tar.*/\1/;q'"
source=(ftp://dante.ctan.org/tex-archive/systems/unix/teTeX/current/distrib/tetex-texmf-$pkgver.tar.gz ftp://dante.ctan.org/tex-archive/systems/unix/teTeX/current/distrib/tetex-src-$pkgver.tar.gz)
md5sums=('11aa15c8d3e28ee7815e0d5fcdf43fd4' '944a4641e79e61043fdaf8f38ecbb4b3')
install=tetex.install
backup=('/usr/share/texmf/web2c/texmf.cnf')
removes=('/usr/share/texmf/web2c/latex.fmt' '/usr/share/texmf/web2c/latex.log')
replaces=('tetex-base' 'tetex-bin')
conflicts=('tetex-base' 'tetex-bin')
provides=('tetex-base' 'tetex-bin')

build() {
	cd $startdir/src
	mkdir texmf
	tar xzf tetex-texmf-$pkgver.tar.gz -C ./texmf
	rm -f $startdir/src/tetex-texmf-$pkgver.tar.gz
	install -d $startdir/pkg/usr/share/texmf
	cd texmf
	mv doc/latex/general/lshort.pdf $startdir/src/
	rm -rf doc/*
	echo "The contents of the doc directory is removed to tetex-docs package, what is availabe in xbit's repository: http://wiki.frugalware.org/index.php/DRs" >doc/README.frugalware
	mv $startdir/src/lshort.pdf doc/
	mv `ls` $startdir/pkg/usr/share/texmf
	cd ..
	rmdir texmf
	
###SRC

	tar xzf tetex-src-$pkgver.tar.gz
	cd tetex-src-$pkgver
	./configure --prefix=/usr --sysconfdir=/etc --disable-multiplatform --datadir=/usr/share --without-texinfo --without-dialog --without-texi2html --with-x --enable-ipc --with-system-zlib --with-system-pnglib --with-system-ncurses
	make all texmf=$startdir/pkg/usr/share/texmf || return 1

	mv $startdir/pkg/usr/share/texmf/ls-R $startdir/pkg/usr/share/texmf/ls-R.tetex-texmf.orig

	make install prefix=$startdir/pkg/usr texmf=$startdir/pkg/usr/share/texmf

	mv $startdir/pkg/usr/share/texmf/ls-R $startdir/pkg/usr/share/texmf/ls-R.tetex-bin.orig
	
	#cp $startdir/src/haltp.tex $startdir/pkg/usr/share/texmf/doc
	rm $startdir/pkg/usr/info/dir
}
