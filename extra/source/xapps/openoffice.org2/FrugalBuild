# Last modified: Wed, 26 Oct 2005 14:09:54 +0200
# Compiling time: 92.07 SBU
# Maintainer: Christian Hamar alias krix <krics@linuxforum.hu>

pkgname=openoffice.org
pkgver=2.0.0
pkgrel=1
pkgdesc="OpenOffice.org, a full office productivity suite (Version 2)"
url="http://ooo.ximian.com/"
depends=('db>=4.3' 'perl' 'gtk+2' 'gnome-vfs' 'libxml2' 'libart_lgpl' \
	'startup-notification' 'fontconfig' 'libpng' 'imagemagick' 'flex' \
	'bison' 'zip' 'unzip' 'expat' 'cups' 'desktop-file-utils')
makedepends=('findutils' 'curl' 'intltool' 'tcsh' 'gcc' 'pam-headers' 'qt' \
	'kdelibs' 'evolution-data-server' 'boost' 'icu' 'hunspell')
groups=('xapps-extra')
archs=('i686')
install=$pkgname.install
up2date="lynx -dump 'http://ooo.ximian.com/packages/OOO680/?C=M;O=D'|grep tar.gz$|sed -n 's/.*-\(.*\)\.t.*/\1/;1 p'"
source=(http://ooo.ximian.com/packages/OOO680/ooo-build-$pkgver.tar.gz \
	http://go-ooo.org/packages/OOO680/OOO_2_0_0-core.tar.bz2 \
	http://go-ooo.org/packages/OOO680/OOO_2_0_0-system.tar.bz2 \
	http://go-ooo.org/packages/OOO680/OOO_2_0_0-lang.tar.bz2 \
	http://go-ooo.org/packages/SRC680/ooo_crystal_images-6.tar.bz2 \
	http://go-ooo.org/packages/SRC680/ooo_custom_images-13.tar.bz2 \
	http://go-ooo.org/packages/SRC680/extras-2.tar.bz2 \
	ooo2-allfixes.patch \
	03-64bit-cws-patch-update.patch \
	ooo.applications \
	ooo.keys \
	Filter.xcu.bz2)
NOEXTRACT=1
sha1sums=('d8b662156121496f9b768d34110fa5f9a7ac0f3e' \
	  'a4cc244164deb831356f609fa967f8d14df6116a' \
	  'e1fcccc53ac719ed5189a556547dbf3236ab6405' \
	  '7b2a1943da8cd5a3c39b5d883345c2d65c578d10' \
	  '99ee34dcba96e27296daf159ab2f48c6c2f0364a' \
	  '215cbf28c87a391e15ba9580e8201389ea8b92e4' \
	  '2c7fca93c106e23961f4aaa7cdfcaeb97064eed1' \
	  'bca2b52c90b50298777a687b4dedc895520649ea' \
	  'f744cdc0088f3a0ead46ee51557c40c897ed39f5' \
	  'fdb8d5b9869e6363fe92d24cd4427f9e8e1cbcc2' \
	  'e31a1b937707007b90731e809ab8947429d645be' \
	  '2ca067f9d6ae3b5c0d2434eb3bc343bef966cb77')
nobuild=1

build() {
	# Untar the ooo-build stuff
	tar -xvzf ooo-build-$pkgver.tar.gz || return 1

	# Note: Requires a running X server for building.
	# Move downloaded tarballs to the correct location. With this
	# ooo-build won't download the tarballs again.
	mv OOO_2_0_0-core.tar.bz2 ooo-build-$pkgver/src
	mv OOO_2_0_0-system.tar.bz2 ooo-build-$pkgver/src
	mv OOO_2_0_0-lang.tar.bz2 ooo-build-$pkgver/src
	mv ooo_crystal_images-6.tar.bz2 ooo-build-$pkgver/src
	mv ooo_custom_images-13.tar.bz2 ooo-build-$pkgver/src
	mv extras-2.tar.bz2 ooo-build-$pkgver/src

	Fcd ooo-build-$pkgver

	Fpatch ooo2-allfixes.patch
#	[ "$CARCH" == "x86_64" ] && Fpatch 03-64bit-cws-patch-update.patch
	
	Fconf --mandir=/usr/man \
		--with-docdir=/usr/share/doc/$pkgname-$pkgver \
		--with-lang="af ar be_BY bg bn br ca cs cy da de el en en_GB en_US es et fi fr ga gu_IN he hi_IN hr hu it ja km ko lt nb ne nl nn ns pa_IN pl pt pt_BR ru sh_YU sk sl sr_CS sv th tn tr vi xh zh_CN zh_TW zu" \
		--enable-libart --enable-libsn \
		--enable-crashdump=yes --without-fonts --disable-rpath \
		--with-system-zlib --enable-fontconfig --with-system-freetype \
		--disable-mozilla --enable-kde --enable-gtk --enable-gnome-vfs \
		--with-icons=gnome --with-distro=Frugalware \
		--with-vendor=Frugalware --with-system-gcc=yes \
		--with-ccache-allowed --with-gcc-speedup=ccache \
		--with-system-db --with-db-version=4.3 \
		--with-system-curl --with-system-sndfile \
		--with-system-odbc-headers \
		--with-system-neon --with-system-boost --with-system-expat \
		--with-system-hunspell --enable-hunspell --enable-symbols \
		--without-binsuffix --enable-cairo --with-system-cairo \
		--enable-xsltproc --with-system-sane-headers \
		--with-java-home=$JAVA_HOME --disable-odk --with-javac \
		|| return 1

	./download || return 1

	make || return 1

	make DESTDIR=$Fdestdir install || return 1

	# Install some miscellaneous files into GNOME's prefix.
	Ffile /usr/share/application-registry/ooo.applications
	Ffile /usr/share/mime-info/ooo.keys

	# Somewhat hacky, workaround for
	# https://bugzilla.novell.com/show_bug.cgi?id=130220
	Ffile /usr/lib/ooo-2.0/share/registry/res/en-US/org/openoffice/TypeDetection/Filter.xcu

	# Fix menu entries' location
	Fmv /opt/gnome/share/applications/ /usr/share/
	Frm /opt

	# Create i18n tarballs.
	mkdir $startdir/openoffice.org-i18n
	cd $Fdestdir/usr/lib/ooo-2.0/program/resource
	for lang in `ls *.res|sed 's/.*680\(.*\)\.res/\1/'|sort|uniq`
	do
		if [ "$lang" != "en-US" ]; then
			tar cvjf openoffice.org-i18n-$lang-$pkgver.tar.bz2 \
				`ls *680$lang.res`
			mv openoffice.org-i18n-$lang-$pkgver.tar.bz2 \
				$startdir/openoffice.org-i18n/
			rm *680$lang.res
		fi
	done
}

# optimalization OK

# vim: ft=sh
