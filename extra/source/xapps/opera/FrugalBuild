# Last Modified: Mon, 28 Nov 2005 22:20:38 +0100
# Compiling Time: ~0.01 SBU
# Contributor: VMiklos <vmiklos@frugalware.org>
# Maintainer: voroskoi <voroskoi@frugalware.org>

pkgname=opera
pkgver=8.51
pkgextraver=-20051114.1-static-qt.i386-en
pkgrel=1
pkgdesc="Opera web browser."
url="http://www.opera.com/linux/"
depends=('qt' 'gcc-lib' 'lesstif')
groups=('xapps-extra')
up2date="lynx -dump ftp://ftp.opera.com/pub/opera/linux/ |grep -wo opera.*[0-9][0-9][0-9] |sort -r | sed -ne 's|.*x/\(.*\)|\1|;s/\([0-9]\)/\1./;1 p'"
source=(ftp://ftp.opera.com/pub/opera/linux/851/final/en/i386/opera-$pkgver$pkgextraver.tar.bz2 \
	$pkgname.desktop)
sha1sums=('0d5ff79293896ae478c4f92fed605711b3cf0693' \
	'cd11a19295ff389988da3b9d96b89329621e1169')
nobuild=1

build()
{
	Fcd
	Fsed 'config_dir="/etc"' "config_dir=\"$Fdestdir/etc/\"" install.sh
	Fsed '/usr/share/applnk' "$Fdestdir/usr/share/applnk" install.sh
	Fsed '/usr/share/pixmaps' "$Fdestdir/usr/share/pixmaps" install.sh
	Fsed '/usr/share/icons' "$Fdestdir/usr/share/icons" install.sh
	Fsed '/etc/X11' "$Fdestdir/etc/X11" install.sh
	Fsed '/usr/share/gnome' "$Fdestdir/usr/share/gnome" install.sh
	Fsed '#\(OPERA_FORCE_JAVA_ENABLED=\)' '\1' install.sh
	Fsed '#\(export LD_PRELOAD OPERA_FORCE_JAVA_ENABLED\)' '\1' install.sh
	Fsed 'read str_answer' 'return 0' install.sh
	Fsed '/opt/kde' "$Fdestdir/usr" install.sh
	Fsed '\(str_localdirplugin=\).*$' '\1/usr/lib/opera/lib/opera/plugins' install.sh

	Fmkdir /etc
	./install.sh --prefix="$Fdestdir"/usr/lib/opera
	Fsed 'LD_PRELOAD="${OPERA_JAVA_DIR}/libawt.so"' \
		'LD_PRELOAD="$LD_PRELOAD"\:"${OPERA_JAVA_DIR}/libawt.so"' \
		$Fdestdir/usr/lib/opera/bin/opera
	Fsed "$Fdestdir" "" $Fdestdir/usr/lib/opera/bin/opera
	Fsed "$Fdestdir" "" $Fdestdir/usr/lib/opera/share/opera/java/opera.policy
	Ffilerel images/opera.xpm /usr/share/pixmaps/
	Ffile /usr/share/applications/opera.desktop
	Fln ../lib/opera/bin/opera /usr/bin/opera
	echo "Plugin Path=/usr/lib/opera/lib/opera/plugins" >> \
		$Fdestdir/etc/opera6rc
}

# vim: ft=sh
