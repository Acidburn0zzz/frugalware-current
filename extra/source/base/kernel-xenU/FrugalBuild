# Last Modified: Sat, 14 Jan 2006 15:51:36 +0000
# Compiling Time: 8.02 SBU
# Maintainer: alex_extreme <alex.extreme2@gmail.com>

pkgname=kernel-xenU
pkgver=2.6.12
pkgrel=1
pkgdesc="Unprivelaged Xen virtual machine kernel"
url="http://www.cl.cam.ac.uk/Research/SRG/netos/xen/"
depends=('xen' 'module-init-tools')
groups=('base-extra')
archs=('i686')
up2date="lynx -dump http://www.kernel.org/kdist/finger_banner |sed -n 's/.* \([0-9]*\.[0-9]*\.[0-9]*\).*/\1/;1 p'"
# We use the xen0 tree because it's exactly the same
source=(http://www.tuxtalk.org/files/kernel-xen0-tree-$pkgver.tar.bz2 \
	config)

sha1sums=('75888d50d16a6a25545f151a41c3dc3081fc4dc7' \
          'f73f9eecd5fd72a66c3af18be64d03da9ae3da03')

build()
{
	Fcd xen-unstable/linux-$pkgver-xen0
	
	cp $Fsrcdir/config .config
	yes "" | make ARCH=xen config
	Fsed "EXTRAVERSION =.*" "EXTRAVERSION = -fw$pkgrel-xenU" Makefile
	
	make ARCH=xen || return 1
	
	make INSTALL_MOD_PATH=$Fdestdir ARCH=xen modules_install || return 1
	
	Fmkdir /boot
	Ffilerel .config /boot/config-$pkgver-fw$pkgrel-xenU
	Ffilerel vmlinuz \
		/boot/vmlinuz-$pkgver-fw$pkgrel-xenU
	Fmkdir /lib/modules
	make INSTALL_MOD_PATH=$Fdestdir ARCH=xen modules_install
	Ffilerel System.map /boot/System.map-$pkgver-fw$pkgrel-xenU
	Frm /lib/modules/$pkgver-fw$pkgrel-xenU/build
	Frm /lib/modules/$pkgver-fw$pkgrel-xenU/source
}

# vim: ft=sh

# optimalization OK
