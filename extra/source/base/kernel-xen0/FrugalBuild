# Last Modified: Sat, 14 Jan 2006 18:39:31 +0100
# Compiling Time: 8.02 SBU
# Maintainer: alex_extreme <alex.extreme2@gmail.com>

pkgname=kernel-xen0
pkgver=2.6.12
pkgrel=1
pkgdesc="Privelaged Xen virtual machine kernel"
url="http://www.cl.cam.ac.uk/Research/SRG/netos/xen/"
depends=('xen' 'module-init-tools')
groups=('base-extra')
archs=('i686')
up2date="lynx -dump http://www.kernel.org/kdist/finger_banner |sed -n 's/.* \([0-9]*\.[0-9]*\.[0-9]*\).*/\1/;1 p'"
source=(http://www.tuxtalk.org/files/$pkgname-tree-$pkgver.tar.bz2 \
	config \
	README.Frugalware)

sha1sums=('75888d50d16a6a25545f151a41c3dc3081fc4dc7' \
          'd7c26fd4ccfae4c5ee8c1c80c104f3963c09c09e' \
	  'c51dc373efec3d80a72d6bb3a2a2aa7bb30ed3b6')

build()
{
	Fcd xen-unstable/linux-$pkgver-xen0
	
	cp $Fsrcdir/config .config
	yes "" | make ARCH=xen config
	Fsed "EXTRAVERSION =.*" "EXTRAVERSION = -fw$pkgrel-xen0" Makefile
	
	make ARCH=xen || return 1
	
	make INSTALL_MOD_PATH=$Fdestdir ARCH=xen modules_install || return 1
	
	Fmkdir /boot
	Ffilerel .config /boot/config-$pkgver-fw$pkgrel-xen0
	Ffilerel vmlinuz \
		/boot/vmlinuz-$pkgver-fw$pkgrel-xen0
	Fmkdir /lib/modules
	make INSTALL_MOD_PATH=$Fdestdir ARCH=xen modules_install
	Ffilerel System.map /boot/System.map-$pkgver-fw$pkgrel-xen0
	Frm /lib/modules/$pkgver-fw$pkgrel-xen0/build
	Frm /lib/modules/$pkgver-fw$pkgrel-xen0/source
	Fdoc README.Frugalware
}

# vim: ft=sh

# optimalization OK
